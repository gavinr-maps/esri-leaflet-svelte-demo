(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))D(R);new MutationObserver(R=>{for(const J of R)if(J.type==="childList")for(const lt of J.addedNodes)lt.tagName==="LINK"&&lt.rel==="modulepreload"&&D(lt)}).observe(document,{childList:!0,subtree:!0});function S(R){const J={};return R.integrity&&(J.integrity=R.integrity),R.referrerPolicy&&(J.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?J.credentials="include":R.crossOrigin==="anonymous"?J.credentials="omit":J.credentials="same-origin",J}function D(R){if(R.ep)return;R.ep=!0;const J=S(R);fetch(R.href,J)}})();function Lo(){}function Tu(g){return g()}function _u(){return Object.create(null)}function Ul(g){g.forEach(Tu)}function Oh(g){return typeof g=="function"}function Su(g,x){return g!=g?x==x:g!==x||g&&typeof g=="object"||typeof g=="function"}function Vp(g){return Object.keys(g).length===0}function Gp(g){return g&&Oh(g.destroy)?g.destroy:Lo}function Iu(g,x,S){g.insertBefore(x,S||null)}function Fh(g){g.parentNode&&g.parentNode.removeChild(g)}function Eu(g){return document.createElement(g)}function Pu(g,x,S){S==null?g.removeAttribute(x):g.getAttribute(x)!==S&&g.setAttribute(x,S)}function qp(g){return Array.from(g.childNodes)}let Uh;function sl(g){Uh=g}const Ca=[],gu=[],Dl=[],yu=[],$p=Promise.resolve();let Mh=!1;function jp(){Mh||(Mh=!0,$p.then(Au))}function zh(g){Dl.push(g)}const Ah=new Set;let Aa=0;function Au(){if(Aa!==0)return;const g=Uh;do{try{for(;Aa<Ca.length;){const x=Ca[Aa];Aa++,sl(x),Wp(x.$$)}}catch(x){throw Ca.length=0,Aa=0,x}for(sl(null),Ca.length=0,Aa=0;gu.length;)gu.pop()();for(let x=0;x<Dl.length;x+=1){const S=Dl[x];Ah.has(S)||(Ah.add(S),S())}Dl.length=0}while(Ca.length);for(;yu.length;)yu.pop()();Mh=!1,Ah.clear(),sl(g)}function Wp(g){if(g.fragment!==null){g.update(),Ul(g.before_update);const x=g.dirty;g.dirty=[-1],g.fragment&&g.fragment.p(g.ctx,x),g.after_update.forEach(zh)}}const Bl=new Set;let Hp;function Cu(g,x){g&&g.i&&(Bl.delete(g),g.i(x))}function Xp(g,x,S,D){if(g&&g.o){if(Bl.has(g))return;Bl.add(g),Hp.c.push(()=>{Bl.delete(g),D&&(S&&g.d(1),D())}),g.o(x)}else D&&D()}function Kp(g){g&&g.c()}function Mu(g,x,S,D){const{fragment:R,after_update:J}=g.$$;R&&R.m(x,S),D||zh(()=>{const lt=g.$$.on_mount.map(Tu).filter(Oh);g.$$.on_destroy?g.$$.on_destroy.push(...lt):Ul(lt),g.$$.on_mount=[]}),J.forEach(zh)}function zu(g,x){const S=g.$$;S.fragment!==null&&(Ul(S.on_destroy),S.fragment&&S.fragment.d(x),S.on_destroy=S.fragment=null,S.ctx=[])}function Jp(g,x){g.$$.dirty[0]===-1&&(Ca.push(g),jp(),g.$$.dirty.fill(0)),g.$$.dirty[x/31|0]|=1<<x%31}function Lu(g,x,S,D,R,J,lt,h=[-1]){const Pt=Uh;sl(g);const ee=g.$$={fragment:null,ctx:[],props:J,update:Lo,not_equal:R,bound:_u(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(x.context||(Pt?Pt.$$.context:[])),callbacks:_u(),dirty:h,skip_bound:!1,root:x.target||Pt.$$.root};lt&&lt(ee.root);let Se=!1;if(ee.ctx=S?S(g,x.props||{},(Gt,ft,...ci)=>{const $e=ci.length?ci[0]:ft;return ee.ctx&&R(ee.ctx[Gt],ee.ctx[Gt]=$e)&&(!ee.skip_bound&&ee.bound[Gt]&&ee.bound[Gt]($e),Se&&Jp(g,Gt)),ft}):[],ee.update(),Se=!0,Ul(ee.before_update),ee.fragment=D?D(ee.ctx):!1,x.target){if(x.hydrate){const Gt=qp(x.target);ee.fragment&&ee.fragment.l(Gt),Gt.forEach(Fh)}else ee.fragment&&ee.fragment.c();x.intro&&Cu(g.$$.fragment),Mu(g,x.target,x.anchor,x.customElement),Au()}sl(Pt)}class ku{$destroy(){zu(this,1),this.$destroy=Lo}$on(x,S){if(!Oh(S))return Lo;const D=this.$$.callbacks[x]||(this.$$.callbacks[x]=[]);return D.push(S),()=>{const R=D.indexOf(S);R!==-1&&D.splice(R,1)}}$set(x){this.$$set&&!Vp(x)&&(this.$$.skip_bound=!0,this.$$set(x),this.$$.skip_bound=!1)}}var Du=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},gt={},Yp={get exports(){return gt},set exports(g){gt=g}};/* @preserve
 * Leaflet 1.9.3, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2022 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(g,x){(function(S,D){D(x)})(Du,function(S){var D="1.9.3";function R(r){var l,_,b,A;for(_=1,b=arguments.length;_<b;_++){A=arguments[_];for(l in A)r[l]=A[l]}return r}var J=Object.create||function(){function r(){}return function(l){return r.prototype=l,new r}}();function lt(r,l){var _=Array.prototype.slice;if(r.bind)return r.bind.apply(r,_.call(arguments,1));var b=_.call(arguments,2);return function(){return r.apply(l,b.length?b.concat(_.call(arguments)):arguments)}}var h=0;function Pt(r){return"_leaflet_id"in r||(r._leaflet_id=++h),r._leaflet_id}function ee(r,l,_){var b,A,U,et;return et=function(){b=!1,A&&(U.apply(_,A),A=!1)},U=function(){b?A=arguments:(r.apply(_,arguments),setTimeout(et,l),b=!0)},U}function Se(r,l,_){var b=l[1],A=l[0],U=b-A;return r===b&&_?r:((r-A)%U+U)%U+A}function Gt(){return!1}function ft(r,l){if(l===!1)return r;var _=Math.pow(10,l===void 0?6:l);return Math.round(r*_)/_}function ci(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function $e(r){return ci(r).split(/\s+/)}function ce(r,l){Object.prototype.hasOwnProperty.call(r,"options")||(r.options=r.options?J(r.options):{});for(var _ in l)r.options[_]=l[_];return r.options}function Or(r,l,_){var b=[];for(var A in r)b.push(encodeURIComponent(_?A.toUpperCase():A)+"="+encodeURIComponent(r[A]));return(!l||l.indexOf("?")===-1?"?":"&")+b.join("&")}var Fr=/\{ *([\w_ -]+) *\}/g;function mn(r,l){return r.replace(Fr,function(_,b){var A=l[b];if(A===void 0)throw new Error("No value provided for variable "+_);return typeof A=="function"&&(A=A(l)),A})}var ii=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function Ur(r,l){for(var _=0;_<r.length;_++)if(r[_]===l)return _;return-1}var ni="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _n(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}var Qn=0;function rn(r){var l=+new Date,_=Math.max(0,16-(l-Qn));return Qn=l+_,window.setTimeout(r,_)}var cs=window.requestAnimationFrame||_n("RequestAnimationFrame")||rn,On=window.cancelAnimationFrame||_n("CancelAnimationFrame")||_n("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function ui(r,l,_){if(_&&cs===rn)r.call(l);else return cs.call(window,lt(r,l))}function di(r){r&&On.call(window,r)}var us={__proto__:null,extend:R,create:J,bind:lt,get lastId(){return h},stamp:Pt,throttle:ee,wrapNum:Se,falseFn:Gt,formatNum:ft,trim:ci,splitWords:$e,setOptions:ce,getParamString:Or,template:mn,isArray:ii,indexOf:Ur,emptyImageUrl:ni,requestFn:cs,cancelFn:On,requestAnimFrame:ui,cancelAnimFrame:di};function Ci(){}Ci.extend=function(r){var l=function(){ce(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},_=l.__super__=this.prototype,b=J(_);b.constructor=l,l.prototype=b;for(var A in this)Object.prototype.hasOwnProperty.call(this,A)&&A!=="prototype"&&A!=="__super__"&&(l[A]=this[A]);return r.statics&&R(l,r.statics),r.includes&&(gr(r.includes),R.apply(null,[b].concat(r.includes))),R(b,r),delete b.statics,delete b.includes,b.options&&(b.options=_.options?J(_.options):{},R(b.options,r.options)),b._initHooks=[],b.callInitHooks=function(){if(!this._initHooksCalled){_.callInitHooks&&_.callInitHooks.call(this),this._initHooksCalled=!0;for(var U=0,et=b._initHooks.length;U<et;U++)b._initHooks[U].call(this)}},l},Ci.include=function(r){var l=this.prototype.options;return R(this.prototype,r),r.options&&(this.prototype.options=l,this.mergeOptions(r.options)),this},Ci.mergeOptions=function(r){return R(this.prototype.options,r),this},Ci.addInitHook=function(r){var l=Array.prototype.slice.call(arguments,1),_=typeof r=="function"?r:function(){this[r].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(_),this};function gr(r){if(!(typeof L>"u"||!L||!L.Mixin)){r=ii(r)?r:[r];for(var l=0;l<r.length;l++)r[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Jt={on:function(r,l,_){if(typeof r=="object")for(var b in r)this._on(b,r[b],l);else{r=$e(r);for(var A=0,U=r.length;A<U;A++)this._on(r[A],l,_)}return this},off:function(r,l,_){if(!arguments.length)delete this._events;else if(typeof r=="object")for(var b in r)this._off(b,r[b],l);else{r=$e(r);for(var A=arguments.length===1,U=0,et=r.length;U<et;U++)A?this._off(r[U]):this._off(r[U],l,_)}return this},_on:function(r,l,_,b){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(r,l,_)===!1){_===this&&(_=void 0);var A={fn:l,ctx:_};b&&(A.once=!0),this._events=this._events||{},this._events[r]=this._events[r]||[],this._events[r].push(A)}},_off:function(r,l,_){var b,A,U;if(this._events&&(b=this._events[r],!!b)){if(arguments.length===1){if(this._firingCount)for(A=0,U=b.length;A<U;A++)b[A].fn=Gt;delete this._events[r];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var et=this._listens(r,l,_);if(et!==!1){var it=b[et];this._firingCount&&(it.fn=Gt,this._events[r]=b=b.slice()),b.splice(et,1)}}},fire:function(r,l,_){if(!this.listens(r,_))return this;var b=R({},l,{type:r,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var A=this._events[r];if(A){this._firingCount=this._firingCount+1||1;for(var U=0,et=A.length;U<et;U++){var it=A[U],ot=it.fn;it.once&&this.off(r,ot,it.ctx),ot.call(it.ctx||this,b)}this._firingCount--}}return _&&this._propagateEvent(b),this},listens:function(r,l,_,b){typeof r!="string"&&console.warn('"string" type argument expected');var A=l;typeof l!="function"&&(b=!!l,A=void 0,_=void 0);var U=this._events&&this._events[r];if(U&&U.length&&this._listens(r,A,_)!==!1)return!0;if(b){for(var et in this._eventParents)if(this._eventParents[et].listens(r,l,_,b))return!0}return!1},_listens:function(r,l,_){if(!this._events)return!1;var b=this._events[r]||[];if(!l)return!!b.length;_===this&&(_=void 0);for(var A=0,U=b.length;A<U;A++)if(b[A].fn===l&&b[A].ctx===_)return A;return!1},once:function(r,l,_){if(typeof r=="object")for(var b in r)this._on(b,r[b],l,!0);else{r=$e(r);for(var A=0,U=r.length;A<U;A++)this._on(r[A],l,_,!0)}return this},addEventParent:function(r){return this._eventParents=this._eventParents||{},this._eventParents[Pt(r)]=r,this},removeEventParent:function(r){return this._eventParents&&delete this._eventParents[Pt(r)],this},_propagateEvent:function(r){for(var l in this._eventParents)this._eventParents[l].fire(r.type,R({layer:r.target,propagatedFrom:r.target},r),!0)}};Jt.addEventListener=Jt.on,Jt.removeEventListener=Jt.clearAllEventListeners=Jt.off,Jt.addOneTimeEventListener=Jt.once,Jt.fireEvent=Jt.fire,Jt.hasEventListeners=Jt.listens;var sn=Ci.extend(Jt);function ae(r,l,_){this.x=_?Math.round(r):r,this.y=_?Math.round(l):l}var gn=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(r){return this.clone()._add(ne(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(ne(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new ae(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new ae(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=gn(this.x),this.y=gn(this.y),this},distanceTo:function(r){r=ne(r);var l=r.x-this.x,_=r.y-this.y;return Math.sqrt(l*l+_*_)},equals:function(r){return r=ne(r),r.x===this.x&&r.y===this.y},contains:function(r){return r=ne(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+ft(this.x)+", "+ft(this.y)+")"}};function ne(r,l,_){return r instanceof ae?r:ii(r)?new ae(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new ae(r.x,r.y):new ae(r,l,_)}function Ze(r,l){if(r)for(var _=l?[r,l]:r,b=0,A=_.length;b<A;b++)this.extend(_[b])}Ze.prototype={extend:function(r){var l,_;if(!r)return this;if(r instanceof ae||typeof r[0]=="number"||"x"in r)l=_=ne(r);else if(r=gi(r),l=r.min,_=r.max,!l||!_)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=_.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(_.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(_.y,this.max.y)),this},getCenter:function(r){return ne((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return ne(this.min.x,this.max.y)},getTopRight:function(){return ne(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var l,_;return typeof r[0]=="number"||r instanceof ae?r=ne(r):r=gi(r),r instanceof Ze?(l=r.min,_=r.max):l=_=r,l.x>=this.min.x&&_.x<=this.max.x&&l.y>=this.min.y&&_.y<=this.max.y},intersects:function(r){r=gi(r);var l=this.min,_=this.max,b=r.min,A=r.max,U=A.x>=l.x&&b.x<=_.x,et=A.y>=l.y&&b.y<=_.y;return U&&et},overlaps:function(r){r=gi(r);var l=this.min,_=this.max,b=r.min,A=r.max,U=A.x>l.x&&b.x<_.x,et=A.y>l.y&&b.y<_.y;return U&&et},isValid:function(){return!!(this.min&&this.max)},pad:function(r){var l=this.min,_=this.max,b=Math.abs(l.x-_.x)*r,A=Math.abs(l.y-_.y)*r;return gi(ne(l.x-b,l.y-A),ne(_.x+b,_.y+A))},equals:function(r){return r?(r=gi(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight())):!1}};function gi(r,l){return!r||r instanceof Ze?r:new Ze(r,l)}function yi(r,l){if(r)for(var _=l?[r,l]:r,b=0,A=_.length;b<A;b++)this.extend(_[b])}yi.prototype={extend:function(r){var l=this._southWest,_=this._northEast,b,A;if(r instanceof Ie)b=r,A=r;else if(r instanceof yi){if(b=r._southWest,A=r._northEast,!b||!A)return this}else return r?this.extend(De(r)||ri(r)):this;return!l&&!_?(this._southWest=new Ie(b.lat,b.lng),this._northEast=new Ie(A.lat,A.lng)):(l.lat=Math.min(b.lat,l.lat),l.lng=Math.min(b.lng,l.lng),_.lat=Math.max(A.lat,_.lat),_.lng=Math.max(A.lng,_.lng)),this},pad:function(r){var l=this._southWest,_=this._northEast,b=Math.abs(l.lat-_.lat)*r,A=Math.abs(l.lng-_.lng)*r;return new yi(new Ie(l.lat-b,l.lng-A),new Ie(_.lat+b,_.lng+A))},getCenter:function(){return new Ie((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ie(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ie(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){typeof r[0]=="number"||r instanceof Ie||"lat"in r?r=De(r):r=ri(r);var l=this._southWest,_=this._northEast,b,A;return r instanceof yi?(b=r.getSouthWest(),A=r.getNorthEast()):b=A=r,b.lat>=l.lat&&A.lat<=_.lat&&b.lng>=l.lng&&A.lng<=_.lng},intersects:function(r){r=ri(r);var l=this._southWest,_=this._northEast,b=r.getSouthWest(),A=r.getNorthEast(),U=A.lat>=l.lat&&b.lat<=_.lat,et=A.lng>=l.lng&&b.lng<=_.lng;return U&&et},overlaps:function(r){r=ri(r);var l=this._southWest,_=this._northEast,b=r.getSouthWest(),A=r.getNorthEast(),U=A.lat>l.lat&&b.lat<_.lat,et=A.lng>l.lng&&b.lng<_.lng;return U&&et},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,l){return r?(r=ri(r),this._southWest.equals(r.getSouthWest(),l)&&this._northEast.equals(r.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ri(r,l){return r instanceof yi?r:new yi(r,l)}function Ie(r,l,_){if(isNaN(r)||isNaN(l))throw new Error("Invalid LatLng object: ("+r+", "+l+")");this.lat=+r,this.lng=+l,_!==void 0&&(this.alt=+_)}Ie.prototype={equals:function(r,l){if(!r)return!1;r=De(r);var _=Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng));return _<=(l===void 0?1e-9:l)},toString:function(r){return"LatLng("+ft(this.lat,r)+", "+ft(this.lng,r)+")"},distanceTo:function(r){return Ni.distance(this,De(r))},wrap:function(){return Ni.wrapLatLng(this)},toBounds:function(r){var l=180*r/40075017,_=l/Math.cos(Math.PI/180*this.lat);return ri([this.lat-l,this.lng-_],[this.lat+l,this.lng+_])},clone:function(){return new Ie(this.lat,this.lng,this.alt)}};function De(r,l,_){return r instanceof Ie?r:ii(r)&&typeof r[0]!="object"?r.length===3?new Ie(r[0],r[1],r[2]):r.length===2?new Ie(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new Ie(r.lat,"lng"in r?r.lng:r.lon,r.alt):l===void 0?null:new Ie(r,l,_)}var Mi={latLngToPoint:function(r,l){var _=this.projection.project(r),b=this.scale(l);return this.transformation._transform(_,b)},pointToLatLng:function(r,l){var _=this.scale(l),b=this.transformation.untransform(r,_);return this.projection.unproject(b)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var l=this.projection.bounds,_=this.scale(r),b=this.transformation.transform(l.min,_),A=this.transformation.transform(l.max,_);return new Ze(b,A)},infinite:!1,wrapLatLng:function(r){var l=this.wrapLng?Se(r.lng,this.wrapLng,!0):r.lng,_=this.wrapLat?Se(r.lat,this.wrapLat,!0):r.lat,b=r.alt;return new Ie(_,l,b)},wrapLatLngBounds:function(r){var l=r.getCenter(),_=this.wrapLatLng(l),b=l.lat-_.lat,A=l.lng-_.lng;if(b===0&&A===0)return r;var U=r.getSouthWest(),et=r.getNorthEast(),it=new Ie(U.lat-b,U.lng-A),ot=new Ie(et.lat-b,et.lng-A);return new yi(it,ot)}},Ni=R({},Mi,{wrapLng:[-180,180],R:6371e3,distance:function(r,l){var _=Math.PI/180,b=r.lat*_,A=l.lat*_,U=Math.sin((l.lat-r.lat)*_/2),et=Math.sin((l.lng-r.lng)*_/2),it=U*U+Math.cos(b)*Math.cos(A)*et*et,ot=2*Math.atan2(Math.sqrt(it),Math.sqrt(1-it));return this.R*ot}}),Zi=6378137,yr={R:Zi,MAX_LATITUDE:85.0511287798,project:function(r){var l=Math.PI/180,_=this.MAX_LATITUDE,b=Math.max(Math.min(_,r.lat),-_),A=Math.sin(b*l);return new ae(this.R*r.lng*l,this.R*Math.log((1+A)/(1-A))/2)},unproject:function(r){var l=180/Math.PI;return new Ie((2*Math.atan(Math.exp(r.y/this.R))-Math.PI/2)*l,r.x*l/this.R)},bounds:function(){var r=Zi*Math.PI;return new Ze([-r,-r],[r,r])}()};function Nr(r,l,_,b){if(ii(r)){this._a=r[0],this._b=r[1],this._c=r[2],this._d=r[3];return}this._a=r,this._b=l,this._c=_,this._d=b}Nr.prototype={transform:function(r,l){return this._transform(r.clone(),l)},_transform:function(r,l){return l=l||1,r.x=l*(this._a*r.x+this._b),r.y=l*(this._c*r.y+this._d),r},untransform:function(r,l){return l=l||1,new ae((r.x/l-this._b)/this._a,(r.y/l-this._d)/this._c)}};function on(r,l,_,b){return new Nr(r,l,_,b)}var Vi=R({},Ni,{code:"EPSG:3857",projection:yr,transformation:function(){var r=.5/(Math.PI*yr.R);return on(r,.5,-r,.5)}()}),Es=R({},Vi,{code:"EPSG:900913"});function tr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Zr(r,l){var _="",b,A,U,et,it,ot;for(b=0,U=r.length;b<U;b++){for(it=r[b],A=0,et=it.length;A<et;A++)ot=it[A],_+=(A?"L":"M")+ot.x+" "+ot.y;_+=l?N.svg?"z":"x":""}return _||"M0 0"}var vr=document.documentElement.style,xr="ActiveXObject"in window,Ae=xr&&!document.addEventListener,En="msLaunchUri"in navigator&&!("documentMode"in document),Fn=zi("webkit"),er=zi("android"),ds=zi("android 2")||zi("android 3"),ir=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),nr=er&&zi("Google")&&ir<537&&!("AudioNode"in window),br=!!window.opera,Un=!En&&zi("chrome"),wt=zi("gecko")&&!Fn&&!br&&!xr,Bt=!Un&&zi("safari"),wr=zi("phantom"),yn="OTransition"in vr,Ce=navigator.platform.indexOf("Win")===0,an=xr&&"transition"in vr,Gi="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ds,Wi="MozPerspective"in vr,Tr=!window.L_DISABLE_3D&&(an||Gi||Wi)&&!yn&&!wr,Lt=typeof orientation<"u"||zi("mobile"),fe=Lt&&Fn,ue=Lt&&Gi,wi=!window.PointerEvent&&window.MSPointerEvent,rr=!!(window.PointerEvent||wi),le="ontouchstart"in window||!!window.TouchEvent,sr=!window.L_NO_TOUCH&&(le||rr),Ti=Lt&&br,ps=Lt&&wt,pi=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,qi=function(){var r=!1;try{var l=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassiveEventSupport",Gt,l),window.removeEventListener("testPassiveEventSupport",Gt,l)}catch{}return r}(),Ue=function(){return!!document.createElement("canvas").getContext}(),Sr=!!(document.createElementNS&&tr("svg").createSVGRect),Nn=!!Sr&&function(){var r=document.createElement("div");return r.innerHTML="<svg/>",(r.firstChild&&r.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Vr=!Sr&&function(){try{var r=document.createElement("div");r.innerHTML='<v:shape adj="1"/>';var l=r.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}}(),Gr=navigator.platform.indexOf("Mac")===0,fs=navigator.platform.indexOf("Linux")===0;function zi(r){return navigator.userAgent.toLowerCase().indexOf(r)>=0}var N={ie:xr,ielt9:Ae,edge:En,webkit:Fn,android:er,android23:ds,androidStock:nr,opera:br,chrome:Un,gecko:wt,safari:Bt,phantom:wr,opera12:yn,win:Ce,ie3d:an,webkit3d:Gi,gecko3d:Wi,any3d:Tr,mobile:Lt,mobileWebkit:fe,mobileWebkit3d:ue,msPointer:wi,pointer:rr,touch:sr,touchNative:le,mobileOpera:Ti,mobileGecko:ps,retina:pi,passiveEvents:qi,canvas:Ue,svg:Sr,vml:Vr,inlineSvg:Nn,mac:Gr,linux:fs},C=N.msPointer?"MSPointerDown":"pointerdown",B=N.msPointer?"MSPointerMove":"pointermove",q=N.msPointer?"MSPointerUp":"pointerup",$=N.msPointer?"MSPointerCancel":"pointercancel",Q={touchstart:C,touchmove:B,touchend:q,touchcancel:$},st={touchstart:ie,touchmove:Ft,touchend:Ft,touchcancel:Ft},nt={},tt=!1;function at(r,l,_){return l==="touchstart"&&Xt(),st[l]?(_=st[l].bind(this,_),r.addEventListener(Q[l],_,!1),_):(console.warn("wrong event specified:",l),Gt)}function xt(r,l,_){if(!Q[l]){console.warn("wrong event specified:",l);return}r.removeEventListener(Q[l],_,!1)}function At(r){nt[r.pointerId]=r}function vt(r){nt[r.pointerId]&&(nt[r.pointerId]=r)}function Ht(r){delete nt[r.pointerId]}function Xt(){tt||(document.addEventListener(C,At,!0),document.addEventListener(B,vt,!0),document.addEventListener(q,Ht,!0),document.addEventListener($,Ht,!0),tt=!0)}function Ft(r,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var _ in nt)l.touches.push(nt[_]);l.changedTouches=[l],r(l)}}function ie(r,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&hi(l),Ft(r,l)}function re(r){var l={},_,b;for(b in r)_=r[b],l[b]=_&&_.bind?_.bind(r):_;return r=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var Me=200;function he(r,l){r.addEventListener("dblclick",l);var _=0,b;function A(U){if(U.detail!==1){b=U.detail;return}if(!(U.pointerType==="mouse"||U.sourceCapabilities&&!U.sourceCapabilities.firesTouchEvents)){var et=Ro(U);if(!(et.some(function(ot){return ot instanceof HTMLLabelElement&&ot.attributes.for})&&!et.some(function(ot){return ot instanceof HTMLInputElement||ot instanceof HTMLSelectElement}))){var it=Date.now();it-_<=Me?(b++,b===2&&l(re(U))):b=1,_=it}}}return r.addEventListener("click",A),{dblclick:l,simDblclick:A}}function me(r,l){r.removeEventListener("dblclick",l.dblclick),r.removeEventListener("click",l.simDblclick)}var we=Ps(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Be=Ps(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),vi=Be==="webkitTransition"||Be==="OTransition"?Be+"End":"transitionend";function Ke(r){return typeof r=="string"?document.getElementById(r):r}function fi(r,l){var _=r.style[l]||r.currentStyle&&r.currentStyle[l];if((!_||_==="auto")&&document.defaultView){var b=document.defaultView.getComputedStyle(r,null);_=b?b[l]:null}return _==="auto"?null:_}function Ee(r,l,_){var b=document.createElement(r);return b.className=l||"",_&&_.appendChild(b),b}function je(r){var l=r.parentNode;l&&l.removeChild(r)}function Oe(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function Ir(r){var l=r.parentNode;l&&l.lastChild!==r&&l.appendChild(r)}function Er(r){var l=r.parentNode;l&&l.firstChild!==r&&l.insertBefore(r,l.firstChild)}function so(r,l){if(r.classList!==void 0)return r.classList.contains(l);var _=qr(r);return _.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(_)}function ge(r,l){if(r.classList!==void 0)for(var _=$e(l),b=0,A=_.length;b<A;b++)r.classList.add(_[b]);else if(!so(r,l)){var U=qr(r);Do(r,(U?U+" ":"")+l)}}function si(r,l){r.classList!==void 0?r.classList.remove(l):Do(r,ci((" "+qr(r)+" ").replace(" "+l+" "," ")))}function Do(r,l){r.className.baseVal===void 0?r.className=l:r.className.baseVal=l}function qr(r){return r.correspondingElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function Hi(r,l){"opacity"in r.style?r.style.opacity=l:"filter"in r.style&&sa(r,l)}function sa(r,l){var _=!1,b="DXImageTransform.Microsoft.Alpha";try{_=r.filters.item(b)}catch{if(l===1)return}l=Math.round(l*100),_?(_.Enabled=l!==100,_.Opacity=l):r.style.filter+=" progid:"+b+"(opacity="+l+")"}function Ps(r){for(var l=document.documentElement.style,_=0;_<r.length;_++)if(r[_]in l)return r[_];return!1}function Pr(r,l,_){var b=l||new ae(0,0);r.style[we]=(N.ie3d?"translate("+b.x+"px,"+b.y+"px)":"translate3d("+b.x+"px,"+b.y+"px,0)")+(_?" scale("+_+")":"")}function Je(r,l){r._leaflet_pos=l,N.any3d?Pr(r,l):(r.style.left=l.x+"px",r.style.top=l.y+"px")}function Pn(r){return r._leaflet_pos||new ae(0,0)}var Zn,Ar,ms;if("onselectstart"in document)Zn=function(){_e(window,"selectstart",hi)},Ar=function(){Ye(window,"selectstart",hi)};else{var Vn=Ps(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Zn=function(){if(Vn){var r=document.documentElement.style;ms=r[Vn],r[Vn]="none"}},Ar=function(){Vn&&(document.documentElement.style[Vn]=ms,ms=void 0)}}function As(){_e(window,"dragstart",hi)}function _s(){Ye(window,"dragstart",hi)}var Cr,We;function $r(r){for(;r.tabIndex===-1;)r=r.parentNode;r.style&&(Cs(),Cr=r,We=r.style.outline,r.style.outline="none",_e(window,"keydown",Cs))}function Cs(){Cr&&(Cr.style.outline=We,Cr=void 0,We=void 0,Ye(window,"keydown",Cs))}function Bo(r){do r=r.parentNode;while((!r.offsetWidth||!r.offsetHeight)&&r!==document.body);return r}function Ms(r){var l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}var oo={__proto__:null,TRANSFORM:we,TRANSITION:Be,TRANSITION_END:vi,get:Ke,getStyle:fi,create:Ee,remove:je,empty:Oe,toFront:Ir,toBack:Er,hasClass:so,addClass:ge,removeClass:si,setClass:Do,getClass:qr,setOpacity:Hi,testProp:Ps,setTransform:Pr,setPosition:Je,getPosition:Pn,get disableTextSelection(){return Zn},get enableTextSelection(){return Ar},disableImageDrag:As,enableImageDrag:_s,preventOutline:$r,restoreOutline:Cs,getSizedParentNode:Bo,getScale:Ms};function _e(r,l,_,b){if(l&&typeof l=="object")for(var A in l)Ls(r,A,l[A],_);else{l=$e(l);for(var U=0,et=l.length;U<et;U++)Ls(r,l[U],_,b)}return this}var Gn="_leaflet_events";function Ye(r,l,_,b){if(arguments.length===1)ao(r),delete r[Gn];else if(l&&typeof l=="object")for(var A in l)ks(r,A,l[A],_);else if(l=$e(l),arguments.length===2)ao(r,function(it){return Ur(l,it)!==-1});else for(var U=0,et=l.length;U<et;U++)ks(r,l[U],_,b);return this}function ao(r,l){for(var _ in r[Gn]){var b=_.split(/\d/)[0];(!l||l(b))&&ks(r,b,null,null,_)}}var zs={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ls(r,l,_,b){var A=l+Pt(_)+(b?"_"+Pt(b):"");if(r[Gn]&&r[Gn][A])return this;var U=function(it){return _.call(b||r,it||window.event)},et=U;!N.touchNative&&N.pointer&&l.indexOf("touch")===0?U=at(r,l,U):N.touch&&l==="dblclick"?U=he(r,U):"addEventListener"in r?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?r.addEventListener(zs[l]||l,U,N.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(U=function(it){it=it||window.event,gs(r,it)&&et(it)},r.addEventListener(zs[l],U,!1)):r.addEventListener(l,et,!1):r.attachEvent("on"+l,U),r[Gn]=r[Gn]||{},r[Gn][A]=U}function ks(r,l,_,b,A){A=A||l+Pt(_)+(b?"_"+Pt(b):"");var U=r[Gn]&&r[Gn][A];if(!U)return this;!N.touchNative&&N.pointer&&l.indexOf("touch")===0?xt(r,l,U):N.touch&&l==="dblclick"?me(r,U):"removeEventListener"in r?r.removeEventListener(zs[l]||l,U,!1):r.detachEvent("on"+l,U),r[Gn][A]=null}function xe(r){return r.stopPropagation?r.stopPropagation():r.originalEvent?r.originalEvent._stopped=!0:r.cancelBubble=!0,this}function lo(r){return Ls(r,"wheel",xe),this}function Ds(r){return _e(r,"mousedown touchstart dblclick contextmenu",xe),r._leaflet_disable_click=!0,this}function hi(r){return r.preventDefault?r.preventDefault():r.returnValue=!1,this}function An(r){return hi(r),xe(r),this}function Ro(r){if(r.composedPath)return r.composedPath();for(var l=[],_=r.target;_;)l.push(_),_=_.parentNode;return l}function Xi(r,l){if(!l)return new ae(r.clientX,r.clientY);var _=Ms(l),b=_.boundingClientRect;return new ae((r.clientX-b.left)/_.x-l.clientLeft,(r.clientY-b.top)/_.y-l.clientTop)}var Oo=N.linux&&N.chrome?window.devicePixelRatio:N.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Bs(r){return N.edge?r.wheelDeltaY/2:r.deltaY&&r.deltaMode===0?-r.deltaY/Oo:r.deltaY&&r.deltaMode===1?-r.deltaY*20:r.deltaY&&r.deltaMode===2?-r.deltaY*60:r.deltaX||r.deltaZ?0:r.wheelDelta?(r.wheelDeltaY||r.wheelDelta)/2:r.detail&&Math.abs(r.detail)<32765?-r.detail*20:r.detail?r.detail/-32765*60:0}function gs(r,l){var _=l.relatedTarget;if(!_)return!0;try{for(;_&&_!==r;)_=_.parentNode}catch{return!1}return _!==r}var Fo={__proto__:null,on:_e,off:Ye,stopPropagation:xe,disableScrollPropagation:lo,disableClickPropagation:Ds,preventDefault:hi,stop:An,getPropagationPath:Ro,getMousePosition:Xi,getWheelDelta:Bs,isExternalTarget:gs,addListener:_e,removeListener:Ye},ho=sn.extend({run:function(r,l,_,b){this.stop(),this._el=r,this._inProgress=!0,this._duration=_||.25,this._easeOutPower=1/Math.max(b||.5,.2),this._startPos=Pn(r),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ui(this._animate,this),this._step()},_step:function(r){var l=+new Date-this._startTime,_=this._duration*1e3;l<_?this._runFrame(this._easeOut(l/_),r):(this._runFrame(1),this._complete())},_runFrame:function(r,l){var _=this._startPos.add(this._offset.multiplyBy(r));l&&_._round(),Je(this._el,_),this.fire("step")},_complete:function(){di(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(r){return 1-Math.pow(1-r,this._easeOutPower)}}),Pe=sn.extend({options:{crs:Vi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(r,l){l=ce(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(r),this._initLayout(),this._onResize=lt(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(De(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Be&&N.any3d&&!N.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),_e(this._proxy,vi,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(r,l,_){if(l=l===void 0?this._zoom:this._limitZoom(l),r=this._limitCenter(De(r),l,this.options.maxBounds),_=_||{},this._stop(),this._loaded&&!_.reset&&_!==!0){_.animate!==void 0&&(_.zoom=R({animate:_.animate},_.zoom),_.pan=R({animate:_.animate,duration:_.duration},_.pan));var b=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(r,l,_.zoom):this._tryAnimatedPan(r,_.pan);if(b)return clearTimeout(this._sizeTimer),this}return this._resetView(r,l,_.pan&&_.pan.noMoveStart),this},setZoom:function(r,l){return this._loaded?this.setView(this.getCenter(),r,{zoom:l}):(this._zoom=r,this)},zoomIn:function(r,l){return r=r||(N.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+r,l)},zoomOut:function(r,l){return r=r||(N.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-r,l)},setZoomAround:function(r,l,_){var b=this.getZoomScale(l),A=this.getSize().divideBy(2),U=r instanceof ae?r:this.latLngToContainerPoint(r),et=U.subtract(A).multiplyBy(1-1/b),it=this.containerPointToLatLng(A.add(et));return this.setView(it,l,{zoom:_})},_getBoundsCenterZoom:function(r,l){l=l||{},r=r.getBounds?r.getBounds():ri(r);var _=ne(l.paddingTopLeft||l.padding||[0,0]),b=ne(l.paddingBottomRight||l.padding||[0,0]),A=this.getBoundsZoom(r,!1,_.add(b));if(A=typeof l.maxZoom=="number"?Math.min(l.maxZoom,A):A,A===1/0)return{center:r.getCenter(),zoom:A};var U=b.subtract(_).divideBy(2),et=this.project(r.getSouthWest(),A),it=this.project(r.getNorthEast(),A),ot=this.unproject(et.add(it).divideBy(2).add(U),A);return{center:ot,zoom:A}},fitBounds:function(r,l){if(r=ri(r),!r.isValid())throw new Error("Bounds are not valid.");var _=this._getBoundsCenterZoom(r,l);return this.setView(_.center,_.zoom,l)},fitWorld:function(r){return this.fitBounds([[-90,-180],[90,180]],r)},panTo:function(r,l){return this.setView(r,this._zoom,{pan:l})},panBy:function(r,l){if(r=ne(r).round(),l=l||{},!r.x&&!r.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(r))return this._resetView(this.unproject(this.project(this.getCenter()).add(r)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ho,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){ge(this._mapPane,"leaflet-pan-anim");var _=this._getMapPanePos().subtract(r).round();this._panAnim.run(this._mapPane,_,l.duration||.25,l.easeLinearity)}else this._rawPanBy(r),this.fire("move").fire("moveend");return this},flyTo:function(r,l,_){if(_=_||{},_.animate===!1||!N.any3d)return this.setView(r,l,_);this._stop();var b=this.project(this.getCenter()),A=this.project(r),U=this.getSize(),et=this._zoom;r=De(r),l=l===void 0?et:l;var it=Math.max(U.x,U.y),ot=it*this.getZoomScale(et,l),Ct=A.distanceTo(b)||1,$t=1.42,se=$t*$t;function oe(a){var d=a?-1:1,f=a?ot:it,y=ot*ot-it*it+d*se*se*Ct*Ct,T=2*f*se*Ct,I=y/T,P=Math.sqrt(I*I+1)-I,z=P<1e-9?-18:Math.log(P);return z}function xi(a){return(Math.exp(a)-Math.exp(-a))/2}function ki(a){return(Math.exp(a)+Math.exp(-a))/2}function Hs(a){return xi(a)/ki(a)}var $i=oe(0);function ti(a){return it*(ki($i)/ki($i+$t*a))}function mi(a){return it*(ki($i)*Hs($i+$t*a)-xi($i))/se}function Yo(a){return 1-Math.pow(1-a,1.5)}var rs=Date.now(),c=(oe(1)-$i)/$t,e=_.duration?1e3*_.duration:1e3*c*.8;function s(){var a=(Date.now()-rs)/e,d=Yo(a)*c;a<=1?(this._flyToFrame=ui(s,this),this._move(this.unproject(b.add(A.subtract(b).multiplyBy(mi(d)/Ct)),et),this.getScaleZoom(it/ti(d),et),{flyTo:!0})):this._move(r,l)._moveEnd(!0)}return this._moveStart(!0,_.noMoveStart),s.call(this),this},flyToBounds:function(r,l){var _=this._getBoundsCenterZoom(r,l);return this.flyTo(_.center,_.zoom,l)},setMaxBounds:function(r){return r=ri(r),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),r.isValid()?(this.options.maxBounds=r,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(r){var l=this.options.minZoom;return this.options.minZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(r):this},setMaxZoom:function(r){var l=this.options.maxZoom;return this.options.maxZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(r):this},panInsideBounds:function(r,l){this._enforcingBounds=!0;var _=this.getCenter(),b=this._limitCenter(_,this._zoom,ri(r));return _.equals(b)||this.panTo(b,l),this._enforcingBounds=!1,this},panInside:function(r,l){l=l||{};var _=ne(l.paddingTopLeft||l.padding||[0,0]),b=ne(l.paddingBottomRight||l.padding||[0,0]),A=this.project(this.getCenter()),U=this.project(r),et=this.getPixelBounds(),it=gi([et.min.add(_),et.max.subtract(b)]),ot=it.getSize();if(!it.contains(U)){this._enforcingBounds=!0;var Ct=U.subtract(it.getCenter()),$t=it.extend(U).getSize().subtract(ot);A.x+=Ct.x<0?-$t.x:$t.x,A.y+=Ct.y<0?-$t.y:$t.y,this.panTo(this.unproject(A),l),this._enforcingBounds=!1}return this},invalidateSize:function(r){if(!this._loaded)return this;r=R({animate:!1,pan:!0},r===!0?{animate:!0}:r);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var _=this.getSize(),b=l.divideBy(2).round(),A=_.divideBy(2).round(),U=b.subtract(A);return!U.x&&!U.y?this:(r.animate&&r.pan?this.panBy(U):(r.pan&&this._rawPanBy(U),this.fire("move"),r.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(lt(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:_}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(r){if(r=this._locateOptions=R({timeout:1e4,watch:!1},r),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=lt(this._handleGeolocationResponse,this),_=lt(this._handleGeolocationError,this);return r.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,_,r):navigator.geolocation.getCurrentPosition(l,_,r),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(r){if(this._container._leaflet_id){var l=r.code,_=r.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+_+"."})}},_handleGeolocationResponse:function(r){if(this._container._leaflet_id){var l=r.coords.latitude,_=r.coords.longitude,b=new Ie(l,_),A=b.toBounds(r.coords.accuracy*2),U=this._locateOptions;if(U.setView){var et=this.getBoundsZoom(A);this.setView(b,U.maxZoom?Math.min(et,U.maxZoom):et)}var it={latlng:b,bounds:A,timestamp:r.timestamp};for(var ot in r.coords)typeof r.coords[ot]=="number"&&(it[ot]=r.coords[ot]);this.fire("locationfound",it)}},addHandler:function(r,l){if(!l)return this;var _=this[r]=new l(this);return this._handlers.push(_),this.options[r]&&_.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),je(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(di(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var r;for(r in this._layers)this._layers[r].remove();for(r in this._panes)je(this._panes[r]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(r,l){var _="leaflet-pane"+(r?" leaflet-"+r.replace("Pane","")+"-pane":""),b=Ee("div",_,l||this._mapPane);return r&&(this._panes[r]=b),b},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var r=this.getPixelBounds(),l=this.unproject(r.getBottomLeft()),_=this.unproject(r.getTopRight());return new yi(l,_)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(r,l,_){r=ri(r),_=ne(_||[0,0]);var b=this.getZoom()||0,A=this.getMinZoom(),U=this.getMaxZoom(),et=r.getNorthWest(),it=r.getSouthEast(),ot=this.getSize().subtract(_),Ct=gi(this.project(it,b),this.project(et,b)).getSize(),$t=N.any3d?this.options.zoomSnap:1,se=ot.x/Ct.x,oe=ot.y/Ct.y,xi=l?Math.max(se,oe):Math.min(se,oe);return b=this.getScaleZoom(xi,b),$t&&(b=Math.round(b/($t/100))*($t/100),b=l?Math.ceil(b/$t)*$t:Math.floor(b/$t)*$t),Math.max(A,Math.min(U,b))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ae(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(r,l){var _=this._getTopLeftPoint(r,l);return new Ze(_,_.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(r){return this.options.crs.getProjectedBounds(r===void 0?this.getZoom():r)},getPane:function(r){return typeof r=="string"?this._panes[r]:r},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(r,l){var _=this.options.crs;return l=l===void 0?this._zoom:l,_.scale(r)/_.scale(l)},getScaleZoom:function(r,l){var _=this.options.crs;l=l===void 0?this._zoom:l;var b=_.zoom(r*_.scale(l));return isNaN(b)?1/0:b},project:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(De(r),l)},unproject:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(ne(r),l)},layerPointToLatLng:function(r){var l=ne(r).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(r){var l=this.project(De(r))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(r){return this.options.crs.wrapLatLng(De(r))},wrapLatLngBounds:function(r){return this.options.crs.wrapLatLngBounds(ri(r))},distance:function(r,l){return this.options.crs.distance(De(r),De(l))},containerPointToLayerPoint:function(r){return ne(r).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(r){return ne(r).add(this._getMapPanePos())},containerPointToLatLng:function(r){var l=this.containerPointToLayerPoint(ne(r));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(r){return this.layerPointToContainerPoint(this.latLngToLayerPoint(De(r)))},mouseEventToContainerPoint:function(r){return Xi(r,this._container)},mouseEventToLayerPoint:function(r){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(r))},mouseEventToLatLng:function(r){return this.layerPointToLatLng(this.mouseEventToLayerPoint(r))},_initContainer:function(r){var l=this._container=Ke(r);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");_e(l,"scroll",this._onScroll,this),this._containerId=Pt(l)},_initLayout:function(){var r=this._container;this._fadeAnimated=this.options.fadeAnimation&&N.any3d,ge(r,"leaflet-container"+(N.touch?" leaflet-touch":"")+(N.retina?" leaflet-retina":"")+(N.ielt9?" leaflet-oldie":"")+(N.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=fi(r,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&l!=="sticky"&&(r.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var r=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Je(this._mapPane,new ae(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ge(r.markerPane,"leaflet-zoom-hide"),ge(r.shadowPane,"leaflet-zoom-hide"))},_resetView:function(r,l,_){Je(this._mapPane,new ae(0,0));var b=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var A=this._zoom!==l;this._moveStart(A,_)._move(r,l)._moveEnd(A),this.fire("viewreset"),b&&this.fire("load")},_moveStart:function(r,l){return r&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(r,l,_,b){l===void 0&&(l=this._zoom);var A=this._zoom!==l;return this._zoom=l,this._lastCenter=r,this._pixelOrigin=this._getNewPixelOrigin(r),b?_&&_.pinch&&this.fire("zoom",_):((A||_&&_.pinch)&&this.fire("zoom",_),this.fire("move",_)),this},_moveEnd:function(r){return r&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return di(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(r){Je(this._mapPane,this._getMapPanePos().subtract(r))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(r){this._targets={},this._targets[Pt(this._container)]=this;var l=r?Ye:_e;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),N.any3d&&this.options.transform3DLimit&&(r?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){di(this._resizeRequest),this._resizeRequest=ui(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var r=this._getMapPanePos();Math.max(Math.abs(r.x),Math.abs(r.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(r,l){for(var _=[],b,A=l==="mouseout"||l==="mouseover",U=r.target||r.srcElement,et=!1;U;){if(b=this._targets[Pt(U)],b&&(l==="click"||l==="preclick")&&this._draggableMoved(b)){et=!0;break}if(b&&b.listens(l,!0)&&(A&&!gs(U,r)||(_.push(b),A))||U===this._container)break;U=U.parentNode}return!_.length&&!et&&!A&&this.listens(l,!0)&&(_=[this]),_},_isClickDisabled:function(r){for(;r&&r!==this._container;){if(r._leaflet_disable_click)return!0;r=r.parentNode}},_handleDOMEvent:function(r){var l=r.target||r.srcElement;if(!(!this._loaded||l._leaflet_disable_events||r.type==="click"&&this._isClickDisabled(l))){var _=r.type;_==="mousedown"&&$r(l),this._fireDOMEvent(r,_)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(r,l,_){if(r.type==="click"){var b=R({},r);b.type="preclick",this._fireDOMEvent(b,b.type,_)}var A=this._findEventTargets(r,l);if(_){for(var U=[],et=0;et<_.length;et++)_[et].listens(l,!0)&&U.push(_[et]);A=U.concat(A)}if(A.length){l==="contextmenu"&&hi(r);var it=A[0],ot={originalEvent:r};if(r.type!=="keypress"&&r.type!=="keydown"&&r.type!=="keyup"){var Ct=it.getLatLng&&(!it._radius||it._radius<=10);ot.containerPoint=Ct?this.latLngToContainerPoint(it.getLatLng()):this.mouseEventToContainerPoint(r),ot.layerPoint=this.containerPointToLayerPoint(ot.containerPoint),ot.latlng=Ct?it.getLatLng():this.layerPointToLatLng(ot.layerPoint)}for(et=0;et<A.length;et++)if(A[et].fire(l,ot,!0),ot.originalEvent._stopped||A[et].options.bubblingMouseEvents===!1&&Ur(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(r){return r=r.dragging&&r.dragging.enabled()?r:this,r.dragging&&r.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var r=0,l=this._handlers.length;r<l;r++)this._handlers[r].disable()},whenReady:function(r,l){return this._loaded?r.call(l||this,{target:this}):this.on("load",r,l),this},_getMapPanePos:function(){return Pn(this._mapPane)||new ae(0,0)},_moved:function(){var r=this._getMapPanePos();return r&&!r.equals([0,0])},_getTopLeftPoint:function(r,l){var _=r&&l!==void 0?this._getNewPixelOrigin(r,l):this.getPixelOrigin();return _.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(r,l){var _=this.getSize()._divideBy(2);return this.project(r,l)._subtract(_)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(r,l,_){var b=this._getNewPixelOrigin(_,l);return this.project(r,l)._subtract(b)},_latLngBoundsToNewLayerBounds:function(r,l,_){var b=this._getNewPixelOrigin(_,l);return gi([this.project(r.getSouthWest(),l)._subtract(b),this.project(r.getNorthWest(),l)._subtract(b),this.project(r.getSouthEast(),l)._subtract(b),this.project(r.getNorthEast(),l)._subtract(b)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(r){return this.latLngToLayerPoint(r).subtract(this._getCenterLayerPoint())},_limitCenter:function(r,l,_){if(!_)return r;var b=this.project(r,l),A=this.getSize().divideBy(2),U=new Ze(b.subtract(A),b.add(A)),et=this._getBoundsOffset(U,_,l);return Math.abs(et.x)<=1&&Math.abs(et.y)<=1?r:this.unproject(b.add(et),l)},_limitOffset:function(r,l){if(!l)return r;var _=this.getPixelBounds(),b=new Ze(_.min.add(r),_.max.add(r));return r.add(this._getBoundsOffset(b,l))},_getBoundsOffset:function(r,l,_){var b=gi(this.project(l.getNorthEast(),_),this.project(l.getSouthWest(),_)),A=b.min.subtract(r.min),U=b.max.subtract(r.max),et=this._rebound(A.x,-U.x),it=this._rebound(A.y,-U.y);return new ae(et,it)},_rebound:function(r,l){return r+l>0?Math.round(r-l)/2:Math.max(0,Math.ceil(r))-Math.max(0,Math.floor(l))},_limitZoom:function(r){var l=this.getMinZoom(),_=this.getMaxZoom(),b=N.any3d?this.options.zoomSnap:1;return b&&(r=Math.round(r/b)*b),Math.max(l,Math.min(_,r))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){si(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(r,l){var _=this._getCenterOffset(r)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(_)?!1:(this.panBy(_,l),!0)},_createAnimProxy:function(){var r=this._proxy=Ee("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(r),this.on("zoomanim",function(l){var _=we,b=this._proxy.style[_];Pr(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),b===this._proxy.style[_]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){je(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var r=this.getCenter(),l=this.getZoom();Pr(this._proxy,this.project(r,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(r){this._animatingZoom&&r.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(r,l,_){if(this._animatingZoom)return!0;if(_=_||{},!this._zoomAnimated||_.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var b=this.getZoomScale(l),A=this._getCenterOffset(r)._divideBy(1-1/b);return _.animate!==!0&&!this.getSize().contains(A)?!1:(ui(function(){this._moveStart(!0,!1)._animateZoom(r,l,!0)},this),!0)},_animateZoom:function(r,l,_,b){this._mapPane&&(_&&(this._animatingZoom=!0,this._animateToCenter=r,this._animateToZoom=l,ge(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:r,zoom:l,noUpdate:b}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(lt(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&si(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Uo(r,l){return new Pe(r,l)}var ln=Ci.extend({options:{position:"topright"},initialize:function(r){ce(this,r)},getPosition:function(){return this.options.position},setPosition:function(r){var l=this._map;return l&&l.removeControl(this),this.options.position=r,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(r){this.remove(),this._map=r;var l=this._container=this.onAdd(r),_=this.getPosition(),b=r._controlCorners[_];return ge(l,"leaflet-control"),_.indexOf("bottom")!==-1?b.insertBefore(l,b.firstChild):b.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(je(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(r){this._map&&r&&r.screenX>0&&r.screenY>0&&this._map.getContainer().focus()}}),Mr=function(r){return new ln(r)};Pe.include({addControl:function(r){return r.addTo(this),this},removeControl:function(r){return r.remove(),this},_initControlPos:function(){var r=this._controlCorners={},l="leaflet-",_=this._controlContainer=Ee("div",l+"control-container",this._container);function b(A,U){var et=l+A+" "+l+U;r[A+U]=Ee("div",et,_)}b("top","left"),b("top","right"),b("bottom","left"),b("bottom","right")},_clearControlPos:function(){for(var r in this._controlCorners)je(this._controlCorners[r]);je(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var No=ln.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(r,l,_,b){return _<b?-1:b<_?1:0}},initialize:function(r,l,_){ce(this,_),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var b in r)this._addLayer(r[b],b);for(b in l)this._addLayer(l[b],b,!0)},onAdd:function(r){this._initLayout(),this._update(),this._map=r,r.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(r){return ln.prototype.addTo.call(this,r),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(r,l){return this._addLayer(r,l),this._map?this._update():this},addOverlay:function(r,l){return this._addLayer(r,l,!0),this._map?this._update():this},removeLayer:function(r){r.off("add remove",this._onLayerChange,this);var l=this._getLayer(Pt(r));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){ge(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var r=this._map.getSize().y-(this._container.offsetTop+50);return r<this._section.clientHeight?(ge(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=r+"px"):si(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return si(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var r="leaflet-control-layers",l=this._container=Ee("div",r),_=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Ds(l),lo(l);var b=this._section=Ee("section",r+"-list");_&&(this._map.on("click",this.collapse,this),_e(l,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var A=this._layersLink=Ee("a",r+"-toggle",l);A.href="#",A.title="Layers",A.setAttribute("role","button"),_e(A,{keydown:function(U){U.keyCode===13&&this._expandSafely()},click:function(U){hi(U),this._expandSafely()}},this),_||this.expand(),this._baseLayersList=Ee("div",r+"-base",b),this._separator=Ee("div",r+"-separator",b),this._overlaysList=Ee("div",r+"-overlays",b),l.appendChild(b)},_getLayer:function(r){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&Pt(this._layers[l].layer)===r)return this._layers[l]},_addLayer:function(r,l,_){this._map&&r.on("add remove",this._onLayerChange,this),this._layers.push({layer:r,name:l,overlay:_}),this.options.sortLayers&&this._layers.sort(lt(function(b,A){return this.options.sortFunction(b.layer,A.layer,b.name,A.name)},this)),this.options.autoZIndex&&r.setZIndex&&(this._lastZIndex++,r.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Oe(this._baseLayersList),Oe(this._overlaysList),this._layerControlInputs=[];var r,l,_,b,A=0;for(_=0;_<this._layers.length;_++)b=this._layers[_],this._addItem(b),l=l||b.overlay,r=r||!b.overlay,A+=b.overlay?0:1;return this.options.hideSingleBase&&(r=r&&A>1,this._baseLayersList.style.display=r?"":"none"),this._separator.style.display=l&&r?"":"none",this},_onLayerChange:function(r){this._handlingClick||this._update();var l=this._getLayer(Pt(r.target)),_=l.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;_&&this._map.fire(_,l)},_createRadioElement:function(r,l){var _='<input type="radio" class="leaflet-control-layers-selector" name="'+r+'"'+(l?' checked="checked"':"")+"/>",b=document.createElement("div");return b.innerHTML=_,b.firstChild},_addItem:function(r){var l=document.createElement("label"),_=this._map.hasLayer(r.layer),b;r.overlay?(b=document.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=_):b=this._createRadioElement("leaflet-base-layers_"+Pt(this),_),this._layerControlInputs.push(b),b.layerId=Pt(r.layer),_e(b,"click",this._onInputClick,this);var A=document.createElement("span");A.innerHTML=" "+r.name;var U=document.createElement("span");l.appendChild(U),U.appendChild(b),U.appendChild(A);var et=r.overlay?this._overlaysList:this._baseLayersList;return et.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){var r=this._layerControlInputs,l,_,b=[],A=[];this._handlingClick=!0;for(var U=r.length-1;U>=0;U--)l=r[U],_=this._getLayer(l.layerId).layer,l.checked?b.push(_):l.checked||A.push(_);for(U=0;U<A.length;U++)this._map.hasLayer(A[U])&&this._map.removeLayer(A[U]);for(U=0;U<b.length;U++)this._map.hasLayer(b[U])||this._map.addLayer(b[U]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,l,_,b=this._map.getZoom(),A=r.length-1;A>=0;A--)l=r[A],_=this._getLayer(l.layerId).layer,l.disabled=_.options.minZoom!==void 0&&b<_.options.minZoom||_.options.maxZoom!==void 0&&b>_.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var r=this._section;_e(r,"click",hi),this.expand(),setTimeout(function(){Ye(r,"click",hi)})}}),oa=function(r,l,_){return new No(r,l,_)},zr=ln.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(r){var l="leaflet-control-zoom",_=Ee("div",l+" leaflet-bar"),b=this.options;return this._zoomInButton=this._createButton(b.zoomInText,b.zoomInTitle,l+"-in",_,this._zoomIn),this._zoomOutButton=this._createButton(b.zoomOutText,b.zoomOutTitle,l+"-out",_,this._zoomOut),this._updateDisabled(),r.on("zoomend zoomlevelschange",this._updateDisabled,this),_},onRemove:function(r){r.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(r){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(r.shiftKey?3:1))},_zoomOut:function(r){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(r.shiftKey?3:1))},_createButton:function(r,l,_,b,A){var U=Ee("a",_,b);return U.innerHTML=r,U.href="#",U.title=l,U.setAttribute("role","button"),U.setAttribute("aria-label",l),Ds(U),_e(U,"click",An),_e(U,"click",A,this),_e(U,"click",this._refocusOnMap,this),U},_updateDisabled:function(){var r=this._map,l="leaflet-disabled";si(this._zoomInButton,l),si(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||r._zoom===r.getMinZoom())&&(ge(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||r._zoom===r.getMaxZoom())&&(ge(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});Pe.mergeOptions({zoomControl:!0}),Pe.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new zr,this.addControl(this.zoomControl))});var za=function(r){return new zr(r)},aa=ln.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(r){var l="leaflet-control-scale",_=Ee("div",l),b=this.options;return this._addScales(b,l+"-line",_),r.on(b.updateWhenIdle?"moveend":"move",this._update,this),r.whenReady(this._update,this),_},onRemove:function(r){r.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(r,l,_){r.metric&&(this._mScale=Ee("div",l,_)),r.imperial&&(this._iScale=Ee("div",l,_))},_update:function(){var r=this._map,l=r.getSize().y/2,_=r.distance(r.containerPointToLatLng([0,l]),r.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(_)},_updateScales:function(r){this.options.metric&&r&&this._updateMetric(r),this.options.imperial&&r&&this._updateImperial(r)},_updateMetric:function(r){var l=this._getRoundNum(r),_=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,_,l/r)},_updateImperial:function(r){var l=r*3.2808399,_,b,A;l>5280?(_=l/5280,b=this._getRoundNum(_),this._updateScale(this._iScale,b+" mi",b/_)):(A=this._getRoundNum(l),this._updateScale(this._iScale,A+" ft",A/l))},_updateScale:function(r,l,_){r.style.width=Math.round(this.options.maxWidth*_)+"px",r.innerHTML=l},_getRoundNum:function(r){var l=Math.pow(10,(Math.floor(r)+"").length-1),_=r/l;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,l*_}}),La=function(r){return new aa(r)},ka='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Zo=ln.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(N.inlineSvg?ka+" ":"")+"Leaflet</a>"},initialize:function(r){ce(this,r),this._attributions={}},onAdd:function(r){r.attributionControl=this,this._container=Ee("div","leaflet-control-attribution"),Ds(this._container);for(var l in r._layers)r._layers[l].getAttribution&&this.addAttribution(r._layers[l].getAttribution());return this._update(),r.on("layeradd",this._addAttribution,this),this._container},onRemove:function(r){r.off("layeradd",this._addAttribution,this)},_addAttribution:function(r){r.layer.getAttribution&&(this.addAttribution(r.layer.getAttribution()),r.layer.once("remove",function(){this.removeAttribution(r.layer.getAttribution())},this))},setPrefix:function(r){return this.options.prefix=r,this._update(),this},addAttribution:function(r){return r?(this._attributions[r]||(this._attributions[r]=0),this._attributions[r]++,this._update(),this):this},removeAttribution:function(r){return r?(this._attributions[r]&&(this._attributions[r]--,this._update()),this):this},_update:function(){if(this._map){var r=[];for(var l in this._attributions)this._attributions[l]&&r.push(l);var _=[];this.options.prefix&&_.push(this.options.prefix),r.length&&_.push(r.join(", ")),this._container.innerHTML=_.join(' <span aria-hidden="true">|</span> ')}}});Pe.mergeOptions({attributionControl:!0}),Pe.addInitHook(function(){this.options.attributionControl&&new Zo().addTo(this)});var Da=function(r){return new Zo(r)};ln.Layers=No,ln.Zoom=zr,ln.Scale=aa,ln.Attribution=Zo,Mr.layers=oa,Mr.zoom=za,Mr.scale=La,Mr.attribution=Da;var vn=Ci.extend({initialize:function(r){this._map=r},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});vn.addTo=function(r,l){return r.addHandler(l,this),this};var co={Events:Jt},uo=N.touch?"touchstart mousedown":"mousedown",qn=sn.extend({options:{clickTolerance:3},initialize:function(r,l,_,b){ce(this,b),this._element=r,this._dragStartTarget=l||r,this._preventOutline=_},enable:function(){this._enabled||(_e(this._dragStartTarget,uo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(qn._dragging===this&&this.finishDrag(!0),Ye(this._dragStartTarget,uo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(r){if(this._enabled&&(this._moved=!1,!so(this._element,"leaflet-zoom-anim"))){if(r.touches&&r.touches.length!==1){qn._dragging===this&&this.finishDrag();return}if(!(qn._dragging||r.shiftKey||r.which!==1&&r.button!==1&&!r.touches)&&(qn._dragging=this,this._preventOutline&&$r(this._element),As(),Zn(),!this._moving)){this.fire("down");var l=r.touches?r.touches[0]:r,_=Bo(this._element);this._startPoint=new ae(l.clientX,l.clientY),this._startPos=Pn(this._element),this._parentScale=Ms(_);var b=r.type==="mousedown";_e(document,b?"mousemove":"touchmove",this._onMove,this),_e(document,b?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(r){if(this._enabled){if(r.touches&&r.touches.length>1){this._moved=!0;return}var l=r.touches&&r.touches.length===1?r.touches[0]:r,_=new ae(l.clientX,l.clientY)._subtract(this._startPoint);!_.x&&!_.y||Math.abs(_.x)+Math.abs(_.y)<this.options.clickTolerance||(_.x/=this._parentScale.x,_.y/=this._parentScale.y,hi(r),this._moved||(this.fire("dragstart"),this._moved=!0,ge(document.body,"leaflet-dragging"),this._lastTarget=r.target||r.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ge(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(_),this._moving=!0,this._lastEvent=r,this._updatePosition())}},_updatePosition:function(){var r={originalEvent:this._lastEvent};this.fire("predrag",r),Je(this._element,this._newPos),this.fire("drag",r)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(r){si(document.body,"leaflet-dragging"),this._lastTarget&&(si(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ye(document,"mousemove touchmove",this._onMove,this),Ye(document,"mouseup touchend touchcancel",this._onUp,this),_s(),Ar(),this._moved&&this._moving&&this.fire("dragend",{noInertia:r,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,qn._dragging=!1}});function jr(r,l){if(!l||!r.length)return r.slice();var _=l*l;return r=ha(r,_),r=po(r,_),r}function Vo(r,l,_){return Math.sqrt(Fe(r,l,_,!0))}function la(r,l,_){return Fe(r,l,_)}function po(r,l){var _=r.length,b=typeof Uint8Array!=void 0+""?Uint8Array:Array,A=new b(_);A[0]=A[_-1]=1,or(r,A,l,0,_-1);var U,et=[];for(U=0;U<_;U++)A[U]&&et.push(r[U]);return et}function or(r,l,_,b,A){var U=0,et,it,ot;for(it=b+1;it<=A-1;it++)ot=Fe(r[it],r[b],r[A],!0),ot>U&&(et=it,U=ot);U>_&&(l[et]=1,or(r,l,_,b,et),or(r,l,_,et,A))}function ha(r,l){for(var _=[r[0]],b=1,A=0,U=r.length;b<U;b++)Re(r[b],r[A])>l&&(_.push(r[b]),A=b);return A<U-1&&_.push(r[U-1]),_}var Wr;function He(r,l,_,b,A){var U=b?Wr:de(r,_),et=de(l,_),it,ot,Ct;for(Wr=et;;){if(!(U|et))return[r,l];if(U&et)return!1;it=U||et,ot=Rs(r,l,it,_,A),Ct=de(ot,_),it===U?(r=ot,U=Ct):(l=ot,et=Ct)}}function Rs(r,l,_,b,A){var U=l.x-r.x,et=l.y-r.y,it=b.min,ot=b.max,Ct,$t;return _&8?(Ct=r.x+U*(ot.y-r.y)/et,$t=ot.y):_&4?(Ct=r.x+U*(it.y-r.y)/et,$t=it.y):_&2?(Ct=ot.x,$t=r.y+et*(ot.x-r.x)/U):_&1&&(Ct=it.x,$t=r.y+et*(it.x-r.x)/U),new ae(Ct,$t,A)}function de(r,l){var _=0;return r.x<l.min.x?_|=1:r.x>l.max.x&&(_|=2),r.y<l.min.y?_|=4:r.y>l.max.y&&(_|=8),_}function Re(r,l){var _=l.x-r.x,b=l.y-r.y;return _*_+b*b}function Fe(r,l,_,b){var A=l.x,U=l.y,et=_.x-A,it=_.y-U,ot=et*et+it*it,Ct;return ot>0&&(Ct=((r.x-A)*et+(r.y-U)*it)/ot,Ct>1?(A=_.x,U=_.y):Ct>0&&(A+=et*Ct,U+=it*Ct)),et=r.x-A,it=r.y-U,b?et*et+it*it:new ae(A,U)}function ze(r){return!ii(r[0])||typeof r[0][0]!="object"&&typeof r[0][0]<"u"}function ys(r){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ze(r)}function Hr(r,l){var _,b,A,U,et,it,ot,Ct;if(!r||r.length===0)throw new Error("latlngs not passed");ze(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var $t=[];for(var se in r)$t.push(l.project(De(r[se])));var oe=$t.length;for(_=0,b=0;_<oe-1;_++)b+=$t[_].distanceTo($t[_+1])/2;if(b===0)Ct=$t[0];else for(_=0,U=0;_<oe-1;_++)if(et=$t[_],it=$t[_+1],A=et.distanceTo(it),U+=A,U>b){ot=(U-b)/A,Ct=[it.x-ot*(it.x-et.x),it.y-ot*(it.y-et.y)];break}return l.unproject(ne(Ct))}var Ba={__proto__:null,simplify:jr,pointToSegmentDistance:Vo,closestPointOnSegment:la,clipSegment:He,_getEdgeIntersection:Rs,_getBitCode:de,_sqClosestPointOnSegment:Fe,isFlat:ze,_flat:ys,polylineCenter:Hr};function ca(r,l,_){var b,A=[1,4,2,8],U,et,it,ot,Ct,$t,se,oe;for(U=0,$t=r.length;U<$t;U++)r[U]._code=de(r[U],l);for(it=0;it<4;it++){for(se=A[it],b=[],U=0,$t=r.length,et=$t-1;U<$t;et=U++)ot=r[U],Ct=r[et],ot._code&se?Ct._code&se||(oe=Rs(Ct,ot,se,l,_),oe._code=de(oe,l),b.push(oe)):(Ct._code&se&&(oe=Rs(Ct,ot,se,l,_),oe._code=de(oe,l),b.push(oe)),b.push(ot));r=b}return r}function Go(r,l){var _,b,A,U,et,it,ot,Ct,$t;if(!r||r.length===0)throw new Error("latlngs not passed");ze(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var se=[];for(var oe in r)se.push(l.project(De(r[oe])));var xi=se.length;for(it=ot=Ct=0,_=0,b=xi-1;_<xi;b=_++)A=se[_],U=se[b],et=A.y*U.x-U.y*A.x,ot+=(A.x+U.x)*et,Ct+=(A.y+U.y)*et,it+=et*3;return it===0?$t=se[0]:$t=[ot/it,Ct/it],l.unproject(ne($t))}var Ra={__proto__:null,clipPolygon:ca,polygonCenter:Go},vs={project:function(r){return new ae(r.lng,r.lat)},unproject:function(r){return new Ie(r.y,r.x)},bounds:new Ze([-180,-90],[180,90])},Xr={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Ze([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(r){var l=Math.PI/180,_=this.R,b=r.lat*l,A=this.R_MINOR/_,U=Math.sqrt(1-A*A),et=U*Math.sin(b),it=Math.tan(Math.PI/4-b/2)/Math.pow((1-et)/(1+et),U/2);return b=-_*Math.log(Math.max(it,1e-10)),new ae(r.lng*l*_,b)},unproject:function(r){for(var l=180/Math.PI,_=this.R,b=this.R_MINOR/_,A=Math.sqrt(1-b*b),U=Math.exp(-r.y/_),et=Math.PI/2-2*Math.atan(U),it=0,ot=.1,Ct;it<15&&Math.abs(ot)>1e-7;it++)Ct=A*Math.sin(et),Ct=Math.pow((1-Ct)/(1+Ct),A/2),ot=Math.PI/2-2*Math.atan(U*Ct)-et,et+=ot;return new Ie(et*l,r.x*l/_)}},Os={__proto__:null,LonLat:vs,Mercator:Xr,SphericalMercator:yr},Fs=R({},Ni,{code:"EPSG:3395",projection:Xr,transformation:function(){var r=.5/(Math.PI*Xr.R);return on(r,.5,-r,.5)}()}),fo=R({},Ni,{code:"EPSG:4326",projection:vs,transformation:on(1/180,1,-1/180,.5)}),ua=R({},Mi,{projection:vs,transformation:on(1,0,-1,0),scale:function(r){return Math.pow(2,r)},zoom:function(r){return Math.log(r)/Math.LN2},distance:function(r,l){var _=l.lng-r.lng,b=l.lat-r.lat;return Math.sqrt(_*_+b*b)},infinite:!0});Mi.Earth=Ni,Mi.EPSG3395=Fs,Mi.EPSG3857=Vi,Mi.EPSG900913=Es,Mi.EPSG4326=fo,Mi.Simple=ua;var Ki=sn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(r){return r.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(r){return r&&r.removeLayer(this),this},getPane:function(r){return this._map.getPane(r?this.options[r]||r:this.options.pane)},addInteractiveTarget:function(r){return this._map._targets[Pt(r)]=this,this},removeInteractiveTarget:function(r){return delete this._map._targets[Pt(r)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(r){var l=r.target;if(l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var _=this.getEvents();l.on(_,this),this.once("remove",function(){l.off(_,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});Pe.include({addLayer:function(r){if(!r._layerAdd)throw new Error("The provided object is not a Layer.");var l=Pt(r);return this._layers[l]?this:(this._layers[l]=r,r._mapToAdd=this,r.beforeAdd&&r.beforeAdd(this),this.whenReady(r._layerAdd,r),this)},removeLayer:function(r){var l=Pt(r);return this._layers[l]?(this._loaded&&r.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:r}),r.fire("remove")),r._map=r._mapToAdd=null,this):this},hasLayer:function(r){return Pt(r)in this._layers},eachLayer:function(r,l){for(var _ in this._layers)r.call(l,this._layers[_]);return this},_addLayers:function(r){r=r?ii(r)?r:[r]:[];for(var l=0,_=r.length;l<_;l++)this.addLayer(r[l])},_addZoomLimit:function(r){(!isNaN(r.options.maxZoom)||!isNaN(r.options.minZoom))&&(this._zoomBoundLayers[Pt(r)]=r,this._updateZoomLevels())},_removeZoomLimit:function(r){var l=Pt(r);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var r=1/0,l=-1/0,_=this._getZoomSpan();for(var b in this._zoomBoundLayers){var A=this._zoomBoundLayers[b].options;r=A.minZoom===void 0?r:Math.min(r,A.minZoom),l=A.maxZoom===void 0?l:Math.max(l,A.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=r===1/0?void 0:r,_!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ar=Ki.extend({initialize:function(r,l){ce(this,l),this._layers={};var _,b;if(r)for(_=0,b=r.length;_<b;_++)this.addLayer(r[_])},addLayer:function(r){var l=this.getLayerId(r);return this._layers[l]=r,this._map&&this._map.addLayer(r),this},removeLayer:function(r){var l=r in this._layers?r:this.getLayerId(r);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(r){var l=typeof r=="number"?r:this.getLayerId(r);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(r){var l=Array.prototype.slice.call(arguments,1),_,b;for(_ in this._layers)b=this._layers[_],b[r]&&b[r].apply(b,l);return this},onAdd:function(r){this.eachLayer(r.addLayer,r)},onRemove:function(r){this.eachLayer(r.removeLayer,r)},eachLayer:function(r,l){for(var _ in this._layers)r.call(l,this._layers[_]);return this},getLayer:function(r){return this._layers[r]},getLayers:function(){var r=[];return this.eachLayer(r.push,r),r},setZIndex:function(r){return this.invoke("setZIndex",r)},getLayerId:function(r){return Pt(r)}}),Cn=function(r,l){return new ar(r,l)},$n=ar.extend({addLayer:function(r){return this.hasLayer(r)?this:(r.addEventParent(this),ar.prototype.addLayer.call(this,r),this.fire("layeradd",{layer:r}))},removeLayer:function(r){return this.hasLayer(r)?(r in this._layers&&(r=this._layers[r]),r.removeEventParent(this),ar.prototype.removeLayer.call(this,r),this.fire("layerremove",{layer:r})):this},setStyle:function(r){return this.invoke("setStyle",r)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var r=new yi;for(var l in this._layers){var _=this._layers[l];r.extend(_.getBounds?_.getBounds():_.getLatLng())}return r}}),qo=function(r,l){return new $n(r,l)},Kr=Ci.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(r){ce(this,r)},createIcon:function(r){return this._createIcon("icon",r)},createShadow:function(r){return this._createIcon("shadow",r)},_createIcon:function(r,l){var _=this._getIconUrl(r);if(!_){if(r==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var b=this._createImg(_,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(b,r),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),b},_setIconStyles:function(r,l){var _=this.options,b=_[l+"Size"];typeof b=="number"&&(b=[b,b]);var A=ne(b),U=ne(l==="shadow"&&_.shadowAnchor||_.iconAnchor||A&&A.divideBy(2,!0));r.className="leaflet-marker-"+l+" "+(_.className||""),U&&(r.style.marginLeft=-U.x+"px",r.style.marginTop=-U.y+"px"),A&&(r.style.width=A.x+"px",r.style.height=A.y+"px")},_createImg:function(r,l){return l=l||document.createElement("img"),l.src=r,l},_getIconUrl:function(r){return N.retina&&this.options[r+"RetinaUrl"]||this.options[r+"Url"]}});function Jr(r){return new Kr(r)}var lr=Kr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(r){return typeof lr.imagePath!="string"&&(lr.imagePath=this._detectIconPath()),(this.options.imagePath||lr.imagePath)+Kr.prototype._getIconUrl.call(this,r)},_stripUrl:function(r){var l=function(_,b,A){var U=b.exec(_);return U&&U[A]};return r=l(r,/^url\((['"])?(.+)\1\)$/,2),r&&l(r,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var r=Ee("div","leaflet-default-icon-path",document.body),l=fi(r,"background-image")||fi(r,"backgroundImage");if(document.body.removeChild(r),l=this._stripUrl(l),l)return l;var _=document.querySelector('link[href$="leaflet.css"]');return _?_.href.substring(0,_.href.length-11-1):""}}),Yr=vn.extend({initialize:function(r){this._marker=r},addHooks:function(){var r=this._marker._icon;this._draggable||(this._draggable=new qn(r,r,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ge(r,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&si(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(r){var l=this._marker,_=l._map,b=this._marker.options.autoPanSpeed,A=this._marker.options.autoPanPadding,U=Pn(l._icon),et=_.getPixelBounds(),it=_.getPixelOrigin(),ot=gi(et.min._subtract(it).add(A),et.max._subtract(it).subtract(A));if(!ot.contains(U)){var Ct=ne((Math.max(ot.max.x,U.x)-ot.max.x)/(et.max.x-ot.max.x)-(Math.min(ot.min.x,U.x)-ot.min.x)/(et.min.x-ot.min.x),(Math.max(ot.max.y,U.y)-ot.max.y)/(et.max.y-ot.max.y)-(Math.min(ot.min.y,U.y)-ot.min.y)/(et.min.y-ot.min.y)).multiplyBy(b);_.panBy(Ct,{animate:!1}),this._draggable._newPos._add(Ct),this._draggable._startPos._add(Ct),Je(l._icon,this._draggable._newPos),this._onDrag(r),this._panRequest=ui(this._adjustPan.bind(this,r))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(r){this._marker.options.autoPan&&(di(this._panRequest),this._panRequest=ui(this._adjustPan.bind(this,r)))},_onDrag:function(r){var l=this._marker,_=l._shadow,b=Pn(l._icon),A=l._map.layerPointToLatLng(b);_&&Je(_,b),l._latlng=A,r.latlng=A,r.oldLatLng=this._oldLatLng,l.fire("move",r).fire("drag",r)},_onDragEnd:function(r){di(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",r)}}),mo=Ki.extend({options:{icon:new lr,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(r,l){ce(this,l),this._latlng=De(r)},onAdd:function(r){this._zoomAnimated=this._zoomAnimated&&r.options.markerZoomAnimation,this._zoomAnimated&&r.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(r){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&r.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(r){var l=this._latlng;return this._latlng=De(r),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(r){return this.options.zIndexOffset=r,this.update()},getIcon:function(){return this.options.icon},setIcon:function(r){return this.options.icon=r,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var r=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(r)}return this},_initIcon:function(){var r=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),_=r.icon.createIcon(this._icon),b=!1;_!==this._icon&&(this._icon&&this._removeIcon(),b=!0,r.title&&(_.title=r.title),_.tagName==="IMG"&&(_.alt=r.alt||"")),ge(_,l),r.keyboard&&(_.tabIndex="0",_.setAttribute("role","button")),this._icon=_,r.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&_e(_,"focus",this._panOnFocus,this);var A=r.icon.createShadow(this._shadow),U=!1;A!==this._shadow&&(this._removeShadow(),U=!0),A&&(ge(A,l),A.alt=""),this._shadow=A,r.opacity<1&&this._updateOpacity(),b&&this.getPane().appendChild(this._icon),this._initInteraction(),A&&U&&this.getPane(r.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ye(this._icon,"focus",this._panOnFocus,this),je(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&je(this._shadow),this._shadow=null},_setPos:function(r){this._icon&&Je(this._icon,r),this._shadow&&Je(this._shadow,r),this._zIndex=r.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(r){this._icon&&(this._icon.style.zIndex=this._zIndex+r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center).round();this._setPos(l)},_initInteraction:function(){if(this.options.interactive&&(ge(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Yr)){var r=this.options.draggable;this.dragging&&(r=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Yr(this),r&&this.dragging.enable()}},setOpacity:function(r){return this.options.opacity=r,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var r=this.options.opacity;this._icon&&Hi(this._icon,r),this._shadow&&Hi(this._shadow,r)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var r=this._map;if(r){var l=this.options.icon.options,_=l.iconSize?ne(l.iconSize):ne(0,0),b=l.iconAnchor?ne(l.iconAnchor):ne(0,0);r.panInside(this._latlng,{paddingTopLeft:b,paddingBottomRight:_.subtract(b)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function _o(r,l){return new mo(r,l)}var hr=Ki.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(r){this._renderer=r.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(r){return ce(this,r),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&r&&Object.prototype.hasOwnProperty.call(r,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Us=hr.extend({options:{fill:!0,radius:10},initialize:function(r,l){ce(this,l),this._latlng=De(r),this._radius=this.options.radius},setLatLng:function(r){var l=this._latlng;return this._latlng=De(r),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(r){return this.options.radius=this._radius=r,this.redraw()},getRadius:function(){return this._radius},setStyle:function(r){var l=r&&r.radius||this._radius;return hr.prototype.setStyle.call(this,r),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,l=this._radiusY||r,_=this._clickTolerance(),b=[r+_,l+_];this._pxBounds=new Ze(this._point.subtract(b),this._point.add(b))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(r){return r.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ns(r,l){return new Us(r,l)}var Zs=Us.extend({initialize:function(r,l,_){if(typeof l=="number"&&(l=R({},_,{radius:l})),ce(this,l),this._latlng=De(r),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(r){return this._mRadius=r,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var r=[this._radius,this._radiusY||this._radius];return new yi(this._map.layerPointToLatLng(this._point.subtract(r)),this._map.layerPointToLatLng(this._point.add(r)))},setStyle:hr.prototype.setStyle,_project:function(){var r=this._latlng.lng,l=this._latlng.lat,_=this._map,b=_.options.crs;if(b.distance===Ni.distance){var A=Math.PI/180,U=this._mRadius/Ni.R/A,et=_.project([l+U,r]),it=_.project([l-U,r]),ot=et.add(it).divideBy(2),Ct=_.unproject(ot).lat,$t=Math.acos((Math.cos(U*A)-Math.sin(l*A)*Math.sin(Ct*A))/(Math.cos(l*A)*Math.cos(Ct*A)))/A;(isNaN($t)||$t===0)&&($t=U/Math.cos(Math.PI/180*l)),this._point=ot.subtract(_.getPixelOrigin()),this._radius=isNaN($t)?0:ot.x-_.project([Ct,r-$t]).x,this._radiusY=ot.y-et.y}else{var se=b.unproject(b.project(this._latlng).subtract([this._mRadius,0]));this._point=_.latLngToLayerPoint(this._latlng),this._radius=this._point.x-_.latLngToLayerPoint(se).x}this._updateBounds()}});function go(r,l,_){return new Zs(r,l,_)}var hn=hr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(r,l){ce(this,l),this._setLatLngs(r)},getLatLngs:function(){return this._latlngs},setLatLngs:function(r){return this._setLatLngs(r),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(r){for(var l=1/0,_=null,b=Fe,A,U,et=0,it=this._parts.length;et<it;et++)for(var ot=this._parts[et],Ct=1,$t=ot.length;Ct<$t;Ct++){A=ot[Ct-1],U=ot[Ct];var se=b(r,A,U,!0);se<l&&(l=se,_=b(r,A,U))}return _&&(_.distance=Math.sqrt(l)),_},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Hr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(r,l){return l=l||this._defaultShape(),r=De(r),l.push(r),this._bounds.extend(r),this.redraw()},_setLatLngs:function(r){this._bounds=new yi,this._latlngs=this._convertLatLngs(r)},_defaultShape:function(){return ze(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(r){for(var l=[],_=ze(r),b=0,A=r.length;b<A;b++)_?(l[b]=De(r[b]),this._bounds.extend(l[b])):l[b]=this._convertLatLngs(r[b]);return l},_project:function(){var r=new Ze;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,r),this._bounds.isValid()&&r.isValid()&&(this._rawPxBounds=r,this._updateBounds())},_updateBounds:function(){var r=this._clickTolerance(),l=new ae(r,r);this._rawPxBounds&&(this._pxBounds=new Ze([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(r,l,_){var b=r[0]instanceof Ie,A=r.length,U,et;if(b){for(et=[],U=0;U<A;U++)et[U]=this._map.latLngToLayerPoint(r[U]),_.extend(et[U]);l.push(et)}else for(U=0;U<A;U++)this._projectLatlngs(r[U],l,_)},_clipPoints:function(){var r=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,_,b,A,U,et,it,ot;for(_=0,A=0,U=this._rings.length;_<U;_++)for(ot=this._rings[_],b=0,et=ot.length;b<et-1;b++)it=He(ot[b],ot[b+1],r,b,!0),it&&(l[A]=l[A]||[],l[A].push(it[0]),(it[1]!==ot[b+1]||b===et-2)&&(l[A].push(it[1]),A++))}},_simplifyPoints:function(){for(var r=this._parts,l=this.options.smoothFactor,_=0,b=r.length;_<b;_++)r[_]=jr(r[_],l)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(r,l){var _,b,A,U,et,it,ot=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(_=0,U=this._parts.length;_<U;_++)for(it=this._parts[_],b=0,et=it.length,A=et-1;b<et;A=b++)if(!(!l&&b===0)&&Vo(r,it[A],it[b])<=ot)return!0;return!1}});function xs(r,l){return new hn(r,l)}hn._flat=ys;var jn=hn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Go(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(r){var l=hn.prototype._convertLatLngs.call(this,r),_=l.length;return _>=2&&l[0]instanceof Ie&&l[0].equals(l[_-1])&&l.pop(),l},_setLatLngs:function(r){hn.prototype._setLatLngs.call(this,r),ze(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ze(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var r=this._renderer._bounds,l=this.options.weight,_=new ae(l,l);if(r=new Ze(r.min.subtract(_),r.max.add(_)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}for(var b=0,A=this._rings.length,U;b<A;b++)U=ca(this._rings[b],r,!0),U.length&&this._parts.push(U)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(r){var l=!1,_,b,A,U,et,it,ot,Ct;if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(U=0,ot=this._parts.length;U<ot;U++)for(_=this._parts[U],et=0,Ct=_.length,it=Ct-1;et<Ct;it=et++)b=_[et],A=_[it],b.y>r.y!=A.y>r.y&&r.x<(A.x-b.x)*(r.y-b.y)/(A.y-b.y)+b.x&&(l=!l);return l||hn.prototype._containsPoint.call(this,r,!0)}});function da(r,l){return new jn(r,l)}var cn=$n.extend({initialize:function(r,l){ce(this,l),this._layers={},r&&this.addData(r)},addData:function(r){var l=ii(r)?r:r.features,_,b,A;if(l){for(_=0,b=l.length;_<b;_++)A=l[_],(A.geometries||A.geometry||A.features||A.coordinates)&&this.addData(A);return this}var U=this.options;if(U.filter&&!U.filter(r))return this;var et=Vs(r,U);return et?(et.feature=Li(r),et.defaultOptions=et.options,this.resetStyle(et),U.onEachFeature&&U.onEachFeature(r,et),this.addLayer(et)):this},resetStyle:function(r){return r===void 0?this.eachLayer(this.resetStyle,this):(r.options=R({},r.defaultOptions),this._setLayerStyle(r,this.options.style),this)},setStyle:function(r){return this.eachLayer(function(l){this._setLayerStyle(l,r)},this)},_setLayerStyle:function(r,l){r.setStyle&&(typeof l=="function"&&(l=l(r.feature)),r.setStyle(l))}});function Vs(r,l){var _=r.type==="Feature"?r.geometry:r,b=_?_.coordinates:null,A=[],U=l&&l.pointToLayer,et=l&&l.coordsToLatLng||yo,it,ot,Ct,$t;if(!b&&!_)return null;switch(_.type){case"Point":return it=et(b),$o(U,r,it,l);case"MultiPoint":for(Ct=0,$t=b.length;Ct<$t;Ct++)it=et(b[Ct]),A.push($o(U,r,it,l));return new $n(A);case"LineString":case"MultiLineString":return ot=cr(b,_.type==="LineString"?0:1,et),new hn(ot,l);case"Polygon":case"MultiPolygon":return ot=cr(b,_.type==="Polygon"?1:2,et),new jn(ot,l);case"GeometryCollection":for(Ct=0,$t=_.geometries.length;Ct<$t;Ct++){var se=Vs({geometry:_.geometries[Ct],type:"Feature",properties:r.properties},l);se&&A.push(se)}return new $n(A);case"FeatureCollection":for(Ct=0,$t=_.features.length;Ct<$t;Ct++){var oe=Vs(_.features[Ct],l);oe&&A.push(oe)}return new $n(A);default:throw new Error("Invalid GeoJSON object.")}}function $o(r,l,_,b){return r?r(l,_):new mo(_,b&&b.markersInheritOptions&&b)}function yo(r){return new Ie(r[1],r[0],r[2])}function cr(r,l,_){for(var b=[],A=0,U=r.length,et;A<U;A++)et=l?cr(r[A],l-1,_):(_||yo)(r[A]),b.push(et);return b}function vo(r,l){return r=De(r),r.alt!==void 0?[ft(r.lng,l),ft(r.lat,l),ft(r.alt,l)]:[ft(r.lng,l),ft(r.lat,l)]}function Lr(r,l,_,b){for(var A=[],U=0,et=r.length;U<et;U++)A.push(l?Lr(r[U],ze(r[U])?0:l-1,_,b):vo(r[U],b));return!l&&_&&A.push(A[0].slice()),A}function Wn(r,l){return r.feature?R({},r.feature,{geometry:l}):Li(l)}function Li(r){return r.type==="Feature"||r.type==="FeatureCollection"?r:{type:"Feature",properties:{},geometry:r}}var Qr={toGeoJSON:function(r){return Wn(this,{type:"Point",coordinates:vo(this.getLatLng(),r)})}};mo.include(Qr),Zs.include(Qr),Us.include(Qr),hn.include({toGeoJSON:function(r){var l=!ze(this._latlngs),_=Lr(this._latlngs,l?1:0,!1,r);return Wn(this,{type:(l?"Multi":"")+"LineString",coordinates:_})}}),jn.include({toGeoJSON:function(r){var l=!ze(this._latlngs),_=l&&!ze(this._latlngs[0]),b=Lr(this._latlngs,_?2:l?1:0,!0,r);return l||(b=[b]),Wn(this,{type:(_?"Multi":"")+"Polygon",coordinates:b})}}),ar.include({toMultiPoint:function(r){var l=[];return this.eachLayer(function(_){l.push(_.toGeoJSON(r).geometry.coordinates)}),Wn(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(r){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(r);var _=l==="GeometryCollection",b=[];return this.eachLayer(function(A){if(A.toGeoJSON){var U=A.toGeoJSON(r);if(_)b.push(U.geometry);else{var et=Li(U);et.type==="FeatureCollection"?b.push.apply(b,et.features):b.push(et)}}}),_?Wn(this,{geometries:b,type:"GeometryCollection"}):{type:"FeatureCollection",features:b}}});function Ji(r,l){return new cn(r,l)}var Oa=Ji,Mn=Ki.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(r,l,_){this._url=r,this._bounds=ri(l),ce(this,_)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ge(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){je(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(r){return this.options.opacity=r,this._image&&this._updateOpacity(),this},setStyle:function(r){return r.opacity&&this.setOpacity(r.opacity),this},bringToFront:function(){return this._map&&Ir(this._image),this},bringToBack:function(){return this._map&&Er(this._image),this},setUrl:function(r){return this._url=r,this._image&&(this._image.src=r),this},setBounds:function(r){return this._bounds=ri(r),this._map&&this._reset(),this},getEvents:function(){var r={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var r=this._url.tagName==="IMG",l=this._image=r?this._url:Ee("img");if(ge(l,"leaflet-image-layer"),this._zoomAnimated&&ge(l,"leaflet-zoom-animated"),this.options.className&&ge(l,this.options.className),l.onselectstart=Gt,l.onmousemove=Gt,l.onload=lt(this.fire,this,"load"),l.onerror=lt(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),r){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(r){var l=this._map.getZoomScale(r.zoom),_=this._map._latLngBoundsToNewLayerBounds(this._bounds,r.zoom,r.center).min;Pr(this._image,_,l)},_reset:function(){var r=this._image,l=new Ze(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),_=l.getSize();Je(r,l.min),r.style.width=_.x+"px",r.style.height=_.y+"px"},_updateOpacity:function(){Hi(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var r=this.options.errorOverlayUrl;r&&this._url!==r&&(this._url=r,this._image.src=r)},getCenter:function(){return this._bounds.getCenter()}}),pa=function(r,l,_){return new Mn(r,l,_)},Hn=Mn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var r=this._url.tagName==="VIDEO",l=this._image=r?this._url:Ee("video");if(ge(l,"leaflet-image-layer"),this._zoomAnimated&&ge(l,"leaflet-zoom-animated"),this.options.className&&ge(l,this.options.className),l.onselectstart=Gt,l.onmousemove=Gt,l.onloadeddata=lt(this.fire,this,"load"),r){for(var _=l.getElementsByTagName("source"),b=[],A=0;A<_.length;A++)b.push(_[A].src);this._url=_.length>0?b:[l.src];return}ii(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var U=0;U<this._url.length;U++){var et=Ee("source");et.src=this._url[U],l.appendChild(et)}}});function Gs(r,l,_){return new Hn(r,l,_)}var xo=Mn.extend({_initImage:function(){var r=this._image=this._url;ge(r,"leaflet-image-layer"),this._zoomAnimated&&ge(r,"leaflet-zoom-animated"),this.options.className&&ge(r,this.options.className),r.onselectstart=Gt,r.onmousemove=Gt}});function Fa(r,l,_){return new xo(r,l,_)}var Xn=Ki.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(r,l){r&&(r instanceof Ie||ii(r))?(this._latlng=De(r),ce(this,l)):(ce(this,r),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(r){return r=arguments.length?r:this._source._map,r.hasLayer(this)||r.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(r){return this._map?this.close():(arguments.length?this._source=r:r=this._source,this._prepareOpen(),this.openOn(r._map)),this},onAdd:function(r){this._zoomAnimated=r._zoomAnimated,this._container||this._initLayout(),r._fadeAnimated&&Hi(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),r._fadeAnimated&&Hi(this._container,1),this.bringToFront(),this.options.interactive&&(ge(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(r){r._fadeAnimated?(Hi(this._container,0),this._removeTimeout=setTimeout(lt(je,void 0,this._container),200)):je(this._container),this.options.interactive&&(si(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(r){return this._latlng=De(r),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(r){return this._content=r,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var r={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ir(this._container),this},bringToBack:function(){return this._map&&Er(this._container),this},_prepareOpen:function(r){var l=this._source;if(!l._map)return!1;if(l instanceof $n){l=null;var _=this._source._layers;for(var b in _)if(_[b]._map){l=_[b];break}if(!l)return!1;this._source=l}if(!r)if(l.getCenter)r=l.getCenter();else if(l.getLatLng)r=l.getLatLng();else if(l.getBounds)r=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(r),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var r=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")r.innerHTML=l;else{for(;r.hasChildNodes();)r.removeChild(r.firstChild);r.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var r=this._map.latLngToLayerPoint(this._latlng),l=ne(this.options.offset),_=this._getAnchor();this._zoomAnimated?Je(this._container,r.add(_)):l=l.add(r).add(_);var b=this._containerBottom=-l.y,A=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=b+"px",this._container.style.left=A+"px"}},_getAnchor:function(){return[0,0]}});Pe.include({_initOverlay:function(r,l,_,b){var A=l;return A instanceof r||(A=new r(b).setContent(l)),_&&A.setLatLng(_),A}}),Ki.include({_initOverlay:function(r,l,_,b){var A=_;return A instanceof r?(ce(A,b),A._source=this):(A=l&&!b?l:new r(b,this),A.setContent(_)),A}});var ts=Xn.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(r){return r=arguments.length?r:this._source._map,!r.hasLayer(this)&&r._popup&&r._popup.options.autoClose&&r.removeLayer(r._popup),r._popup=this,Xn.prototype.openOn.call(this,r)},onAdd:function(r){Xn.prototype.onAdd.call(this,r),r.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof hr||this._source.on("preclick",xe))},onRemove:function(r){Xn.prototype.onRemove.call(this,r),r.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof hr||this._source.off("preclick",xe))},getEvents:function(){var r=Xn.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(r.preclick=this.close),this.options.keepInView&&(r.moveend=this._adjustPan),r},_initLayout:function(){var r="leaflet-popup",l=this._container=Ee("div",r+" "+(this.options.className||"")+" leaflet-zoom-animated"),_=this._wrapper=Ee("div",r+"-content-wrapper",l);if(this._contentNode=Ee("div",r+"-content",_),Ds(l),lo(this._contentNode),_e(l,"contextmenu",xe),this._tipContainer=Ee("div",r+"-tip-container",l),this._tip=Ee("div",r+"-tip",this._tipContainer),this.options.closeButton){var b=this._closeButton=Ee("a",r+"-close-button",l);b.setAttribute("role","button"),b.setAttribute("aria-label","Close popup"),b.href="#close",b.innerHTML='<span aria-hidden="true">&#215;</span>',_e(b,"click",function(A){hi(A),this.close()},this)}},_updateLayout:function(){var r=this._contentNode,l=r.style;l.width="",l.whiteSpace="nowrap";var _=r.offsetWidth;_=Math.min(_,this.options.maxWidth),_=Math.max(_,this.options.minWidth),l.width=_+1+"px",l.whiteSpace="",l.height="";var b=r.offsetHeight,A=this.options.maxHeight,U="leaflet-popup-scrolled";A&&b>A?(l.height=A+"px",ge(r,U)):si(r,U),this._containerWidth=this._container.offsetWidth},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center),_=this._getAnchor();Je(this._container,l.add(_))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var r=this._map,l=parseInt(fi(this._container,"marginBottom"),10)||0,_=this._container.offsetHeight+l,b=this._containerWidth,A=new ae(this._containerLeft,-_-this._containerBottom);A._add(Pn(this._container));var U=r.layerPointToContainerPoint(A),et=ne(this.options.autoPanPadding),it=ne(this.options.autoPanPaddingTopLeft||et),ot=ne(this.options.autoPanPaddingBottomRight||et),Ct=r.getSize(),$t=0,se=0;U.x+b+ot.x>Ct.x&&($t=U.x+b-Ct.x+ot.x),U.x-$t-it.x<0&&($t=U.x-it.x),U.y+_+ot.y>Ct.y&&(se=U.y+_-Ct.y+ot.y),U.y-se-it.y<0&&(se=U.y-it.y),($t||se)&&(this.options.keepInView&&(this._autopanning=!0),r.fire("autopanstart").panBy([$t,se]))}},_getAnchor:function(){return ne(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),qs=function(r,l){return new ts(r,l)};Pe.mergeOptions({closePopupOnClick:!0}),Pe.include({openPopup:function(r,l,_){return this._initOverlay(ts,r,l,_).openOn(this),this},closePopup:function(r){return r=arguments.length?r:this._popup,r&&r.close(),this}}),Ki.include({bindPopup:function(r,l){return this._popup=this._initOverlay(ts,this._popup,r,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(r){return this._popup&&(this instanceof $n||(this._popup._source=this),this._popup._prepareOpen(r||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(r){return this._popup&&this._popup.setContent(r),this},getPopup:function(){return this._popup},_openPopup:function(r){if(!(!this._popup||!this._map)){An(r);var l=r.layer||r.target;if(this._popup._source===l&&!(l instanceof hr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(r.latlng);return}this._popup._source=l,this.openPopup(r.latlng)}},_movePopup:function(r){this._popup.setLatLng(r.latlng)},_onKeyPress:function(r){r.originalEvent.keyCode===13&&this._openPopup(r)}});var xn=Xn.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(r){Xn.prototype.onAdd.call(this,r),this.setOpacity(this.options.opacity),r.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(r){Xn.prototype.onRemove.call(this,r),r.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var r=Xn.prototype.getEvents.call(this);return this.options.permanent||(r.preclick=this.close),r},_initLayout:function(){var r="leaflet-tooltip",l=r+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ee("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+Pt(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(r){var l,_,b=this._map,A=this._container,U=b.latLngToContainerPoint(b.getCenter()),et=b.layerPointToContainerPoint(r),it=this.options.direction,ot=A.offsetWidth,Ct=A.offsetHeight,$t=ne(this.options.offset),se=this._getAnchor();it==="top"?(l=ot/2,_=Ct):it==="bottom"?(l=ot/2,_=0):it==="center"?(l=ot/2,_=Ct/2):it==="right"?(l=0,_=Ct/2):it==="left"?(l=ot,_=Ct/2):et.x<U.x?(it="right",l=0,_=Ct/2):(it="left",l=ot+($t.x+se.x)*2,_=Ct/2),r=r.subtract(ne(l,_,!0)).add($t).add(se),si(A,"leaflet-tooltip-right"),si(A,"leaflet-tooltip-left"),si(A,"leaflet-tooltip-top"),si(A,"leaflet-tooltip-bottom"),ge(A,"leaflet-tooltip-"+it),Je(A,r)},_updatePosition:function(){var r=this._map.latLngToLayerPoint(this._latlng);this._setPosition(r)},setOpacity:function(r){this.options.opacity=r,this._container&&Hi(this._container,r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center);this._setPosition(l)},_getAnchor:function(){return ne(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),qt=function(r,l){return new xn(r,l)};Pe.include({openTooltip:function(r,l,_){return this._initOverlay(xn,r,l,_).openOn(this),this},closeTooltip:function(r){return r.close(),this}}),Ki.include({bindTooltip:function(r,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(xn,this._tooltip,r,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(r){if(!(!r&&this._tooltipHandlersAdded)){var l=r?"off":"on",_={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?_.add=this._openTooltip:(_.mouseover=this._openTooltip,_.mouseout=this.closeTooltip,_.click=this._openTooltip,this._map?this._addFocusListeners():_.add=this._addFocusListeners),this._tooltip.options.sticky&&(_.mousemove=this._moveTooltip),this[l](_),this._tooltipHandlersAdded=!r}},openTooltip:function(r){return this._tooltip&&(this instanceof $n||(this._tooltip._source=this),this._tooltip._prepareOpen(r)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(r){return this._tooltip&&this._tooltip.setContent(r),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(r){var l=r.getElement();l&&(_e(l,"focus",function(){this._tooltip._source=r,this.openTooltip()},this),_e(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(r){var l=r.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(r){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=r.layer||r.target,this.openTooltip(this._tooltip.options.sticky?r.latlng:void 0))},_moveTooltip:function(r){var l=r.latlng,_,b;this._tooltip.options.sticky&&r.originalEvent&&(_=this._map.mouseEventToContainerPoint(r.originalEvent),b=this._map.containerPointToLayerPoint(_),l=this._map.layerPointToLatLng(b)),this._tooltip.setLatLng(l)}});var jo=Kr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(r){var l=r&&r.tagName==="DIV"?r:document.createElement("div"),_=this.options;if(_.html instanceof Element?(Oe(l),l.appendChild(_.html)):l.innerHTML=_.html!==!1?_.html:"",_.bgPos){var b=ne(_.bgPos);l.style.backgroundPosition=-b.x+"px "+-b.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function es(r){return new jo(r)}Kr.Default=lr;var bn=Ki.extend({options:{tileSize:256,opacity:1,updateWhenIdle:N.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(r){ce(this,r)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(r){r._addZoomLimit(this)},onRemove:function(r){this._removeAllTiles(),je(this._container),r._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ir(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Er(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(r){return this.options.opacity=r,this._updateOpacity(),this},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var r=this._clampZoom(this._map.getZoom());r!==this._tileZoom&&(this._tileZoom=r,this._updateLevels()),this._update()}return this},getEvents:function(){var r={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=ee(this._onMoveEnd,this.options.updateInterval,this)),r.move=this._onMove),this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},createTile:function(){return document.createElement("div")},getTileSize:function(){var r=this.options.tileSize;return r instanceof ae?r:new ae(r,r)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(r){for(var l=this.getPane().children,_=-r(-1/0,1/0),b=0,A=l.length,U;b<A;b++)U=l[b].style.zIndex,l[b]!==this._container&&U&&(_=r(_,+U));isFinite(_)&&(this.options.zIndex=_+r(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!N.ielt9){Hi(this._container,this.options.opacity);var r=+new Date,l=!1,_=!1;for(var b in this._tiles){var A=this._tiles[b];if(!(!A.current||!A.loaded)){var U=Math.min(1,(r-A.loaded)/200);Hi(A.el,U),U<1?l=!0:(A.active?_=!0:this._onOpaqueTile(A),A.active=!0)}}_&&!this._noPrune&&this._pruneTiles(),l&&(di(this._fadeFrame),this._fadeFrame=ui(this._updateOpacity,this))}},_onOpaqueTile:Gt,_initContainer:function(){this._container||(this._container=Ee("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var r=this._tileZoom,l=this.options.maxZoom;if(r!==void 0){for(var _ in this._levels)_=Number(_),this._levels[_].el.children.length||_===r?(this._levels[_].el.style.zIndex=l-Math.abs(r-_),this._onUpdateLevel(_)):(je(this._levels[_].el),this._removeTilesAtZoom(_),this._onRemoveLevel(_),delete this._levels[_]);var b=this._levels[r],A=this._map;return b||(b=this._levels[r]={},b.el=Ee("div","leaflet-tile-container leaflet-zoom-animated",this._container),b.el.style.zIndex=l,b.origin=A.project(A.unproject(A.getPixelOrigin()),r).round(),b.zoom=r,this._setZoomTransform(b,A.getCenter(),A.getZoom()),Gt(b.el.offsetWidth),this._onCreateLevel(b)),this._level=b,b}},_onUpdateLevel:Gt,_onRemoveLevel:Gt,_onCreateLevel:Gt,_pruneTiles:function(){if(this._map){var r,l,_=this._map.getZoom();if(_>this.options.maxZoom||_<this.options.minZoom){this._removeAllTiles();return}for(r in this._tiles)l=this._tiles[r],l.retain=l.current;for(r in this._tiles)if(l=this._tiles[r],l.current&&!l.active){var b=l.coords;this._retainParent(b.x,b.y,b.z,b.z-5)||this._retainChildren(b.x,b.y,b.z,b.z+2)}for(r in this._tiles)this._tiles[r].retain||this._removeTile(r)}},_removeTilesAtZoom:function(r){for(var l in this._tiles)this._tiles[l].coords.z===r&&this._removeTile(l)},_removeAllTiles:function(){for(var r in this._tiles)this._removeTile(r)},_invalidateAll:function(){for(var r in this._levels)je(this._levels[r].el),this._onRemoveLevel(Number(r)),delete this._levels[r];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(r,l,_,b){var A=Math.floor(r/2),U=Math.floor(l/2),et=_-1,it=new ae(+A,+U);it.z=+et;var ot=this._tileCoordsToKey(it),Ct=this._tiles[ot];return Ct&&Ct.active?(Ct.retain=!0,!0):(Ct&&Ct.loaded&&(Ct.retain=!0),et>b?this._retainParent(A,U,et,b):!1)},_retainChildren:function(r,l,_,b){for(var A=2*r;A<2*r+2;A++)for(var U=2*l;U<2*l+2;U++){var et=new ae(A,U);et.z=_+1;var it=this._tileCoordsToKey(et),ot=this._tiles[it];if(ot&&ot.active){ot.retain=!0;continue}else ot&&ot.loaded&&(ot.retain=!0);_+1<b&&this._retainChildren(A,U,_+1,b)}},_resetView:function(r){var l=r&&(r.pinch||r.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(r){this._setView(r.center,r.zoom,!0,r.noUpdate)},_clampZoom:function(r){var l=this.options;return l.minNativeZoom!==void 0&&r<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<r?l.maxNativeZoom:r},_setView:function(r,l,_,b){var A=Math.round(l);this.options.maxZoom!==void 0&&A>this.options.maxZoom||this.options.minZoom!==void 0&&A<this.options.minZoom?A=void 0:A=this._clampZoom(A);var U=this.options.updateWhenZooming&&A!==this._tileZoom;(!b||U)&&(this._tileZoom=A,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),A!==void 0&&this._update(r),_||this._pruneTiles(),this._noPrune=!!_),this._setZoomTransforms(r,l)},_setZoomTransforms:function(r,l){for(var _ in this._levels)this._setZoomTransform(this._levels[_],r,l)},_setZoomTransform:function(r,l,_){var b=this._map.getZoomScale(_,r.zoom),A=r.origin.multiplyBy(b).subtract(this._map._getNewPixelOrigin(l,_)).round();N.any3d?Pr(r.el,A,b):Je(r.el,A)},_resetGrid:function(){var r=this._map,l=r.options.crs,_=this._tileSize=this.getTileSize(),b=this._tileZoom,A=this._map.getPixelWorldBounds(this._tileZoom);A&&(this._globalTileRange=this._pxBoundsToTileRange(A)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(r.project([0,l.wrapLng[0]],b).x/_.x),Math.ceil(r.project([0,l.wrapLng[1]],b).x/_.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(r.project([l.wrapLat[0],0],b).y/_.x),Math.ceil(r.project([l.wrapLat[1],0],b).y/_.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(r){var l=this._map,_=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),b=l.getZoomScale(_,this._tileZoom),A=l.project(r,this._tileZoom).floor(),U=l.getSize().divideBy(b*2);return new Ze(A.subtract(U),A.add(U))},_update:function(r){var l=this._map;if(l){var _=this._clampZoom(l.getZoom());if(r===void 0&&(r=l.getCenter()),this._tileZoom!==void 0){var b=this._getTiledPixelBounds(r),A=this._pxBoundsToTileRange(b),U=A.getCenter(),et=[],it=this.options.keepBuffer,ot=new Ze(A.getBottomLeft().subtract([it,-it]),A.getTopRight().add([it,-it]));if(!(isFinite(A.min.x)&&isFinite(A.min.y)&&isFinite(A.max.x)&&isFinite(A.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ct in this._tiles){var $t=this._tiles[Ct].coords;($t.z!==this._tileZoom||!ot.contains(new ae($t.x,$t.y)))&&(this._tiles[Ct].current=!1)}if(Math.abs(_-this._tileZoom)>1){this._setView(r,_);return}for(var se=A.min.y;se<=A.max.y;se++)for(var oe=A.min.x;oe<=A.max.x;oe++){var xi=new ae(oe,se);if(xi.z=this._tileZoom,!!this._isValidTile(xi)){var ki=this._tiles[this._tileCoordsToKey(xi)];ki?ki.current=!0:et.push(xi)}}if(et.sort(function($i,ti){return $i.distanceTo(U)-ti.distanceTo(U)}),et.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Hs=document.createDocumentFragment();for(oe=0;oe<et.length;oe++)this._addTile(et[oe],Hs);this._level.el.appendChild(Hs)}}}},_isValidTile:function(r){var l=this._map.options.crs;if(!l.infinite){var _=this._globalTileRange;if(!l.wrapLng&&(r.x<_.min.x||r.x>_.max.x)||!l.wrapLat&&(r.y<_.min.y||r.y>_.max.y))return!1}if(!this.options.bounds)return!0;var b=this._tileCoordsToBounds(r);return ri(this.options.bounds).overlaps(b)},_keyToBounds:function(r){return this._tileCoordsToBounds(this._keyToTileCoords(r))},_tileCoordsToNwSe:function(r){var l=this._map,_=this.getTileSize(),b=r.scaleBy(_),A=b.add(_),U=l.unproject(b,r.z),et=l.unproject(A,r.z);return[U,et]},_tileCoordsToBounds:function(r){var l=this._tileCoordsToNwSe(r),_=new yi(l[0],l[1]);return this.options.noWrap||(_=this._map.wrapLatLngBounds(_)),_},_tileCoordsToKey:function(r){return r.x+":"+r.y+":"+r.z},_keyToTileCoords:function(r){var l=r.split(":"),_=new ae(+l[0],+l[1]);return _.z=+l[2],_},_removeTile:function(r){var l=this._tiles[r];l&&(je(l.el),delete this._tiles[r],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(r)}))},_initTile:function(r){ge(r,"leaflet-tile");var l=this.getTileSize();r.style.width=l.x+"px",r.style.height=l.y+"px",r.onselectstart=Gt,r.onmousemove=Gt,N.ielt9&&this.options.opacity<1&&Hi(r,this.options.opacity)},_addTile:function(r,l){var _=this._getTilePos(r),b=this._tileCoordsToKey(r),A=this.createTile(this._wrapCoords(r),lt(this._tileReady,this,r));this._initTile(A),this.createTile.length<2&&ui(lt(this._tileReady,this,r,null,A)),Je(A,_),this._tiles[b]={el:A,coords:r,current:!0},l.appendChild(A),this.fire("tileloadstart",{tile:A,coords:r})},_tileReady:function(r,l,_){l&&this.fire("tileerror",{error:l,tile:_,coords:r});var b=this._tileCoordsToKey(r);_=this._tiles[b],_&&(_.loaded=+new Date,this._map._fadeAnimated?(Hi(_.el,0),di(this._fadeFrame),this._fadeFrame=ui(this._updateOpacity,this)):(_.active=!0,this._pruneTiles()),l||(ge(_.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:_.el,coords:r})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),N.ielt9||!this._map._fadeAnimated?ui(this._pruneTiles,this):setTimeout(lt(this._pruneTiles,this),250)))},_getTilePos:function(r){return r.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(r){var l=new ae(this._wrapX?Se(r.x,this._wrapX):r.x,this._wrapY?Se(r.y,this._wrapY):r.y);return l.z=r.z,l},_pxBoundsToTileRange:function(r){var l=this.getTileSize();return new Ze(r.min.unscaleBy(l).floor(),r.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var r in this._tiles)if(!this._tiles[r].loaded)return!1;return!0}});function Wo(r){return new bn(r)}var Dt=bn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(r,l){this._url=r,l=ce(this,l),l.detectRetina&&N.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(r,l){return this._url===r&&l===void 0&&(l=!0),this._url=r,l||this.redraw(),this},createTile:function(r,l){var _=document.createElement("img");return _e(_,"load",lt(this._tileOnLoad,this,l,_)),_e(_,"error",lt(this._tileOnError,this,l,_)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(_.referrerPolicy=this.options.referrerPolicy),_.alt="",_.src=this.getTileUrl(r),_},getTileUrl:function(r){var l={r:N.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var _=this._globalTileRange.max.y-r.y;this.options.tms&&(l.y=_),l["-y"]=_}return mn(this._url,R(l,this.options))},_tileOnLoad:function(r,l){N.ielt9?setTimeout(lt(r,this,null,l),0):r(null,l)},_tileOnError:function(r,l,_){var b=this.options.errorTileUrl;b&&l.getAttribute("src")!==b&&(l.src=b),r(_,l)},_onTileRemove:function(r){r.tile.onload=null},_getZoomForUrl:function(){var r=this._tileZoom,l=this.options.maxZoom,_=this.options.zoomReverse,b=this.options.zoomOffset;return _&&(r=l-r),r+b},_getSubdomain:function(r){var l=Math.abs(r.x+r.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var r,l;for(r in this._tiles)if(this._tiles[r].coords.z!==this._tileZoom&&(l=this._tiles[r].el,l.onload=Gt,l.onerror=Gt,!l.complete)){l.src=ni;var _=this._tiles[r].coords;je(l),delete this._tiles[r],this.fire("tileabort",{tile:l,coords:_})}},_removeTile:function(r){var l=this._tiles[r];if(l)return l.el.setAttribute("src",ni),bn.prototype._removeTile.call(this,r)},_tileReady:function(r,l,_){if(!(!this._map||_&&_.getAttribute("src")===ni))return bn.prototype._tileReady.call(this,r,l,_)}});function $s(r,l){return new Dt(r,l)}var fa=Dt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(r,l){this._url=r;var _=R({},this.defaultWmsParams);for(var b in l)b in this.options||(_[b]=l[b]);l=ce(this,l);var A=l.detectRetina&&N.retina?2:1,U=this.getTileSize();_.width=U.x*A,_.height=U.y*A,this.wmsParams=_},onAdd:function(r){this._crs=this.options.crs||r.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,Dt.prototype.onAdd.call(this,r)},getTileUrl:function(r){var l=this._tileCoordsToNwSe(r),_=this._crs,b=gi(_.project(l[0]),_.project(l[1])),A=b.min,U=b.max,et=(this._wmsVersion>=1.3&&this._crs===fo?[A.y,A.x,U.y,U.x]:[A.x,A.y,U.x,U.y]).join(","),it=Dt.prototype.getTileUrl.call(this,r);return it+Or(this.wmsParams,it,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+et},setParams:function(r,l){return R(this.wmsParams,r),l||this.redraw(),this}});function Ho(r,l){return new fa(r,l)}Dt.WMS=fa,$s.wms=Ho;var zn=Ki.extend({options:{padding:.1},initialize:function(r){ce(this,r),Pt(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&ge(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var r={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(r.zoomanim=this._onAnimZoom),r},_onAnimZoom:function(r){this._updateTransform(r.center,r.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(r,l){var _=this._map.getZoomScale(l,this._zoom),b=this._map.getSize().multiplyBy(.5+this.options.padding),A=this._map.project(this._center,l),U=b.multiplyBy(-_).add(A).subtract(this._map._getNewPixelOrigin(r,l));N.any3d?Pr(this._container,U,_):Je(this._container,U)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var r in this._layers)this._layers[r]._reset()},_onZoomEnd:function(){for(var r in this._layers)this._layers[r]._project()},_updatePaths:function(){for(var r in this._layers)this._layers[r]._update()},_update:function(){var r=this.options.padding,l=this._map.getSize(),_=this._map.containerPointToLayerPoint(l.multiplyBy(-r)).round();this._bounds=new Ze(_,_.add(l.multiplyBy(1+r*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Xo=zn.extend({options:{tolerance:0},getEvents:function(){var r=zn.prototype.getEvents.call(this);return r.viewprereset=this._onViewPreReset,r},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var r=this._container=document.createElement("canvas");_e(r,"mousemove",this._onMouseMove,this),_e(r,"click dblclick mousedown mouseup contextmenu",this._onClick,this),_e(r,"mouseout",this._handleMouseOut,this),r._leaflet_disable_events=!0,this._ctx=r.getContext("2d")},_destroyContainer:function(){di(this._redrawRequest),delete this._ctx,je(this._container),Ye(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var r;this._redrawBounds=null;for(var l in this._layers)r=this._layers[l],r._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zn.prototype._update.call(this);var r=this._bounds,l=this._container,_=r.getSize(),b=N.retina?2:1;Je(l,r.min),l.width=b*_.x,l.height=b*_.y,l.style.width=_.x+"px",l.style.height=_.y+"px",N.retina&&this._ctx.scale(2,2),this._ctx.translate(-r.min.x,-r.min.y),this.fire("update")}},_reset:function(){zn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(r){this._updateDashArray(r),this._layers[Pt(r)]=r;var l=r._order={layer:r,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(r){this._requestRedraw(r)},_removePath:function(r){var l=r._order,_=l.next,b=l.prev;_?_.prev=b:this._drawLast=b,b?b.next=_:this._drawFirst=_,delete r._order,delete this._layers[Pt(r)],this._requestRedraw(r)},_updatePath:function(r){this._extendRedrawBounds(r),r._project(),r._update(),this._requestRedraw(r)},_updateStyle:function(r){this._updateDashArray(r),this._requestRedraw(r)},_updateDashArray:function(r){if(typeof r.options.dashArray=="string"){var l=r.options.dashArray.split(/[, ]+/),_=[],b,A;for(A=0;A<l.length;A++){if(b=Number(l[A]),isNaN(b))return;_.push(b)}r.options._dashArray=_}else r.options._dashArray=r.options.dashArray},_requestRedraw:function(r){this._map&&(this._extendRedrawBounds(r),this._redrawRequest=this._redrawRequest||ui(this._redraw,this))},_extendRedrawBounds:function(r){if(r._pxBounds){var l=(r.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ze,this._redrawBounds.extend(r._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(r._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var r=this._redrawBounds;if(r){var l=r.getSize();this._ctx.clearRect(r.min.x,r.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var r,l=this._redrawBounds;if(this._ctx.save(),l){var _=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,_.x,_.y),this._ctx.clip()}this._drawing=!0;for(var b=this._drawFirst;b;b=b.next)r=b.layer,(!l||r._pxBounds&&r._pxBounds.intersects(l))&&r._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(r,l){if(this._drawing){var _,b,A,U,et=r._parts,it=et.length,ot=this._ctx;if(it){for(ot.beginPath(),_=0;_<it;_++){for(b=0,A=et[_].length;b<A;b++)U=et[_][b],ot[b?"lineTo":"moveTo"](U.x,U.y);l&&ot.closePath()}this._fillStroke(ot,r)}}},_updateCircle:function(r){if(!(!this._drawing||r._empty())){var l=r._point,_=this._ctx,b=Math.max(Math.round(r._radius),1),A=(Math.max(Math.round(r._radiusY),1)||b)/b;A!==1&&(_.save(),_.scale(1,A)),_.beginPath(),_.arc(l.x,l.y/A,b,0,Math.PI*2,!1),A!==1&&_.restore(),this._fillStroke(_,r)}},_fillStroke:function(r,l){var _=l.options;_.fill&&(r.globalAlpha=_.fillOpacity,r.fillStyle=_.fillColor||_.color,r.fill(_.fillRule||"evenodd")),_.stroke&&_.weight!==0&&(r.setLineDash&&r.setLineDash(l.options&&l.options._dashArray||[]),r.globalAlpha=_.opacity,r.lineWidth=_.weight,r.strokeStyle=_.color,r.lineCap=_.lineCap,r.lineJoin=_.lineJoin,r.stroke())},_onClick:function(r){for(var l=this._map.mouseEventToLayerPoint(r),_,b,A=this._drawFirst;A;A=A.next)_=A.layer,_.options.interactive&&_._containsPoint(l)&&(!(r.type==="click"||r.type==="preclick")||!this._map._draggableMoved(_))&&(b=_);this._fireEvent(b?[b]:!1,r)},_onMouseMove:function(r){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(r);this._handleMouseHover(r,l)}},_handleMouseOut:function(r){var l=this._hoveredLayer;l&&(si(this._container,"leaflet-interactive"),this._fireEvent([l],r,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(r,l){if(!this._mouseHoverThrottled){for(var _,b,A=this._drawFirst;A;A=A.next)_=A.layer,_.options.interactive&&_._containsPoint(l)&&(b=_);b!==this._hoveredLayer&&(this._handleMouseOut(r),b&&(ge(this._container,"leaflet-interactive"),this._fireEvent([b],r,"mouseover"),this._hoveredLayer=b)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,r),this._mouseHoverThrottled=!0,setTimeout(lt(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(r,l,_){this._map._fireDOMEvent(l,_||l.type,r)},_bringToFront:function(r){var l=r._order;if(l){var _=l.next,b=l.prev;if(_)_.prev=b;else return;b?b.next=_:_&&(this._drawFirst=_),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(r)}},_bringToBack:function(r){var l=r._order;if(l){var _=l.next,b=l.prev;if(b)b.next=_;else return;_?_.prev=b:b&&(this._drawLast=b),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(r)}}});function Ko(r){return N.canvas?new Xo(r):null}var js=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(r){return document.createElement("<lvml:"+r+' class="lvml">')}}catch{}return function(r){return document.createElement("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),ma={_initContainer:function(){this._container=Ee("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zn.prototype._update.call(this),this.fire("update"))},_initPath:function(r){var l=r._container=js("shape");ge(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",r._path=js("path"),l.appendChild(r._path),this._updateStyle(r),this._layers[Pt(r)]=r},_addPath:function(r){var l=r._container;this._container.appendChild(l),r.options.interactive&&r.addInteractiveTarget(l)},_removePath:function(r){var l=r._container;je(l),r.removeInteractiveTarget(l),delete this._layers[Pt(r)]},_updateStyle:function(r){var l=r._stroke,_=r._fill,b=r.options,A=r._container;A.stroked=!!b.stroke,A.filled=!!b.fill,b.stroke?(l||(l=r._stroke=js("stroke")),A.appendChild(l),l.weight=b.weight+"px",l.color=b.color,l.opacity=b.opacity,b.dashArray?l.dashStyle=ii(b.dashArray)?b.dashArray.join(" "):b.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=b.lineCap.replace("butt","flat"),l.joinstyle=b.lineJoin):l&&(A.removeChild(l),r._stroke=null),b.fill?(_||(_=r._fill=js("fill")),A.appendChild(_),_.color=b.fillColor||b.color,_.opacity=b.fillOpacity):_&&(A.removeChild(_),r._fill=null)},_updateCircle:function(r){var l=r._point.round(),_=Math.round(r._radius),b=Math.round(r._radiusY||_);this._setPath(r,r._empty()?"M0 0":"AL "+l.x+","+l.y+" "+_+","+b+" 0,"+65535*360)},_setPath:function(r,l){r._path.v=l},_bringToFront:function(r){Ir(r._container)},_bringToBack:function(r){Er(r._container)}},bs=N.vml?js:tr,is=zn.extend({_initContainer:function(){this._container=bs("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=bs("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){je(this._container),Ye(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zn.prototype._update.call(this);var r=this._bounds,l=r.getSize(),_=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,_.setAttribute("width",l.x),_.setAttribute("height",l.y)),Je(_,r.min),_.setAttribute("viewBox",[r.min.x,r.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(r){var l=r._path=bs("path");r.options.className&&ge(l,r.options.className),r.options.interactive&&ge(l,"leaflet-interactive"),this._updateStyle(r),this._layers[Pt(r)]=r},_addPath:function(r){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(r._path),r.addInteractiveTarget(r._path)},_removePath:function(r){je(r._path),r.removeInteractiveTarget(r._path),delete this._layers[Pt(r)]},_updatePath:function(r){r._project(),r._update()},_updateStyle:function(r){var l=r._path,_=r.options;l&&(_.stroke?(l.setAttribute("stroke",_.color),l.setAttribute("stroke-opacity",_.opacity),l.setAttribute("stroke-width",_.weight),l.setAttribute("stroke-linecap",_.lineCap),l.setAttribute("stroke-linejoin",_.lineJoin),_.dashArray?l.setAttribute("stroke-dasharray",_.dashArray):l.removeAttribute("stroke-dasharray"),_.dashOffset?l.setAttribute("stroke-dashoffset",_.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),_.fill?(l.setAttribute("fill",_.fillColor||_.color),l.setAttribute("fill-opacity",_.fillOpacity),l.setAttribute("fill-rule",_.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(r,l){this._setPath(r,Zr(r._parts,l))},_updateCircle:function(r){var l=r._point,_=Math.max(Math.round(r._radius),1),b=Math.max(Math.round(r._radiusY),1)||_,A="a"+_+","+b+" 0 1,0 ",U=r._empty()?"M0 0":"M"+(l.x-_)+","+l.y+A+_*2+",0 "+A+-_*2+",0 ";this._setPath(r,U)},_setPath:function(r,l){r._path.setAttribute("d",l)},_bringToFront:function(r){Ir(r._path)},_bringToBack:function(r){Er(r._path)}});N.vml&&is.include(ma);function bo(r){return N.svg||N.vml?new is(r):null}Pe.include({getRenderer:function(r){var l=r.options.renderer||this._getPaneRenderer(r.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(r){if(r==="overlayPane"||r===void 0)return!1;var l=this._paneRenderers[r];return l===void 0&&(l=this._createRenderer({pane:r}),this._paneRenderers[r]=l),l},_createRenderer:function(r){return this.options.preferCanvas&&Ko(r)||bo(r)}});var wo=jn.extend({initialize:function(r,l){jn.prototype.initialize.call(this,this._boundsToLatLngs(r),l)},setBounds:function(r){return this.setLatLngs(this._boundsToLatLngs(r))},_boundsToLatLngs:function(r){return r=ri(r),[r.getSouthWest(),r.getNorthWest(),r.getNorthEast(),r.getSouthEast()]}});function Yi(r,l){return new wo(r,l)}is.create=bs,is.pointsToPath=Zr,cn.geometryToLayer=Vs,cn.coordsToLatLng=yo,cn.coordsToLatLngs=cr,cn.latLngToCoords=vo,cn.latLngsToCoords=Lr,cn.getFeature=Wn,cn.asFeature=Li,Pe.mergeOptions({boxZoom:!0});var ur=vn.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane,this._resetStateTimeout=0,r.on("unload",this._destroy,this)},addHooks:function(){_e(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ye(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){je(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(r){if(!r.shiftKey||r.which!==1&&r.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Zn(),As(),this._startPoint=this._map.mouseEventToContainerPoint(r),_e(document,{contextmenu:An,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(r){this._moved||(this._moved=!0,this._box=Ee("div","leaflet-zoom-box",this._container),ge(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(r);var l=new Ze(this._point,this._startPoint),_=l.getSize();Je(this._box,l.min),this._box.style.width=_.x+"px",this._box.style.height=_.y+"px"},_finish:function(){this._moved&&(je(this._box),si(this._container,"leaflet-crosshair")),Ar(),_s(),Ye(document,{contextmenu:An,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(r){if(!(r.which!==1&&r.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(lt(this._resetState,this),0);var l=new yi(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(r){r.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Pe.addInitHook("addHandler","boxZoom",ur),Pe.mergeOptions({doubleClickZoom:!0});var Jo=vn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(r){var l=this._map,_=l.getZoom(),b=l.options.zoomDelta,A=r.originalEvent.shiftKey?_-b:_+b;l.options.doubleClickZoom==="center"?l.setZoom(A):l.setZoomAround(r.containerPoint,A)}});Pe.addInitHook("addHandler","doubleClickZoom",Jo),Pe.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ns=vn.extend({addHooks:function(){if(!this._draggable){var r=this._map;this._draggable=new qn(r._mapPane,r._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),r.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),r.on("zoomend",this._onZoomEnd,this),r.whenReady(this._onZoomEnd,this))}ge(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){si(this._map._container,"leaflet-grab"),si(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var r=this._map;if(r._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=ri(this._map.options.maxBounds);this._offsetLimit=gi(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;r.fire("movestart").fire("dragstart"),r.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(r){if(this._map.options.inertia){var l=this._lastTime=+new Date,_=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(_),this._times.push(l),this._prunePositions(l)}this._map.fire("move",r).fire("drag",r)},_prunePositions:function(r){for(;this._positions.length>1&&r-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var r=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(r).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(r,l){return r-(r-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var r=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;r.x<l.min.x&&(r.x=this._viscousLimit(r.x,l.min.x)),r.y<l.min.y&&(r.y=this._viscousLimit(r.y,l.min.y)),r.x>l.max.x&&(r.x=this._viscousLimit(r.x,l.max.x)),r.y>l.max.y&&(r.y=this._viscousLimit(r.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(r)}},_onPreDragWrap:function(){var r=this._worldWidth,l=Math.round(r/2),_=this._initialWorldOffset,b=this._draggable._newPos.x,A=(b-l+_)%r+l-_,U=(b+l+_)%r-l-_,et=Math.abs(A+_)<Math.abs(U+_)?A:U;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=et},_onDragEnd:function(r){var l=this._map,_=l.options,b=!_.inertia||r.noInertia||this._times.length<2;if(l.fire("dragend",r),b)l.fire("moveend");else{this._prunePositions(+new Date);var A=this._lastPos.subtract(this._positions[0]),U=(this._lastTime-this._times[0])/1e3,et=_.easeLinearity,it=A.multiplyBy(et/U),ot=it.distanceTo([0,0]),Ct=Math.min(_.inertiaMaxSpeed,ot),$t=it.multiplyBy(Ct/ot),se=Ct/(_.inertiaDeceleration*et),oe=$t.multiplyBy(-se/2).round();!oe.x&&!oe.y?l.fire("moveend"):(oe=l._limitOffset(oe,l.options.maxBounds),ui(function(){l.panBy(oe,{duration:se,easeLinearity:et,noMoveStart:!0,animate:!0})}))}}});Pe.addInitHook("addHandler","dragging",ns),Pe.mergeOptions({keyboard:!0,keyboardPanDelta:80});var To=vn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(r){this._map=r,this._setPanDelta(r.options.keyboardPanDelta),this._setZoomDelta(r.options.zoomDelta)},addHooks:function(){var r=this._map._container;r.tabIndex<=0&&(r.tabIndex="0"),_e(r,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ye(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var r=document.body,l=document.documentElement,_=r.scrollTop||l.scrollTop,b=r.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(b,_)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(r){var l=this._panKeys={},_=this.keyCodes,b,A;for(b=0,A=_.left.length;b<A;b++)l[_.left[b]]=[-1*r,0];for(b=0,A=_.right.length;b<A;b++)l[_.right[b]]=[r,0];for(b=0,A=_.down.length;b<A;b++)l[_.down[b]]=[0,r];for(b=0,A=_.up.length;b<A;b++)l[_.up[b]]=[0,-1*r]},_setZoomDelta:function(r){var l=this._zoomKeys={},_=this.keyCodes,b,A;for(b=0,A=_.zoomIn.length;b<A;b++)l[_.zoomIn[b]]=r;for(b=0,A=_.zoomOut.length;b<A;b++)l[_.zoomOut[b]]=-r},_addHooks:function(){_e(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ye(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(r){if(!(r.altKey||r.ctrlKey||r.metaKey)){var l=r.keyCode,_=this._map,b;if(l in this._panKeys){if(!_._panAnim||!_._panAnim._inProgress)if(b=this._panKeys[l],r.shiftKey&&(b=ne(b).multiplyBy(3)),_.options.maxBounds&&(b=_._limitOffset(ne(b),_.options.maxBounds)),_.options.worldCopyJump){var A=_.wrapLatLng(_.unproject(_.project(_.getCenter()).add(b)));_.panTo(A)}else _.panBy(b)}else if(l in this._zoomKeys)_.setZoom(_.getZoom()+(r.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&_._popup&&_._popup.options.closeOnEscapeKey)_.closePopup();else return;An(r)}}});Pe.addInitHook("addHandler","keyboard",To),Pe.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ws=vn.extend({addHooks:function(){_e(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ye(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(r){var l=Bs(r),_=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(r),this._startTime||(this._startTime=+new Date);var b=Math.max(_-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(lt(this._performZoom,this),b),An(r)},_performZoom:function(){var r=this._map,l=r.getZoom(),_=this._map.options.zoomSnap||0;r._stop();var b=this._delta/(this._map.options.wheelPxPerZoomLevel*4),A=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,U=_?Math.ceil(A/_)*_:A,et=r._limitZoom(l+(this._delta>0?U:-U))-l;this._delta=0,this._startTime=null,et&&(r.options.scrollWheelZoom==="center"?r.setZoom(l+et):r.setZoomAround(this._lastMousePos,l+et))}});Pe.addInitHook("addHandler","scrollWheelZoom",ws);var _a=600;Pe.mergeOptions({tapHold:N.touchNative&&N.safari&&N.mobile,tapTolerance:15});var un=vn.extend({addHooks:function(){_e(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ye(this._map._container,"touchstart",this._onDown,this)},_onDown:function(r){if(clearTimeout(this._holdTimeout),r.touches.length===1){var l=r.touches[0];this._startPos=this._newPos=new ae(l.clientX,l.clientY),this._holdTimeout=setTimeout(lt(function(){this._cancel(),this._isTapValid()&&(_e(document,"touchend",hi),_e(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),_a),_e(document,"touchend touchcancel contextmenu",this._cancel,this),_e(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function r(){Ye(document,"touchend",hi),Ye(document,"touchend touchcancel",r)},_cancel:function(){clearTimeout(this._holdTimeout),Ye(document,"touchend touchcancel contextmenu",this._cancel,this),Ye(document,"touchmove",this._onMove,this)},_onMove:function(r){var l=r.touches[0];this._newPos=new ae(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(r,l){var _=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});_._simulated=!0,l.target.dispatchEvent(_)}});Pe.addInitHook("addHandler","tapHold",un),Pe.mergeOptions({touchZoom:N.touch,bounceAtZoomLimits:!0});var Qe=vn.extend({addHooks:function(){ge(this._map._container,"leaflet-touch-zoom"),_e(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){si(this._map._container,"leaflet-touch-zoom"),Ye(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(r){var l=this._map;if(!(!r.touches||r.touches.length!==2||l._animatingZoom||this._zooming)){var _=l.mouseEventToContainerPoint(r.touches[0]),b=l.mouseEventToContainerPoint(r.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(_.add(b)._divideBy(2))),this._startDist=_.distanceTo(b),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),_e(document,"touchmove",this._onTouchMove,this),_e(document,"touchend touchcancel",this._onTouchEnd,this),hi(r)}},_onTouchMove:function(r){if(!(!r.touches||r.touches.length!==2||!this._zooming)){var l=this._map,_=l.mouseEventToContainerPoint(r.touches[0]),b=l.mouseEventToContainerPoint(r.touches[1]),A=_.distanceTo(b)/this._startDist;if(this._zoom=l.getScaleZoom(A,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&A<1||this._zoom>l.getMaxZoom()&&A>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,A===1)return}else{var U=_._add(b)._divideBy(2)._subtract(this._centerPoint);if(A===1&&U.x===0&&U.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(U),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),di(this._animRequest);var et=lt(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ui(et,this,!0),hi(r)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,di(this._animRequest),Ye(document,"touchmove",this._onTouchMove,this),Ye(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Pe.addInitHook("addHandler","touchZoom",Qe),Pe.BoxZoom=ur,Pe.DoubleClickZoom=Jo,Pe.Drag=ns,Pe.Keyboard=To,Pe.ScrollWheelZoom=ws,Pe.TapHold=un,Pe.TouchZoom=Qe,S.Bounds=Ze,S.Browser=N,S.CRS=Mi,S.Canvas=Xo,S.Circle=Zs,S.CircleMarker=Us,S.Class=Ci,S.Control=ln,S.DivIcon=jo,S.DivOverlay=Xn,S.DomEvent=Fo,S.DomUtil=oo,S.Draggable=qn,S.Evented=sn,S.FeatureGroup=$n,S.GeoJSON=cn,S.GridLayer=bn,S.Handler=vn,S.Icon=Kr,S.ImageOverlay=Mn,S.LatLng=Ie,S.LatLngBounds=yi,S.Layer=Ki,S.LayerGroup=ar,S.LineUtil=Ba,S.Map=Pe,S.Marker=mo,S.Mixin=co,S.Path=hr,S.Point=ae,S.PolyUtil=Ra,S.Polygon=jn,S.Polyline=hn,S.Popup=ts,S.PosAnimation=ho,S.Projection=Os,S.Rectangle=wo,S.Renderer=zn,S.SVG=is,S.SVGOverlay=xo,S.TileLayer=Dt,S.Tooltip=xn,S.Transformation=Nr,S.Util=us,S.VideoOverlay=Hn,S.bind=lt,S.bounds=gi,S.canvas=Ko,S.circle=go,S.circleMarker=Ns,S.control=Mr,S.divIcon=es,S.extend=R,S.featureGroup=qo,S.geoJSON=Ji,S.geoJson=Oa,S.gridLayer=Wo,S.icon=Jr,S.imageOverlay=pa,S.latLng=De,S.latLngBounds=ri,S.layerGroup=Cn,S.map=Uo,S.marker=_o,S.point=ne,S.polygon=da,S.polyline=xs,S.popup=qs,S.rectangle=Yi,S.setOptions=ce,S.stamp=Pt,S.svg=bo,S.svgOverlay=Fa,S.tileLayer=$s,S.tooltip=qt,S.transformation=on,S.version=D,S.videoOverlay=Gs;var Ws=window.L;S.noConflict=function(){return window.L=Ws,this},window.L=S})})(Yp,gt);var Nl=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,Mo=document.documentElement.style.pointerEvents==="",zo={cors:Nl,pointerEvents:Mo},Qp={attributionWidthOffset:55},vu=0;function Zl(g){var x="";g.f=g.f||"json";for(var S in g)if(Object.prototype.hasOwnProperty.call(g,S)){var D=g[S],R=Object.prototype.toString.call(D),J;x.length&&(x+="&"),R==="[object Array]"?J=Object.prototype.toString.call(D[0])==="[object Object]"?JSON.stringify(D):D.join(","):R==="[object Object]"?J=JSON.stringify(D):R==="[object Date]"?J=D.valueOf():J=D,x+=encodeURIComponent(S)+"="+encodeURIComponent(J)}return x}function Nh(g,x){var S=new window.XMLHttpRequest;return S.onerror=function(D){S.onreadystatechange=gt.Util.falseFn,g.call(x,{error:{code:500,message:"XMLHttpRequest error"}},null)},S.onreadystatechange=function(){var D,R;if(S.readyState===4){try{D=JSON.parse(S.responseText)}catch{D=null,R={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!R&&D.error&&(R=D.error,D=null),S.onerror=gt.Util.falseFn,g.call(x,R,D)}},S.ontimeout=function(){this.onerror()},S}function tf(g,x,S,D){var R=Nh(S,D);return R.open("POST",g),typeof D<"u"&&D!==null&&typeof D.options<"u"&&(R.timeout=D.options.timeout),R.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),R.send(Zl(x)),R}function Bu(g,x,S,D){var R=Nh(S,D);return R.open("GET",g+"?"+Zl(x),!0),typeof D<"u"&&D!==null&&typeof D.options<"u"&&(R.timeout=D.options.timeout,D.options.withCredentials&&(R.withCredentials=!0)),R.send(null),R}function Ma(g,x,S,D){var R=Zl(x),J=Nh(S,D),lt=(g+"?"+R).length;if(lt<=2e3&&zo.cors?J.open("GET",g+"?"+R):lt>2e3&&zo.cors&&(J.open("POST",g),J.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof D<"u"&&D!==null&&typeof D.options<"u"&&(J.timeout=D.options.timeout,D.options.withCredentials&&(J.withCredentials=!0)),lt<=2e3&&zo.cors)J.send(null);else if(lt>2e3&&zo.cors)J.send(R);else{if(lt<=2e3&&!zo.cors)return Zh(g,x,S,D);ko("a request to "+g+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/");return}return J}function Zh(g,x,S,D){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var R="c"+vu;x.callback="window._EsriLeafletCallbacks."+R,window._EsriLeafletCallbacks[R]=function(lt){if(window._EsriLeafletCallbacks[R]!==!0){var h,Pt=Object.prototype.toString.call(lt);Pt==="[object Object]"||Pt==="[object Array]"||(h={error:{code:500,message:"Expected array or object as JSONP response"}},lt=null),!h&&lt.error&&(h=lt,lt=null),S.call(D,h,lt),window._EsriLeafletCallbacks[R]=!0}};var J=gt.DomUtil.create("script",null,document.body);return J.type="text/javascript",J.src=g+"?"+Zl(x),J.id=R,J.onerror=function(lt){if(lt&&window._EsriLeafletCallbacks[R]!==!0){var h={error:{code:500,message:"An unknown error occurred"}};S.call(D,h),window._EsriLeafletCallbacks[R]=!0}},gt.DomUtil.addClass(J,"esri-leaflet-jsonp"),vu++,{id:R,url:J.src,abort:function(){window._EsriLeafletCallbacks._callback[R]({code:0,message:"Request aborted."})}}}var Vh=zo.cors?Bu:Zh;Vh.CORS=Bu;Vh.JSONP=Zh;function ko(){console&&console.warn&&console.warn.apply(console,arguments)}var Rl={request:Ma,get:Vh,post:tf};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var ef=function(x,S,D,R){var J=(R[0]-D[0])*(x[1]-D[1])-(R[1]-D[1])*(x[0]-D[0]),lt=(S[0]-x[0])*(x[1]-D[1])-(S[1]-x[1])*(x[0]-D[0]),h=(R[1]-D[1])*(S[0]-x[0])-(R[0]-D[0])*(S[1]-x[1]);if(h!==0){var Pt=J/h,ee=lt/h;if(Pt>=0&&Pt<=1&&ee>=0&&ee<=1)return!0}return!1},nf=function(x,S){for(var D=!1,R=-1,J=x.length,lt=J-1;++R<J;lt=R)(x[R][1]<=S[1]&&S[1]<x[lt][1]||x[lt][1]<=S[1]&&S[1]<x[R][1])&&S[0]<(x[lt][0]-x[R][0])*(S[1]-x[R][1])/(x[lt][1]-x[R][1])+x[R][0]&&(D=!D);return D},rf=function(x,S){for(var D=0;D<x.length;D++)if(x[D]!==S[D])return!1;return!0},Ru=function(x,S){for(var D=0;D<x.length-1;D++)for(var R=0;R<S.length-1;R++)if(ef(x[D],x[D+1],S[R],S[R+1]))return!0;return!1},Lh=function(x){return rf(x[0],x[x.length-1])||x.push(x[0]),x},kh=function(x){var S=0,D=0,R=x.length,J=x[D],lt;for(D;D<R-1;D++)lt=x[D+1],S+=(lt[0]-J[0])*(lt[1]+J[1]),J=lt;return S>=0},Ou=function(x){var S={};for(var D in x)x.hasOwnProperty(D)&&(S[D]=x[D]);return S},sf=function(x,S){var D=Ru(x,S),R=nf(x,S[0]);return!!(!D&&R)},of=function(x){for(var S=[],D=[],R,J,lt,h=0;h<x.length;h++){var Pt=Lh(x[h].slice(0));if(!(Pt.length<4))if(kh(Pt)){var ee=[Pt.slice().reverse()];S.push(ee)}else D.push(Pt.slice().reverse())}for(var Se=[];D.length;){lt=D.pop();var Gt=!1;for(R=S.length-1;R>=0;R--)if(J=S[R][0],sf(J,lt)){S[R].push(lt),Gt=!0;break}Gt||Se.push(lt)}for(;Se.length;){lt=Se.pop();var ft=!1;for(R=S.length-1;R>=0;R--)if(J=S[R][0],Ru(J,lt)){S[R].push(lt),ft=!0;break}ft||S.push([lt.reverse()])}return S.length===1?{type:"Polygon",coordinates:S[0]}:{type:"MultiPolygon",coordinates:S}},af=function(x,S){for(var D=S?[S,"OBJECTID","FID"]:["OBJECTID","FID"],R=0;R<D.length;R++){var J=D[R];if(J in x&&(typeof x[J]=="string"||typeof x[J]=="number"))return x[J]}throw Error("No valid id attribute found")},lf=function g(x,S){var D={};if(x.features){D.type="FeatureCollection",D.features=[];for(var R=0;R<x.features.length;R++)D.features.push(g(x.features[R],S))}if(typeof x.x=="number"&&typeof x.y=="number"&&(D.type="Point",D.coordinates=[x.x,x.y],typeof x.z=="number"&&D.coordinates.push(x.z)),x.points&&(D.type="MultiPoint",D.coordinates=x.points.slice(0)),x.paths&&(x.paths.length===1?(D.type="LineString",D.coordinates=x.paths[0].slice(0)):(D.type="MultiLineString",D.coordinates=x.paths.slice(0))),x.rings&&(D=of(x.rings.slice(0))),typeof x.xmin=="number"&&typeof x.ymin=="number"&&typeof x.xmax=="number"&&typeof x.ymax=="number"&&(D.type="Polygon",D.coordinates=[[[x.xmax,x.ymax],[x.xmin,x.ymax],[x.xmin,x.ymin],[x.xmax,x.ymin],[x.xmax,x.ymax]]]),(x.geometry||x.attributes)&&(D.type="Feature",D.geometry=x.geometry?g(x.geometry):null,D.properties=x.attributes?Ou(x.attributes):null,x.attributes))try{D.id=af(x.attributes,S)}catch{}return JSON.stringify(D.geometry)===JSON.stringify({})&&(D.geometry=null),x.spatialReference&&x.spatialReference.wkid&&x.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(x.spatialReference)),D},Fu=function(x){var S=[],D=x.slice(0),R=Lh(D.shift().slice(0));if(R.length>=4){kh(R)||R.reverse(),S.push(R);for(var J=0;J<D.length;J++){var lt=Lh(D[J].slice(0));lt.length>=4&&(kh(lt)&&lt.reverse(),S.push(lt))}}return S},hf=function(x){for(var S=[],D=0;D<x.length;D++)for(var R=Fu(x[D]),J=R.length-1;J>=0;J--){var lt=R[J].slice(0);S.push(lt)}return S},cf=function g(x,S){S=S||"OBJECTID";var D={wkid:4326},R={},J;switch(x.type){case"Point":R.x=x.coordinates[0],R.y=x.coordinates[1],x.coordinates[2]!=null&&(R.z=x.coordinates[2]),R.spatialReference=D;break;case"MultiPoint":R.points=x.coordinates.slice(0),x.coordinates[0][2]!=null&&(R.hasZ=!0),R.spatialReference=D;break;case"LineString":R.paths=[x.coordinates.slice(0)],x.coordinates[0][2]!=null&&(R.hasZ=!0),R.spatialReference=D;break;case"MultiLineString":R.paths=x.coordinates.slice(0),x.coordinates[0][0][2]!=null&&(R.hasZ=!0),R.spatialReference=D;break;case"Polygon":R.rings=Fu(x.coordinates.slice(0)),x.coordinates[0][0][2]!=null&&(R.hasZ=!0),R.spatialReference=D;break;case"MultiPolygon":R.rings=hf(x.coordinates.slice(0)),x.coordinates[0][0][0][2]!=null&&(R.hasZ=!0),R.spatialReference=D;break;case"Feature":x.geometry&&(R.geometry=g(x.geometry,S)),R.attributes=x.properties?Ou(x.properties):{},x.id&&(R.attributes[S]=x.id);break;case"FeatureCollection":for(R=[],J=0;J<x.features.length;J++)R.push(g(x.features[J],S));break;case"GeometryCollection":for(R=[],J=0;J<x.geometries.length;J++)R.push(g(x.geometries[J],S));break}return R},Uu='<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',uf='Powered by <a href="https://www.esri.com">Esri</a>';function ol(g,x){return cf(g,x)}function Nu(g,x){return lf(g,x)}function Dh(g){if(g.xmin!=="NaN"&&g.ymin!=="NaN"&&g.xmax!=="NaN"&&g.ymax!=="NaN"){var x=gt.latLng(g.ymin,g.xmin),S=gt.latLng(g.ymax,g.xmax);return gt.latLngBounds(x,S)}else return null}function Gh(g){return g=gt.latLngBounds(g),{xmin:g.getSouthWest().lng,ymin:g.getSouthWest().lat,xmax:g.getNorthEast().lng,ymax:g.getNorthEast().lat,spatialReference:{wkid:4326}}}var Zu=/^(OBJECTID|FID|OID|ID)$/i;function Vu(g){var x;if(g.objectIdFieldName)x=g.objectIdFieldName;else if(g.fields){for(var S=0;S<=g.fields.length-1;S++)if(g.fields[S].type==="esriFieldTypeOID"){x=g.fields[S].name;break}if(!x){for(S=0;S<=g.fields.length-1;S++)if(g.fields[S].name.match(Zu)){x=g.fields[S].name;break}}}return x}function Gu(g){for(var x in g.attributes)if(x.match(Zu))return x}function al(g,x){var S,D=g.features||g.results,R=D&&D.length;x?S=x:S=Vu(g);var J={type:"FeatureCollection",features:[]};if(R)for(var lt=D.length-1;lt>=0;lt--){var h=Nu(D[lt],S||Gu(D[lt]));J.features.push(h)}return J}function Vl(g){return g=gt.Util.trim(g),g[g.length-1]!=="/"&&(g+="/"),g}function ll(g){if(g.url.indexOf("?")!==-1){g.requestParams=g.requestParams||{};var x=g.url.substring(g.url.indexOf("?")+1);g.url=g.url.split("?")[0],g.requestParams=JSON.parse('{"'+decodeURI(x).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return g.url=Vl(g.url.split("?")[0]),g}function qu(g){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(g)}function Bh(g){var x;switch(g){case"Point":x="esriGeometryPoint";break;case"MultiPoint":x="esriGeometryMultipoint";break;case"LineString":x="esriGeometryPolyline";break;case"MultiLineString":x="esriGeometryPolyline";break;case"Polygon":x="esriGeometryPolygon";break;case"MultiPolygon":x="esriGeometryPolygon";break}return x}function Ol(g){return g.getSize().x-Qp.attributionWidthOffset+"px"}function hl(g){if(g.attributionControl){if(g.attributionControl._esriAttributionLayerCount||(g.attributionControl._esriAttributionLayerCount=0),g.attributionControl._esriAttributionLayerCount===0){if(!g.attributionControl._esriAttributionAddedOnce){var x=document.createElement("style");x.type="text/css",x.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(x);var S=document.createElement("style");S.type="text/css",S.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+Ol(g)+";}",document.getElementsByTagName("head")[0].appendChild(S),g.on("resize",function(D){g.attributionControl&&(g.attributionControl._container.style.maxWidth=Ol(D.target))}),g.attributionControl._esriAttributionAddedOnce=!0}g.attributionControl.setPrefix(Uu+" | "+uf),gt.DomUtil.addClass(g.attributionControl._container,"esri-truncated-attribution:hover"),gt.DomUtil.addClass(g.attributionControl._container,"esri-truncated-attribution")}g.attributionControl._esriAttributionLayerCount=g.attributionControl._esriAttributionLayerCount+1}}function Gl(g){g.attributionControl&&(g.attributionControl._esriAttributionLayerCount&&g.attributionControl._esriAttributionLayerCount===1&&(g.attributionControl.setPrefix(Uu),gt.DomUtil.removeClass(g.attributionControl._container,"esri-truncated-attribution:hover"),gt.DomUtil.removeClass(g.attributionControl._container,"esri-truncated-attribution")),g.attributionControl._esriAttributionLayerCount=g.attributionControl._esriAttributionLayerCount-1)}function qh(g){var x={geometry:null,geometryType:null};if(g instanceof gt.LatLngBounds)return x.geometry=Gh(g),x.geometryType="esriGeometryEnvelope",x;if(g.getLatLng&&(g=g.getLatLng()),g instanceof gt.LatLng&&(g={type:"Point",coordinates:[g.lng,g.lat]}),g instanceof gt.GeoJSON&&(g=g.getLayers()[0].feature.geometry,x.geometry=ol(g),x.geometryType=Bh(g.type)),g.toGeoJSON&&(g=g.toGeoJSON()),g.type==="Feature"&&(g=g.geometry),g.type==="Point"||g.type==="LineString"||g.type==="Polygon"||g.type==="MultiPolygon")return x.geometry=ol(g),x.geometryType=Bh(g.type),x;ko("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function $u(g,x){zo.cors&&Ma(g,{},gt.Util.bind(function(S,D){if(!S){x._esriAttributions=[];for(var R=0;R<D.contributors.length;R++)for(var J=D.contributors[R],lt=0;lt<J.coverageAreas.length;lt++){var h=J.coverageAreas[lt],Pt=gt.latLng(h.bbox[0],h.bbox[1]),ee=gt.latLng(h.bbox[2],h.bbox[3]);x._esriAttributions.push({attribution:J.attribution,score:h.score,bounds:gt.latLngBounds(Pt,ee),minZoom:h.zoomMin,maxZoom:h.zoomMax})}x._esriAttributions.sort(function(Gt,ft){return ft.score-Gt.score});var Se={target:x};Fl(Se)}},this))}function Fl(g){var x=g.target,S=x._esriAttributions;if(!(!x||!x.attributionControl)){var D=x.attributionControl._container.querySelector(".esri-dynamic-attribution");if(D&&S){for(var R="",J=x.getBounds(),lt=gt.latLngBounds(J.getSouthWest().wrap(),J.getNorthEast().wrap()),h=x.getZoom(),Pt=0;Pt<S.length;Pt++){var ee=S[Pt],Se=ee.attribution;!R.match(Se)&&ee.bounds.intersects(lt)&&h>=ee.minZoom&&h<=ee.maxZoom&&(R+=", "+Se)}R=R.substr(2),D.innerHTML=R,D.style.maxWidth=Ol(x),x.fire("attributionupdated",{attribution:R})}}}var rl={warn:ko,cleanUrl:Vl,getUrlParams:ll,isArcgisOnline:qu,geojsonTypeToArcGIS:Bh,responseToFeatureCollection:al,geojsonToArcGIS:ol,arcgisToGeoJSON:Nu,boundsToExtent:Gh,extentToBounds:Dh,calcAttributionWidth:Ol,setEsriAttribution:hl,_setGeometry:qh,_getAttributionData:$u,_updateMapAttribution:Fl,_findIdAttributeFromFeature:Gu,_findIdAttributeFromResponse:Vu},$h=gt.Class.extend({options:{proxy:!1,useCors:Nl},generateSetter:function(g,x){return gt.Util.bind(function(S){return this.params[g]=S,this},x)},initialize:function(g){if(g.request&&g.options?(this._service=g,gt.Util.setOptions(this,g.options)):(gt.Util.setOptions(this,g),this.options.url=Vl(g.url)),this.params=gt.Util.extend({},this.params||{}),this.setters)for(var x in this.setters){var S=this.setters[x];this[x]=this.generateSetter(S,this)}},token:function(g){return this._service?this._service.authenticate(g):this.params.token=g,this},apikey:function(g){return this.token(g)},format:function(g){return this.params.returnUnformattedValues=!g,this},request:function(g,x){return this.options.requestParams&&gt.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,g,x):this._request("request",this.path,this.params,g,x)},_request:function(g,x,S,D,R){var J=this.options.proxy?this.options.proxy+"?"+this.options.url+x:this.options.url+x;return(g==="get"||g==="request")&&!this.options.useCors?Rl.get.JSONP(J,S,D,R):Rl[g](J,S,D,R)}}),df=$h.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(g,x){return g=gt.latLng(g),this.params.geometry=[g.lng,g.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=x,this.params.inSR=4326,this},where:function(g){return this.params.where=g,this},between:function(g,x){return this.params.time=[g.valueOf(),x.valueOf()],this},simplify:function(g,x){var S=Math.abs(g.getBounds().getWest()-g.getBounds().getEast());return this.params.maxAllowableOffset=S/g.getSize().y*x,this},orderBy:function(g,x){return x=x||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[g,x].join(" "),this},run:function(g,x){return this._cleanParams(),this.options.isModern||qu(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(S,D){this._trapSQLerrors(S),g.call(x,S,D,D)},this)):this.request(function(S,D){this._trapSQLerrors(S),g.call(x,S,D&&al(D),D)},this)},count:function(g,x){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(S,D){g.call(this,S,D&&D.count,D)},x)},ids:function(g,x){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(S,D){g.call(this,S,D&&D.objectIds,D)},x)},bounds:function(g,x){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(S,D){D&&D.extent&&Dh(D.extent)?g.call(x,S,Dh(D.extent),D):(S={message:"Invalid Bounds"},g.call(x,S,null,D))},x)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(g){var x=gt.point(g);return this.params.pixelSize=[x.x,x.y],this},layer:function(g){return this.path=g+"/query",this},_trapSQLerrors:function(g){g&&g.code==="400"&&ko("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(g){this.params.inSR=4326;var x=qh(g);this.params.geometry=x.geometry,this.params.geometryType=x.geometryType}});function jh(g){return new df(g)}var pf=$h.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(g,x){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[g,x].join(":"),this},simplify:function(g,x){var S=Math.abs(g.getBounds().getWest()-g.getBounds().getEast());return this.params.maxAllowableOffset=S/g.getSize().y*x,this},run:function(g,x){return this.request(function(S,D){g.call(x,S,D&&al(D),D)},x)}});function ff(g){return new pf(g)}var ju=$h.extend({path:"identify",between:function(g,x){return this.params.time=[g.valueOf(),x.valueOf()],this}}),mf=ju.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(g){var x=Gh(g.getBounds()),S=g.getSize();return this.params.imageDisplay=[S.x,S.y,96],this.params.mapExtent=[x.xmin,x.ymin,x.xmax,x.ymax],this},at:function(g){return g.length===2&&(g=gt.latLng(g)),this._setGeometryParams(g),this},layerDef:function(g,x){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[g,x].join(":"),this},simplify:function(g,x){var S=Math.abs(g.getBounds().getWest()-g.getBounds().getEast());return this.params.maxAllowableOffset=S/g.getSize().y*x,this},run:function(g,x){return this.request(function(S,D){if(S)g.call(x,S,void 0,D);else{var R=al(D);D.results=D.results.reverse();for(var J=0;J<R.features.length;J++){var lt=R.features[J];lt.layerId=D.results[J].layerId}g.call(x,void 0,R,D)}})},_setGeometryParams:function(g){var x=qh(g);this.params.geometry=x.geometry,this.params.geometryType=x.geometryType}});function _f(g){return new mf(g)}var gf=ju.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(g){return g=gt.latLng(g),this.params.geometry=JSON.stringify({x:g.lng,y:g.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(g,x){return this.request(function(S,D){g.call(x,S,D&&this._responseToGeoJSON(D),D)},this)},_responseToGeoJSON:function(g){var x=g.location,S=g.catalogItems,D=g.catalogItemVisibilities,R={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[x.x,x.y]},crs:{type:"EPSG",properties:{code:x.spatialReference.wkid}},properties:{OBJECTID:g.objectId,name:g.name,value:g.value},id:g.objectId}};if(g.properties&&g.properties.Values&&(R.pixel.properties.values=g.properties.Values),S&&S.features&&(R.catalogItems=al(S),D&&D.length===R.catalogItems.features.length))for(var J=D.length-1;J>=0;J--)R.catalogItems.features[J].properties.catalogItemVisibility=D[J];return R}});function yf(g){return new gf(g)}var Wh=gt.Evented.extend({options:{proxy:!1,useCors:Nl,timeout:0},initialize:function(g){g=g||{},this._requestQueue=[],this._authenticating=!1,gt.Util.setOptions(this,g),this.options.url=Vl(this.options.url)},get:function(g,x,S,D){return this._request("get",g,x,S,D)},post:function(g,x,S,D){return this._request("post",g,x,S,D)},request:function(g,x,S,D){return this._request("request",g,x,S,D)},metadata:function(g,x){return this._request("get","",{},g,x)},authenticate:function(g){return this._authenticating=!1,this.options.token=g,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(g){this.options.timeout=g},_request:function(g,x,S,D,R){this.fire("requeststart",{url:this.options.url+x,params:S,method:g},!0);var J=this._createServiceCallback(g,x,S,D,R);if(this.options.token&&(S.token=this.options.token),this.options.requestParams&&gt.Util.extend(S,this.options.requestParams),this._authenticating)this._requestQueue.push([g,x,S,D,R]);else{var lt=this.options.proxy?this.options.proxy+"?"+this.options.url+x:this.options.url+x;return(g==="get"||g==="request")&&!this.options.useCors?Rl.get.JSONP(lt,S,J,R):Rl[g](lt,S,J,R)}},_createServiceCallback:function(g,x,S,D,R){return gt.Util.bind(function(J,lt){J&&(J.code===499||J.code===498)&&(this._authenticating=!0,this._requestQueue.push([g,x,S,D,R]),this.fire("authenticationrequired",{authenticate:gt.Util.bind(this.authenticate,this)},!0),J.authenticate=gt.Util.bind(this.authenticate,this)),D.call(R,J,lt),J?this.fire("requesterror",{url:this.options.url+x,params:S,message:J.message,code:J.code,method:g},!0):this.fire("requestsuccess",{url:this.options.url+x,params:S,response:lt,method:g},!0),this.fire("requestend",{url:this.options.url+x,params:S,method:g},!0)},this)},_runQueue:function(){for(var g=this._requestQueue.length-1;g>=0;g--){var x=this._requestQueue[g],S=x.shift();this[S].apply(this,x)}this._requestQueue=[]}}),vf=Wh.extend({identify:function(){return _f(this)},find:function(){return ff(this)},query:function(){return jh(this)}});function Wu(g){return new vf(g)}var xf=Wh.extend({query:function(){return jh(this)},identify:function(){return yf(this)}});function bf(g){return new xf(g)}var wf=Wh.extend({options:{idAttribute:"OBJECTID"},query:function(){return jh(this)},addFeature:function(g,x,S){this.addFeatures(g,x,S)},addFeatures:function(g,x,S){for(var D=g.features?g.features:[g],R=D.length-1;R>=0;R--)delete D[R].id;return g=ol(g),g=D.length>1?g:[g],this.post("addFeatures",{features:g},function(J,lt){var h=lt&&lt.addResults?lt.addResults.length>1?lt.addResults:lt.addResults[0]:void 0;x&&x.call(S,J||lt.addResults[0].error,h)},S)},updateFeature:function(g,x,S){this.updateFeatures(g,x,S)},updateFeatures:function(g,x,S){var D=g.features?g.features:[g];return g=ol(g,this.options.idAttribute),g=D.length>1?g:[g],this.post("updateFeatures",{features:g},function(R,J){var lt=J&&J.updateResults?J.updateResults.length>1?J.updateResults:J.updateResults[0]:void 0;x&&x.call(S,R||J.updateResults[0].error,lt)},S)},deleteFeature:function(g,x,S){this.deleteFeatures(g,x,S)},deleteFeatures:function(g,x,S){return this.post("deleteFeatures",{objectIds:g},function(D,R){var J=R&&R.deleteResults?R.deleteResults.length>1?R.deleteResults:R.deleteResults[0]:void 0;x&&x.call(S,D||R.deleteResults[0].error,J)},S)}});function Tf(g){return new wf(g)}var Ui=window.location.protocol!=="https:"?"http:":"https:",xu=gt.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:Ui+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:Ui+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:Ui+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:Ui+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(g,x){var S;if(typeof g=="object"&&g.urlTemplate&&g.options)S=g;else if(typeof g=="string"&&xu.TILES[g])S=xu.TILES[g];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var D=gt.Util.extend(S.options,x);gt.Util.setOptions(this,D),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&S.urlTemplate.indexOf("token=")===-1&&(S.urlTemplate+="?token="+this.options.token),this.options.proxy&&(S.urlTemplate=this.options.proxy+"?"+S.urlTemplate),gt.TileLayer.prototype.initialize.call(this,S.urlTemplate,D)},onAdd:function(g){hl(g),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&$u((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,g),g.on("moveend",Fl),gt.TileLayer.prototype.onAdd.call(this,g)},onRemove:function(g){Gl(g),g.off("moveend",Fl),gt.TileLayer.prototype.onRemove.call(this,g)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var g=this._map.createPane(this.options.pane);g.style.pointerEvents="none",g.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var g='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return g}}),Sf=gt.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(g){g=gt.Util.setOptions(this,g),g=ll(g),this.tileUrl=(g.proxy?g.proxy+"?":"")+g.url+"tile/{z}/{y}/{x}"+(g.requestParams&&Object.keys(g.requestParams).length>0?gt.Util.getParamString(g.requestParams):""),g.url.indexOf("{s}")!==-1&&g.subdomains&&(g.url=g.url.replace("{s}",g.subdomains[0])),this.service=Wu(g),this.service.addEventParent(this);var x=new RegExp(/tiles.arcgis(online)?\.com/g);x.test(g.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),g.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),gt.TileLayer.prototype.initialize.call(this,this.tileUrl,g)},getTileUrl:function(g){var x=this._getZoomForUrl();return gt.Util.template(this.tileUrl,gt.Util.extend({s:this._getSubdomain(g),x:g.x,y:g.y,z:this._lodMap&&this._lodMap[x]?this._lodMap[x]:x},this.options))},createTile:function(g,x){var S=document.createElement("img");return gt.DomEvent.on(S,"load",gt.Util.bind(this._tileOnLoad,this,x,S)),gt.DomEvent.on(S,"error",gt.Util.bind(this._tileOnError,this,x,S)),this.options.crossOrigin&&(S.crossOrigin=""),S.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?S.src=this.getTileUrl(g):this.once("lodmap",function(){S.src=this.getTileUrl(g)},this),S},onAdd:function(g){hl(g),this._lodMap||this.metadata(function(x,S){if(!x&&S.spatialReference){var D=S.spatialReference.latestWkid||S.spatialReference.wkid;if(!this.options.attribution&&g.attributionControl&&S.copyrightText&&(this.options.attribution=S.copyrightText,g.attributionControl.addAttribution(this.getAttribution())),g.options.crs===gt.CRS.EPSG3857&&(D===102100||D===3857)){this._lodMap={};for(var R=S.tileInfo.lods,J=Sf.MercatorZoomLevels,lt=0;lt<R.length;lt++){var h=R[lt];for(var Pt in J){var ee=J[Pt];if(this._withinPercentage(h.resolution,ee,this.options.zoomOffsetAllowance)){this._lodMap[Pt]=h.level;break}}}this.fire("lodmap")}else g.options.crs&&g.options.crs.code&&g.options.crs.code.indexOf(D)>-1||ko("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),gt.TileLayer.prototype.onAdd.call(this,g)},onRemove:function(g){Gl(g),gt.TileLayer.prototype.onRemove.call(this,g)},metadata:function(g,x){return this.service.metadata(g,x),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(g){var x="?token="+g;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,x):this.tileUrl+x,this.options.token=g,this.service.authenticate(g),this},_withinPercentage:function(g,x,S){var D=Math.abs(g/x-1);return D<S}}),If=gt.ImageOverlay.extend({onAdd:function(g){this._topLeft=g.getPixelBounds().min,gt.ImageOverlay.prototype.onAdd.call(this,g)},_reset:function(){this._map.options.crs===gt.CRS.EPSG3857?gt.ImageOverlay.prototype._reset.call(this):gt.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),Hu=gt.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:Nl,attribution:null,interactive:!1,alt:""},onAdd:function(g){hl(g),this.options.zIndex&&(this.options.position=null),this._update=gt.Util.throttle(this._update,this.options.updateInterval,this),g.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?g.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(x,S){!x&&!this.options.attribution&&g.attributionControl&&S.copyrightText&&(this.options.attribution=S.copyrightText,g.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(g){Gl(g),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(g,x){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=gt.popup(x),this._popupFunction=g,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(g){return this.options.zIndex=g,this._currentImage&&this._currentImage.setZIndex(g),this},_setAutoZIndex:function(g){if(this._currentImage){for(var x=this._currentImage.getPane().children,S=-g(-1/0,1/0),D=0,R=x.length,J;D<R;D++)J=x[D].style.zIndex,x[D]!==this._currentImage._image&&J&&(S=g(S,+J));isFinite(S)&&(this.options.zIndex=S+g(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(g){return this.options.opacity=g,this._currentImage&&this._currentImage.setOpacity(g),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(g,x){return this.options.from=g,this.options.to=x,this._update(),this},metadata:function(g,x){return this.service.metadata(g,x),this},authenticate:function(g){return this.service.authenticate(g),this},redraw:function(){this._update()},_renderImage:function(g,x,S){if(this._map){if(S&&(g="data:"+S+";base64,"+g),!g)return;var D=new If(g,x,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),R=function(){this._map.removeLayer(D),this.fire("error"),D.off("load",J,this)},J=function(lt){if(D.off("error",R,this),this._map){var h=lt.target,Pt=this._currentImage;h._bounds.equals(x)&&h._bounds.equals(this._map.getBounds())?(this._currentImage=h,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),Pt&&this._map&&this._map.removeLayer(Pt),Pt&&Pt._map&&Pt._map.removeLayer(Pt)):this._map.removeLayer(h)}this.fire("load",{bounds:x})};D.once("error",R,this),D.once("load",J,this)}},_update:function(){if(this._map){var g=this._map.getZoom(),x=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(g>this.options.maxZoom||g<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var S=this._buildExportParams();gt.Util.extend(S,this.options.requestParams),S?(this._requestExport(S,x),this.fire("loading",{bounds:x})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(g,x,S,D){if(g=gt.latLng(g),this._shouldRenderPopup&&this._lastClick.equals(g)){var R=this._popupFunction(x,S,D);R&&this._popup.setLatLng(g).setContent(R).openOn(this._map)}},_resetPopupState:function(g){this._shouldRenderPopup=!1,this._lastClick=g.latlng},_calculateBbox:function(){var g=this._map.getPixelBounds(),x=this._map.unproject(g.getBottomLeft()),S=this._map.unproject(g.getTopRight()),D=this._map.options.crs.project(S),R=this._map.options.crs.project(x),J=gt.bounds(D,R);return[J.getBottomLeft().x,J.getBottomLeft().y,J.getTopRight().x,J.getTopRight().y].join(",")},_calculateImageSize:function(){var g=this._map.getPixelBounds(),x=this._map.getSize(),S=this._map.unproject(g.getBottomLeft()),D=this._map.unproject(g.getTopRight()),R=this._map.latLngToLayerPoint(D).y,J=this._map.latLngToLayerPoint(S).y;return(R>0||J<x.y)&&(x.y=J-R),x.x+","+x.y}});Hu.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(g){g=ll(g),this.service=bf(g),this.service.addEventParent(this),gt.Util.setOptions(this,g)},setPixelType:function(g){return this.options.pixelType=g,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(g){return gt.Util.isArray(g)?this.options.bandIds=g.join(","):this.options.bandIds=g.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(g,x){return gt.Util.isArray(g)?this.options.noData=g.join(","):this.options.noData=g.toString(),x&&(this.options.noDataInterpretation=x),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(g){this.options.renderingRule=g,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(g){this.options.mosaicRule=g,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(g){var x=gt.Util.bind(function(D,R,J){D||setTimeout(gt.Util.bind(function(){this._renderPopup(g.latlng,D,R,J)},this),300)},this),S=this.identify().at(g.latlng);this.options.mosaicRule&&S.setMosaicRule(this.options.mosaicRule),S.run(x),this._shouldRenderPopup=!0,this._lastClick=g.latlng},_buildExportParams:function(){var g=parseInt(this._map.options.crs.code.split(":")[1],10),x={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:g,imageSR:g};return this.options.from&&this.options.to&&(x.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(x.pixelType=this.options.pixelType),this.options.interpolation&&(x.interpolation=this.options.interpolation),this.options.compressionQuality&&(x.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(x.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(x.noData=this.options.noData),this.options.noDataInterpretation&&(x.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(x.token=this.service.options.token),this.options.renderingRule&&(x.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(x.mosaicRule=JSON.stringify(this.options.mosaicRule)),x},_requestExport:function(g,x){if(this.options.f==="json")this.service.request("exportImage",g,function(D,R){D||(this.options.token&&(R.href+="?token="+this.options.token),this.options.proxy&&(R.href=this.options.proxy+"?"+R.href),this._renderImage(R.href,x))},this);else{g.f="image";var S=this.options.url+"exportImage"+gt.Util.getParamString(g);this.options.proxy&&(S=this.options.proxy+"?"+S),this._renderImage(S,x)}}});Hu.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(g){g=ll(g),this.service=Wu(g),this.service.addEventParent(this),gt.Util.setOptions(this,g)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(g){return this.options.dynamicLayers=g,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(g){return this.options.layers=g,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(g){return this.options.layerDefs=g,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(g){return this.options.timeOptions=g,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(g){var x=gt.Util.bind(function(R,J,lt){R||setTimeout(gt.Util.bind(function(){this._renderPopup(g.latlng,R,J,lt)},this),300)},this),S;if(this.options.popup?S=this.options.popup.on(this._map).at(g.latlng):S=this.identify().on(this._map).at(g.latlng),S.params.maxAllowableOffset||S.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?S.layers("visible:"+this.options.layers.join(",")):S.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!S.params.layerDefs)for(var D in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,D)&&S.layerDef(D,this.options.layerDefs[D]);S.run(x),this._shouldRenderPopup=!0,this._lastClick=g.latlng},_buildExportParams:function(){var g=parseInt(this._map.options.crs.code.split(":")[1],10),x={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:g,imageSR:g};if(this.options.dynamicLayers&&(x.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;x.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(x.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(x.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(x.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(x.token=this.service.options.token),this.options.proxy&&(x.proxy=this.options.proxy),this.options.disableCache&&(x._ts=Date.now()),x},_requestExport:function(g,x){if(this.options.f==="json")this.service.request("export",g,function(D,R){D||(this.options.token&&R.href&&(R.href+="?token="+this.options.token),this.options.proxy&&R.href&&(R.href=this.options.proxy+"?"+R.href),R.href?this._renderImage(R.href,x):this._renderImage(R.imageData,x,R.contentType))},this);else{g.f="image";var S=this.options.url+"export"+gt.Util.getParamString(g);this.options.proxy&&(S=this.options.proxy+"?"+S),this._renderImage(S,x)}}});var kl=gt.Layer.extend({options:{cellSize:512,updateWhenIdle:gt.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(g){gt.Util.setOptions(this,g)},onAdd:function(g){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(g){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var g={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=gt.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),g.move=this._onMove),g},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var g=this.options.cellSize;return g instanceof gt.Point?g:new gt.Point(g,g)},_pruneCells:function(){if(this._map){var g,x;for(g in this._cells)x=this._cells[g],x.retain=x.current;for(g in this._cells)if(x=this._cells[g],x.current&&!x.active){var S=x.coords;this._retainParent(S.x,S.y,S.z,S.z-5)||this._retainChildren(S.x,S.y,S.z,S.z+2)}for(g in this._cells)this._cells[g].retain||this._removeCell(g)}},_removeAllCells:function(){for(var g in this._cells)this._removeCell(g)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(g,x,S,D){var R=Math.floor(g/2),J=Math.floor(x/2),lt=S-1,h=new gt.Point(+R,+J);h.z=+lt;var Pt=this._cellCoordsToKey(h),ee=this._cells[Pt];return ee&&ee.active?(ee.retain=!0,!0):(ee&&ee.loaded&&(ee.retain=!0),lt>D?this._retainParent(R,J,lt,D):!1)},_retainChildren:function(g,x,S,D){for(var R=2*g;R<2*g+2;R++)for(var J=2*x;J<2*x+2;J++){var lt=new gt.Point(R,J);lt.z=S+1;var h=this._cellCoordsToKey(lt),Pt=this._cells[h];if(Pt&&Pt.active){Pt.retain=!0;continue}else Pt&&Pt.loaded&&(Pt.retain=!0);S+1<D&&this._retainChildren(R,J,S+1,D)}},_resetView:function(g){var x=g&&(g.pinch||g.flyTo);x||this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_setView:function(g,x,S,D){var R=Math.round(x);D||(this._cellZoom=R,this._abortLoading&&this._abortLoading(),this._resetGrid(),R!==void 0&&this._update(g),S||this._pruneCells(),this._noPrune=!!S)},_resetGrid:function(){var g=this._map,x=g.options.crs,S=this._cellSize=this.getCellSize(),D=this._cellZoom,R=this._map.getPixelWorldBounds(this._cellZoom);R&&(this._globalCellRange=this._pxBoundsToCellRange(R)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(g.project([0,x.wrapLng[0]],D).x/S.x),Math.ceil(g.project([0,x.wrapLng[1]],D).x/S.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(g.project([x.wrapLat[0],0],D).y/S.x),Math.ceil(g.project([x.wrapLat[1],0],D).y/S.y)]},_onMoveEnd:function(g){var x=g&&(g.pinch||g.flyTo);x||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(g){var x=this._map,S=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),D=x.getZoomScale(S,this._cellZoom),R=x.project(g,this._cellZoom).floor(),J=x.getSize().divideBy(D*2);return new gt.Bounds(R.subtract(J),R.add(J))},_update:function(g){var x=this._map;if(x){var S=Math.round(x.getZoom());g===void 0&&(g=x.getCenter());var D=this._getCelldPixelBounds(g),R=this._pxBoundsToCellRange(D),J=R.getCenter(),lt=[],h=this.options.keepBuffer,Pt=new gt.Bounds(R.getBottomLeft().subtract([h,-h]),R.getTopRight().add([h,-h]));if(!(isFinite(R.min.x)&&isFinite(R.min.y)&&isFinite(R.max.x)&&isFinite(R.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var ee in this._cells){var Se=this._cells[ee].coords;(Se.z!==this._cellZoom||!Pt.contains(new gt.Point(Se.x,Se.y)))&&(this._cells[ee].current=!1)}if(Math.abs(S-this._cellZoom)>1){this._setView(g,S);return}for(var Gt=R.min.y;Gt<=R.max.y;Gt++)for(var ft=R.min.x;ft<=R.max.x;ft++){var ci=new gt.Point(ft,Gt);if(ci.z=this._cellZoom,!!this._isValidCell(ci)){var $e=this._cells[this._cellCoordsToKey(ci)];$e?$e.current=!0:lt.push(ci)}}if(lt.sort(function(Fr,mn){return Fr.distanceTo(J)-mn.distanceTo(J)}),lt.length!==0)for(this._loading||(this._loading=!0),ft=0;ft<lt.length;ft++){var ce=this._cellCoordsToKey(lt[ft]),Or=this._keyToCellCoords(ce);this._activeCells[Or]?this._reuseCell(lt[ft]):this._createCell(lt[ft])}}},_isValidCell:function(g){var x=this._map.options.crs;if(!x.infinite){var S=this._globalCellRange;if(!x.wrapLng&&(g.x<S.min.x||g.x>S.max.x)||!x.wrapLat&&(g.y<S.min.y||g.y>S.max.y))return!1}if(!this.options.bounds)return!0;var D=this._cellCoordsToBounds(g);return gt.toLatLngBounds(this.options.bounds).overlaps(D)},_keyToBounds:function(g){return this._cellCoordsToBounds(this._keyToCellCoords(g))},_cellCoordsToNwSe:function(g){var x=this._map,S=this.getCellSize(),D=g.scaleBy(S),R=D.add(S),J=x.unproject(D,g.z),lt=x.unproject(R,g.z);return[J,lt]},_cellCoordsToBounds:function(g){var x=this._cellCoordsToNwSe(g),S=new gt.LatLngBounds(x[0],x[1]);return this.options.noWrap||(S=this._map.wrapLatLngBounds(S)),S},_cellCoordsToKey:function(g){return g.x+":"+g.y+":"+g.z},_keyToCellCoords:function(g){var x=g.split(":"),S=new gt.Point(+x[0],+x[1]);return S.z=+x[2],S},_removeCell:function(g){var x=this._cells[g];if(x){var S=this._keyToCellCoords(g),D=this._wrapCoords(S),R=this._cellCoordsToBounds(this._wrapCoords(S));x.current=!1,delete this._cells[g],this._activeCells[g]=x,this.cellLeave(R,D,g),this.fire("cellleave",{key:g,coords:D,bounds:R})}},_reuseCell:function(g){var x=this._cellCoordsToKey(g);this._cells[x]=this._activeCells[x],this._cells[x].current=!0;var S=this._wrapCoords(g),D=this._cellCoordsToBounds(this._wrapCoords(g));this.cellEnter(D,S,x),this.fire("cellenter",{key:x,coords:S,bounds:D})},_createCell:function(g){var x=this._cellCoordsToKey(g),S=this._wrapCoords(g),D=this._cellCoordsToBounds(this._wrapCoords(g));this.createCell(D,S,x),this.fire("cellcreate",{key:x,coords:S,bounds:D}),this._cells[x]={coords:g,current:!0},gt.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(g,x,S){var D=this._cellCoordsToKey(g);S=this._cells[D],S&&(S.loaded=+new Date,S.active=!0)},_getCellPos:function(g){return g.scaleBy(this.getCellSize())},_wrapCoords:function(g){var x=new gt.Point(this._wrapX?gt.Util.wrapNum(g.x,this._wrapX):g.x,this._wrapY?gt.Util.wrapNum(g.y,this._wrapY):g.y);return x.z=g.z,x},_pxBoundsToCellRange:function(g){var x=this.getCellSize();return new gt.Bounds(g.min.unscaleBy(x).floor(),g.max.unscaleBy(x).ceil().subtract([1,1]))}});function ro(g){this.values=[].concat(g||[])}ro.prototype.query=function(g){var x=this.getIndex(g);return this.values[x]};ro.prototype.getIndex=function(x){this.dirty&&this.sort();for(var S=0,D=this.values.length-1,R,J;S<=D;)if(R=(S+D)/2|0,J=this.values[Math.round(R)],+J.value<+x)S=R+1;else if(+J.value>+x)D=R-1;else return R;return Math.abs(~D)};ro.prototype.between=function(x,S){var D=this.getIndex(x),R=this.getIndex(S);if(D===0&&R===0)return[];for(;this.values[D-1]&&this.values[D-1].value===x;)D--;for(;this.values[R+1]&&this.values[R+1].value===S;)R++;return this.values[R]&&this.values[R].value===S&&this.values[R+1]&&R++,this.values.slice(D,R)};ro.prototype.insert=function(x){return this.values.splice(this.getIndex(x.value),0,x),this};ro.prototype.bulkAdd=function(x,S){return this.values=this.values.concat([].concat(x||[])),S?this.sort():this.dirty=!0,this};ro.prototype.sort=function(){return this.values.sort(function(x,S){return+S.value-+x.value}).reverse(),this.dirty=!1,this};var Ch=kl.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(g){if(kl.prototype.initialize.call(this,g),g=ll(g),g=gt.Util.setOptions(this,g),this.service=Tf(g),this.service.addEventParent(this),this.options.fields[0]!=="*"){for(var x=!1,S=0;S<this.options.fields.length;S++)this.options.fields[S].match(/^(OBJECTID|FID|OID|ID)$/i)&&(x=!0);x===!1&&ko("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new ro,this._endTimeIndex=new ro):this.options.timeField&&(this._timeIndex=new ro),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(g){return hl(g),this.service.metadata(function(x,S){if(!x){var D=S.supportedQueryFormats,R=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(R=!0),!R&&D&&D.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),S.objectIdField&&(this.service.options.idAttribute=S.objectIdField),!this.options.attribution&&g.attributionControl&&S.copyrightText&&(this.options.attribution=S.copyrightText,g.attributionControl.addAttribution(this.getAttribution()))}},this),g.on("zoomend",this._handleZoomChange,this),kl.prototype.onAdd.call(this,g)},onRemove:function(g){return Gl(g),g.off("zoomend",this._handleZoomChange,this),kl.prototype.onRemove.call(this,g)},getAttribution:function(){return this.options.attribution},createCell:function(g,x){this._visibleZoom()&&this._requestFeatures(g,x)},_requestFeatures:function(g,x,S,D){this._activeRequests++,D=D||0;var R=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:g},!0),this._buildQuery(g,D).run(function(J,lt,h){h&&h.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===R&&(!J&&lt&&lt.features.length&&gt.Util.requestAnimFrame(gt.Util.bind(function(){this._addFeatures(lt.features,x),this._postProcessFeatures(g)},this)),!J&&lt&&!lt.features.length&&this._postProcessFeatures(g),J&&this._postProcessFeatures(g),S&&S.call(this,J,lt),h&&(h.exceededTransferLimit||h.properties&&h.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(g,x,S,D+lt.features.length))},this)},_postProcessFeatures:function(g){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:g})},_cacheKey:function(g){return g.z+":"+g.x+":"+g.y},_addFeatures:function(g,x){if(x){var S=this._cacheKey(x);this._cache[S]=this._cache[S]||[]}for(var D=g.length-1;D>=0;D--){var R=g[D].id;this._currentSnapshot.indexOf(R)===-1&&this._currentSnapshot.push(R),typeof S<"u"&&this._cache[S].indexOf(R)===-1&&this._cache[S].push(R)}this.options.timeField&&this._buildTimeIndexes(g),this.createLayers(g)},_buildQuery:function(g,x){var S=this.service.query().intersects(g).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(x))&&(S=S.offset(x)),S.params.resultType="tile",this.options.requestParams&&gt.Util.extend(S.params,this.options.requestParams),this.options.simplifyFactor&&S.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&S.between(this.options.from,this.options.to),S},setWhere:function(g,x,S){this.options.where=g&&g.length?g:"1=1";for(var D=[],R=[],J=0,lt=null,h=gt.Util.bind(function(ft,ci){if(ft&&(lt=ft),ci)for(var $e=ci.features.length-1;$e>=0;$e--)R.push(ci.features[$e].id);J--,J<=0&&this._visibleZoom()&&g===this.options.where&&(this._currentSnapshot=R,gt.Util.requestAnimFrame(gt.Util.bind(function(){this.removeLayers(D),this.addLayers(R),x&&x.call(S,lt)},this)))},this),Pt=this._currentSnapshot.length-1;Pt>=0;Pt--)D.push(this._currentSnapshot[Pt]);this._cache={};for(var ee in this._cells){J++;var Se=this._keyToCellCoords(ee),Gt=this._cellCoordsToBounds(Se);this._requestFeatures(Gt,Se,h)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(g,x,S,D){var R=this.options.from,J=this.options.to,lt=0,h=null,Pt=gt.Util.bind(function(ft){ft&&(h=ft),this._filterExistingFeatures(R,J,g,x),lt--,S&&lt<=0&&S.call(D,h)},this);if(this.options.from=g,this.options.to=x,this._filterExistingFeatures(R,J,g,x),this.options.timeFilterMode==="server")for(var ee in this._cells){lt++;var Se=this._keyToCellCoords(ee),Gt=this._cellCoordsToBounds(Se);this._requestFeatures(Gt,Se,Pt)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(g,x,S,D){var R=g&&x?this._getFeaturesInTimeRange(g,x):this._currentSnapshot,J=this._getFeaturesInTimeRange(S,D);if(J.indexOf)for(var lt=0;lt<J.length;lt++){var h=R.indexOf(J[lt]);h>=0&&R.splice(h,1)}gt.Util.requestAnimFrame(gt.Util.bind(function(){this.removeLayers(R),this.addLayers(J)},this))},_getFeaturesInTimeRange:function(g,x){var S=[],D;if(this.options.timeField.start&&this.options.timeField.end){var R=this._startTimeIndex.between(g,x),J=this._endTimeIndex.between(g,x);D=R.concat(J)}else if(this._timeIndex)D=this._timeIndex.between(g,x);else return ko("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(var lt=D.length-1;lt>=0;lt--)S.push(D[lt].id);return S},_buildTimeIndexes:function(g){var x,S;if(this.options.timeField.start&&this.options.timeField.end){var D=[],R=[];for(x=g.length-1;x>=0;x--)S=g[x],D.push({id:S.id,value:new Date(S.properties[this.options.timeField.start])}),R.push({id:S.id,value:new Date(S.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(D),this._endTimeIndex.bulkAdd(R)}else{var J=[];for(x=g.length-1;x>=0;x--)S=g[x],J.push({id:S.id,value:new Date(S.properties[this.options.timeField])});this._timeIndex.bulkAdd(J)}},_featureWithinTimeRange:function(g){if(!this.options.from||!this.options.to)return!0;var x=+this.options.from.valueOf(),S=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){var D=+g.properties[this.options.timeField];return D>=x&&D<=S}if(this.options.timeField.start&&this.options.timeField.end){var R=+g.properties[this.options.timeField.start],J=+g.properties[this.options.timeField.end];return R>=x&&R<=S||J>=x&&J<=S||R<=x&&J>=S}},_visibleZoom:function(){if(!this._map)return!1;var g=this._map.getZoom();return!(g>this.options.maxZoom||g<this.options.minZoom)},_handleZoomChange:function(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot),this._currentSnapshot=[];else for(var g in this._cells){var x=this._cells[g].coords,S=this._cacheKey(x);this._cache[S]&&this.addLayers(this._cache[S])}},authenticate:function(g){return this.service.authenticate(g),this},metadata:function(g,x){return this.service.metadata(g,x),this},query:function(){return this.service.query()},_getMetadata:function(g){if(this._metadata){var x;g(x,this._metadata)}else this.metadata(gt.Util.bind(function(S,D){this._metadata=D,g(S,this._metadata)},this))},addFeature:function(g,x,S){this.addFeatures(g,x,S)},addFeatures:function(g,x,S){this._getMetadata(gt.Util.bind(function(D,R){if(D){x&&x.call(this,D,null);return}var J=g.features?g.features:[g];this.service.addFeatures(g,gt.Util.bind(function(lt,h){if(!lt){for(var Pt=J.length-1;Pt>=0;Pt--)J[Pt].properties[R.objectIdField]=J.length>1?h[Pt].objectId:h.objectId,J[Pt].id=J.length>1?h[Pt].objectId:h.objectId;this._addFeatures(J)}x&&x.call(S,lt,h)},this))},this))},updateFeature:function(g,x,S){this.updateFeatures(g,x,S)},updateFeatures:function(g,x,S){var D=g.features?g.features:[g];this.service.updateFeatures(g,function(R,J){if(!R){for(var lt=D.length-1;lt>=0;lt--)this.removeLayers([D[lt].id],!0);this._addFeatures(D)}x&&x.call(S,R,J)},this)},deleteFeature:function(g,x,S){this.deleteFeatures(g,x,S)},deleteFeatures:function(g,x,S){return this.service.deleteFeatures(g,function(D,R){var J=R.length?R:[R];if(!D&&J.length>0)for(var lt=J.length-1;lt>=0;lt--)this.removeLayers([J[lt].objectId],!0);x&&x.call(S,D,R)},this)}}),Ef=Ch.extend({options:{cacheLayers:!0},initialize:function(g){g.apikey&&(g.token=g.apikey),Ch.prototype.initialize.call(this,g),this._originalStyle=this.options.style,this._layers={}},onRemove:function(g){for(var x in this._layers)g.removeLayer(this._layers[x]),this.fire("removefeature",{feature:this._layers[x].feature,permanent:!1},!0);return Ch.prototype.onRemove.call(this,g)},createNewLayer:function(g){var x=gt.GeoJSON.geometryToLayer(g,this.options);return x&&(x.defaultOptions=x.options),x},_updateLayer:function(g,x){var S=[],D=this.options.coordsToLatLng||gt.GeoJSON.coordsToLatLng;switch(x.properties&&(g.feature.properties=x.properties),x.geometry.type){case"Point":S=gt.GeoJSON.coordsToLatLng(x.geometry.coordinates),g.setLatLng(S);break;case"LineString":S=gt.GeoJSON.coordsToLatLngs(x.geometry.coordinates,0,D),g.setLatLngs(S);break;case"MultiLineString":S=gt.GeoJSON.coordsToLatLngs(x.geometry.coordinates,1,D),g.setLatLngs(S);break;case"Polygon":S=gt.GeoJSON.coordsToLatLngs(x.geometry.coordinates,1,D),g.setLatLngs(S);break;case"MultiPolygon":S=gt.GeoJSON.coordsToLatLngs(x.geometry.coordinates,2,D),g.setLatLngs(S);break}this.redraw(g.feature.id)},createLayers:function(g){for(var x=g.length-1;x>=0;x--){var S=g[x],D=this._layers[S.id],R;this._visibleZoom()&&D&&!this._map.hasLayer(D)&&(!this.options.timeField||this._featureWithinTimeRange(S))&&(this._map.addLayer(D),this.fire("addfeature",{feature:D.feature},!0)),D&&(D.setLatLngs||D.setLatLng)&&this._updateLayer(D,S),D||(R=this.createNewLayer(S),R?(R.feature=S,R.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(R.feature,R),this._layers[R.feature.id]=R,this.setFeatureStyle(R.feature.id,this.options.style),this.fire("createfeature",{feature:R.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(S))&&this._map.addLayer(R)):ko("invalid GeoJSON encountered"))}},addLayers:function(g){for(var x=g.length-1;x>=0;x--){var S=this._layers[g[x]];S&&(!this.options.timeField||this._featureWithinTimeRange(S.feature))&&(this._map.addLayer(S),this.fire("addfeature",{feature:S.feature},!0))}},removeLayers:function(g,x){for(var S=g.length-1;S>=0;S--){var D=g[S],R=this._layers[D];R&&(this.fire("removefeature",{feature:R.feature,permanent:x},!0),this._map.removeLayer(R)),R&&x&&delete this._layers[D]}},cellEnter:function(g,x){this._visibleZoom()&&!this._zooming&&this._map&&gt.Util.requestAnimFrame(gt.Util.bind(function(){var S=this._cacheKey(x),D=this._cellCoordsToKey(x),R=this._cache[S];this._activeCells[D]&&R&&this.addLayers(R)},this))},cellLeave:function(g,x){this._zooming||gt.Util.requestAnimFrame(gt.Util.bind(function(){if(this._map){var S=this._cacheKey(x),D=this._cellCoordsToKey(x),R=this._cache[S],J=this._map.getBounds();if(!this._activeCells[D]&&R){for(var lt=!0,h=0;h<R.length;h++){var Pt=this._layers[R[h]];Pt&&Pt.getBounds&&J.intersects(Pt.getBounds())&&(lt=!1)}lt&&this.removeLayers(R,!this.options.cacheLayers),!this.options.cacheLayers&&lt&&(delete this._cache[S],delete this._cells[D],delete this._activeCells[D])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(g){this.resetFeatureStyle(g.feature.id)},this),this},setStyle:function(g){return this.options.style=g,this.eachFeature(function(x){this.setFeatureStyle(x.feature.id,g)},this),this},resetFeatureStyle:function(g){var x=this._layers[g],S=this._originalStyle||gt.Path.prototype.options;return x&&(gt.Util.extend(x.options,x.defaultOptions),this.setFeatureStyle(g,S)),this},setFeatureStyle:function(g,x){var S=this._layers[g];return typeof x=="function"&&(x=x(S.feature)),S.setStyle&&S.setStyle(x),this},eachActiveFeature:function(g,x){if(this._map){var S=this._map.getBounds();for(var D in this._layers)this._currentSnapshot.indexOf(this._layers[D].feature.id)!==-1&&(typeof this._layers[D].getLatLng=="function"&&S.contains(this._layers[D].getLatLng())?g.call(x,this._layers[D]):typeof this._layers[D].getBounds=="function"&&S.intersects(this._layers[D].getBounds())&&g.call(x,this._layers[D]))}return this},eachFeature:function(g,x){for(var S in this._layers)g.call(x,this._layers[S]);return this},getFeature:function(g){return this._layers[g]},bringToBack:function(){this.eachFeature(function(g){g.bringToBack&&g.bringToBack()})},bringToFront:function(){this.eachFeature(function(g){g.bringToFront&&g.bringToFront()})},redraw:function(g){return g&&this._redraw(g),this},_redraw:function(g){var x=this._layers[g],S=x.feature;if(x&&x.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var D=this.options.pointToLayer(S,gt.latLng(S.geometry.coordinates[1],S.geometry.coordinates[0])),R=D.options.icon;x.setIcon(R)}if(x&&x.setStyle&&this.options.pointToLayer){var J=this.options.pointToLayer(S,gt.latLng(S.geometry.coordinates[1],S.geometry.coordinates[0])),lt=J.options;this.setFeatureStyle(S.id,lt)}x&&x.setStyle&&this.options.style&&this.resetFeatureStyle(S.id)},openPopup(g){return this._popup&&this._popup._prepareOpen(g||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(g){return this._tooltip&&this._tooltip._prepareOpen(g)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});function Pf(g,x){let S="https://basemaps-api.arcgis.com/arcgis/rest/services/styles/"+g+"?type=style";return x&&(S=S+"&apiKey="+x),S}function Af(g,x,S){const D=/^https?:\/\//,R=/\/VectorTileServer\/?$/;D.test(g)&&R.test(g)?Ku(g,x,S):Cf(g,x,S)}function Xu(g,x,S){const D=x.token?{token:x.token}:{};Ma(g,D,S)}function bu(g,x,S){const D=x.token?{token:x.token}:{},R=x.portalUrl+"/sharing/rest/content/items/"+g;Ma(R,D,S)}function Cf(g,x,S){const D=x.portalUrl+"/sharing/rest/content/items/"+g+"/resources/styles/root.json";Ju(D,x,function(R,J){R?bu(g,x,function(lt,h){lt&&console.error(lt),Ku(h.url,x,S)}):bu(g,x,function(lt,h){lt&&console.error(lt),Xu(h.url,x,function(Pt,ee){S(Pt,J,D,ee,h.url)})})})}function Ku(g,x,S){Xu(g,x,function(D,R){D&&console.error(D);let J=g;g.charAt(g.length-1)==="/"&&(J=g.slice(0,g.length-1));let lt;R.defaultStyles.charAt(0)==="/"?lt=J+R.defaultStyles+"/root.json":lt=J+"/"+R.defaultStyles+"/root.json",Ju(lt,x,function(h,Pt){h&&console.error(h),S(null,Pt,lt,R,g)})})}function Ju(g,x,S){const D=x.token?{token:x.token}:{};Ma(g,D,S)}function Mf(g,x,S,D){const R=Object.keys(g.sources);for(let lt=0;lt<R.length;lt++){const h=g.sources[R[lt]];h.url.indexOf("http")===-1&&(h.url=x.replace("/resources/styles/root.json","")),h.url.charAt(h.url.length-1)==="/"&&(h.url=h.url.slice(0,h.url.length-1)),h.tiles||(S.tiles&&S.tiles[0].charAt(0)!=="/"&&(S.tiles[0]="/"+S.tiles[0]),h.tiles=[h.url+S.tiles[0]]),h.url+="?f=json",h.url+=D?"&token="+D:"",h.tiles[0]+=D?"?token="+D:"",h.minzoom=S.tileInfo.lods[0].level,h.maxzoom=S.tileInfo.lods[S.tileInfo.lods.length-1].level}const J=g.sources[R[R.length-1]];J.attribution=S.copyrightText||"",J.copyrightText=S.copyrightText||"";for(let lt=0;lt<g.layers.length;lt++){const h=g.layers[lt];h.layout&&h.layout["text-font"]&&h.layout["text-font"].length>1&&(h.layout["text-font"]=[h.layout["text-font"][0]])}return g.sprite&&g.sprite.indexOf("http")===-1&&(g.sprite=x.replace("styles/root.json",g.sprite.replace("../","")),g.sprite+=D?"?token="+D:""),g.glyphs&&g.glyphs.indexOf("http")===-1&&(g.glyphs=x.replace("styles/root.json",g.glyphs.replace("../","")),g.glyphs+=D?"?token="+D:""),g}function zf(g,x){zo.cors&&Ma(g,{},function(S,D){if(S)return;x._esriAttributions=x._esriAttributions||[];for(let J=0;J<D.contributors.length;J++){const lt=D.contributors[J];for(let h=0;h<lt.coverageAreas.length;h++){const Pt=lt.coverageAreas[h],ee=gt.latLng(Pt.bbox[0],Pt.bbox[1]),Se=gt.latLng(Pt.bbox[2],Pt.bbox[3]);x._esriAttributions.push({attribution:lt.attribution,score:Pt.score,bounds:gt.latLngBounds(ee,Se),minZoom:Pt.zoomMin,maxZoom:Pt.zoomMax})}}x._esriAttributions.sort(function(J,lt){return lt.score-J.score});const R={target:x};rl._updateMapAttribution(R)})}const Lf=[3857,102100,102113];function kf(g){return Lf.indexOf(g)>=0}var Rh={},Df={get exports(){return Rh},set exports(g){Rh=g}};(function(g,x){(function(S,D){g.exports=D()})(Du,function(){var S,D,R;function J(h,Pt){if(!S)S=Pt;else if(!D)D=Pt;else{var ee="var sharedChunk = {}; ("+S+")(sharedChunk); ("+D+")(sharedChunk);",Se={};S(Se),R=Pt(Se),typeof window<"u"&&(R.workerUrl=window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"})))}}J(["exports"],function(h){var Pt=ee;function ee(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}function Se(i,t,n,o){const u=new Pt(i,t,n,o);return function(p){return u.solve(p)}}ee.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<t)return n;var p=this.sampleCurveDerivativeX(n);if(Math.abs(p)<1e-6)break;n-=u/p}var m=0,v=1;for(n=i,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<t));o++)i>u?m=n:v=n,n=.5*(v-m)+m;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};const Gt=Se(.25,.1,.25,1);function ft(i,t,n){return Math.min(n,Math.max(t,i))}function ci(i,t,n){const o=n-t,u=((i-t)%o+o)%o+t;return u===t?n:u}function $e(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let ce=1;function Or(i,t){i.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Fr(i,t,n){const o={};for(const u in i)o[u]=t.call(n||this,i[u],u,i);return o}function mn(i,t,n){const o={};for(const u in i)t.call(n||this,i[u],u,i)&&(o[u]=i[u]);return o}function ii(i){return Array.isArray(i)?i.map(ii):typeof i=="object"&&i?Fr(i,ii):i}const Ur={};function ni(i){Ur[i]||(typeof console<"u"&&console.warn(i),Ur[i]=!0)}function _n(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function Qn(i){let t=0;for(let n,o,u=0,p=i.length,m=p-1;u<p;m=u++)n=i[u],o=i[m],t+=(o.x-n.x)*(n.y+o.y);return t}function rn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function cs(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,p)=>{const m=u||p;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let On,ui,di=null;function us(i){if(di==null){const t=i.navigator?i.navigator.userAgent:null;di=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return di}function Ci(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const gr={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const n=window.document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return n.width=i.width,n.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-t,-t,i.width+2*t,i.height+2*t)},resolveURL:i=>(On||(On=document.createElement("a")),On.href=i,On.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ui==null&&(ui=matchMedia("(prefers-reduced-motion: reduce)")),ui.matches)}};var Jt=sn;function sn(i,t){this.x=i,this.y=t}sn.prototype={clone:function(){return new sn(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,t){var n=Math.cos(i),o=Math.sin(i),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},sn.convert=function(i){return i instanceof sn?i:Array.isArray(i)?new sn(i[0],i[1]):i};const ae={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},gn="mapbox-tiles";let ne,Ze,gi=500,yi=50;function ri(){typeof caches>"u"||ne||(ne=caches.open(gn))}let Ie=1/0;const De={supported:!1,testSupport:function(i){!Zi&&Ni&&(yr?Nr(i):Mi=i)}};let Mi,Ni,Zi=!1,yr=!1;function Nr(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Ni),i.isContextLost())return;De.supported=!0}catch{}i.deleteTexture(t),Zi=!0}typeof document<"u"&&(Ni=document.createElement("img"),Ni.onload=function(){Mi&&Nr(Mi),Mi=null,yr=!0},Ni.onerror=function(){Zi=!0,Mi=null},Ni.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const on={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(on);class Vi extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const Es=rn()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function tr(i,t){const n=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Es(),signal:n.signal});let u=!1,p=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),((m,v,w)=>{if(p)return;const E=Date.now();fetch(o).then(M=>M.ok?((k,F,V)=>{(i.type==="arrayBuffer"?k.arrayBuffer():i.type==="json"?k.json():k.text()).then(G=>{p||(F&&V&&function(Y,K,ut){if(ri(),!ne)return;const yt={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((mt,Et)=>yt.headers.set(Et,mt));const ct=cs(K.headers.get("Cache-Control")||"");ct["no-store"]||(ct["max-age"]&&yt.headers.set("Expires",new Date(ut+1e3*ct["max-age"]).toUTCString()),new Date(yt.headers.get("Expires")).getTime()-ut<42e4||function(mt,Et){if(Ze===void 0)try{new Response(new ReadableStream),Ze=!0}catch{Ze=!1}Ze?Et(mt.body):mt.blob().then(Et)}(K,mt=>{const Et=new Response(mt,yt);ri(),ne&&ne.then(It=>It.put(function(Wt){const Kt=Wt.indexOf("?");return Kt<0?Wt:Wt.slice(0,Kt)}(Y.url),Et)).catch(It=>ni(It.message))}))}(o,F,V),u=!0,t(null,G,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(G=>{p||t(new Error(G.message))})})(M,null,E):M.blob().then(k=>t(new Vi(M.status,M.statusText,i.url,k)))).catch(M=>{M.code!==20&&t(new Error(M.message))})})(),{cancel:()=>{p=!0,u||n.abort()}}}const Zr=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(rn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!rn()){const o=i.url.substring(0,i.url.indexOf("://"));return(ae.REGISTERED_PROTOCOLS[o]||tr)(i,t)}}if(!(/^file:/.test(n=i.url)||/^file:/.test(Es())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return tr(i,t);if(rn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var n;return function(o,u){const p=new XMLHttpRequest;p.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in o.headers)p.setRequestHeader(m,o.headers[m]);return o.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=o.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(o.type==="json")try{m=JSON.parse(p.response)}catch(v){return u(v)}u(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else{const m=new Blob([p.response],{type:p.getResponseHeader("Content-Type")});u(new Vi(p.status,p.statusText,o.url,m))}},p.send(o.body),{cancel:()=>p.abort()}}(i,t)},vr=function(i,t){return Zr($e(i,{type:"arrayBuffer"}),t)};function xr(i){const t=window.document.createElement("a");return t.href=i,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let En,Fn;En=[],Fn=0;const er=function(i,t){if(De.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Fn>=ae.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return En.push(p),p}Fn++;let n=!1;const o=()=>{if(!n)for(n=!0,Fn--;En.length&&Fn<ae.MAX_PARALLEL_IMAGE_REQUESTS;){const p=En.shift(),{requestParameters:m,callback:v,cancelled:w}=p;w||(p.cancel=er(m,v).cancel)}},u=vr(i,(p,m,v,w)=>{o(),p?t(p):m&&function(E,M){typeof createImageBitmap=="function"?function(k,F){const V=new Blob([new Uint8Array(k)],{type:"image/png"});createImageBitmap(V).then(G=>{F(null,G)}).catch(G=>{F(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(E,M):function(k,F){const V=new Image;V.onload=()=>{F(null,V),URL.revokeObjectURL(V.src),V.onload=null,window.requestAnimationFrame(()=>{V.src=Ae})},V.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new Blob([new Uint8Array(k)],{type:"image/png"});V.src=k.byteLength?URL.createObjectURL(G):Ae}(E,M)}(m,(E,M)=>{E!=null?t(E):M!=null&&t(null,M,{cacheControl:v,expires:w})})});return{cancel:()=>{u.cancel(),o()}}};function ds(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function ir(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class nr{constructor(t,n={}){$e(this,n),this.type=t}}class br extends nr{constructor(t,n={}){super("error",$e({error:t},n))}}class Un{on(t,n){return this._listeners=this._listeners||{},ds(t,n,this._listeners),this}off(t,n){return ir(t,n,this._listeners),ir(t,n,this._oneTimeListeners),this}once(t,n){return this._oneTimeListeners=this._oneTimeListeners||{},ds(t,n,this._oneTimeListeners),this}fire(t,n){typeof t=="string"&&(t=new nr(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of u)v.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of p)ir(o,v,this._oneTimeListeners),v.call(this,t);const m=this._eventedParent;m&&($e(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof br&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var wt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Bt{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function wr(i){const t=i.value;return t?[new Bt(i.key,t,"constants have been deprecated as of v8")]:[]}function yn(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}function Ce(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function an(i){if(Array.isArray(i))return i.map(an);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=an(i[n]);return t}return Ce(i)}class Gi extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Wi{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Wi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Tr={kind:"null"},Lt={kind:"number"},fe={kind:"string"},ue={kind:"boolean"},wi={kind:"color"},rr={kind:"object"},le={kind:"value"},sr={kind:"collator"},Ti={kind:"formatted"},ps={kind:"padding"},pi={kind:"resolvedImage"};function qi(i,t){return{kind:"array",itemType:i,N:t}}function Ue(i){if(i.kind==="array"){const t=Ue(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Sr=[Tr,Lt,fe,ue,wi,Ti,rr,qi(le),ps,pi];function Nn(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Nn(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of Sr)if(!Nn(n,t))return null}}return`Expected ${Ue(i)} but found ${Ue(t)} instead.`}function Vr(i,t){return t.some(n=>n.kind===i.kind)}function Gr(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}var fs,zi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function N(i){return(i=Math.round(i))<0?0:i>255?255:i}function C(i){return N(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function B(i){return(t=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function q(i,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(t-i)*n*6:2*n<1?t:3*n<2?i+(t-i)*(2/3-n)*6:i}try{fs={}.parseCSSColor=function(i){var t,n=i.replace(/ /g,"").toLowerCase();if(n in zi)return zi[n].slice();if(n[0]==="#")return n.length===4?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:n.length===7&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var o=n.indexOf("("),u=n.indexOf(")");if(o!==-1&&u+1===n.length){var p=n.substr(0,o),m=n.substr(o+1,u-(o+1)).split(","),v=1;switch(p){case"rgba":if(m.length!==4)return null;v=B(m.pop());case"rgb":return m.length!==3?null:[C(m[0]),C(m[1]),C(m[2]),v];case"hsla":if(m.length!==4)return null;v=B(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=B(m[1]),M=B(m[2]),k=M<=.5?M*(E+1):M+E-M*E,F=2*M-k;return[N(255*q(F,k,w+1/3)),N(255*q(F,k,w)),N(255*q(F,k,w-1/3)),v];default:return null}}return null}}catch{}class ${constructor(t,n,o,u=1){this.r=t,this.g=n,this.b=o,this.a=u}static parse(t){if(!t)return;if(t instanceof $)return t;if(typeof t!="string")return;const n=fs(t);return n?new $(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,o,u]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(o)},${u})`}toArray(){const{r:t,g:n,b:o,a:u}=this;return u===0?[0,0,0,0]:[255*t/u,255*n/u,255*o/u,u]}}$.black=new $(0,0,0,1),$.white=new $(1,1,1,1),$.transparent=new $(0,0,0,0),$.red=new $(1,0,0,1);class Q{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class st{constructor(t,n,o,u,p){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=p}}class nt{constructor(t){this.sections=t}static fromString(t){return new nt([new st(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof nt?t:nt.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class tt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof tt)return t;if(typeof t=="number")return new tt([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new tt(t)}}toString(){return JSON.stringify(this.values)}}class at{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new at({name:t,available:!1}):null}}function xt(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function At(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof $||i instanceof Q||i instanceof nt||i instanceof tt||i instanceof at)return!0;if(Array.isArray(i)){for(const t of i)if(!At(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!At(i[t]))return!1;return!0}return!1}function vt(i){if(i===null)return Tr;if(typeof i=="string")return fe;if(typeof i=="boolean")return ue;if(typeof i=="number")return Lt;if(i instanceof $)return wi;if(i instanceof Q)return sr;if(i instanceof nt)return Ti;if(i instanceof tt)return ps;if(i instanceof at)return pi;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const u=vt(o);if(n){if(n===u)continue;n=le;break}n=u}return qi(n||le,t)}return rr}function Ht(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof $||i instanceof nt||i instanceof tt||i instanceof at?i.toString():JSON.stringify(i)}class Xt{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!At(t[1]))return n.error("invalid value");const o=t[1];let u=vt(o);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Xt(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ft{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ie={string:fe,number:Lt,boolean:ue,object:rr};class re{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const p=t[0];if(p==="array"){let v,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in ie)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=ie[E],u++}else v=le;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);w=t[2],u++}o=qi(v,w)}else{if(!ie[p])throw new Error(`Types doesn't contain name = ${p}`);o=ie[p]}const m=[];for(;u<t.length;u++){const v=n.parse(t[u],u,le);if(!v)return null;m.push(v)}return new re(o,m)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Nn(this.type,vt(o)))return o;if(n===this.args.length-1)throw new Ft(`Expected value to be of type ${Ue(this.type)}, but found ${Ue(vt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Me={"to-boolean":ue,"to-color":wi,"to-number":Lt,"to-string":fe};class he{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Me[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=Me[o],p=[];for(let m=1;m<t.length;m++){const v=n.parse(t[m],m,le);if(!v)return null;p.push(v)}return new he(u,p)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof $)return n;if(typeof n=="string"){const p=t.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:xt(n[0],n[1],n[2],n[3]),!o))return new $(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ft(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="padding"){let n;for(const o of this.args){n=o.evaluate(t);const u=tt.parse(n);if(u)return u}throw new Ft(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Ft(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?nt.fromString(Ht(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?at.fromString(Ht(this.args[0].evaluate(t))):Ht(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const me=["Unknown","Point","LineString","Polygon"];class we{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?me[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=$.parse(t)),n}}class Be{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=Be.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=m.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,M]of v){w=new Vn(n.registry,n.path,null,n.scope);const k=[];let F=!1;for(let V=1;V<t.length;V++){const G=t[V],Y=Array.isArray(E)?E[V-1]:E.type,K=w.parse(G,1+k.length,Y);if(!K){F=!0;break}k.push(K)}if(!F)if(Array.isArray(E)&&E.length!==k.length)w.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let V=0;V<k.length;V++){const G=Array.isArray(E)?E[V]:E.type,Y=k[V];w.concat(V+1).checkSubtype(G,Y.type)}if(w.errors.length===0)return new Be(o,p,M,k)}}if(v.length===1)n.errors.push(...w.errors);else{const E=(v.length?v:m).map(([k])=>{return F=k,Array.isArray(F)?`(${F.map(Ue).join(", ")})`:`(${Ue(F.type)}...)`;var F}).join(" | "),M=[];for(let k=1;k<t.length;k++){const F=n.parse(t[k],1+M.length);if(!F)return null;M.push(Ue(F.type))}n.error(`Expected arguments of type ${E}, but found (${M.join(", ")}) instead.`)}return null}static register(t,n){Be.definitions=n;for(const o in n)t[o]=Be}}class vi{constructor(t,n,o){this.type=sr,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ue);if(!u)return null;const p=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ue);if(!p)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,fe),!m)?null:new vi(u,p,m)}evaluate(t){return new Q(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const Ke=8192;function fi(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Ee(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function je(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*Ke),Math.round(o*u*Ke)]}function Oe(i,t,n){const o=i[0]-t[0],u=i[1]-t[1],p=i[0]-n[0],m=i[1]-n[1];return o*m-p*u==0&&o*p<=0&&u*m<=0}function Ir(i,t){let n=!1;for(let m=0,v=t.length;m<v;m++){const w=t[m];for(let E=0,M=w.length;E<M-1;E++){if(Oe(i,w[E],w[E+1]))return!1;(u=w[E])[1]>(o=i)[1]!=(p=w[E+1])[1]>o[1]&&o[0]<(p[0]-u[0])*(o[1]-u[1])/(p[1]-u[1])+u[0]&&(n=!n)}}var o,u,p;return n}function Er(i,t){for(let n=0;n<t.length;n++)if(Ir(i,t[n]))return!0;return!1}function so(i,t,n,o){const u=o[0]-n[0],p=o[1]-n[1],m=(i[0]-n[0])*p-u*(i[1]-n[1]),v=(t[0]-n[0])*p-u*(t[1]-n[1]);return m>0&&v<0||m<0&&v>0}function ge(i,t,n){for(const E of n)for(let M=0;M<E.length-1;++M)if((v=[(m=E[M+1])[0]-(p=E[M])[0],m[1]-p[1]])[0]*(w=[(u=t)[0]-(o=i)[0],u[1]-o[1]])[1]-v[1]*w[0]!=0&&so(o,u,p,m)&&so(p,m,o,u))return!0;var o,u,p,m,v,w;return!1}function si(i,t){for(let n=0;n<i.length;++n)if(!Ir(i[n],t))return!1;for(let n=0;n<i.length-1;++n)if(ge(i[n],i[n+1],t))return!1;return!0}function Do(i,t){for(let n=0;n<t.length;n++)if(si(i,t[n]))return!0;return!1}function qr(i,t,n){const o=[];for(let u=0;u<i.length;u++){const p=[];for(let m=0;m<i[u].length;m++){const v=je(i[u][m],n);fi(t,v),p.push(v)}o.push(p)}return o}function Hi(i,t,n){const o=[];for(let u=0;u<i.length;u++){const p=qr(i[u],t,n);o.push(p)}return o}function sa(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let p=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;p===0&&(p=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=p}fi(t,i)}function Ps(i,t,n,o){const u=Math.pow(2,o.z)*Ke,p=[o.x*Ke,o.y*Ke],m=[];for(const v of i)for(const w of v){const E=[w.x+p[0],w.y+p[1]];sa(E,t,n,u),m.push(E)}return m}function Pr(i,t,n,o){const u=Math.pow(2,o.z)*Ke,p=[o.x*Ke,o.y*Ke],m=[];for(const w of i){const E=[];for(const M of w){const k=[M.x+p[0],M.y+p[1]];fi(t,k),E.push(k)}m.push(E)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of m)for(const E of w)sa(E,t,n,u)}var v;return m}class Je{constructor(t,n){this.type=ue,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(At(t[1])){const o=t[1];if(o.type==="FeatureCollection")for(let u=0;u<o.features.length;++u){const p=o.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Je(o,o.features[u].geometry)}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Je(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Je(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const v=qr(o.coordinates,p,m),w=Ps(n.geometry(),u,p,m);if(!Ee(u,p))return!1;for(const E of w)if(!Ir(E,v))return!1}if(o.type==="MultiPolygon"){const v=Hi(o.coordinates,p,m),w=Ps(n.geometry(),u,p,m);if(!Ee(u,p))return!1;for(const E of w)if(!Er(E,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const v=qr(o.coordinates,p,m),w=Pr(n.geometry(),u,p,m);if(!Ee(u,p))return!1;for(const E of w)if(!si(E,v))return!1}if(o.type==="MultiPolygon"){const v=Hi(o.coordinates,p,m),w=Pr(n.geometry(),u,p,m);if(!Ee(u,p))return!1;for(const E of w)if(!Do(E,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Pn(i){if(i instanceof Be&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Je)return!1;let t=!0;return i.eachChild(n=>{t&&!Pn(n)&&(t=!1)}),t}function Zn(i){if(i instanceof Be&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!Zn(n)&&(t=!1)}),t}function Ar(i,t){if(i instanceof Be&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!Ar(o,t)&&(n=!1)}),n}class ms{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new ms(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Vn{constructor(t,n=[],o,u=new Wi,p=[]){this.registry=t,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=p,this.expectedType=o}parse(t,n,o,u,p={}){return n?this.concat(n,o,u)._parse(t,p):this._parse(t,p)}_parse(t,n){function o(u,p,m){return m==="assert"?new re(p,[u]):m==="coerce"?new he(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let m=p.parse(t,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,w=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(v.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array"){if(this.checkSubtype(v,w))return null}else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"assert")}if(!(m instanceof Xt)&&m.type.kind!=="resolvedImage"&&As(m)){const v=new we;try{m=new Xt(m.type,m.evaluate(v))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new Vn(this.registry,u,n||null,p,this.errors)}error(t,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Gi(o,t))}checkSubtype(t,n){const o=Nn(t,n);return o&&this.error(o),o}}function As(i){if(i instanceof ms)return As(i.boundExpression);if(i instanceof Be&&i.name==="error"||i instanceof vi||i instanceof Je)return!1;const t=i instanceof he||i instanceof re;let n=!0;return i.eachChild(o=>{n=t?n&&As(o):n&&o instanceof Xt}),!!n&&Pn(i)&&Ar(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _s(i,t){const n=i.length-1;let o,u,p=0,m=n,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),o=i[v],u=i[v+1],o<=t){if(v===n||t<u)return v;p=v+1}else{if(!(o>t))throw new Ft("Input is not a number.");m=v-1}return 0}class Cr{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Lt);if(!o)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let m=1;m<t.length;m+=2){const v=m===1?-1/0:t[m],w=t[m+1],E=m,M=m+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=n.parse(w,M,p);if(!k)return null;p=p||k.type,u.push([v,k])}return new Cr(p,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;return u>=n[p-1]?o[p-1].evaluate(t):o[_s(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function We(i,t,n){return i*(1-n)+t*n}var $r=Object.freeze({__proto__:null,number:We,color:function(i,t,n){return new $(We(i.r,t.r,n),We(i.g,t.g,n),We(i.b,t.b,n),We(i.a,t.a,n))},array:function(i,t,n){return i.map((o,u)=>We(o,t[u],n))},padding:function(i,t,n){const o=i.values,u=t.values;return new tt([We(o[0],u[0],n),We(o[1],u[1],n),We(o[2],u[2],n),We(o[3],u[3],n)])}});const Cs=.95047,Bo=1.08883,Ms=4/29,oo=6/29,_e=3*oo*oo,Gn=Math.PI/180,Ye=180/Math.PI;function ao(i){return i>.008856451679035631?Math.pow(i,1/3):i/_e+Ms}function zs(i){return i>oo?i*i*i:_e*(i-Ms)}function Ls(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ks(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function xe(i){const t=ks(i.r),n=ks(i.g),o=ks(i.b),u=ao((.4124564*t+.3575761*n+.1804375*o)/Cs),p=ao((.2126729*t+.7151522*n+.072175*o)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-ao((.0193339*t+.119192*n+.9503041*o)/Bo)),alpha:i.a}}function lo(i){let t=(i.l+16)/116,n=isNaN(i.a)?t:t+i.a/500,o=isNaN(i.b)?t:t-i.b/200;return t=1*zs(t),n=Cs*zs(n),o=Bo*zs(o),new $(Ls(3.2404542*n-1.5371385*t-.4985314*o),Ls(-.969266*n+1.8760108*t+.041556*o),Ls(.0556434*n-.2040259*t+1.0572252*o),i.alpha)}function Ds(i,t,n){const o=t-i;return i+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const hi={forward:xe,reverse:lo,interpolate:function(i,t,n){return{l:We(i.l,t.l,n),a:We(i.a,t.a,n),b:We(i.b,t.b,n),alpha:We(i.alpha,t.alpha,n)}}},An={forward:function(i){const{l:t,a:n,b:o}=xe(i),u=Math.atan2(o,n)*Ye;return{h:u<0?u+360:u,c:Math.sqrt(n*n+o*o),l:t,alpha:i.a}},reverse:function(i){const t=i.h*Gn,n=i.c;return lo({l:i.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:i.alpha})},interpolate:function(i,t,n){return{h:Ds(i.h,t.h,n),c:We(i.c,t.c,n),l:We(i.l,t.l,n),alpha:We(i.alpha,t.alpha,n)}}};var Ro=Object.freeze({__proto__:null,lab:hi,hcl:An});class Xi{constructor(t,n,o,u,p){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(t,n,o,u){let p=0;if(t.name==="exponential")p=Oo(n,t.base,o,u);else if(t.name==="linear")p=Oo(n,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;p=new Pt(m[0],m[1],m[2],m[3]).solve(Oo(n,1,o,u))}return p}static parse(t,n){let[o,u,p,...m]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Lt),!p)return null;const v=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=wi:n.expectedType&&n.expectedType.kind!=="value"&&(w=n.expectedType);for(let E=0;E<m.length;E+=2){const M=m[E],k=m[E+1],F=E+3,V=E+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const G=n.parse(k,V,w);if(!G)return null;w=w||G.type,v.push([M,G])}return w.kind==="number"||w.kind==="color"||w.kind==="padding"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Xi(w,o,u,p,v):n.error(`Type ${Ue(w)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const p=n.length;if(u>=n[p-1])return o[p-1].evaluate(t);const m=_s(n,u),v=Xi.interpolationFactor(this.interpolation,u,n[m],n[m+1]),w=o[m].evaluate(t),E=o[m+1].evaluate(t);return this.operator==="interpolate"?$r[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?An.reverse(An.interpolate(An.forward(w),An.forward(E),v)):hi.reverse(hi.interpolate(hi.forward(w),hi.forward(E),v))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Oo(i,t,n,o){const u=o-n,p=i-n;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}class Bs{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const v of t.slice(1)){const w=n.parse(v,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,p.push(w)}if(!o)throw new Error("No output type");const m=u&&p.some(v=>Nn(u,v.type));return new Bs(m?le:o,p)}evaluate(t){let n,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(t),o&&o instanceof at&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class gs{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const m=t[p];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=n.parse(t[p+1],p+1);if(!v)return null;o.push([m,v])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new gs(o,u):null}outputDefined(){return this.result.outputDefined()}}class Fo{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Lt),u=n.parse(t[2],2,qi(n.expectedType||le));return o&&u?new Fo(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new Ft(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Ft(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Ft(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ho{constructor(t,n){this.type=ue,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,le),u=n.parse(t[2],2,le);return o&&u?Vr(o.type,[ue,fe,Lt,Tr,le])?new ho(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Gr(n,["boolean","string","number","null"]))throw new Ft(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(vt(n))} instead.`);if(!Gr(o,["string","array"]))throw new Ft(`Expected second argument to be of type array or string, but found ${Ue(vt(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Pe{constructor(t,n,o){this.type=Lt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,le),u=n.parse(t[2],2,le);if(!o||!u)return null;if(!Vr(o.type,[ue,fe,Lt,Tr,le]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Lt);return p?new Pe(o,u,p):null}return new Pe(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Gr(n,["boolean","string","number","null"]))throw new Ft(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(vt(n))} instead.`);if(!Gr(o,["string","array"]))throw new Ft(`Expected second argument to be of type array or string, but found ${Ue(vt(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(t);return o.indexOf(n,u)}return o.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Uo{constructor(t,n,o,u,p,m){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=p,this.otherwise=m}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},m=[];for(let E=2;E<t.length-1;E+=2){let M=t[E];const k=t[E+1];Array.isArray(M)||(M=[M]);const F=n.concat(E);if(M.length===0)return F.error("Expected at least one branch label.");for(const G of M){if(typeof G!="number"&&typeof G!="string")return F.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return F.error("Numeric branch labels must be integer values.");if(o){if(F.checkSubtype(o,vt(G)))return null}else o=vt(G);if(p[String(G)]!==void 0)return F.error("Branch labels must be unique.");p[String(G)]=m.length}const V=n.parse(k,E,u);if(!V)return null;u=u||V.type,m.push(V)}const v=n.parse(t[1],1,le);if(!v)return null;const w=n.parse(t[t.length-1],t.length-1,u);return w?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new Uo(o,u,v,p,m,w):null}evaluate(t){const n=this.input.evaluate(t);return(vt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ln{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const v=n.parse(t[m],m,ue);if(!v)return null;const w=n.parse(t[m+1],m+1,o);if(!w)return null;u.push([v,w]),o=o||w.type}const p=n.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new ln(o,u,p)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Mr{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,le),u=n.parse(t[2],2,Lt);if(!o||!u)return null;if(!Vr(o.type,[qi(le),fe,le]))return n.error(`Expected first argument to be of type array or string, but found ${Ue(o.type)} instead`);if(t.length===4){const p=n.parse(t[3],3,Lt);return p?new Mr(o.type,o,u,p):null}return new Mr(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);if(!Gr(n,["string","array"]))throw new Ft(`Expected first argument to be of type array or string, but found ${Ue(vt(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(t);return n.slice(o,u)}return n.slice(o)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function No(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function oa(i,t,n,o){return o.compare(t,n)===0}function zr(i,t,n){const o=i!=="=="&&i!=="!=";return class Yu{constructor(p,m,v){this.type=ue,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let w=m.parse(p[1],1,le);if(!w)return null;if(!No(v,w.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ue(w.type)}'.`);let E=m.parse(p[2],2,le);if(!E)return null;if(!No(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ue(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Ue(w.type)}' and '${Ue(E.type)}'.`);o&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new re(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new re(w.type,[E])));let M=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(p[3],3,sr),!M)return null}return new Yu(w,E,M)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const w=vt(m),E=vt(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Ft(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=vt(m),E=vt(v);if(w.kind!=="string"||E.kind!=="string")return t(p,m,v)}return this.collator?n(p,m,v,this.collator.evaluate(p)):t(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const za=zr("==",function(i,t,n){return t===n},oa),aa=zr("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!oa(0,t,n,o)}),La=zr("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),ka=zr(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),Zo=zr("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),Da=zr(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class vn{constructor(t,n,o,u,p){this.type=fe,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Lt);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parse(u.locale,1,fe),!p))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,fe),!m))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,Lt),!v))return null;let w=null;return u["max-fraction-digits"]&&(w=n.parse(u["max-fraction-digits"],1,Lt),!w)?null:new vn(o,p,m,v,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class co{constructor(t){this.type=Ti,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=t.length-1;++m){const v=t[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=n.parse(v["font-scale"],1,Lt),!w))return null;let E=null;if(v["text-font"]&&(E=n.parse(v["text-font"],1,qi(fe)),!E))return null;let M=null;if(v["text-color"]&&(M=n.parse(v["text-color"],1,wi),!M))return null;const k=u[u.length-1];k.scale=w,k.font=E,k.textColor=M}else{const w=n.parse(t[m],1,le);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new co(u)}evaluate(t){return new nt(this.sections.map(n=>{const o=n.content.evaluate(t);return vt(o)===pi?new st("",o,null,null,null):new st(Ht(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class uo{constructor(t){this.type=pi,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,fe);return o?new uo(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=at.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class qn{constructor(t){this.type=Lt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ue(o.type)} instead.`):new qn(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Ft(`Expected value to be of type string or array, but found ${Ue(vt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const jr={"==":za,"!=":aa,">":ka,"<":La,">=":Da,"<=":Zo,array:re,at:Fo,boolean:re,case:ln,coalesce:Bs,collator:vi,format:co,image:uo,in:ho,"index-of":Pe,interpolate:Xi,"interpolate-hcl":Xi,"interpolate-lab":Xi,length:qn,let:gs,literal:Xt,match:Uo,number:re,"number-format":vn,object:re,slice:Mr,step:Cr,string:re,"to-boolean":he,"to-color":he,"to-number":he,"to-string":he,var:ms,within:Je};function Vo(i,[t,n,o,u]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const p=u?u.evaluate(i):1,m=xt(t,n,o,p);if(m)throw new Ft(m);return new $(t/255*p,n/255*p,o/255*p,p)}function la(i,t){return i in t}function po(i,t){const n=t[i];return n===void 0?null:n}function or(i){return{type:i}}function ha(i){return{result:"success",value:i}}function Wr(i){return{result:"error",value:i}}function He(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Rs(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function de(i){return!!i.expression&&i.expression.interpolated}function Re(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Fe(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ze(i){return i}function ys(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),p=i.type||(de(t)?"exponential":"interval");if(n||t.type==="padding"){const E=n?$.parse:tt.parse;(i=yn({},i)).stops&&(i.stops=i.stops.map(M=>[M[0],E(M[1])])),i.default=E(i.default?i.default:t.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!Ro[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,w;if(p==="exponential")m=Go;else if(p==="interval")m=ca;else if(p==="categorical"){m=Ba,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];w=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=Ra}if(o){const E={},M=[];for(let V=0;V<i.stops.length;V++){const G=i.stops[V],Y=G[0].zoom;E[Y]===void 0&&(E[Y]={zoom:Y,type:i.type,property:i.property,default:i.default,stops:[]},M.push(Y)),E[Y].stops.push([G[0].value,G[1]])}const k=[];for(const V of M)k.push([E[V].zoom,ys(E[V],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Xi.interpolationFactor.bind(void 0,F),zoomStops:k.map(V=>V[0]),evaluate:({zoom:V},G)=>Go({stops:k,base:i.base},t,V).evaluate(V,G)}}if(u){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Xi.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>m(i,t,M,v,w)}}return{kind:"source",evaluate(E,M){const k=M&&M.properties?M.properties[i.property]:void 0;return k===void 0?Hr(i.default,t.default):m(i,t,k,v,w)}}}function Hr(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function Ba(i,t,n,o,u){return Hr(typeof n===u?o[n]:void 0,i.default,t.default)}function ca(i,t,n){if(Re(n)!=="number")return Hr(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=_s(i.stops.map(p=>p[0]),n);return i.stops[u][1]}function Go(i,t,n){const o=i.base!==void 0?i.base:1;if(Re(n)!=="number")return Hr(i.default,t.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const p=_s(i.stops.map(M=>M[0]),n),m=function(M,k,F,V){const G=V-F,Y=M-F;return G===0?0:k===1?Y/G:(Math.pow(k,Y)-1)/(Math.pow(k,G)-1)}(n,o,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let E=$r[t.type]||ze;if(i.colorSpace&&i.colorSpace!=="rgb"){const M=Ro[i.colorSpace];E=(k,F)=>M.reverse(M.interpolate(M.forward(k),M.forward(F),m))}return typeof v.evaluate=="function"?{evaluate(...M){const k=v.evaluate.apply(void 0,M),F=w.evaluate.apply(void 0,M);if(k!==void 0&&F!==void 0)return E(k,F,m)}}:E(v,w,m)}function Ra(i,t,n){switch(t.type){case"color":n=$.parse(n);break;case"formatted":n=nt.fromString(n.toString());break;case"resolvedImage":n=at.fromString(n.toString());break;case"padding":n=tt.parse(n);break;default:Re(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Hr(n,i.default,t.default)}Be.register(jr,{error:[{kind:"error"},[fe],(i,[t])=>{throw new Ft(t.evaluate(i))}],typeof:[fe,[le],(i,[t])=>Ue(vt(t.evaluate(i)))],"to-rgba":[qi(Lt,4),[wi],(i,[t])=>t.evaluate(i).toArray()],rgb:[wi,[Lt,Lt,Lt],Vo],rgba:[wi,[Lt,Lt,Lt,Lt],Vo],has:{type:ue,overloads:[[[fe],(i,[t])=>la(t.evaluate(i),i.properties())],[[fe,rr],(i,[t,n])=>la(t.evaluate(i),n.evaluate(i))]]},get:{type:le,overloads:[[[fe],(i,[t])=>po(t.evaluate(i),i.properties())],[[fe,rr],(i,[t,n])=>po(t.evaluate(i),n.evaluate(i))]]},"feature-state":[le,[fe],(i,[t])=>po(t.evaluate(i),i.featureState||{})],properties:[rr,[],i=>i.properties()],"geometry-type":[fe,[],i=>i.geometryType()],id:[le,[],i=>i.id()],zoom:[Lt,[],i=>i.globals.zoom],"heatmap-density":[Lt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Lt,[],i=>i.globals.lineProgress||0],accumulated:[le,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Lt,or(Lt),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[Lt,or(Lt),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:Lt,overloads:[[[Lt,Lt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[Lt],(i,[t])=>-t.evaluate(i)]]},"/":[Lt,[Lt,Lt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[Lt,[Lt,Lt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[Lt,[Lt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Lt,[Lt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Lt,[Lt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Lt,[Lt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Lt,[Lt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Lt,[Lt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Lt,[Lt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Lt,[Lt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Lt,[Lt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Lt,[Lt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Lt,or(Lt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[Lt,or(Lt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[Lt,[Lt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Lt,[Lt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Lt,[Lt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Lt,[Lt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[ue,[fe,le],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[ue,[le],(i,[t])=>i.id()===t.value],"filter-type-==":[ue,[fe],(i,[t])=>i.geometryType()===t.value],"filter-<":[ue,[fe,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[ue,[fe,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[ue,[fe,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[ue,[fe,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[ue,[le],(i,[t])=>t.value in i.properties()],"filter-has-id":[ue,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ue,[qi(fe)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[ue,[qi(le)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[ue,[fe,qi(le)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[ue,[fe,qi(le)],(i,[t,n])=>function(o,u,p,m){for(;p<=m;){const v=p+m>>1;if(u[v]===o)return!0;u[v]>o?m=v-1:p=v+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:ue,overloads:[[[ue,ue],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[or(ue),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ue,overloads:[[[ue,ue],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[or(ue),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[ue,[ue],(i,[t])=>!t.evaluate(i)],"is-supported-script":[ue,[fe],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[fe,[fe],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[fe,[fe],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[fe,or(le),(i,t)=>t.map(n=>Ht(n.evaluate(i))).join("")],"resolved-locale":[fe,[sr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class vs{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new we,this._defaultValue=n?function(o){return o.type==="color"&&Fe(o.default)?new $(0,0,0,0):o.type==="color"?$.parse(o.default)||null:o.type==="padding"?tt.parse(o.default)||null:o.default===void 0?null:o.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,u,p,m){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,p,m){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Ft(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Xr(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in jr}function Os(i,t){const n=new Vn(jr,[],t?function(u){const p={color:wi,string:fe,number:Lt,enum:fe,boolean:ue,formatted:Ti,padding:ps,resolvedImage:pi};return u.type==="array"?qi(p[u.value]||le,u.length):p[u.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ha(new vs(o,t)):Wr(n.errors)}class Fs{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Zn(n.expression)}evaluateWithoutErrorHandling(t,n,o,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,m)}evaluate(t,n,o,u,p,m){return this._styleExpression.evaluate(t,n,o,u,p,m)}}class fo{constructor(t,n,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Zn(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,n,o,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,p,m)}evaluate(t,n,o,u,p,m){return this._styleExpression.evaluate(t,n,o,u,p,m)}interpolationFactor(t,n,o){return this.interpolationType?Xi.interpolationFactor(this.interpolationType,t,n,o):0}}function ua(i,t){const n=Os(i,t);if(n.result==="error")return n;const o=n.value.expression,u=Pn(o);if(!u&&!He(t))return Wr([new Gi("","data expressions not supported")]);const p=Ar(o,["zoom"]);if(!p&&!Rs(t))return Wr([new Gi("","zoom expressions not supported")]);const m=ar(o);return m||p?m instanceof Gi?Wr([m]):m instanceof Xi&&!de(t)?Wr([new Gi("",'"interpolate" expressions cannot be used with this property')]):ha(m?new fo(u?"camera":"composite",n.value,m.labels,m instanceof Xi?m.interpolation:void 0):new Fs(u?"constant":"source",n.value)):Wr([new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ki{constructor(t,n){this._parameters=t,this._specification=n,yn(this,ys(this._parameters,this._specification))}static deserialize(t){return new Ki(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ar(i){let t=null;if(i instanceof gs)t=ar(i.result);else if(i instanceof Bs){for(const n of i.args)if(t=ar(n),t)break}else(i instanceof Cr||i instanceof Xi)&&i.input instanceof Be&&i.input.name==="zoom"&&(t=i);return t instanceof Gi||i.eachChild(n=>{const o=ar(n);o instanceof Gi?t=o:!t&&o?t=new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Cn(i){const t=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,m=i.styleSpec;let v=[];const w=Re(n);if(w!=="object")return[new Bt(t,n,`object expected, ${w} found`)];for(const E in n){const M=E.split(".")[0],k=o[M]||o["*"];let F;if(u[M])F=u[M];else if(o[M])F=Ji;else if(u["*"])F=u["*"];else{if(!o["*"]){v.push(new Bt(t,n[E],`unknown property "${E}"`));continue}F=Ji}v=v.concat(F({key:(t&&`${t}.`)+E,value:n[E],valueSpec:k,style:p,styleSpec:m,object:n,objectKey:E},n))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&n[E]===void 0&&v.push(new Bt(t,n,`missing required property "${E}"`));return v}function $n(i){const t=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,p=i.key,m=i.arrayElementValidator||Ji;if(Re(t)!=="array")return[new Bt(p,t,`array expected, ${Re(t)} found`)];if(n.length&&t.length!==n.length)return[new Bt(p,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Bt(p,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};u.$version<7&&(v.function=n.function),Re(n.value)==="object"&&(v=n.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(m({array:t,arrayIndex:E,value:t[E],valueSpec:v,style:o,styleSpec:u,key:`${p}[${E}]`}));return w}function qo(i){const t=i.key,n=i.value,o=i.valueSpec;let u=Re(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Bt(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Bt(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Bt(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Kr(i){const t=i.valueSpec,n=Ce(i.value.type);let o,u,p,m={};const v=n!=="categorical"&&i.value.property===void 0,w=!v,E=Re(i.value.stops)==="array"&&Re(i.value.stops[0])==="array"&&Re(i.value.stops[0][0])==="object",M=Cn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(V){if(n==="identity")return[new Bt(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const Y=V.value;return G=G.concat($n({key:V.key,value:Y,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:k})),Re(Y)==="array"&&Y.length===0&&G.push(new Bt(V.key,Y,"array must have at least one stop")),G},default:function(V){return Ji({key:V.key,value:V.value,valueSpec:t,style:V.style,styleSpec:V.styleSpec})}}});return n==="identity"&&v&&M.push(new Bt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||M.push(new Bt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!de(i.valueSpec)&&M.push(new Bt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!He(i.valueSpec)?M.push(new Bt(i.key,i.value,"property functions not supported")):v&&!Rs(i.valueSpec)&&M.push(new Bt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!E||i.value.property!==void 0||M.push(new Bt(i.key,i.value,'"property" property is required')),M;function k(V){let G=[];const Y=V.value,K=V.key;if(Re(Y)!=="array")return[new Bt(K,Y,`array expected, ${Re(Y)} found`)];if(Y.length!==2)return[new Bt(K,Y,`array length 2 expected, length ${Y.length} found`)];if(E){if(Re(Y[0])!=="object")return[new Bt(K,Y,`object expected, ${Re(Y[0])} found`)];if(Y[0].zoom===void 0)return[new Bt(K,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new Bt(K,Y,"object stop key must have value")];if(p&&p>Ce(Y[0].zoom))return[new Bt(K,Y[0].zoom,"stop zoom values must appear in ascending order")];Ce(Y[0].zoom)!==p&&(p=Ce(Y[0].zoom),u=void 0,m={}),G=G.concat(Cn({key:`${K}[0]`,value:Y[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:qo,value:F}}))}else G=G.concat(F({key:`${K}[0]`,value:Y[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},Y));return Xr(an(Y[1]))?G.concat([new Bt(`${K}[1]`,Y[1],"expressions are not allowed in function stops.")]):G.concat(Ji({key:`${K}[1]`,value:Y[1],valueSpec:t,style:V.style,styleSpec:V.styleSpec}))}function F(V,G){const Y=Re(V.value),K=Ce(V.value),ut=V.value!==null?V.value:G;if(o){if(Y!==o)return[new Bt(V.key,ut,`${Y} stop domain type must match previous stop domain type ${o}`)]}else o=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean")return[new Bt(V.key,ut,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&n!=="categorical"){let yt=`number expected, ${Y} found`;return He(t)&&n===void 0&&(yt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Bt(V.key,ut,yt)]}return n!=="categorical"||Y!=="number"||isFinite(K)&&Math.floor(K)===K?n!=="categorical"&&Y==="number"&&u!==void 0&&K<u?[new Bt(V.key,ut,"stop domain values must appear in ascending order")]:(u=K,n==="categorical"&&K in m?[new Bt(V.key,ut,"stop domain values must be unique")]:(m[K]=!0,[])):[new Bt(V.key,ut,`integer expected, found ${K}`)]}}function Jr(i){const t=(i.expressionContext==="property"?ua:Os)(an(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Bt(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Bt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Zn(n))return[new Bt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Zn(n))return[new Bt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ar(n,["zoom","feature-state"]))return[new Bt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Pn(n))return[new Bt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function lr(i){const t=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Ce(n))===-1&&u.push(new Bt(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ce(n))===-1&&u.push(new Bt(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Yr(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Yr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const mo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _o(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Yr(i)||(i=Ns(i));const t=Os(i,mo);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,u)=>t.value.evaluate(n,o,{},u),needGeometry:Us(i)}}function hr(i,t){return i<t?-1:i>t?1:0}function Us(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(Us(i[t]))return!0;return!1}function Ns(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Zs(i[1],i[2],"=="):t==="!="?xs(Zs(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Zs(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(Ns))):t==="all"?["all"].concat(i.slice(1).map(Ns)):t==="none"?["all"].concat(i.slice(1).map(Ns).map(xs)):t==="in"?go(i[1],i.slice(2)):t==="!in"?xs(go(i[1],i.slice(2))):t==="has"?hn(i[1]):t==="!has"?xs(hn(i[1])):t!=="within"||i;var n}function Zs(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function go(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(hr)]]:["filter-in-small",i,["literal",t]]}}function hn(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function xs(i){return["!",i]}function jn(i){return Yr(an(i.value))?Jr(yn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):da(i)}function da(i){const t=i.value,n=i.key;if(Re(t)!=="array")return[new Bt(n,t,`array expected, ${Re(t)} found`)];const o=i.styleSpec;let u,p=[];if(t.length<1)return[new Bt(n,t,"filter array must have at least 1 element")];switch(p=p.concat(lr({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ce(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ce(t[1])==="$type"&&p.push(new Bt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Bt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Re(t[1]),u!=="string"&&p.push(new Bt(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=Re(t[m]),Ce(t[1])==="$type"?p=p.concat(lr({key:`${n}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new Bt(`${n}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)p=p.concat(da({key:`${n}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=Re(t[1]),t.length!==2?p.push(new Bt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new Bt(`${n}[1]`,t[1],`string expected, ${u} found`));break;case"within":u=Re(t[1]),t.length!==2?p.push(new Bt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="object"&&p.push(new Bt(`${n}[1]`,t[1],`object expected, ${u} found`))}return p}function cn(i,t){const n=i.key,o=i.style,u=i.styleSpec,p=i.value,m=i.objectKey,v=u[`${t}_${i.layerType}`];if(!v)return[];const w=m.match(/^(.*)-transition$/);if(t==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return Ji({key:n,value:p,valueSpec:u.transition,style:o,styleSpec:u});const E=i.valueSpec||v[m];if(!E)return[new Bt(n,p,`unknown property "${m}"`)];let M;if(Re(p)==="string"&&He(E)&&!E.tokens&&(M=/^{([^}]+)}$/.exec(p)))return[new Bt(n,p,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const k=[];return i.layerType==="symbol"&&(m==="text-field"&&o&&!o.glyphs&&k.push(new Bt(n,p,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Fe(an(p))&&Ce(p.type)==="identity"&&k.push(new Bt(n,p,'"text-font" does not support identity functions'))),k.concat(Ji({key:i.key,value:p,valueSpec:E,style:o,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:m}))}function Vs(i){return cn(i,"paint")}function $o(i){return cn(i,"layout")}function yo(i){let t=[];const n=i.value,o=i.key,u=i.style,p=i.styleSpec;n.type||n.ref||t.push(new Bt(o,n,'either "type" or "ref" is required'));let m=Ce(n.type);const v=Ce(n.ref);if(n.id){const w=Ce(n.id);for(let E=0;E<i.arrayIndex;E++){const M=u.layers[E];Ce(M.id)===w&&t.push(new Bt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${M.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&t.push(new Bt(o,n[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{Ce(E.id)===v&&(w=E)}),w?w.ref?t.push(new Bt(o,n.ref,"ref cannot reference another ref layer")):m=Ce(w.type):t.push(new Bt(o,n.ref,`ref layer "${v}" not found`))}else if(m!=="background")if(n.source){const w=u.sources&&u.sources[n.source],E=w&&Ce(w.type);w?E==="vector"&&m==="raster"?t.push(new Bt(o,n.source,`layer "${n.id}" requires a raster source`)):E==="raster"&&m!=="raster"?t.push(new Bt(o,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&m!=="hillshade"?t.push(new Bt(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||E==="geojson"&&w.lineMetrics||t.push(new Bt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Bt(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Bt(o,n.source,`source "${n.source}" not found`))}else t.push(new Bt(o,n,'missing required property "source"'));return t=t.concat(Cn({key:o,value:n,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ji({key:`${o}.type`,value:n.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:jn,layout:w=>Cn({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>$o(yn({layerType:m},E))}}),paint:w=>Cn({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Vs(yn({layerType:m},E))}})}})),t}function cr(i){const t=i.value,n=i.key,o=Re(t);return o!=="string"?[new Bt(n,t,`string expected, ${o} found`)]:[]}const vo={promoteId:function({key:i,value:t}){if(Re(t)==="string")return cr({key:i,value:t});{const n=[];for(const o in t)n.push(...cr({key:`${i}.${o}`,value:t[o]}));return n}}};function Lr(i){const t=i.value,n=i.key,o=i.styleSpec,u=i.style;if(!t.type)return[new Bt(n,t,'"type" is required')];const p=Ce(t.type);let m;switch(p){case"vector":case"raster":case"raster-dem":return m=Cn({key:n,value:t,valueSpec:o[`source_${p.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:vo}),m;case"geojson":if(m=Cn({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,objectElementValidators:vo}),t.cluster)for(const v in t.clusterProperties){const[w,E]=t.clusterProperties[v],M=typeof w=="string"?[w,["accumulated"],["get",v]]:w;m.push(...Jr({key:`${n}.${v}.map`,value:E,expressionContext:"cluster-map"})),m.push(...Jr({key:`${n}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return m;case"video":return Cn({key:n,value:t,valueSpec:o.source_video,style:u,styleSpec:o});case"image":return Cn({key:n,value:t,valueSpec:o.source_image,style:u,styleSpec:o});case"canvas":return[new Bt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return lr({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:o})}}function Wn(i){const t=i.value,n=i.styleSpec,o=n.light,u=i.style;let p=[];const m=Re(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new Bt("light",t,`object expected, ${m} found`)]),p;for(const v in t){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&o[w[1]]&&o[w[1]].transition?Ji({key:v,value:t[v],valueSpec:n.transition,style:u,styleSpec:n}):o[v]?Ji({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Bt(v,t[v],`unknown property "${v}"`)])}return p}function Li(i){const t=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let p=[];const m=Re(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new Bt("terrain",t,`object expected, ${m} found`)]),p;for(const v in t)p=p.concat(o[v]?Ji({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Bt(v,t[v],`unknown property "${v}"`)]);return p}const Qr={"*":()=>[],array:$n,boolean:function(i){const t=i.value,n=i.key,o=Re(t);return o!=="boolean"?[new Bt(n,t,`boolean expected, ${o} found`)]:[]},number:qo,color:function(i){const t=i.key,n=i.value,o=Re(n);return o!=="string"?[new Bt(t,n,`color expected, ${o} found`)]:fs(n)===null?[new Bt(t,n,`color expected, "${n}" found`)]:[]},constants:wr,enum:lr,filter:jn,function:Kr,layer:yo,object:Cn,source:Lr,light:Wn,terrain:Li,string:cr,formatted:function(i){return cr(i).length===0?[]:Jr(i)},resolvedImage:function(i){return cr(i).length===0?[]:Jr(i)},padding:function(i){const t=i.key,n=i.value;if(Re(n)==="array"){if(n.length<1||n.length>4)return[new Bt(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<n.length;p++)u=u.concat(Ji({key:`${t}[${p}]`,value:n[p],valueSpec:o}));return u}return qo({key:t,value:n,valueSpec:{}})}};function Ji(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return n.expression&&Fe(Ce(t))?Kr(i):n.expression&&Xr(an(t))?Jr(i):n.type&&Qr[n.type]?Qr[n.type](i):Cn(yn({},i,{valueSpec:n.type?o[n.type]:n}))}function Oa(i){const t=i.value,n=i.key,o=cr(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Bt(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Bt(n,t,'"glyphs" url must include a "{range}" token'))),o}function Mn(i,t=wt){let n=[];return n=n.concat(Ji({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:Oa,"*":()=>[]}})),i.constants&&(n=n.concat(wr({key:"constants",value:i.constants,style:i,styleSpec:t}))),pa(n)}function pa(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Hn(i){return function(...t){return pa(i.apply(this,t))}}Mn.source=Hn(Lr),Mn.light=Hn(Wn),Mn.terrain=Hn(Li),Mn.layer=Hn(yo),Mn.filter=Hn(jn),Mn.paintProperty=Hn(Vs),Mn.layoutProperty=Hn($o);const Gs=Mn,xo=Gs.light,Fa=Gs.paintProperty,Xn=Gs.layoutProperty;function ts(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new br(new Error(o.message))),n=!0;return n}class qs{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(n=m[1])+2*(o=m[2]);for(let w=0;w<this.d*this.d;w++){const E=m[3+w],M=m[3+w+1];u.push(E===M?null:m.subarray(E,M))}const v=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],v),this.bboxes=m.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const p=o/n*t;this.min=-p,this.max=t+p}insert(t,n,o,u,p){this._forEachCell(n,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,p,m){this.cells[p].push(m)}query(t,n,o,u,p){const m=this.min,v=this.max;if(t<=m&&n<=m&&v<=o&&v<=u&&!p)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,n,o,u,this._queryCell,w,{},p),w}}_queryCell(t,n,o,u,p,m,v,w){const E=this.cells[p];if(E!==null){const M=this.keys,k=this.bboxes;for(let F=0;F<E.length;F++){const V=E[F];if(v[V]===void 0){const G=4*V;(w?w(k[G+0],k[G+1],k[G+2],k[G+3]):t<=k[G+2]&&n<=k[G+3]&&o>=k[G+0]&&u>=k[G+1])?(v[V]=!0,m.push(M[V])):v[V]=!1}}}}_forEachCell(t,n,o,u,p,m,v,w){const E=this._convertToCellCoord(t),M=this._convertToCellCoord(n),k=this._convertToCellCoord(o),F=this._convertToCellCoord(u);for(let V=E;V<=k;V++)for(let G=M;G<=F;G++){const Y=this.d*G+V;if((!w||w(this._convertFromCellCoord(V),this._convertFromCellCoord(G),this._convertFromCellCoord(V+1),this._convertFromCellCoord(G+1)))&&p.call(this,t,n,o,u,Y,m,v,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=n;for(let m=0;m<t.length;m++){const v=t[m];u[3+m]=p,u.set(v,p),p+=v.length}return u[3+t.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+t.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new qs(t.buffer)}}const xn={};function qt(i,t,n={}){if(xn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),xn[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}qt("Object",Object),qt("TransferableGridIndex",qs),qt("Color",$),qt("Error",Error),qt("AJAXError",Vi),qt("ResolvedImage",at),qt("StylePropertyFunction",Ki),qt("StyleExpression",vs,{omit:["_evaluator"]}),qt("ZoomDependentExpression",fo),qt("ZoomConstantExpression",Fs),qt("CompoundExpression",Be,{omit:["_evaluate"]});for(const i in jr)jr[i]._classRegistryKey||qt(`Expression_${i}`,jr[i]);function jo(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function es(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(jo(i)||Ci(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return t&&t.push(n.buffer),n}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(es(o,t));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!xn[o])throw new Error(`${o} is not registered.`);const u=n.serialize?n.serialize(i,t):{};if(n.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||xn[o].omit.indexOf(p)>=0)continue;const m=i[p];u[p]=xn[o].shallow.indexOf(p)>=0?m:es(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof i)}function bn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||jo(i)||Ci(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(bn);if(typeof i=="object"){const t=i.$name||"Object";if(!xn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=xn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const p=i[u];o[u]=xn[t].shallow.indexOf(u)>=0?p:bn(p)}return o}throw new Error("can't deserialize object of type "+typeof i)}class Wo{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Dt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function $s(i){for(const t of i)if(zn(t.charCodeAt(0)))return!0;return!1}function fa(i){for(const t of i)if(!Ho(t.charCodeAt(0)))return!1;return!0}function Ho(i){return!(Dt.Arabic(i)||Dt["Arabic Supplement"](i)||Dt["Arabic Extended-A"](i)||Dt["Arabic Presentation Forms-A"](i)||Dt["Arabic Presentation Forms-B"](i))}function zn(i){return!(i!==746&&i!==747&&(i<4352||!(Dt["Bopomofo Extended"](i)||Dt.Bopomofo(i)||Dt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Dt["CJK Compatibility Ideographs"](i)||Dt["CJK Compatibility"](i)||Dt["CJK Radicals Supplement"](i)||Dt["CJK Strokes"](i)||!(!Dt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Dt["CJK Unified Ideographs Extension A"](i)||Dt["CJK Unified Ideographs"](i)||Dt["Enclosed CJK Letters and Months"](i)||Dt["Hangul Compatibility Jamo"](i)||Dt["Hangul Jamo Extended-A"](i)||Dt["Hangul Jamo Extended-B"](i)||Dt["Hangul Jamo"](i)||Dt["Hangul Syllables"](i)||Dt.Hiragana(i)||Dt["Ideographic Description Characters"](i)||Dt.Kanbun(i)||Dt["Kangxi Radicals"](i)||Dt["Katakana Phonetic Extensions"](i)||Dt.Katakana(i)&&i!==12540||!(!Dt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Dt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Dt["Unified Canadian Aboriginal Syllabics"](i)||Dt["Unified Canadian Aboriginal Syllabics Extended"](i)||Dt["Vertical Forms"](i)||Dt["Yijing Hexagram Symbols"](i)||Dt["Yi Syllables"](i)||Dt["Yi Radicals"](i))))}function Xo(i){return!(zn(i)||function(t){return!!(Dt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Dt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Dt["Letterlike Symbols"](t)||Dt["Number Forms"](t)||Dt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Dt["Control Pictures"](t)&&t!==9251||Dt["Optical Character Recognition"](t)||Dt["Enclosed Alphanumerics"](t)||Dt["Geometric Shapes"](t)||Dt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Dt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Dt["CJK Symbols and Punctuation"](t)||Dt.Katakana(t)||Dt["Private Use Area"](t)||Dt["CJK Compatibility Forms"](t)||Dt["Small Form Variants"](t)||Dt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Ko(i){return i>=1424&&i<=2303||Dt["Arabic Presentation Forms-A"](i)||Dt["Arabic Presentation Forms-B"](i)}function js(i,t){return!(!t&&Ko(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Dt.Khmer(i))}function ma(i){for(const t of i)if(Ko(t.charCodeAt(0)))return!0;return!1}const bs="deferred",is="loading",bo="loaded";let wo=null,Yi="unavailable",ur=null;const Jo=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Yi="error"),wo&&wo(i)};function ns(){To.fire(new nr("pluginStateChange",{pluginStatus:Yi,pluginURL:ur}))}const To=new Un,ws=function(){return Yi},_a=function(){if(Yi!==bs||!ur)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yi=is,ns(),ur&&vr({url:ur},i=>{i?Jo(i):(Yi=bo,ns())})},un={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yi===bo||un.applyArabicShaping!=null,isLoading:()=>Yi===is,setState(i){if(!rn())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Yi=i.pluginStatus,ur=i.pluginURL},isParsed(){if(!rn())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return un.applyArabicShaping!=null&&un.processBidirectionalText!=null&&un.processStyledBidirectionalText!=null},getPluginURL(){if(!rn())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return ur}};class Qe{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Wo,this.transition={})}isSupportedScript(t){return function(n,o){for(const u of n)if(!js(u.charCodeAt(0),o))return!1;return!0}(t,un.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Ws{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,u){if(Fe(o))return new Ki(o,u);if(Xr(o)){const p=ua(o,u);if(p.result==="error")throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));return p.value}{let p=o;return u.type==="color"&&typeof o=="string"?p=$.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)||(p=tt.parse(o)),{kind:"constant",evaluate:()=>p}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class r{constructor(t){this.property=t,this.value=new Ws(t,void 0)}transitioned(t,n){return new _(this.property,this.value,n,$e({},t.transition,this.transition),t.now)}untransitioned(){return new _(this.property,this.value,null,{},0)}}class l{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ii(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new r(this._values[t].property)),this._values[t].value=new Ws(this._values[t].property,n===null?void 0:ii(n))}getTransition(t){return ii(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new r(this._values[t].property)),this._values[t].transition=ii(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new b(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new b(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class _{constructor(t,n,o,u,p){this.property=t,this.value=n,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,p=this.value.possiblyEvaluate(t,n,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(t,n,o);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,n,o),p,function(w){if(w<=0)return 0;if(w>=1)return 1;const E=w*w,M=E*w;return 4*(w<.5?M:3*(w-E)+M-.75)}(v))}}return p}}class b{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new et(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class A{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return ii(this._values[t].value)}setValue(t,n){this._values[t]=new Ws(this._values[t].property,n===null?void 0:ii(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new et(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,n,o);return u}}class U{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class et{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class it{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=$r[this.specification.type];return u?u(t,n,o):t}}class ot{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new U(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new U(this,{kind:"constant",value:void 0},t.parameters);const u=$r[this.specification.type];return u?new U(this,{kind:"constant",value:u(t.value.value,n.value.value,o)},t.parameters):t}evaluate(t,n,o,u,p,m){return t.kind==="constant"?t.value:t.evaluate(n,o,u,p,m)}}class Ct extends ot{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new U(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,v=this._calculate(m,m,m,n);return new U(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new U(this,{kind:"constant",value:p},n)}return new U(this,t.expression,n)}evaluate(t,n,o,u,p,m){if(t.kind==="source"){const v=t.evaluate(n,o,u,p,m);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class $t{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(n,null,{},o,u);return this._calculate(p,p,p,n)}return this._calculate(t.expression.evaluate(new Qe(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Qe(Math.floor(n.zoom),n)),t.expression.evaluate(new Qe(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class se{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class oe{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Ws(o,void 0),p=this.defaultTransitionablePropertyValues[n]=new r(o);this.defaultTransitioningPropertyValues[n]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}qt("DataDrivenProperty",ot),qt("DataConstantProperty",it),qt("CrossFadedDataDrivenProperty",Ct),qt("CrossFadedProperty",$t),qt("ColorRampProperty",se);const xi="-transition";class ki extends Un{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new A(n.layout)),n.paint)){this._transitionablePaint=new l(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new et(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Xn,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(xi)?this._transitionablePaint.getTransition(t.slice(0,-xi.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Fa,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(xi))return this._transitionablePaint.setTransition(t.slice(0,-xi.length),n||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||m||p||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mn(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,u,p={}){return(!p||p.validate!==!1)&&ts(this,t.call(Gs,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof U&&He(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Hs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $i{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mi(i,t=1){let n=0,o=0;return{members:i.map(u=>{const p=Hs[u.type].BYTES_PER_ELEMENT,m=n=Yo(n,Math.max(t,p)),v=u.components||1;return o=Math.max(o,p),n+=p*v,{name:u.name,type:u.type,components:v,offset:m}}),size:Yo(n,Math.max(o,t)),alignment:t}}function Yo(i,t){return Math.ceil(i/t)*t}class rs extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}rs.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",rs);class c extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const m=4*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=p,t}}c.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",c);class e extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,v){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=v,t}}e.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",e);class s extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,v){const w=4*t,E=8*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[E+4]=u,this.uint8[E+5]=p,this.uint8[E+6]=m,this.uint8[E+7]=v,t}}s.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",s);class a extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}a.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",a);class d extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,v,w,E,M){const k=this.length;return this.resize(k+1),this.emplace(k,t,n,o,u,p,m,v,w,E,M)}emplace(t,n,o,u,p,m,v,w,E,M,k){const F=10*t;return this.uint16[F+0]=n,this.uint16[F+1]=o,this.uint16[F+2]=u,this.uint16[F+3]=p,this.uint16[F+4]=m,this.uint16[F+5]=v,this.uint16[F+6]=w,this.uint16[F+7]=E,this.uint16[F+8]=M,this.uint16[F+9]=k,t}}d.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",d);class f extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,v,w,E,M,k,F){const V=this.length;return this.resize(V+1),this.emplace(V,t,n,o,u,p,m,v,w,E,M,k,F)}emplace(t,n,o,u,p,m,v,w,E,M,k,F,V){const G=12*t;return this.int16[G+0]=n,this.int16[G+1]=o,this.int16[G+2]=u,this.int16[G+3]=p,this.uint16[G+4]=m,this.uint16[G+5]=v,this.uint16[G+6]=w,this.uint16[G+7]=E,this.int16[G+8]=M,this.int16[G+9]=k,this.int16[G+10]=F,this.int16[G+11]=V,t}}f.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",f);class y extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=u,t}}y.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",y);class T extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}T.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",T);class I extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,v,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,u,p,m,v,w,E)}emplace(t,n,o,u,p,m,v,w,E,M){const k=10*t,F=5*t;return this.int16[k+0]=n,this.int16[k+1]=o,this.int16[k+2]=u,this.int16[k+3]=p,this.int16[k+4]=m,this.int16[k+5]=v,this.uint32[F+3]=w,this.uint16[k+8]=E,this.uint16[k+9]=M,t}}I.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",I);class P extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,p,m)}emplace(t,n,o,u,p,m,v){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=v,t}}P.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",P);class z extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u,p)}emplace(t,n,o,u,p,m){const v=4*t,w=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=u,this.int16[w+6]=p,this.int16[w+7]=m,t}}z.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",z);class O extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const m=12*t,v=3*t;return this.uint8[m+0]=n,this.uint8[m+1]=o,this.float32[v+1]=u,this.float32[v+2]=p,t}}O.prototype.bytesPerElement=12,qt("StructArrayLayout2ub2f12",O);class Z extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.uint16[p+0]=n,this.uint16[p+1]=o,this.uint16[p+2]=u,t}}Z.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",Z);class H extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y,K,ut){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y,K,ut)}emplace(t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y,K,ut,yt){const ct=24*t,mt=12*t,Et=48*t;return this.int16[ct+0]=n,this.int16[ct+1]=o,this.uint16[ct+2]=u,this.uint16[ct+3]=p,this.uint32[mt+2]=m,this.uint32[mt+3]=v,this.uint32[mt+4]=w,this.uint16[ct+10]=E,this.uint16[ct+11]=M,this.uint16[ct+12]=k,this.float32[mt+7]=F,this.float32[mt+8]=V,this.uint8[Et+36]=G,this.uint8[Et+37]=Y,this.uint8[Et+38]=K,this.uint32[mt+10]=ut,this.int16[ct+22]=yt,t}}H.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",H);class j extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y,K,ut,yt,ct,mt,Et,It,Wt,Kt,Nt,Ot,kt,Zt){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y,K,ut,yt,ct,mt,Et,It,Wt,Kt,Nt,Ot,kt,Zt)}emplace(t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y,K,ut,yt,ct,mt,Et,It,Wt,Kt,Nt,Ot,kt,Zt,Ut){const zt=34*t,te=17*t;return this.int16[zt+0]=n,this.int16[zt+1]=o,this.int16[zt+2]=u,this.int16[zt+3]=p,this.int16[zt+4]=m,this.int16[zt+5]=v,this.int16[zt+6]=w,this.int16[zt+7]=E,this.uint16[zt+8]=M,this.uint16[zt+9]=k,this.uint16[zt+10]=F,this.uint16[zt+11]=V,this.uint16[zt+12]=G,this.uint16[zt+13]=Y,this.uint16[zt+14]=K,this.uint16[zt+15]=ut,this.uint16[zt+16]=yt,this.uint16[zt+17]=ct,this.uint16[zt+18]=mt,this.uint16[zt+19]=Et,this.uint16[zt+20]=It,this.uint16[zt+21]=Wt,this.uint16[zt+22]=Kt,this.uint32[te+12]=Nt,this.float32[te+13]=Ot,this.float32[te+14]=kt,this.float32[te+15]=Zt,this.float32[te+16]=Ut,t}}j.prototype.bytesPerElement=68,qt("StructArrayLayout8i15ui1ul4f68",j);class W extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}W.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",W);class rt extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=3*t;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=u,t}}rt.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",rt);class ht extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const p=4*t;return this.uint32[2*t+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=u,t}}ht.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",ht);class dt extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}dt.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",dt);class X extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}X.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",X);class _t extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,o,u)}emplace(t,n,o,u,p){const m=4*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=p,t}}_t.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",_t);class pt extends $i{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Jt(this.anchorPointX,this.anchorPointY)}}pt.prototype.size=20;class Tt extends I{get(t){return new pt(this,t)}}qt("CollisionBoxArray",Tt);class St extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}St.prototype.size=48;class Mt extends H{get(t){return new St(this,t)}}qt("PlacedSymbolArray",Mt);class bt extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}bt.prototype.size=68;class Vt extends j{get(t){return new bt(this,t)}}qt("SymbolInstanceArray",Vt);class Rt extends W{getoffsetX(t){return this.float32[1*t+0]}}qt("GlyphOffsetArray",Rt);class jt extends rt{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}qt("SymbolLineVertexArray",jt);class pe extends $i{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pe.prototype.size=8;class ye extends ht{get(t){return new pe(this,t)}}qt("FeatureIndexArray",ye);class Qt extends rs{}class Ve extends rs{}class Ge extends rs{}class Le extends e{}class ke extends s{}class qe extends a{}class Di extends d{}class kr extends f{}class dr extends y{}class Dr extends T{}class Ts extends P{}class Kn extends O{}class wn extends Z{}class ss extends dt{}const ga=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ei}=ga;class be{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,u){let p=this.segments[this.segments.length-1];return t>be.MAX_VERTEX_ARRAY_LENGTH&&ni(`Max vertices per segment is ${be.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>be.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new be([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Ne(i,t){return 256*(i=ft(Math.floor(i),0,255))+ft(Math.floor(t),0,255)}be.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",be);const Bi=mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ri={exports:{}},oi={exports:{}};oi.exports=function(i,t){var n,o,u,p,m,v,w,E;for(o=i.length-(n=3&i.length),u=t,m=3432918353,v=461845907,E=0;E<o;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,u=27492+(65535&(p=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,n){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Jn={exports:{}};Jn.exports=function(i,t){for(var n,o=i.length,u=t^o,p=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++p;switch(o){case 3:u^=(255&i.charCodeAt(p+2))<<16;case 2:u^=(255&i.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Xs=oi.exports,Ua=Jn.exports;Ri.exports=Xs,Ri.exports.murmur3=Xs,Ri.exports.murmur2=Ua;class So{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(cl(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=cl(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=n?u=m:o=m+1}const p=[];for(;this.ids[o]===n;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Na(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new So;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function cl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ri.exports(String(i))}function Na(i,t,n,o){for(;n<o;){const u=i[n+o>>1];let p=n-1,m=o+1;for(;;){do p++;while(i[p]<u);do m--;while(i[m]>u);if(p>=m)break;Ss(i,p,m),Ss(t,3*p,3*m),Ss(t,3*p+1,3*m+1),Ss(t,3*p+2,3*m+2)}m-n<o-m?(Na(i,t,n,m),n=m+1):(Na(i,t,m+1,o),o=m)}}function Ss(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}qt("FeaturePositionMap",So);class Ks{constructor(t,n){this.gl=t.gl,this.location=n}}class Js extends Ks{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ya extends Ks{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Hh extends Ks{constructor(t,n){super(t,n),this.current=$.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const td=new Float32Array(16);function ql(i){return[Ne(255*i.r,255*i.g),Ne(255*i.b,255*i.a)]}class Za{constructor(t,n,o){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Hh(t,n):new Js(t,n)}}class va{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,u){const p=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new ya(t,n):new Js(t,n)}}class Ys{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,o,u,p){const m=this.paintVertexArray.length,v=this.expression.evaluate(new Qe(0),n,{},u,[],p);this.paintVertexArray.resize(t),this._setPaintValue(m,t,v)}updatePaintArray(t,n,o,u){const p=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,n,p)}_setPaintValue(t,n,o){if(this.type==="color"){const u=ql(o);for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class os{constructor(t,n,o,u,p,m){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,n,o,u,p){const m=this.expression.evaluate(new Qe(this.zoom),n,{},u,[],p),v=this.expression.evaluate(new Qe(this.zoom+1),n,{},u,[],p),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,m,v)}updatePaintArray(t,n,o,u){const p=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,n,p,m)}_setPaintValue(t,n,o,u){if(this.type==="color"){const p=ql(o),m=ql(u);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,p[0],p[1],m[0],m[1])}else{for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=ft(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new Js(t,n)}}class Io{constructor(t,n,o,u,p,m){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,u,p){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(t,n,o,u){if(!u||!o)return;const{min:p,mid:m,max:v}=o,w=u[p],E=u[m],M=u[v];if(w&&E&&M)for(let k=t;k<n;k++)this.zoomInPaintVertexArray.emplace(k,E.tl[0],E.tl[1],E.br[0],E.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],E.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,E.tl[0],E.tl[1],E.br[0],E.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],E.pixelRatio,M.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Bi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Bi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xh{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!o(p))continue;const m=t.paint.get(p);if(!(m instanceof U&&He(m.property.specification)))continue;const v=ed(p,t.type),w=m.value,E=m.property.specification.type,M=m.property.useIntegerZoom,k=m.property.specification["property-type"],F=k==="cross-faded"||k==="cross-faded-data-driven";if(w.kind==="constant")this.binders[p]=F?new va(w.value,v):new Za(w.value,v,E),u.push(`/u_${p}`);else if(w.kind==="source"||F){const V=Kh(p,E,"source");this.binders[p]=F?new Io(w,E,M,n,V,t.id):new Ys(w,v,E,V),u.push(`/a_${p}`)}else{const V=Kh(p,E,"composite");this.binders[p]=new os(w,v,E,M,n,V),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ys||n instanceof os?n.maxValue:0}populatePaintArrays(t,n,o,u,p){for(const m in this.binders){const v=this.binders[m];(v instanceof Ys||v instanceof os||v instanceof Io)&&v.populatePaintArray(t,n,o,u,p)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof va&&u.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,u,p){let m=!1;for(const v in t){const w=n.getPositions(v);for(const E of w){const M=o.feature(E.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof Ys||F instanceof os||F instanceof Io)&&F.expression.isStateDependent===!0){const V=u.paint.get(k);F.expression=V.value,F.updatePaintArray(E.start,E.end,M,t[v],p),m=!0}}}}return m}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Za||o instanceof va)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ys||o instanceof os)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Io)for(let u=0;u<Bi.members.length;u++)t.push(Bi.members[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Za||o instanceof va||o instanceof os)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Za||p instanceof va||p instanceof os){for(const m of p.uniformNames)if(n[m]){const v=p.getBinding(t,n[m],m);o.push({name:m,property:u,binding:v})}}}return o}setUniforms(t,n,o,u){for(const{name:p,property:m,binding:v}of n)this.binders[m].setUniform(v,u,o.get(m),p)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Io){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Ys||o instanceof os)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ys||o instanceof os||o instanceof Io)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ys||n instanceof os||n instanceof Io)&&n.destroy()}}}class Qo{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Xh(u,n,o);this.needsUpload=!1,this._featureMap=new So,this._bufferOffset=0}populatePaintArrays(t,n,o,u,p,m){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,n,u,p,m);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,n,p,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ed(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Kh(i,t,n){const o={color:{source:a,composite:_t},number:{source:W,composite:a}},u=function(p){return{"line-pattern":{source:Di,composite:Di},"fill-pattern":{source:Di,composite:Di},"fill-extrusion-pattern":{source:Di,composite:Di}}[p]}(i);return u&&u[n]||o[t][n]}qt("ConstantBinder",Za),qt("CrossFadedConstantBinder",va),qt("SourceExpressionBinder",Ys),qt("CrossFadedCompositeBinder",Io),qt("CompositeExpressionBinder",os),qt("ProgramConfiguration",Xh,{omit:["_buffers"]}),qt("ProgramConfigurationSet",Qo);var Pi=8192;const $l=Math.pow(2,14)-1,Jh=-$l-1;function ta(i){const t=Pi/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let p=0;p<u.length;p++){const m=u[p],v=Math.round(m.x*t),w=Math.round(m.y*t);m.x=ft(v,Jh,$l),m.y=ft(w,Jh,$l),(v<m.x||v>m.x+1||w<m.y||w>m.y+1)&&ni("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ea(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?ta(i):[]}}function ul(i,t,n,o,u){i.emplaceBack(2*t+(o+1)/2,2*n+(u+1)/2)}class jl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ve,this.indexArray=new wn,this.segments=new be,this.programConfigurations=new Qo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const u=this.layers[0],p=[];let m=null,v=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),v=!m.isConstant());for(const{feature:w,id:E,index:M,sourceLayerIndex:k}of t){const F=this.layers[0]._featureFilter.needGeometry,V=ea(w,F);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),V,o))continue;const G=v?m.evaluate(V,{},o):void 0,Y={id:E,properties:w.properties,type:w.type,sourceLayerIndex:k,index:M,geometry:F?V.geometry:ta(w),patterns:{},sortKey:G};p.push(Y)}v&&p.sort((w,E)=>w.sortKey-E.sortKey);for(const w of p){const{geometry:E,index:M,sourceLayerIndex:k}=w,F=t[M].feature;this.addFeature(w,E,M,o),n.featureIndex.insert(F,E,M,k,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ei),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u){for(const p of n)for(const m of p){const v=m.x,w=m.y;if(v<0||v>=Pi||w<0||w>=Pi)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),M=E.vertexLength;ul(this.layoutVertexArray,v,w,-1,-1),ul(this.layoutVertexArray,v,w,1,-1),ul(this.layoutVertexArray,v,w,1,1),ul(this.layoutVertexArray,v,w,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function Yh(i,t){for(let n=0;n<i.length;n++)if(xa(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(xa(i,t[n]))return!0;return!!Wl(i,t)}function id(i,t,n){return!!xa(i,t)||!!Hl(t,i,n)}function Qh(i,t){if(i.length===1)return ec(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(xa(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(ec(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Wl(i,t[n]))return!0;return!1}function nd(i,t,n){if(i.length>1){if(Wl(i,t))return!0;for(let o=0;o<t.length;o++)if(Hl(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Hl(i[o],t,n))return!0;return!1}function Wl(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let p=0;p<t.length-1;p++)if(rd(o,u,t[p],t[p+1]))return!0}return!1}function rd(i,t,n,o){return _n(i,n,o)!==_n(t,n,o)&&_n(i,t,n)!==_n(i,t,o)}function Hl(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(tc(i,t[u-1],t[u])<o)return!0;return!1}function tc(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const u=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function ec(i,t){let n,o,u,p=!1;for(let m=0;m<i.length;m++){n=i[m];for(let v=0,w=n.length-1;v<n.length;w=v++)o=n[v],u=n[w],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function xa(i,t){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const p=i[o],m=i[u];p.y>t.y!=m.y>t.y&&t.x<(m.x-p.x)*(t.y-p.y)/(m.y-p.y)+p.x&&(n=!n)}return n}function sd(i,t,n){const o=n[0],u=n[2];if(i.x<o.x&&t.x<o.x||i.x>u.x&&t.x>u.x||i.y<o.y&&t.y<o.y||i.y>u.y&&t.y>u.y)return!1;const p=_n(i,t,n[0]);return p!==_n(i,t,n[1])||p!==_n(i,t,n[2])||p!==_n(i,t,n[3])}function Va(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function dl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pl(i,t,n,o,u){if(!t[0]&&!t[1])return i;const p=Jt.convert(t)._mult(u);n==="viewport"&&p._rotate(-o);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(p));return m}qt("CircleBucket",jl,{omit:["layers"]});const od=new oe({"circle-sort-key":new ot(wt.layout_circle["circle-sort-key"])});var ad={paint:new oe({"circle-radius":new ot(wt.paint_circle["circle-radius"]),"circle-color":new ot(wt.paint_circle["circle-color"]),"circle-blur":new ot(wt.paint_circle["circle-blur"]),"circle-opacity":new ot(wt.paint_circle["circle-opacity"]),"circle-translate":new it(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new it(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new it(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new it(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ot(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ot(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ot(wt.paint_circle["circle-stroke-opacity"])}),layout:od},Tn=1e-6,Sn=typeof Float32Array<"u"?Float32Array:Array;function ic(){var i=new Sn(9);return Sn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Xl(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function nc(i,t,n){var o=t[0],u=t[1],p=t[2],m=t[3],v=t[4],w=t[5],E=t[6],M=t[7],k=t[8],F=t[9],V=t[10],G=t[11],Y=t[12],K=t[13],ut=t[14],yt=t[15],ct=n[0],mt=n[1],Et=n[2],It=n[3];return i[0]=ct*o+mt*v+Et*k+It*Y,i[1]=ct*u+mt*w+Et*F+It*K,i[2]=ct*p+mt*E+Et*V+It*ut,i[3]=ct*m+mt*M+Et*G+It*yt,i[4]=(ct=n[4])*o+(mt=n[5])*v+(Et=n[6])*k+(It=n[7])*Y,i[5]=ct*u+mt*w+Et*F+It*K,i[6]=ct*p+mt*E+Et*V+It*ut,i[7]=ct*m+mt*M+Et*G+It*yt,i[8]=(ct=n[8])*o+(mt=n[9])*v+(Et=n[10])*k+(It=n[11])*Y,i[9]=ct*u+mt*w+Et*F+It*K,i[10]=ct*p+mt*E+Et*V+It*ut,i[11]=ct*m+mt*M+Et*G+It*yt,i[12]=(ct=n[12])*o+(mt=n[13])*v+(Et=n[14])*k+(It=n[15])*Y,i[13]=ct*u+mt*w+Et*F+It*K,i[14]=ct*p+mt*E+Et*V+It*ut,i[15]=ct*m+mt*M+Et*G+It*yt,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Ga,ld=nc;function rc(){var i=new Sn(3);return Sn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function sc(i,t,n){var o=new Sn(3);return o[0]=i,o[1]=t,o[2]=n,o}function fl(i,t,n){var o=t[0],u=t[1],p=t[2],m=t[3];return i[0]=n[0]*o+n[4]*u+n[8]*p+n[12]*m,i[1]=n[1]*o+n[5]*u+n[9]*p+n[13]*m,i[2]=n[2]*o+n[6]*u+n[10]*p+n[14]*m,i[3]=n[3]*o+n[7]*u+n[11]*p+n[15]*m,i}function oc(){var i=new Sn(4);return Sn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ac(i,t){const n=fl([],[i.x,i.y,0,1],t);return new Jt(n[0]/n[3],n[1]/n[3])}rc(),Ga=new Sn(4),Sn!=Float32Array&&(Ga[0]=0,Ga[1]=0,Ga[2]=0,Ga[3]=0),rc(),sc(1,0,0),sc(0,1,0),oc(),oc(),ic(),function(){var i;i=new Sn(2),Sn!=Float32Array&&(i[0]=0,i[1]=0)}();class lc extends jl{}qt("HeatmapBucket",lc,{omit:["layers"]});var hd={paint:new oe({"heatmap-radius":new ot(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ot(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new it(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new se(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new it(wt.paint_heatmap["heatmap-opacity"])})};function Kl(i,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=u,i}function hc(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const u=Kl({},{width:t,height:n},o);Jl(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=u.data}function Jl(i,t,n,o,u,p){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,v=t.data;if(m===v)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const E=((n.y+w)*i.width+n.x)*p,M=((o.y+w)*t.width+o.x)*p;for(let k=0;k<u.width*p;k++)v[M+k]=m[E+k]}return t}class qa{constructor(t,n){Kl(this,t,1,n)}resize(t){hc(this,t,1)}clone(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){Jl(t,n,o,u,p,1)}}class pr{constructor(t,n){Kl(this,t,4,n)}resize(t){hc(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,p){Jl(t,n,o,u,p,4)}}function cc(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new pr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const p=(m,v,w)=>{t[i.evaluationKey]=w;const E=i.expression.evaluate(t);u.data[m+v+0]=Math.floor(255*E.r/E.a),u.data[m+v+1]=Math.floor(255*E.g/E.a),u.data[m+v+2]=Math.floor(255*E.b/E.a),u.data[m+v+3]=Math.floor(255*E.a)};if(i.clips)for(let m=0,v=0;m<o;++m,v+=4*n)for(let w=0,E=0;w<n;w++,E+=4){const M=w/(n-1),{start:k,end:F}=i.clips[m];p(v,E,k*(1-M)+F*M)}else for(let m=0,v=0;m<n;m++,v+=4)p(0,v,m/(n-1));return u}qt("AlphaImage",qa),qt("RGBAImage",pr);var cd={paint:new oe({"hillshade-illumination-direction":new it(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new it(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new it(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new it(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new it(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new it(wt.paint_hillshade["hillshade-accent-color"])})};const ud=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:dd}=ud;var ml={exports:{}};function _l(i,t,n){n=n||2;var o,u,p,m,v,w,E,M=t&&t.length,k=M?t[0]*n:i.length,F=uc(i,0,k,n,!0),V=[];if(!F||F.next===F.prev)return V;if(M&&(F=function(Y,K,ut,yt){var ct,mt,Et,It=[];for(ct=0,mt=K.length;ct<mt;ct++)(Et=uc(Y,K[ct]*yt,ct<mt-1?K[ct+1]*yt:Y.length,yt,!1))===Et.next&&(Et.steiner=!0),It.push(xd(Et));for(It.sort(gd),ct=0;ct<It.length;ct++)ut=yd(It[ct],ut);return ut}(i,t,F,n)),i.length>80*n){o=p=i[0],u=m=i[1];for(var G=n;G<k;G+=n)(v=i[G])<o&&(o=v),(w=i[G+1])<u&&(u=w),v>p&&(p=v),w>m&&(m=w);E=(E=Math.max(p-o,m-u))!==0?32767/E:0}return $a(F,V,n,o,u,E,0),V}function uc(i,t,n,o,u){var p,m;if(u===th(i,t,n,o)>0)for(p=t;p<n;p+=o)m=fc(p,i[p],i[p+1],m);else for(p=n-o;p>=t;p-=o)m=fc(p,i[p],i[p+1],m);return m&&gl(m,m.next)&&(Wa(m),m=m.next),m}function ia(i,t){if(!i)return i;t||(t=i);var n,o=i;do if(n=!1,o.steiner||!gl(o,o.next)&&bi(o.prev,o,o.next)!==0)o=o.next;else{if(Wa(o),(o=t=o.prev)===o.next)break;n=!0}while(n||o!==t);return t}function $a(i,t,n,o,u,p,m){if(i){!m&&p&&function(M,k,F,V){var G=M;do G.z===0&&(G.z=Yl(G.x,G.y,k,F,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==M);G.prevZ.nextZ=null,G.prevZ=null,function(Y){var K,ut,yt,ct,mt,Et,It,Wt,Kt=1;do{for(ut=Y,Y=null,mt=null,Et=0;ut;){for(Et++,yt=ut,It=0,K=0;K<Kt&&(It++,yt=yt.nextZ);K++);for(Wt=Kt;It>0||Wt>0&&yt;)It!==0&&(Wt===0||!yt||ut.z<=yt.z)?(ct=ut,ut=ut.nextZ,It--):(ct=yt,yt=yt.nextZ,Wt--),mt?mt.nextZ=ct:Y=ct,ct.prevZ=mt,mt=ct;ut=yt}mt.nextZ=null,Kt*=2}while(Et>1)}(G)}(i,o,u,p);for(var v,w,E=i;i.prev!==i.next;)if(v=i.prev,w=i.next,p?fd(i,o,u,p):pd(i))t.push(v.i/n|0),t.push(i.i/n|0),t.push(w.i/n|0),Wa(i),i=w.next,E=w.next;else if((i=w)===E){m?m===1?$a(i=md(ia(i),t,n),t,n,o,u,p,2):m===2&&_d(i,t,n,o,u,p):$a(ia(i),t,n,o,u,p,1);break}}}function pd(i){var t=i.prev,n=i,o=i.next;if(bi(t,n,o)>=0)return!1;for(var u=t.x,p=n.x,m=o.x,v=t.y,w=n.y,E=o.y,M=u<p?u<m?u:m:p<m?p:m,k=v<w?v<E?v:E:w<E?w:E,F=u>p?u>m?u:m:p>m?p:m,V=v>w?v>E?v:E:w>E?w:E,G=o.next;G!==t;){if(G.x>=M&&G.x<=F&&G.y>=k&&G.y<=V&&ba(u,v,p,w,m,E,G.x,G.y)&&bi(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function fd(i,t,n,o){var u=i.prev,p=i,m=i.next;if(bi(u,p,m)>=0)return!1;for(var v=u.x,w=p.x,E=m.x,M=u.y,k=p.y,F=m.y,V=v<w?v<E?v:E:w<E?w:E,G=M<k?M<F?M:F:k<F?k:F,Y=v>w?v>E?v:E:w>E?w:E,K=M>k?M>F?M:F:k>F?k:F,ut=Yl(V,G,t,n,o),yt=Yl(Y,K,t,n,o),ct=i.prevZ,mt=i.nextZ;ct&&ct.z>=ut&&mt&&mt.z<=yt;){if(ct.x>=V&&ct.x<=Y&&ct.y>=G&&ct.y<=K&&ct!==u&&ct!==m&&ba(v,M,w,k,E,F,ct.x,ct.y)&&bi(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,mt.x>=V&&mt.x<=Y&&mt.y>=G&&mt.y<=K&&mt!==u&&mt!==m&&ba(v,M,w,k,E,F,mt.x,mt.y)&&bi(mt.prev,mt,mt.next)>=0))return!1;mt=mt.nextZ}for(;ct&&ct.z>=ut;){if(ct.x>=V&&ct.x<=Y&&ct.y>=G&&ct.y<=K&&ct!==u&&ct!==m&&ba(v,M,w,k,E,F,ct.x,ct.y)&&bi(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;mt&&mt.z<=yt;){if(mt.x>=V&&mt.x<=Y&&mt.y>=G&&mt.y<=K&&mt!==u&&mt!==m&&ba(v,M,w,k,E,F,mt.x,mt.y)&&bi(mt.prev,mt,mt.next)>=0)return!1;mt=mt.nextZ}return!0}function md(i,t,n){var o=i;do{var u=o.prev,p=o.next.next;!gl(u,p)&&dc(u,o,o.next,p)&&ja(u,p)&&ja(p,u)&&(t.push(u.i/n|0),t.push(o.i/n|0),t.push(p.i/n|0),Wa(o),Wa(o.next),o=i=p),o=o.next}while(o!==i);return ia(o)}function _d(i,t,n,o,u,p){var m=i;do{for(var v=m.next.next;v!==m.prev;){if(m.i!==v.i&&bd(m,v)){var w=pc(m,v);return m=ia(m,m.next),w=ia(w,w.next),$a(m,t,n,o,u,p,0),void $a(w,t,n,o,u,p,0)}v=v.next}m=m.next}while(m!==i)}function gd(i,t){return i.x-t.x}function yd(i,t){var n=function(u,p){var m,v=p,w=u.x,E=u.y,M=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var k=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(k<=w&&k>M&&(M=k,m=v.x<v.next.x?v:v.next,k===w))return m}v=v.next}while(v!==p);if(!m)return null;var F,V=m,G=m.x,Y=m.y,K=1/0;v=m;do w>=v.x&&v.x>=G&&w!==v.x&&ba(E<Y?w:M,E,G,Y,E<Y?M:w,E,v.x,v.y)&&(F=Math.abs(E-v.y)/(w-v.x),ja(v,u)&&(F<K||F===K&&(v.x>m.x||v.x===m.x&&vd(m,v)))&&(m=v,K=F)),v=v.next;while(v!==V);return m}(i,t);if(!n)return t;var o=pc(n,i);return ia(o,o.next),ia(n,n.next)}function vd(i,t){return bi(i.prev,i,t.prev)<0&&bi(t.next,i,i.next)<0}function Yl(i,t,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xd(i){var t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function ba(i,t,n,o,u,p,m,v){return(u-m)*(t-v)>=(i-m)*(p-v)&&(i-m)*(o-v)>=(n-m)*(t-v)&&(n-m)*(p-v)>=(u-m)*(o-v)}function bd(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&dc(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(i,t)&&(ja(i,t)&&ja(t,i)&&function(n,o){var u=n,p=!1,m=(n.x+o.x)/2,v=(n.y+o.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&m<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p}(i,t)&&(bi(i.prev,i,t.prev)||bi(i,t.prev,t))||gl(i,t)&&bi(i.prev,i,i.next)>0&&bi(t.prev,t,t.next)>0)}function bi(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function gl(i,t){return i.x===t.x&&i.y===t.y}function dc(i,t,n,o){var u=vl(bi(i,t,n)),p=vl(bi(i,t,o)),m=vl(bi(n,o,i)),v=vl(bi(n,o,t));return u!==p&&m!==v||!(u!==0||!yl(i,n,t))||!(p!==0||!yl(i,o,t))||!(m!==0||!yl(n,i,o))||!(v!==0||!yl(n,t,o))}function yl(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function vl(i){return i>0?1:i<0?-1:0}function ja(i,t){return bi(i.prev,i,i.next)<0?bi(i,t,i.next)>=0&&bi(i,i.prev,t)>=0:bi(i,t,i.prev)<0||bi(i,i.next,t)<0}function pc(i,t){var n=new Ql(i.i,i.x,i.y),o=new Ql(t.i,t.x,t.y),u=i.next,p=t.prev;return i.next=t,t.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,p.next=o,o.prev=p,o}function fc(i,t,n,o){var u=new Ql(i,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Wa(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ql(i,t,n){this.i=i,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function th(i,t,n,o){for(var u=0,p=t,m=n-o;p<n;p+=o)u+=(i[m]-i[p])*(i[p+1]+i[m+1]),m=p;return u}function wd(i,t,n,o,u){mc(i,t,n||0,o||i.length-1,u||Td)}function mc(i,t,n,o,u){for(;o>n;){if(o-n>600){var p=o-n+1,m=t-n+1,v=Math.log(p),w=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*w*(p-w)/p)*(m-p/2<0?-1:1);mc(i,t,Math.max(n,Math.floor(t-m*w/p+E)),Math.min(o,Math.floor(t+(p-m)*w/p+E)),u)}var M=i[t],k=n,F=o;for(Ha(i,n,t),u(i[o],M)>0&&Ha(i,n,o);k<F;){for(Ha(i,k,F),k++,F--;u(i[k],M)<0;)k++;for(;u(i[F],M)>0;)F--}u(i[n],M)===0?Ha(i,n,F):Ha(i,++F,o),F<=t&&(n=F+1),t<=F&&(o=F-1)}}function Ha(i,t,n){var o=i[t];i[t]=i[n],i[n]=o}function Td(i,t){return i<t?-1:i>t?1:0}function eh(i,t){const n=i.length;if(n<=1)return[i];const o=[];let u,p;for(let m=0;m<n;m++){const v=Qn(i[m]);v!==0&&(i[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(u&&o.push(u),u=[i[m]]):u.push(i[m]))}if(u&&o.push(u),t>1)for(let m=0;m<o.length;m++)o[m].length<=t||(wd(o[m],t,1,o[m].length-1,Sd),o[m]=o[m].slice(0,t));return o}function Sd(i,t){return t.area-i.area}function ih(i,t,n){const o=n.patternDependencies;let u=!1;for(const p of t){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const v=m.constantOr(null);v&&(u=!0,o[v.to]=!0,o[v.from]=!0)}return u}function nh(i,t,n,o,u){const p=u.patternDependencies;for(const m of t){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:o-1},n,{},u.availableImages),E=v.evaluate({zoom:o},n,{},u.availableImages),M=v.evaluate({zoom:o+1},n,{},u.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,p[w]=!0,p[E]=!0,p[M]=!0,n.patterns[m.id]={min:w,mid:E,max:M}}}return n}ml.exports=_l,ml.exports.default=_l,_l.deviation=function(i,t,n,o){var u=t&&t.length,p=Math.abs(th(i,0,u?t[0]*n:i.length,n));if(u)for(var m=0,v=t.length;m<v;m++)p-=Math.abs(th(i,t[m]*n,m<v-1?t[m+1]*n:i.length,n));var w=0;for(m=0;m<o.length;m+=3){var E=o[m]*n,M=o[m+1]*n,k=o[m+2]*n;w+=Math.abs((i[E]-i[k])*(i[M+1]-i[E+1])-(i[E]-i[M])*(i[k+1]-i[E+1]))}return p===0&&w===0?0:Math.abs((w-p)/p)},_l.flatten=function(i){for(var t=i[0][0].length,n={vertices:[],holes:[],dimensions:t},o=0,u=0;u<i.length;u++){for(var p=0;p<i[u].length;p++)for(var m=0;m<t;m++)n.vertices.push(i[u][p][m]);u>0&&n.holes.push(o+=i[u-1].length)}return n};class rh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ge,this.indexArray=new wn,this.indexArray2=new ss,this.programConfigurations=new Qo(t.layers,t.zoom),this.segments=new be,this.segments2=new be,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ih("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:M}of t){const k=this.layers[0]._featureFilter.needGeometry,F=ea(v,k);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),F,o))continue;const V=p?u.evaluate(F,{},o,n.availableImages):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:k?F.geometry:ta(v),patterns:{},sortKey:V};m.push(G)}p&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const k=nh("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(v,w,E,o,{});n.featureIndex.insert(t[E].feature,w,E,M,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,p){for(const m of eh(n,500)){let v=0;for(const V of m)v+=V.length;const w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=w.vertexLength,M=[],k=[];for(const V of m){if(V.length===0)continue;V!==m[0]&&k.push(M.length/2);const G=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),Y=G.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(Y+V.length-1,Y),M.push(V[0].x),M.push(V[0].y);for(let K=1;K<V.length;K++)this.layoutVertexArray.emplaceBack(V[K].x,V[K].y),this.indexArray2.emplaceBack(Y+K-1,Y+K),M.push(V[K].x),M.push(V[K].y);G.vertexLength+=V.length,G.primitiveLength+=V.length}const F=ml.exports(M,k);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(E+F[V],E+F[V+1],E+F[V+2]);w.vertexLength+=v,w.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}}qt("FillBucket",rh,{omit:["layers","patternFeatures"]});const Id=new oe({"fill-sort-key":new ot(wt.layout_fill["fill-sort-key"])});var Ed={paint:new oe({"fill-antialias":new it(wt.paint_fill["fill-antialias"]),"fill-opacity":new ot(wt.paint_fill["fill-opacity"]),"fill-color":new ot(wt.paint_fill["fill-color"]),"fill-outline-color":new ot(wt.paint_fill["fill-outline-color"]),"fill-translate":new it(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new it(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ct(wt.paint_fill["fill-pattern"])}),layout:Id};const Pd=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ad=mi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Cd}=Pd;var Eo={},Md=Jt,_c=wa;function wa(i,t,n,o,u){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(zd,this,t)}function zd(i,t,n){i==1?t.id=n.readVarint():i==2?function(o,u){for(var p=o.readVarint()+o.pos;o.pos<p;){var m=u._keys[o.readVarint()],v=u._values[o.readVarint()];u.properties[m]=v}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function Ld(i){for(var t,n,o=0,u=0,p=i.length,m=p-1;u<p;m=u++)o+=((n=i[m]).x-(t=i[u]).x)*(t.y+n.y);return o}wa.types=["Unknown","Point","LineString","Polygon"],wa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,o=1,u=0,p=0,m=0,v=[];i.pos<n;){if(u<=0){var w=i.readVarint();o=7&w,u=w>>3}if(u--,o===1||o===2)p+=i.readSVarint(),m+=i.readSVarint(),o===1&&(t&&v.push(t),t=[]),t.push(new Md(p,m));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&v.push(t),v},wa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,o=0,u=0,p=0,m=1/0,v=-1/0,w=1/0,E=-1/0;i.pos<t;){if(o<=0){var M=i.readVarint();n=7&M,o=M>>3}if(o--,n===1||n===2)(u+=i.readSVarint())<m&&(m=u),u>v&&(v=u),(p+=i.readSVarint())<w&&(w=p),p>E&&(E=p);else if(n!==7)throw new Error("unknown command "+n)}return[m,w,v,E]},wa.prototype.toGeoJSON=function(i,t,n){var o,u,p=this.extent*Math.pow(2,n),m=this.extent*i,v=this.extent*t,w=this.loadGeometry(),E=wa.types[this.type];function M(V){for(var G=0;G<V.length;G++){var Y=V[G];V[G]=[360*(Y.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(o=0;o<w.length;o++)k[o]=w[o][0];M(w=k);break;case 2:for(o=0;o<w.length;o++)M(w[o]);break;case 3:for(w=function(V){var G=V.length;if(G<=1)return[V];for(var Y,K,ut=[],yt=0;yt<G;yt++){var ct=Ld(V[yt]);ct!==0&&(K===void 0&&(K=ct<0),K===ct<0?(Y&&ut.push(Y),Y=[V[yt]]):Y.push(V[yt]))}return Y&&ut.push(Y),ut}(w),o=0;o<w.length;o++)for(u=0;u<w[o].length;u++)M(w[o][u])}w.length===1?w=w[0]:E="Multi"+E;var F={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(F.id=this.id),F};var kd=_c,gc=yc;function yc(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Dd,this,t),this.length=this._features.length}function Dd(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(o){for(var u=null,p=o.readVarint()+o.pos;o.pos<p;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(n))}yc.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new kd(this._pbf,t,this.extent,this._keys,this._values)};var Bd=gc;function Rd(i,t,n){if(i===3){var o=new Bd(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}Eo.VectorTile=function(i,t){this.layers=i.readFields(Rd,{},t)},Eo.VectorTileFeature=_c,Eo.VectorTileLayer=gc;const Od=Eo.VectorTileFeature.types,sh=Math.pow(2,13);function Xa(i,t,n,o,u,p,m,v){i.emplaceBack(t,n,2*Math.floor(o*sh)+m,u*sh*2,p*sh*2,Math.round(v))}class oh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.centroidVertexArray=new Qt,this.indexArray=new wn,this.programConfigurations=new Qo(t.layers,t.zoom),this.segments=new be,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=ih("fill-extrusion",this.layers,n);for(const{feature:u,id:p,index:m,sourceLayerIndex:v}of t){const w=this.layers[0]._featureFilter.needGeometry,E=ea(u,w);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),E,o))continue;const M={id:p,sourceLayerIndex:v,index:m,geometry:w?E.geometry:ta(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(nh("fill-extrusion",this.layers,M,this.zoom,n)):this.addFeature(M,M.geometry,m,o,{}),n.featureIndex.insert(u,M.geometry,m,v,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cd),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ad.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,p){const m={x:0,y:0,vertexCount:0};for(const v of eh(n,500)){let w=0;for(const G of v)w+=G.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of v){if(G.length===0||Ud(G))continue;let Y=0;for(let K=0;K<G.length;K++){const ut=G[K];if(K>=1){const yt=G[K-1];if(!Fd(ut,yt)){E.vertexLength+4>be.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ct=ut.sub(yt)._perp()._unit(),mt=yt.dist(ut);Y+mt>32768&&(Y=0),Xa(this.layoutVertexArray,ut.x,ut.y,ct.x,ct.y,0,0,Y),Xa(this.layoutVertexArray,ut.x,ut.y,ct.x,ct.y,0,1,Y),m.x+=2*ut.x,m.y+=2*ut.y,m.vertexCount+=2,Y+=mt,Xa(this.layoutVertexArray,yt.x,yt.y,ct.x,ct.y,0,0,Y),Xa(this.layoutVertexArray,yt.x,yt.y,ct.x,ct.y,0,1,Y),m.x+=2*yt.x,m.y+=2*yt.y,m.vertexCount+=2;const Et=E.vertexLength;this.indexArray.emplaceBack(Et,Et+2,Et+1),this.indexArray.emplaceBack(Et+1,Et+2,Et+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+w>be.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),Od[t.type]!=="Polygon")continue;const M=[],k=[],F=E.vertexLength;for(const G of v)if(G.length!==0){G!==v[0]&&k.push(M.length/2);for(let Y=0;Y<G.length;Y++){const K=G[Y];Xa(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),m.x+=K.x,m.y+=K.y,m.vertexCount+=1,M.push(K.x),M.push(K.y)}}const V=ml.exports(M,k);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(F+V[G],F+V[G+2],F+V[G+1]);E.primitiveLength+=V.length/3,E.vertexLength+=w}for(let v=0;v<m.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(m.x/m.vertexCount),Math.floor(m.y/m.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}}function Fd(i,t){return i.x===t.x&&(i.x<0||i.x>Pi)||i.y===t.y&&(i.y<0||i.y>Pi)}function Ud(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Pi)||i.every(t=>t.y<0)||i.every(t=>t.y>Pi)}qt("FillExtrusionBucket",oh,{omit:["layers","features"]});var Nd={paint:new oe({"fill-extrusion-opacity":new it(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ot(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new it(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new it(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ct(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ot(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ot(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new it(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ka(i,t){return i.x*t.x+i.y*t.y}function vc(i,t){if(i.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const p=t[n],m=i[0],v=u.sub(o),w=p.sub(o),E=m.sub(o),M=Ka(v,v),k=Ka(v,w),F=Ka(w,w),V=Ka(E,v),G=Ka(E,w),Y=M*F-k*k,K=(F*V-k*G)/Y,ut=(M*G-k*V)/Y,yt=o.z*(1-K-ut)+u.z*K+p.z*ut;if(isFinite(yt))return yt}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Zd=mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Vd}=Zd,Gd=mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qd}=Gd,$d=Eo.VectorTileFeature.types,jd=Math.cos(Math.PI/180*37.5),xc=Math.pow(2,14)/.5;class ah{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new qe,this.indexArray=new wn,this.programConfigurations=new Qo(t.layers,t.zoom),this.segments=new be,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ih("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:M}of t){const k=this.layers[0]._featureFilter.needGeometry,F=ea(v,k);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),F,o))continue;const V=p?u.evaluate(F,{},o):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:k?F.geometry:ta(v),patterns:{},sortKey:V};m.push(G)}p&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const k=nh("line",this.layers,v,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(v,w,E,o,{});n.featureIndex.insert(t[E].feature,w,E,M,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,qd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,p){const m=this.layers[0].layout,v=m.get("line-join").evaluate(t,{}),w=m.get("line-cap"),E=m.get("line-miter-limit"),M=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of n)this.addLine(k,t,v,w,E,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}addLine(t,n,o,u,p,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ut=0;ut<t.length-1;ut++)this.totalDistance+=t[ut].dist(t[ut+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=$d[n.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(v?3:2))return;o==="bevel"&&(p=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let F,V,G,Y,K;this.e1=this.e2=-1,v&&(F=t[w-2],K=t[E].sub(F)._unit()._perp());for(let ut=E;ut<w;ut++){if(G=ut===w-1?v?t[E+1]:void 0:t[ut+1],G&&t[ut].equals(G))continue;K&&(Y=K),F&&(V=F),F=t[ut],K=G?G.sub(F)._unit()._perp():Y,Y=Y||K;let yt=Y.add(K);yt.x===0&&yt.y===0||yt._unit();const ct=Y.x*K.x+Y.y*K.y,mt=yt.x*K.x+yt.y*K.y,Et=mt!==0?1/mt:1/0,It=2*Math.sqrt(2-2*mt),Wt=mt<jd&&V&&G,Kt=Y.x*K.y-Y.y*K.x>0;if(Wt&&ut>E){const kt=F.dist(V);if(kt>2*M){const Zt=F.sub(F.sub(V)._mult(M/kt)._round());this.updateDistance(V,Zt),this.addCurrentVertex(Zt,Y,0,0,k),V=Zt}}const Nt=V&&G;let Ot=Nt?o:v?"butt":u;if(Nt&&Ot==="round"&&(Et<m?Ot="miter":Et<=2&&(Ot="fakeround")),Ot==="miter"&&Et>p&&(Ot="bevel"),Ot==="bevel"&&(Et>2&&(Ot="flipbevel"),Et<p&&(Ot="miter")),V&&this.updateDistance(V,F),Ot==="miter")yt._mult(Et),this.addCurrentVertex(F,yt,0,0,k);else if(Ot==="flipbevel"){if(Et>100)yt=K.mult(-1);else{const kt=Et*Y.add(K).mag()/Y.sub(K).mag();yt._perp()._mult(kt*(Kt?-1:1))}this.addCurrentVertex(F,yt,0,0,k),this.addCurrentVertex(F,yt.mult(-1),0,0,k)}else if(Ot==="bevel"||Ot==="fakeround"){const kt=-Math.sqrt(Et*Et-1),Zt=Kt?kt:0,Ut=Kt?0:kt;if(V&&this.addCurrentVertex(F,Y,Zt,Ut,k),Ot==="fakeround"){const zt=Math.round(180*It/Math.PI/20);for(let te=1;te<zt;te++){let Yt=te/zt;if(Yt!==.5){const ei=Yt-.5;Yt+=Yt*ei*(Yt-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*ei*ei+(.848013+ct*(.215638*ct-1.06021)))}const ve=K.sub(Y)._mult(Yt)._add(Y)._unit()._mult(Kt?-1:1);this.addHalfVertex(F,ve.x,ve.y,!1,Kt,0,k)}}G&&this.addCurrentVertex(F,K,-Zt,-Ut,k)}else if(Ot==="butt")this.addCurrentVertex(F,yt,0,0,k);else if(Ot==="square"){const kt=V?1:-1;this.addCurrentVertex(F,yt,kt,kt,k)}else Ot==="round"&&(V&&(this.addCurrentVertex(F,Y,0,0,k),this.addCurrentVertex(F,Y,1,1,k,!0)),G&&(this.addCurrentVertex(F,K,-1,-1,k,!0),this.addCurrentVertex(F,K,0,0,k)));if(Wt&&ut<w-1){const kt=F.dist(G);if(kt>2*M){const Zt=F.add(G.sub(F)._mult(M/kt)._round());this.updateDistance(F,Zt),this.addCurrentVertex(Zt,K,0,0,k),F=Zt}}}}addCurrentVertex(t,n,o,u,p,m=!1){const v=n.y*u-n.x,w=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,m,!1,o,p),this.addHalfVertex(t,v,w,m,!0,-u,p),this.distance>xc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,n,o,u,p,m))}addHalfVertex({x:t,y:n},o,u,p,m,v,w){const E=.5*(this.lineClips?this.scaledDistance*(xc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),w.primitiveLength++),m?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}qt("LineBucket",ah,{omit:["layers","patternFeatures"]});const Wd=new oe({"line-cap":new it(wt.layout_line["line-cap"]),"line-join":new ot(wt.layout_line["line-join"]),"line-miter-limit":new it(wt.layout_line["line-miter-limit"]),"line-round-limit":new it(wt.layout_line["line-round-limit"]),"line-sort-key":new ot(wt.layout_line["line-sort-key"])});var bc={paint:new oe({"line-opacity":new ot(wt.paint_line["line-opacity"]),"line-color":new ot(wt.paint_line["line-color"]),"line-translate":new it(wt.paint_line["line-translate"]),"line-translate-anchor":new it(wt.paint_line["line-translate-anchor"]),"line-width":new ot(wt.paint_line["line-width"]),"line-gap-width":new ot(wt.paint_line["line-gap-width"]),"line-offset":new ot(wt.paint_line["line-offset"]),"line-blur":new ot(wt.paint_line["line-blur"]),"line-dasharray":new $t(wt.paint_line["line-dasharray"]),"line-pattern":new Ct(wt.paint_line["line-pattern"]),"line-gradient":new se(wt.paint_line["line-gradient"])}),layout:Wd};const wc=new class extends ot{possiblyEvaluate(i,t){return t=new Qe(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,n,o){return t=$e({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,n,o)}}(bc.paint.properties["line-width"].specification);function Tc(i,t){return t>0?t+2*i:i}wc.useIntegerZoom=!0;const Hd=mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xd=mi([{name:"a_projected_pos",components:3,type:"Float32"}],4);mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Kd=mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sc=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Jd=mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yd(i,t,n){return i.sections.forEach(o=>{o.text=function(u,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),un.applyArabicShaping&&(u=un.applyArabicShaping(u)),u}(o.text,t,n)}),i}mi([{name:"triangle",components:3,type:"Uint16"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mi([{type:"Float32",name:"offsetX"}]),mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ja={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ji=24,lh=Xe,Ic=function(i,t,n,o,u){var p,m,v=8*u-o-1,w=(1<<v)-1,E=w>>1,M=-7,k=n?u-1:0,F=n?-1:1,V=i[t+k];for(k+=F,p=V&(1<<-M)-1,V>>=-M,M+=v;M>0;p=256*p+i[t+k],k+=F,M-=8);for(m=p&(1<<-M)-1,p>>=-M,M+=o;M>0;m=256*m+i[t+k],k+=F,M-=8);if(p===0)p=1-E;else{if(p===w)return m?NaN:1/0*(V?-1:1);m+=Math.pow(2,o),p-=E}return(V?-1:1)*m*Math.pow(2,p-o)},Ec=function(i,t,n,o,u,p){var m,v,w,E=8*p-u-1,M=(1<<E)-1,k=M>>1,F=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=o?0:p-1,G=o?1:-1,Y=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,m=M):(m=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-m))<1&&(m--,w*=2),(t+=m+k>=1?F/w:F*Math.pow(2,1-k))*w>=2&&(m++,w/=2),m+k>=M?(v=0,m=M):m+k>=1?(v=(t*w-1)*Math.pow(2,u),m+=k):(v=t*Math.pow(2,k-1)*Math.pow(2,u),m=0));u>=8;i[n+V]=255&v,V+=G,v/=256,u-=8);for(m=m<<u|v,E+=u;E>0;i[n+V]=255&m,V+=G,m/=256,E-=8);i[n+V-G]|=128*Y};function Xe(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Xe.Varint=0,Xe.Fixed64=1,Xe.Bytes=2,Xe.Fixed32=5;var Po,hh=4294967296,Pc=1/hh,Ac=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qs(i){return i.type===Xe.Bytes?i.readVarint()+i.pos:i.pos+1}function Ta(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Cc(i,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function Qd(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function tp(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function ep(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function ip(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function np(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function rp(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function sp(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function op(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function ap(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function xl(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Sa(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function Mc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function lp(i,t,n){i===1&&n.readMessage(hp,t)}function hp(i,t,n){if(i===3){const{id:o,bitmap:u,width:p,height:m,left:v,top:w,advance:E}=n.readMessage(cp,{});t.push({id:o,bitmap:new qa({width:p+6,height:m+6},u),metrics:{width:p,height:m,left:v,top:w,advance:E}})}}function cp(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}function zc(i){let t=0,n=0;for(const m of i)t+=m.w*m.h,n=Math.max(n,m.w);i.sort((m,v)=>v.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,p=0;for(const m of i)for(let v=o.length-1;v>=0;v--){const w=o[v];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===w.w&&m.h===w.h){const E=o.pop();v<o.length&&(o[v]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(o.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}Xe.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),u=o>>3,p=this.pos;this.type=7&o,i(u,t,this),this.pos===p&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=xl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Mc(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=xl(this.buf,this.pos)+xl(this.buf,this.pos+4)*hh;return this.pos+=8,i},readSFixed64:function(){var i=xl(this.buf,this.pos)+Mc(this.buf,this.pos+4)*hh;return this.pos+=8,i},readFloat:function(){var i=Ic(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ic(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(u,p,m){var v,w,E=m.buf;if(v=(112&(w=E[m.pos++]))>>4,w<128||(v|=(127&(w=E[m.pos++]))<<3,w<128)||(v|=(127&(w=E[m.pos++]))<<10,w<128)||(v|=(127&(w=E[m.pos++]))<<17,w<128)||(v|=(127&(w=E[m.pos++]))<<24,w<128)||(v|=(1&(w=E[m.pos++]))<<31,w<128))return Ta(u,v,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Ac?function(n,o,u){return Ac.decode(n.subarray(o,u))}(this.buf,t,i):function(n,o,u){for(var p="",m=o;m<u;){var v,w,E,M=n[m],k=null,F=M>239?4:M>223?3:M>191?2:1;if(m+F>u)break;F===1?M<128&&(k=M):F===2?(192&(v=n[m+1]))==128&&(k=(31&M)<<6|63&v)<=127&&(k=null):F===3?(w=n[m+2],(192&(v=n[m+1]))==128&&(192&w)==128&&((k=(15&M)<<12|(63&v)<<6|63&w)<=2047||k>=55296&&k<=57343)&&(k=null)):F===4&&(w=n[m+2],E=n[m+3],(192&(v=n[m+1]))==128&&(192&w)==128&&(192&E)==128&&((k=(15&M)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,F=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),m+=F}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Xe.Bytes)return i.push(this.readVarint(t));var n=Qs(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Xe.Bytes)return i.push(this.readSVarint());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Xe.Bytes)return i.push(this.readBoolean());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Xe.Bytes)return i.push(this.readFloat());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Xe.Bytes)return i.push(this.readDouble());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Xe.Bytes)return i.push(this.readFixed32());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Xe.Bytes)return i.push(this.readSFixed32());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Xe.Bytes)return i.push(this.readFixed64());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Xe.Bytes)return i.push(this.readSFixed64());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Xe.Varint)for(;this.buf[this.pos++]>127;);else if(t===Xe.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Xe.Fixed32)this.pos+=4;else{if(t!==Xe.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Sa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Sa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Sa(this.buf,-1&i,this.pos),Sa(this.buf,Math.floor(i*Pc),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Sa(this.buf,-1&i,this.pos),Sa(this.buf,Math.floor(i*Pc),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var o,u;if(t>=0?(o=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(o,0,n),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(u,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,u,p){for(var m,v,w=0;w<u.length;w++){if((m=u.charCodeAt(w))>55295&&m<57344){if(!v){m>56319||w+1===u.length?(o[p++]=239,o[p++]=191,o[p++]=189):v=m;continue}if(m<56320){o[p++]=239,o[p++]=191,o[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(o[p++]=239,o[p++]=191,o[p++]=189,v=null);m<128?o[p++]=m:(m<2048?o[p++]=m>>6|192:(m<65536?o[p++]=m>>12|224:(o[p++]=m>>18|240,o[p++]=m>>12&63|128),o[p++]=m>>6&63|128),o[p++]=63&m|128)}return p}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&Cc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Ec(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Ec(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var o=this.pos-n;o>=128&&Cc(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,n){this.writeTag(i,Xe.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Qd,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,tp,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,np,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,ep,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,ip,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,rp,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,sp,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,op,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,ap,t)},writeBytesField:function(i,t){this.writeTag(i,Xe.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Xe.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Xe.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Xe.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Xe.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Xe.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Xe.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Xe.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Xe.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Xe.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class ch{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:p,content:m}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=p,this.content=m,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Lc{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(n,u,p);const{w:m,h:v}=zc(p),w=new pr({width:m||1,height:v||1});for(const E in t){const M=t[E],k=o[E].paddedRect;pr.copy(M.data,w,{x:0,y:0},{x:k.x+1,y:k.y+1},M.data)}for(const E in n){const M=n[E],k=u[E].paddedRect,F=k.x+1,V=k.y+1,G=M.data.width,Y=M.data.height;pr.copy(M.data,w,{x:0,y:0},{x:F,y:V},M.data),pr.copy(M.data,w,{x:0,y:Y-1},{x:F,y:V-1},{width:G,height:1}),pr.copy(M.data,w,{x:0,y:0},{x:F,y:V+Y},{width:G,height:1}),pr.copy(M.data,w,{x:G-1,y:0},{x:F-1,y:V},{width:1,height:Y}),pr.copy(M.data,w,{x:0,y:0},{x:F+G,y:V},{width:1,height:Y})}this.image=w,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const p=t[u],m={x:0,y:0,w:p.data.width+2,h:p.data.height+2};o.push(m),n[u]=new ch(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,p]=t.tl;o.update(n.data,void 0,{x:u,y:p})}}qt("ImagePosition",ch),qt("ImageAtlas",Lc),h.WritingMode=void 0,(Po=h.WritingMode||(h.WritingMode={}))[Po.none=0]="none",Po[Po.horizontal=1]="horizontal",Po[Po.vertical=2]="vertical",Po[Po.horizontalOnly=3]="horizontalOnly";const bl=-17;class Ya{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new Ya;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new Ya;return n.imageName=t,n}}class Ia{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Ia;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;n+=u&&Xo(u)&&!Ja[t[o+1]]||p&&Xo(p)&&!Ja[t[o-1]]||!Ja[t[o]]?t[o]:Ja[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Tl[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Tl[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Ia;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ya.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void ni("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ya.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wl(i,t,n,o,u,p,m,v,w,E,M,k,F,V,G,Y){const K=Ia.fromFeature(i,u);let ut;k===h.WritingMode.vertical&&K.verticalizePunctuation();const{processBidirectionalText:yt,processStyledBidirectionalText:ct}=un;if(yt&&K.sections.length===1){ut=[];const It=yt(K.toString(),uh(K,E,p,t,o,V,G));for(const Wt of It){const Kt=new Ia;Kt.text=Wt,Kt.sections=K.sections;for(let Nt=0;Nt<Wt.length;Nt++)Kt.sectionIndex.push(0);ut.push(Kt)}}else if(ct){ut=[];const It=ct(K.text,K.sectionIndex,uh(K,E,p,t,o,V,G));for(const Wt of It){const Kt=new Ia;Kt.text=Wt[0],Kt.sectionIndex=Wt[1],Kt.sections=K.sections,ut.push(Kt)}}else ut=function(It,Wt){const Kt=[],Nt=It.text;let Ot=0;for(const kt of Wt)Kt.push(It.substring(Ot,kt)),Ot=kt;return Ot<Nt.length&&Kt.push(It.substring(Ot,Nt.length)),Kt}(K,uh(K,E,p,t,o,V,G));const mt=[],Et={positionedLines:mt,text:K.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(It,Wt,Kt,Nt,Ot,kt,Zt,Ut,zt,te,Yt,ve){let ei=0,ai=bl,Ai=0,mr=0;const Qi=Ut==="right"?1:Ut==="left"?0:.5;let Si=0;for(const Ii of Ot){Ii.trim();const en=Ii.getMaxScale(),pn=(en-1)*ji,In={positionedGlyphs:[],lineOffset:0};It.positionedLines[Si]=In;const kn=In.positionedGlyphs;let Dn=0;if(!Ii.length()){ai+=kt,++Si;continue}for(let Fi=0;Fi<Ii.length();Fi++){const Te=Ii.getSection(Fi),Yn=Ii.getSectionIndex(Fi),nn=Ii.getCharCode(Fi);let fn=0,Br=null,as=null,ls=null,eo=ji;const Rr=!(zt===h.WritingMode.horizontal||!Yt&&!zn(nn)||Yt&&(Tl[nn]||(Oi=nn,Dt.Arabic(Oi)||Dt["Arabic Supplement"](Oi)||Dt["Arabic Extended-A"](Oi)||Dt["Arabic Presentation Forms-A"](Oi)||Dt["Arabic Presentation Forms-B"](Oi))));if(Te.imageName){const _r=Nt[Te.imageName];if(!_r)continue;ls=Te.imageName,It.iconsInText=It.iconsInText||!0,as=_r.paddedRect;const Bn=_r.displaySize;Te.scale=Te.scale*ji/ve,Br={width:Bn[0],height:Bn[1],left:1,top:-3,advance:Rr?Bn[1]:Bn[0]},fn=pn+(ji-Bn[1]*Te.scale),eo=Br.advance;const io=Rr?Bn[0]*Te.scale-ji*en:Bn[1]*Te.scale-ji*en;io>0&&io>Dn&&(Dn=io)}else{const _r=Kt[Te.fontStack],Bn=_r&&_r[nn];if(Bn&&Bn.rect)as=Bn.rect,Br=Bn.metrics;else{const io=Wt[Te.fontStack],el=io&&io[nn];if(!el)continue;Br=el.metrics}fn=(en-Te.scale)*ji}Rr?(It.verticalizable=!0,kn.push({glyph:nn,imageName:ls,x:ei,y:ai+fn,vertical:Rr,scale:Te.scale,fontStack:Te.fontStack,sectionIndex:Yn,metrics:Br,rect:as}),ei+=eo*Te.scale+te):(kn.push({glyph:nn,imageName:ls,x:ei,y:ai+fn,vertical:Rr,scale:Te.scale,fontStack:Te.fontStack,sectionIndex:Yn,metrics:Br,rect:as}),ei+=Br.advance*Te.scale+te)}kn.length!==0&&(Ai=Math.max(ei-te,Ai),pp(kn,0,kn.length-1,Qi,Dn)),ei=0;const li=kt*en+Dn;In.lineOffset=Math.max(Dn,pn),ai+=li,mr=Math.max(li,mr),++Si}var Oi;const tn=ai-bl,{horizontalAlign:dn,verticalAlign:Ln}=dh(Zt);(function(Ii,en,pn,In,kn,Dn,li,Fi,Te){const Yn=(en-pn)*kn;let nn=0;nn=Dn!==li?-Fi*In-bl:(-In*Te+.5)*li;for(const fn of Ii)for(const Br of fn.positionedGlyphs)Br.x+=Yn,Br.y+=nn})(It.positionedLines,Qi,dn,Ln,Ai,mr,kt,tn,Ot.length),It.top+=-Ln*tn,It.bottom=It.top+tn,It.left+=-dn*Ai,It.right=It.left+Ai}(Et,t,n,o,ut,m,v,w,k,E,F,Y),!function(It){for(const Wt of It)if(Wt.positionedGlyphs.length!==0)return!1;return!0}(mt)&&Et}const Tl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},up={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function kc(i,t,n,o,u,p){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*ji/p+u:0}{const m=n[t.fontStack],v=m&&m[i];return v?v.metrics.advance*t.scale+u:0}}function Dc(i,t,n,o){const u=Math.pow(i-t,2);return o?i<t?u/2:2*u:u+Math.abs(n)*n}function dp(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Bc(i,t,n,o,u,p){let m=null,v=Dc(t,n,u,p);for(const w of o){const E=Dc(t-w.x,n,u,p)+w.badness;E<=v&&(m=w,v=E)}return{index:i,x:t,priorBreak:m,badness:v}}function Rc(i){return i?Rc(i.priorBreak).concat(i.index):[]}function uh(i,t,n,o,u,p,m){if(p!=="point")return[];if(!i)return[];const v=[],w=function(F,V,G,Y,K,ut){let yt=0;for(let ct=0;ct<F.length();ct++){const mt=F.getSection(ct);yt+=kc(F.getCharCode(ct),mt,Y,K,V,ut)}return yt/Math.max(1,Math.ceil(yt/G))}(i,t,n,o,u,m),E=i.text.indexOf("")>=0;let M=0;for(let F=0;F<i.length();F++){const V=i.getSection(F),G=i.getCharCode(F);if(Tl[G]||(M+=kc(G,V,o,u,t,m)),F<i.length()-1){const Y=!((k=G)<11904||!(Dt["Bopomofo Extended"](k)||Dt.Bopomofo(k)||Dt["CJK Compatibility Forms"](k)||Dt["CJK Compatibility Ideographs"](k)||Dt["CJK Compatibility"](k)||Dt["CJK Radicals Supplement"](k)||Dt["CJK Strokes"](k)||Dt["CJK Symbols and Punctuation"](k)||Dt["CJK Unified Ideographs Extension A"](k)||Dt["CJK Unified Ideographs"](k)||Dt["Enclosed CJK Letters and Months"](k)||Dt["Halfwidth and Fullwidth Forms"](k)||Dt.Hiragana(k)||Dt["Ideographic Description Characters"](k)||Dt["Kangxi Radicals"](k)||Dt["Katakana Phonetic Extensions"](k)||Dt.Katakana(k)||Dt["Vertical Forms"](k)||Dt["Yi Radicals"](k)||Dt["Yi Syllables"](k)));(up[G]||Y||V.imageName)&&v.push(Bc(F+1,M,w,v,dp(G,i.getCharCode(F+1),Y&&E),!1))}}var k;return Rc(Bc(i.length(),M,w,v,0,!0))}function dh(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function pp(i,t,n,o,u){if(!o&&!u)return;const p=i[n],m=(i[n].x+p.metrics.advance*p.scale)*o;for(let v=t;v<=n;v++)i[v].x-=m,i[v].y+=u}function fp(i,t,n){const{horizontalAlign:o,verticalAlign:u}=dh(n),p=t[0]-i.displaySize[0]*o,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Oc(i,t,n,o,u,p){const m=i.image;let v;if(m.content){const K=m.content,ut=m.pixelRatio||1;v=[K[0]/ut,K[1]/ut,m.displaySize[0]-K[2]/ut,m.displaySize[1]-K[3]/ut]}const w=t.left*p,E=t.right*p;let M,k,F,V;n==="width"||n==="both"?(V=u[0]+w-o[3],k=u[0]+E+o[1]):(V=u[0]+(w+E-m.displaySize[0])/2,k=V+m.displaySize[0]);const G=t.top*p,Y=t.bottom*p;return n==="height"||n==="both"?(M=u[1]+G-o[0],F=u[1]+Y+o[2]):(M=u[1]+(G+Y-m.displaySize[1])/2,F=M+m.displaySize[1]),{image:m,top:M,right:k,bottom:F,left:V,collisionPadding:v}}const to=128;function Fc(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Qe(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const v=o[p],w=o[m];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:w,minSize:n.evaluate(new Qe(v)),maxSize:n.evaluate(new Qe(w)),interpolationType:u}}}class Ao extends Jt{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Ao(this.x,this.y,this.angle,this.segment)}}function Uc(i,t,n,o,u){if(t.segment===void 0)return!0;let p=t,m=t.segment+1,v=0;for(;v>-n/2;){if(m--,m<0)return!1;v-=i[m].dist(p),p=i[m]}v+=i[m].dist(i[m+1]),m++;const w=[];let E=0;for(;v<n/2;){const M=i[m],k=i[m+1];if(!k)return!1;let F=i[m-1].angleTo(M)-M.angleTo(k);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:F}),E+=F;v-w[0].distance>o;)E-=w.shift().angleDelta;if(E>u)return!1;m++,v+=M.dist(k)}return!0}function Nc(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function Zc(i,t,n){return i?.6*t*n:0}function Vc(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function mp(i,t,n,o,u,p){const m=Zc(n,u,p),v=Vc(n,o)*p;let w=0;const E=Nc(i)/2;for(let M=0;M<i.length-1;M++){const k=i[M],F=i[M+1],V=k.dist(F);if(w+V>E){const G=(E-w)/V,Y=We(k.x,F.x,G),K=We(k.y,F.y,G),ut=new Ao(Y,K,F.angleTo(k),M);return ut._round(),!m||Uc(i,ut,v,m,t)?ut:void 0}w+=V}}function _p(i,t,n,o,u,p,m,v,w){const E=Zc(o,p,m),M=Vc(o,u),k=M*m,F=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return t-k<t/4&&(t=k+t/4),Gc(i,F?t/2*v%t:(M/2+2*p)*m*v%t,t,E,n,k,F,!1,w)}function Gc(i,t,n,o,u,p,m,v,w){const E=p/2,M=Nc(i);let k=0,F=t-n,V=[];for(let G=0;G<i.length-1;G++){const Y=i[G],K=i[G+1],ut=Y.dist(K),yt=K.angleTo(Y);for(;F+n<k+ut;){F+=n;const ct=(F-k)/ut,mt=We(Y.x,K.x,ct),Et=We(Y.y,K.y,ct);if(mt>=0&&mt<w&&Et>=0&&Et<w&&F-E>=0&&F+E<=M){const It=new Ao(mt,Et,yt,G);It._round(),o&&!Uc(i,It,p,o,u)||V.push(It)}}k+=ut}return v||V.length||m||(V=Gc(i,k/2,n,o,u,p,m,!0,w)),V}function qc(i,t,n,o,u){const p=[];for(let m=0;m<i.length;m++){const v=i[m];let w;for(let E=0;E<v.length-1;E++){let M=v[E],k=v[E+1];M.x<t&&k.x<t||(M.x<t?M=new Jt(t,M.y+(t-M.x)/(k.x-M.x)*(k.y-M.y))._round():k.x<t&&(k=new Jt(t,M.y+(t-M.x)/(k.x-M.x)*(k.y-M.y))._round()),M.y<n&&k.y<n||(M.y<n?M=new Jt(M.x+(n-M.y)/(k.y-M.y)*(k.x-M.x),n)._round():k.y<n&&(k=new Jt(M.x+(n-M.y)/(k.y-M.y)*(k.x-M.x),n)._round()),M.x>=o&&k.x>=o||(M.x>=o?M=new Jt(o,M.y+(o-M.x)/(k.x-M.x)*(k.y-M.y))._round():k.x>=o&&(k=new Jt(o,M.y+(o-M.x)/(k.x-M.x)*(k.y-M.y))._round()),M.y>=u&&k.y>=u||(M.y>=u?M=new Jt(M.x+(u-M.y)/(k.y-M.y)*(k.x-M.x),u)._round():k.y>=u&&(k=new Jt(M.x+(u-M.y)/(k.y-M.y)*(k.x-M.x),u)._round()),w&&M.equals(w[w.length-1])||(w=[M],p.push(w)),w.push(k)))))}}return p}function $c(i,t,n,o){const u=[],p=i.image,m=p.pixelRatio,v=p.paddedRect.w-2,w=p.paddedRect.h-2,E=i.right-i.left,M=i.bottom-i.top,k=p.stretchX||[[0,v]],F=p.stretchY||[[0,w]],V=(kt,Zt)=>kt+Zt[1]-Zt[0],G=k.reduce(V,0),Y=F.reduce(V,0),K=v-G,ut=w-Y;let yt=0,ct=G,mt=0,Et=Y,It=0,Wt=K,Kt=0,Nt=ut;if(p.content&&o){const kt=p.content;yt=Sl(k,0,kt[0]),mt=Sl(F,0,kt[1]),ct=Sl(k,kt[0],kt[2]),Et=Sl(F,kt[1],kt[3]),It=kt[0]-yt,Kt=kt[1]-mt,Wt=kt[2]-kt[0]-ct,Nt=kt[3]-kt[1]-Et}const Ot=(kt,Zt,Ut,zt)=>{const te=Il(kt.stretch-yt,ct,E,i.left),Yt=El(kt.fixed-It,Wt,kt.stretch,G),ve=Il(Zt.stretch-mt,Et,M,i.top),ei=El(Zt.fixed-Kt,Nt,Zt.stretch,Y),ai=Il(Ut.stretch-yt,ct,E,i.left),Ai=El(Ut.fixed-It,Wt,Ut.stretch,G),mr=Il(zt.stretch-mt,Et,M,i.top),Qi=El(zt.fixed-Kt,Nt,zt.stretch,Y),Si=new Jt(te,ve),Oi=new Jt(ai,ve),tn=new Jt(ai,mr),dn=new Jt(te,mr),Ln=new Jt(Yt/m,ei/m),Ii=new Jt(Ai/m,Qi/m),en=t*Math.PI/180;if(en){const kn=Math.sin(en),Dn=Math.cos(en),li=[Dn,-kn,kn,Dn];Si._matMult(li),Oi._matMult(li),dn._matMult(li),tn._matMult(li)}const pn=kt.stretch+kt.fixed,In=Zt.stretch+Zt.fixed;return{tl:Si,tr:Oi,bl:dn,br:tn,tex:{x:p.paddedRect.x+1+pn,y:p.paddedRect.y+1+In,w:Ut.stretch+Ut.fixed-pn,h:zt.stretch+zt.fixed-In},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ln,pixelOffsetBR:Ii,minFontScaleX:Wt/m/E,minFontScaleY:Nt/m/M,isSDF:n}};if(o&&(p.stretchX||p.stretchY)){const kt=jc(k,K,G),Zt=jc(F,ut,Y);for(let Ut=0;Ut<kt.length-1;Ut++){const zt=kt[Ut],te=kt[Ut+1];for(let Yt=0;Yt<Zt.length-1;Yt++)u.push(Ot(zt,Zt[Yt],te,Zt[Yt+1]))}}else u.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return u}function Sl(i,t,n){let o=0;for(const u of i)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function jc(i,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,p]of i){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return o.push({fixed:t+1,stretch:n}),o}function Il(i,t,n,o){return i/t*n+o}function El(i,t,n,o){return i-t*n/o}qt("Anchor",Ao);class Pl{constructor(t,n,o,u,p,m,v,w,E,M){if(this.boxStartIndex=t.length,E){let k=m.top,F=m.bottom;const V=m.collisionPadding;V&&(k-=V[1],F+=V[3]);let G=F-k;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let k=m.top*v-w[0],F=m.bottom*v+w[2],V=m.left*v-w[3],G=m.right*v+w[1];const Y=m.collisionPadding;if(Y&&(V-=Y[0]*v,k-=Y[1]*v,G+=Y[2]*v,F+=Y[3]*v),M){const K=new Jt(V,k),ut=new Jt(G,k),yt=new Jt(V,F),ct=new Jt(G,F),mt=M*Math.PI/180;K._rotate(mt),ut._rotate(mt),yt._rotate(mt),ct._rotate(mt),V=Math.min(K.x,ut.x,yt.x,ct.x),G=Math.max(K.x,ut.x,yt.x,ct.x),k=Math.min(K.y,ut.y,yt.y,ct.y),F=Math.max(K.y,ut.y,yt.y,ct.y)}t.emplaceBack(n.x,n.y,V,k,G,F,o,u,p)}this.boxEndIndex=t.length}}class gp{constructor(t=[],n=yp){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const p=t-1>>1,m=n[p];if(o(u,m)>=0)break;n[t]=m,t=p}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,p=n[t];for(;t<u;){let m=1+(t<<1),v=n[m];const w=m+1;if(w<this.length&&o(n[w],v)<0&&(m=w,v=n[w]),o(v,p)>=0)break;n[t]=v,t=m}n[t]=p}}function yp(i,t){return i<t?-1:i>t?1:0}function vp(i,t=1,n=!1){let o=1/0,u=1/0,p=-1/0,m=-1/0;const v=i[0];for(let V=0;V<v.length;V++){const G=v[V];(!V||G.x<o)&&(o=G.x),(!V||G.y<u)&&(u=G.y),(!V||G.x>p)&&(p=G.x),(!V||G.y>m)&&(m=G.y)}const w=Math.min(p-o,m-u);let E=w/2;const M=new gp([],xp);if(w===0)return new Jt(o,u);for(let V=o;V<p;V+=w)for(let G=u;G<m;G+=w)M.push(new Ea(V+E,G+E,E,i));let k=function(V){let G=0,Y=0,K=0;const ut=V[0];for(let yt=0,ct=ut.length,mt=ct-1;yt<ct;mt=yt++){const Et=ut[yt],It=ut[mt],Wt=Et.x*It.y-It.x*Et.y;Y+=(Et.x+It.x)*Wt,K+=(Et.y+It.y)*Wt,G+=3*Wt}return new Ea(Y/G,K/G,0,V)}(i),F=M.length;for(;M.length;){const V=M.pop();(V.d>k.d||!k.d)&&(k=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-k.d<=t||(E=V.h/2,M.push(new Ea(V.p.x-E,V.p.y-E,E,i)),M.push(new Ea(V.p.x+E,V.p.y-E,E,i)),M.push(new Ea(V.p.x-E,V.p.y+E,E,i)),M.push(new Ea(V.p.x+E,V.p.y+E,E,i)),F+=4)}return n&&(console.log(`num probes: ${F}`),console.log(`best distance: ${k.d}`)),k.p}function xp(i,t){return t.max-i.max}function Ea(i,t,n,o){this.p=new Jt(i,t),this.h=n,this.d=function(u,p){let m=!1,v=1/0;for(let w=0;w<p.length;w++){const E=p[w];for(let M=0,k=E.length,F=k-1;M<k;F=M++){const V=E[M],G=E[F];V.y>u.y!=G.y>u.y&&u.x<(G.x-V.x)*(u.y-V.y)/(G.y-V.y)+V.x&&(m=!m),v=Math.min(v,tc(u,V,G))}}return(m?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const ph=Number.POSITIVE_INFINITY;function Wc(i,t){return t[1]!==ph?function(n,o,u){let p=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(n){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,m]}(i,t[0],t[1]):function(n,o){let u=0,p=0;o<0&&(o=0);const m=o/Math.sqrt(2);switch(n){case"top-right":case"top-left":p=m-7;break;case"bottom-right":case"bottom-left":p=7-m;break;case"bottom":p=7-o;break;case"top":p=o-7}switch(n){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,p]}(i,t[0])}function fh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bp(i,t,n,o,u,p,m,v,w,E,M){let k=p.textMaxSize.evaluate(t,{});k===void 0&&(k=m);const F=i.layers[0].layout,V=F.get("icon-offset").evaluate(t,{},M),G=Xc(n.horizontal),Y=m/24,K=i.tilePixelRatio*Y,ut=i.tilePixelRatio*k/24,yt=i.tilePixelRatio*v,ct=i.tilePixelRatio*F.get("symbol-spacing"),mt=F.get("text-padding")*i.tilePixelRatio,Et=function(zt,te,Yt,ve=1){const ei=zt.get("icon-padding").evaluate(te,{},Yt),ai=ei&&ei.values;return[ai[0]*ve,ai[1]*ve,ai[2]*ve,ai[3]*ve]}(F,t,M,i.tilePixelRatio),It=F.get("text-max-angle")/180*Math.PI,Wt=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Kt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Nt=F.get("symbol-placement"),Ot=ct/2,kt=F.get("icon-text-fit");let Zt;o&&kt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Zt=Oc(o,n.vertical,kt,F.get("icon-text-fit-padding"),V,Y)),G&&(o=Oc(o,G,kt,F.get("icon-text-fit-padding"),V,Y)));const Ut=(zt,te)=>{te.x<0||te.x>=Pi||te.y<0||te.y>=Pi||function(Yt,ve,ei,ai,Ai,mr,Qi,Si,Oi,tn,dn,Ln,Ii,en,pn,In,kn,Dn,li,Fi,Te,Yn,nn,fn,Br){const as=Yt.addToLineVertexArray(ve,ei);let ls,eo,Rr,_r,Bn=0,io=0,el=0,uu=0,Sh=-1,Ih=-1;const no={};let du=Ri.exports(""),Eh=0,Ph=0;if(Si._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Eh,Ph]=Si.layout.get("text-offset").evaluate(Te,{},fn).map(Rn=>Rn*ji):(Eh=Si.layout.get("text-radial-offset").evaluate(Te,{},fn)*ji,Ph=ph),Yt.allowVerticalPlacement&&ai.vertical){const Rn=Si.layout.get("text-rotate").evaluate(Te,{},fn)+90;Rr=new Pl(Oi,ve,tn,dn,Ln,ai.vertical,Ii,en,pn,Rn),Qi&&(_r=new Pl(Oi,ve,tn,dn,Ln,Qi,kn,Dn,pn,Rn))}if(Ai){const Rn=Si.layout.get("icon-rotate").evaluate(Te,{}),Is=Si.layout.get("icon-text-fit")!=="none",il=$c(Ai,Rn,nn,Is),nl=Qi?$c(Qi,Rn,nn,Is):void 0;eo=new Pl(Oi,ve,tn,dn,Ln,Ai,kn,Dn,!1,Rn),Bn=4*il.length;const mu=Yt.iconSizeData;let ra=null;mu.kind==="source"?(ra=[to*Si.layout.get("icon-size").evaluate(Te,{})],ra[0]>Co&&ni(`${Yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):mu.kind==="composite"&&(ra=[to*Yn.compositeIconSizes[0].evaluate(Te,{},fn),to*Yn.compositeIconSizes[1].evaluate(Te,{},fn)],(ra[0]>Co||ra[1]>Co)&&ni(`${Yt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Yt.addSymbols(Yt.icon,il,ra,Fi,li,Te,h.WritingMode.none,ve,as.lineStartIndex,as.lineLength,-1,fn),Sh=Yt.icon.placedSymbolArray.length-1,nl&&(io=4*nl.length,Yt.addSymbols(Yt.icon,nl,ra,Fi,li,Te,h.WritingMode.vertical,ve,as.lineStartIndex,as.lineLength,-1,fn),Ih=Yt.icon.placedSymbolArray.length-1)}const pu=Object.keys(ai.horizontal);for(const Rn of pu){const Is=ai.horizontal[Rn];if(!ls){du=Ri.exports(Is.text);const nl=Si.layout.get("text-rotate").evaluate(Te,{},fn);ls=new Pl(Oi,ve,tn,dn,Ln,Is,Ii,en,pn,nl)}const il=Is.positionedLines.length===1;if(el+=Hc(Yt,ve,Is,mr,Si,pn,Te,In,as,ai.vertical?h.WritingMode.horizontal:h.WritingMode.horizontalOnly,il?pu:[Rn],no,Sh,Yn,fn),il)break}ai.vertical&&(uu+=Hc(Yt,ve,ai.vertical,mr,Si,pn,Te,In,as,h.WritingMode.vertical,["vertical"],no,Ih,Yn,fn));const Dp=ls?ls.boxStartIndex:Yt.collisionBoxArray.length,Bp=ls?ls.boxEndIndex:Yt.collisionBoxArray.length,Rp=Rr?Rr.boxStartIndex:Yt.collisionBoxArray.length,Op=Rr?Rr.boxEndIndex:Yt.collisionBoxArray.length,Fp=eo?eo.boxStartIndex:Yt.collisionBoxArray.length,Up=eo?eo.boxEndIndex:Yt.collisionBoxArray.length,Np=_r?_r.boxStartIndex:Yt.collisionBoxArray.length,Zp=_r?_r.boxEndIndex:Yt.collisionBoxArray.length;let hs=-1;const Ll=(Rn,Is)=>Rn&&Rn.circleDiameter?Math.max(Rn.circleDiameter,Is):Is;hs=Ll(ls,hs),hs=Ll(Rr,hs),hs=Ll(eo,hs),hs=Ll(_r,hs);const fu=hs>-1?1:0;fu&&(hs*=Br/ji),Yt.glyphOffsetArray.length>=Pa.MAX_GLYPHS&&ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Te.sortKey!==void 0&&Yt.addToSortKeyRanges(Yt.symbolInstances.length,Te.sortKey),Yt.symbolInstances.emplaceBack(ve.x,ve.y,no.right>=0?no.right:-1,no.center>=0?no.center:-1,no.left>=0?no.left:-1,no.vertical||-1,Sh,Ih,du,Dp,Bp,Rp,Op,Fp,Up,Np,Zp,tn,el,uu,Bn,io,fu,0,Ii,Eh,Ph,hs)}(i,te,zt,n,o,u,Zt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,K,[mt,mt,mt,mt],Wt,w,yt,Et,Kt,V,t,p,E,M,m)};if(Nt==="line")for(const zt of qc(t.geometry,0,0,Pi,Pi)){const te=_p(zt,ct,It,n.vertical||G,o,24,ut,i.overscaling,Pi);for(const Yt of te){const ve=G;ve&&wp(i,ve.text,Ot,Yt)||Ut(zt,Yt)}}else if(Nt==="line-center"){for(const zt of t.geometry)if(zt.length>1){const te=mp(zt,It,n.vertical||G,o,24,ut);te&&Ut(zt,te)}}else if(t.type==="Polygon")for(const zt of eh(t.geometry,0)){const te=vp(zt,16);Ut(zt[0],new Ao(te.x,te.y,0))}else if(t.type==="LineString")for(const zt of t.geometry)Ut(zt,new Ao(zt[0].x,zt[0].y,0));else if(t.type==="Point")for(const zt of t.geometry)for(const te of zt)Ut([te],new Ao(te.x,te.y,0))}const Co=32640;function Hc(i,t,n,o,u,p,m,v,w,E,M,k,F,V,G){const Y=function(yt,ct,mt,Et,It,Wt,Kt,Nt){const Ot=Et.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,kt=[];for(const Zt of ct.positionedLines)for(const Ut of Zt.positionedGlyphs){if(!Ut.rect)continue;const zt=Ut.rect||{};let te=4,Yt=!0,ve=1,ei=0;const ai=(It||Nt)&&Ut.vertical,Ai=Ut.metrics.advance*Ut.scale/2;if(Nt&&ct.verticalizable){const li=(Ut.scale-1)*ji,Fi=(ji-Ut.metrics.width*Ut.scale)/2;ei=Zt.lineOffset/2-(Ut.imageName?-Fi:li)}if(Ut.imageName){const li=Kt[Ut.imageName];Yt=li.sdf,ve=li.pixelRatio,te=1/ve}const mr=It?[Ut.x+Ai,Ut.y]:[0,0];let Qi=It?[0,0]:[Ut.x+Ai+mt[0],Ut.y+mt[1]-ei],Si=[0,0];ai&&(Si=Qi,Qi=[0,0]);const Oi=(Ut.metrics.left-te)*Ut.scale-Ai+Qi[0],tn=(-Ut.metrics.top-te)*Ut.scale+Qi[1],dn=Oi+zt.w*Ut.scale/ve,Ln=tn+zt.h*Ut.scale/ve,Ii=new Jt(Oi,tn),en=new Jt(dn,tn),pn=new Jt(Oi,Ln),In=new Jt(dn,Ln);if(ai){const li=new Jt(-Ai,Ai-bl),Fi=-Math.PI/2,Te=12-Ai,Yn=new Jt(22-Te,-(Ut.imageName?Te:0)),nn=new Jt(...Si);Ii._rotateAround(Fi,li)._add(Yn)._add(nn),en._rotateAround(Fi,li)._add(Yn)._add(nn),pn._rotateAround(Fi,li)._add(Yn)._add(nn),In._rotateAround(Fi,li)._add(Yn)._add(nn)}if(Ot){const li=Math.sin(Ot),Fi=Math.cos(Ot),Te=[Fi,-li,li,Fi];Ii._matMult(Te),en._matMult(Te),pn._matMult(Te),In._matMult(Te)}const kn=new Jt(0,0),Dn=new Jt(0,0);kt.push({tl:Ii,tr:en,bl:pn,br:In,tex:zt,writingMode:ct.writingMode,glyphOffset:mr,sectionIndex:Ut.sectionIndex,isSDF:Yt,pixelOffsetTL:kn,pixelOffsetBR:Dn,minFontScaleX:0,minFontScaleY:0})}return kt}(0,n,v,u,p,m,o,i.allowVerticalPlacement),K=i.textSizeData;let ut=null;K.kind==="source"?(ut=[to*u.layout.get("text-size").evaluate(m,{})],ut[0]>Co&&ni(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(ut=[to*V.compositeTextSizes[0].evaluate(m,{},G),to*V.compositeTextSizes[1].evaluate(m,{},G)],(ut[0]>Co||ut[1]>Co)&&ni(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Y,ut,v,p,m,E,t,w.lineStartIndex,w.lineLength,F,G);for(const yt of M)k[yt]=i.text.placedSymbolArray.length-1;return 4*Y.length}function Xc(i){for(const t in i)return i[t];return null}function wp(i,t,n,o){const u=i.compareText;if(t in u){const p=u[t];for(let m=p.length-1;m>=0;m--)if(o.dist(p[m])<n)return!0}else u[t]=[];return u[t].push(o),!1}const Tp=Eo.VectorTileFeature.types,Sp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Al(i,t,n,o,u,p,m,v,w,E,M,k,F){const V=v?Math.min(Co,Math.round(v[0])):0,G=v?Math.min(Co,Math.round(v[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),p,m,(V<<1)+(w?1:0),G,16*E,16*M,256*k,256*F)}function mh(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function Ip(i){for(const t of i.sections)if(ma(t.text))return!0;return!1}class _h{constructor(t){this.layoutVertexArray=new kr,this.indexArray=new wn,this.programConfigurations=t,this.segments=new be,this.dynamicLayoutVertexArray=new dr,this.opacityVertexArray=new Dr,this.placedSymbolArray=new Mt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Xd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Sp,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",_h);class gh{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new be,this.collisionVertexArray=new Kn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Kd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",gh);class Pa{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xl([]),this.placementViewportMatrix=Xl([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fc(this.zoom,n["text-size"]),this.iconSizeData=Fc(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=vh(o,"text-overlap","text-allow-overlap")!=="never"||vh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>h.WritingMode[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new _h(new Qo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new _h(new Qo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Rt,this.lineVertexArray=new jt,this.symbolInstances=new Vt}calculateGlyphDependencies(t,n,o,u,p){for(let m=0;m<t.length;m++)if(n[t.charCodeAt(m)]=!0,(o||u)&&p){const v=Ja[t.charAt(m)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],p=u.layout,m=p.get("text-font"),v=p.get("text-field"),w=p.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof nt&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),M=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,k=p.get("symbol-sort-key");if(this.features=[],!E&&!M)return;const F=n.iconDependencies,V=n.glyphDependencies,G=n.availableImages,Y=new Qe(this.zoom);for(const{feature:K,id:ut,index:yt,sourceLayerIndex:ct}of t){const mt=u._featureFilter.needGeometry,Et=ea(K,mt);if(!u._featureFilter.filter(Y,Et,o))continue;let It,Wt;if(mt||(Et.geometry=ta(K)),E){const Nt=u.getValueAndResolveTokens("text-field",Et,o,G),Ot=nt.factory(Nt);Ip(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||ws()==="unavailable"||this.hasRTLText&&un.isParsed())&&(It=Yd(Ot,u,Et))}if(M){const Nt=u.getValueAndResolveTokens("icon-image",Et,o,G);Wt=Nt instanceof at?Nt:at.fromString(Nt)}if(!It&&!Wt)continue;const Kt=this.sortFeaturesByKey?k.evaluate(Et,{},o):void 0;if(this.features.push({id:ut,text:It,icon:Wt,index:yt,sourceLayerIndex:ct,geometry:Et.geometry,properties:K.properties,type:Tp[K.type],sortKey:Kt}),Wt&&(F[Wt.name]=!0),It){const Nt=m.evaluate(Et,{},o).join(","),Ot=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.WritingMode.vertical)>=0;for(const kt of It.sections)if(kt.image)F[kt.image.name]=!0;else{const Zt=$s(It.toString()),Ut=kt.fontStack||Nt,zt=V[Ut]=V[Ut]||{};this.calculateGlyphDependencies(kt.text,zt,Ot,this.allowVerticalPlacement,Zt)}}}p.get("symbol-placement")==="line"&&(this.features=function(K){const ut={},yt={},ct=[];let mt=0;function Et(Nt){ct.push(K[Nt]),mt++}function It(Nt,Ot,kt){const Zt=yt[Nt];return delete yt[Nt],yt[Ot]=Zt,ct[Zt].geometry[0].pop(),ct[Zt].geometry[0]=ct[Zt].geometry[0].concat(kt[0]),Zt}function Wt(Nt,Ot,kt){const Zt=ut[Ot];return delete ut[Ot],ut[Nt]=Zt,ct[Zt].geometry[0].shift(),ct[Zt].geometry[0]=kt[0].concat(ct[Zt].geometry[0]),Zt}function Kt(Nt,Ot,kt){const Zt=kt?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Nt}:${Zt.x}:${Zt.y}`}for(let Nt=0;Nt<K.length;Nt++){const Ot=K[Nt],kt=Ot.geometry,Zt=Ot.text?Ot.text.toString():null;if(!Zt){Et(Nt);continue}const Ut=Kt(Zt,kt),zt=Kt(Zt,kt,!0);if(Ut in yt&&zt in ut&&yt[Ut]!==ut[zt]){const te=Wt(Ut,zt,kt),Yt=It(Ut,zt,ct[te].geometry);delete ut[Ut],delete yt[zt],yt[Kt(Zt,ct[Yt].geometry,!0)]=Yt,ct[te].geometry=null}else Ut in yt?It(Ut,zt,kt):zt in ut?Wt(Ut,zt,kt):(Et(Nt),ut[Ut]=mt-1,yt[zt]=mt-1)}return ct.filter(Nt=>Nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ut)=>K.sortKey-ut.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),p=t.dist(n[t.segment]);const m={};for(let v=t.segment+1;v<n.length;v++)m[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:u},v<n.length-1&&(u+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)m[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const w=m[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,p,m,v,w,E,M,k,F){const V=t.indexArray,G=t.layoutVertexArray,Y=t.segments.prepareSegment(4*n.length,G,V,this.canOverlap?m.sortKey:void 0),K=this.glyphOffsetArray.length,ut=Y.vertexLength,yt=this.allowVerticalPlacement&&v===h.WritingMode.vertical?Math.PI/2:0,ct=m.text&&m.text.sections;for(let mt=0;mt<n.length;mt++){const{tl:Et,tr:It,bl:Wt,br:Kt,tex:Nt,pixelOffsetTL:Ot,pixelOffsetBR:kt,minFontScaleX:Zt,minFontScaleY:Ut,glyphOffset:zt,isSDF:te,sectionIndex:Yt}=n[mt],ve=Y.vertexLength,ei=zt[1];Al(G,w.x,w.y,Et.x,ei+Et.y,Nt.x,Nt.y,o,te,Ot.x,Ot.y,Zt,Ut),Al(G,w.x,w.y,It.x,ei+It.y,Nt.x+Nt.w,Nt.y,o,te,kt.x,Ot.y,Zt,Ut),Al(G,w.x,w.y,Wt.x,ei+Wt.y,Nt.x,Nt.y+Nt.h,o,te,Ot.x,kt.y,Zt,Ut),Al(G,w.x,w.y,Kt.x,ei+Kt.y,Nt.x+Nt.w,Nt.y+Nt.h,o,te,kt.x,kt.y,Zt,Ut),mh(t.dynamicLayoutVertexArray,w,yt),V.emplaceBack(ve,ve+1,ve+2),V.emplaceBack(ve+1,ve+2,ve+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zt[0]),mt!==n.length-1&&Yt===n[mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,m,m.index,{},F,ct&&ct[Yt])}t.placedSymbolArray.emplaceBack(w.x,w.y,K,this.glyphOffsetArray.length-K,ut,E,M,w.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],v,0,!1,0,k)}_addCollisionDebugVertex(t,n,o,u,p,m){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,p,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,n,o,u,p,m,v){const w=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),E=w.vertexLength,M=p.layoutVertexArray,k=p.collisionVertexArray,F=v.anchorX,V=v.anchorY;this._addCollisionDebugVertex(M,k,m,F,V,new Jt(t,n)),this._addCollisionDebugVertex(M,k,m,F,V,new Jt(o,n)),this._addCollisionDebugVertex(M,k,m,F,V,new Jt(o,u)),this._addCollisionDebugVertex(M,k,m,F,V,new Jt(t,u)),w.vertexLength+=4;const G=p.indexArray;G.emplaceBack(E,E+1),G.emplaceBack(E+1,E+2),G.emplaceBack(E+2,E+3),G.emplaceBack(E+3,E),w.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let p=t;p<n;p++){const m=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gh(Ts,Sc.members,ss),this.iconCollisionBox=new gh(Ts,Sc.members,ss);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,p,m,v,w,E){const M={};for(let k=n;k<o;k++){const F=t.get(k);M.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.textFeatureIndex=F.featureIndex;break}for(let k=u;k<p;k++){const F=t.get(k);M.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalTextFeatureIndex=F.featureIndex;break}for(let k=m;k<v;k++){const F=t.get(k);M.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.iconFeatureIndex=F.featureIndex;break}for(let k=w;k<E;k++){const F=t.get(k);M.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalIconFeatureIndex=F.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const w=this.symbolInstances.get(v);u.push(0|Math.round(n*w.anchorX+o*w.anchorY)),p.push(w.featureIndex)}return m.sort((v,w)=>u[v]-u[w]||p[w]-p[v]),m}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,p,m)=>{u>=0&&m.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}qt("SymbolBucket",Pa,{omit:["layers","collisionBoxArray","features","compareText"]}),Pa.MAX_GLYPHS=65535,Pa.addDynamicAttributes=mh;const Ep=new oe({"symbol-placement":new it(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new it(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new it(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ot(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new it(wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new it(wt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new it(wt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new it(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new it(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new it(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new ot(wt.layout_symbol["icon-size"]),"icon-text-fit":new it(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new it(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new ot(wt.layout_symbol["icon-image"]),"icon-rotate":new ot(wt.layout_symbol["icon-rotate"]),"icon-padding":new ot(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new it(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new ot(wt.layout_symbol["icon-offset"]),"icon-anchor":new ot(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new it(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new it(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new it(wt.layout_symbol["text-rotation-alignment"]),"text-field":new ot(wt.layout_symbol["text-field"]),"text-font":new ot(wt.layout_symbol["text-font"]),"text-size":new ot(wt.layout_symbol["text-size"]),"text-max-width":new ot(wt.layout_symbol["text-max-width"]),"text-line-height":new it(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new ot(wt.layout_symbol["text-letter-spacing"]),"text-justify":new ot(wt.layout_symbol["text-justify"]),"text-radial-offset":new ot(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new it(wt.layout_symbol["text-variable-anchor"]),"text-anchor":new ot(wt.layout_symbol["text-anchor"]),"text-max-angle":new it(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new it(wt.layout_symbol["text-writing-mode"]),"text-rotate":new ot(wt.layout_symbol["text-rotate"]),"text-padding":new it(wt.layout_symbol["text-padding"]),"text-keep-upright":new it(wt.layout_symbol["text-keep-upright"]),"text-transform":new ot(wt.layout_symbol["text-transform"]),"text-offset":new ot(wt.layout_symbol["text-offset"]),"text-allow-overlap":new it(wt.layout_symbol["text-allow-overlap"]),"text-overlap":new it(wt.layout_symbol["text-overlap"]),"text-ignore-placement":new it(wt.layout_symbol["text-ignore-placement"]),"text-optional":new it(wt.layout_symbol["text-optional"])});var yh={paint:new oe({"icon-opacity":new ot(wt.paint_symbol["icon-opacity"]),"icon-color":new ot(wt.paint_symbol["icon-color"]),"icon-halo-color":new ot(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new ot(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ot(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new it(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new it(wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new ot(wt.paint_symbol["text-opacity"]),"text-color":new ot(wt.paint_symbol["text-color"],{runtimeType:wi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ot(wt.paint_symbol["text-halo-color"]),"text-halo-width":new ot(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new ot(wt.paint_symbol["text-halo-blur"]),"text-translate":new it(wt.paint_symbol["text-translate"]),"text-translate-anchor":new it(wt.paint_symbol["text-translate-anchor"])}),layout:Ep};class Kc{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Tr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",Kc,{omit:["defaultValue"]});class Cl extends ki{constructor(t){super(t,yh)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const p=this.layout.get(t).evaluate(n,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Xr(m.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,M)=>M in v?String(v[M]):"")}(n.properties,p)}createBucket(t){return new Pa(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of yh.paint.overridableProperties){if(!Cl.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Kc(n),u=new vs(o,n.property.specification);let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Fs("source",u):new fo("composite",u,n.value.zoomStops),this.paint._values[t]=new U(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Cl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=yh.paint.properties[n];let p=!1;const m=v=>{for(const w of v)if(u.overrides&&u.overrides.hasOverride(w))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof nt)m(o.value.value.sections);else if(o.value.kind==="source"){const v=E=>{p||(E instanceof Xt&&vt(E.value)===Ti?m(E.value.sections):E instanceof co?m(E.sections):E.eachChild(v))},w=o.value;w._styleExpression&&v(w._styleExpression.expression)}return p}}function vh(i,t,n){let o="never";const u=i.get(t);return u?o=u:i.get(n)&&(o="always"),o}var Pp={paint:new oe({"background-color":new it(wt.paint_background["background-color"]),"background-pattern":new $t(wt.paint_background["background-pattern"]),"background-opacity":new it(wt.paint_background["background-opacity"])})},Ap={paint:new oe({"raster-opacity":new it(wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new it(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new it(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new it(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new it(wt.paint_raster["raster-saturation"]),"raster-contrast":new it(wt.paint_raster["raster-contrast"]),"raster-resampling":new it(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new it(wt.paint_raster["raster-fade-duration"])})};class Cp extends ki{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Mp={circle:class extends ki{constructor(i){super(i,ad)}createBucket(i){return new jl(i)}queryRadius(i){const t=i;return Va("circle-radius",this,t)+Va("circle-stroke-width",this,t)+dl(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,n,o,u,p,m,v){const w=pl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,m),E=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),M=this.paint.get("circle-pitch-alignment")==="map",k=M?w:function(V,G){return V.map(Y=>ac(Y,G))}(w,v),F=M?E*m:E;for(const V of o)for(const G of V){const Y=M?G:ac(G,v);let K=F;const ut=fl([],[G.x,G.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?K*=ut[3]/p.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(K*=p.cameraToCenterDistance/ut[3]),id(k,Y,K))return!0}return!1}},heatmap:class extends ki{constructor(i){super(i,hd),this._updateColorRamp()}createBucket(i){return new lc(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ki{constructor(i){super(i,cd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ki{constructor(i){super(i,Ed)}recalculate(i,t){super.recalculate(i,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new rh(i)}queryRadius(){return dl(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,n,o,u,p,m){return Qh(pl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,m),o)}isTileClipped(){return!0}},"fill-extrusion":class extends ki{constructor(i){super(i,Nd)}createBucket(i){return new oh(i)}queryRadius(){return dl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,n,o,u,p,m,v){const w=pl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,m),E=this.paint.get("fill-extrusion-height").evaluate(t,n),M=this.paint.get("fill-extrusion-base").evaluate(t,n),k=function(V,G,Y,K){const ut=[];for(const yt of V){const ct=[yt.x,yt.y,0,1];fl(ct,ct,G),ut.push(new Jt(ct[0]/ct[3],ct[1]/ct[3]))}return ut}(w,v),F=function(V,G,Y,K){const ut=[],yt=[],ct=K[8]*G,mt=K[9]*G,Et=K[10]*G,It=K[11]*G,Wt=K[8]*Y,Kt=K[9]*Y,Nt=K[10]*Y,Ot=K[11]*Y;for(const kt of V){const Zt=[],Ut=[];for(const zt of kt){const te=zt.x,Yt=zt.y,ve=K[0]*te+K[4]*Yt+K[12],ei=K[1]*te+K[5]*Yt+K[13],ai=K[2]*te+K[6]*Yt+K[14],Ai=K[3]*te+K[7]*Yt+K[15],mr=ai+Et,Qi=Ai+It,Si=ve+Wt,Oi=ei+Kt,tn=ai+Nt,dn=Ai+Ot,Ln=new Jt((ve+ct)/Qi,(ei+mt)/Qi);Ln.z=mr/Qi,Zt.push(Ln);const Ii=new Jt(Si/dn,Oi/dn);Ii.z=tn/dn,Ut.push(Ii)}ut.push(Zt),yt.push(Ut)}return[ut,yt]}(o,M,E,v);return function(V,G,Y){let K=1/0;Qh(Y,G)&&(K=vc(Y,G[0]));for(let ut=0;ut<G.length;ut++){const yt=G[ut],ct=V[ut];for(let mt=0;mt<yt.length-1;mt++){const Et=yt[mt],It=[Et,yt[mt+1],ct[mt+1],ct[mt],Et];Yh(Y,It)&&(K=Math.min(K,vc(Y,It)))}}return K!==1/0&&K}(F[0],F[1],k)}},line:class extends ki{constructor(i){super(i,bc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Cr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=wc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ah(i)}queryRadius(i){const t=i,n=Tc(Va("line-width",this,t),Va("line-gap-width",this,t)),o=Va("line-offset",this,t);return n/2+Math.abs(o)+dl(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,n,o,u,p,m){const v=pl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,m),w=m/2*Tc(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),E=this.paint.get("line-offset").evaluate(t,n);return E&&(o=function(M,k){const F=[];for(let V=0;V<M.length;V++){const G=M[V],Y=[];for(let K=0;K<G.length;K++){const ut=G[K-1],yt=G[K],ct=G[K+1],mt=K===0?new Jt(0,0):yt.sub(ut)._unit()._perp(),Et=K===G.length-1?new Jt(0,0):ct.sub(yt)._unit()._perp(),It=mt._add(Et)._unit(),Wt=It.x*Et.x+It.y*Et.y;Wt!==0&&It._mult(1/Wt),Y.push(It._mult(k)._add(yt))}F.push(Y)}return F}(o,E*m)),function(M,k,F){for(let V=0;V<k.length;V++){const G=k[V];if(M.length>=3){for(let Y=0;Y<G.length;Y++)if(xa(M,G[Y]))return!0}if(nd(M,G,F))return!0}return!1}(v,o,w)}isTileClipped(){return!0}},symbol:Cl,background:class extends ki{constructor(i){super(i,Pp)}},raster:class extends ki{constructor(i){super(i,Ap)}}};class zp{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Jc=63710088e-1;class _i{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _i(ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return Jc*Math.acos(Math.min(p,1))}toBounds(t=0){const n=360*t/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new na(new _i(this.lng-o,this.lat-n),new _i(this.lng+o,this.lat+n))}static convert(t){if(t instanceof _i)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _i(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _i(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class na{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof _i?new _i(t.lng,t.lat):_i.convert(t),this}setSouthWest(t){return this._sw=t instanceof _i?new _i(t.lng,t.lat):_i.convert(t),this}extend(t){const n=this._sw,o=this._ne;let u,p;if(t instanceof _i)u=t,p=t;else{if(!(t instanceof na))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(na.convert(t)):this.extend(_i.convert(t)):this;if(u=t._sw,p=t._ne,!u||!p)return this}return n||o?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),o.lng=Math.max(p.lng,o.lng),o.lat=Math.max(p.lat,o.lat)):(this._sw=new _i(u.lng,u.lat),this._ne=new _i(p.lng,p.lat)),this}getCenter(){return new _i((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _i(this.getWest(),this.getNorth())}getSouthEast(){return new _i(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:o}=_i.convert(t);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&u}static convert(t){return t instanceof na?t:t&&new na(t)}}const Yc=2*Math.PI*Jc;function Qc(i){return Yc*Math.cos(i*Math.PI/180)}function tu(i){return(180+i)/360}function eu(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function iu(i,t){return i/Qc(t)}function xh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Ml{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=_i.convert(t);return new Ml(tu(o.lng),eu(o.lat),iu(n,o.lat))}toLngLat(){return new _i(360*this.x-180,xh(this.y))}toAltitude(){return this.z*Qc(xh(this.y))}meterInMercatorCoordinateUnits(){return 1/Yc*(t=xh(this.y),1/Math.cos(t*Math.PI/180));var t}}function nu(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class bh{constructor(t,n,o){if(t<0||t>25||o<0||o>=Math.pow(2,t)||n<0||n>=Math.pow(2,t))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=Qa(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(m=this.y,v=this.z,w=nu(256*(p=this.x),256*(m=Math.pow(2,v)-m-1),v),E=nu(256*(p+1),256*(m+1),v),w[0]+","+w[1]+","+E[0]+","+E[1]);var p,m,v,w,E;const M=function(k,F,V){let G,Y="";for(let K=k;K>0;K--)G=1<<K-1,Y+=(F&G?1:0)+(V&G?2:0);return Y}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Jt((t.x*n-this.x)*Pi,(t.y*n-this.y)*Pi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ru{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Qa(t,n.z,n.z,n.x,n.y)}}class fr{constructor(t,n,o,u,p){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new bh(o,+u,+p),this.key=Qa(n,t,o,u,p)}clone(){return new fr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new fr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Qa(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Qa(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new fr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new fr(n,this.wrap,n,o,u),new fr(n,this.wrap,n,o+1,u),new fr(n,this.wrap,n,o,u+1),new fr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new fr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new fr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ru(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ml(t.x-this.wrap,t.y))}}function Qa(i,t,n,o,u){(i*=2)<0&&(i=-1*i-1);const p=1<<n;return(p*p*i+p*u+o).toString(36)+n.toString(36)+t.toString(36)}qt("CanonicalTileID",bh),qt("OverscaledTileID",fr,{omit:["posMatrix"]});class su{constructor(t,n,o){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void ni(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=o||"mapbox";for(let p=0;p<u;p++)this.data[this._idx(-1,p)]=this.data[this._idx(0,p)],this.data[this._idx(u,p)]=this.data[this._idx(u-1,p)],this.data[this._idx(p,-1)]=this.data[this._idx(p,0)],this.data[this._idx(p,u)]=this.data[this._idx(p,u-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(u,-1)]=this.data[this._idx(u-1,0)],this.data[this._idx(-1,u)]=this.data[this._idx(0,u-1)],this.data[this._idx(u,u)]=this.data[this._idx(u-1,u-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let p=0;p<u;p++)for(let m=0;m<u;m++){const v=this.get(p,m);v>this.max&&(this.max=v),v<this.min&&(this.min=v)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[u],o[u+1],o[u+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}_unpackMapbox(t,n,o){return(256*t*256+256*n+o)/10-1e4}_unpackTerrarium(t,n,o){return 256*t+n+o/256-32768}getPixels(){return new pr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,m=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:m=v-1;break;case 1:v=m+1}const w=-n*this.dim,E=-o*this.dim;for(let M=m;M<v;M++)for(let k=u;k<p;k++)this.data[this._idx(k,M)]=t.data[this._idx(k+w,M+E)]}}qt("DEMData",su);class ou{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class au{constructor(t,n,o,u,p){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class lu{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new qs(Pi,16,0),this.grid3D=new qs(Pi,16,0),this.featureIndexArray=new ye,this.promoteId=n}insert(t,n,o,u,p,m){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const w=m?this.grid3D:this.grid;for(let E=0;E<n.length;E++){const M=n[E],k=[1/0,1/0,-1/0,-1/0];for(let F=0;F<M.length;F++){const V=M[F];k[0]=Math.min(k[0],V.x),k[1]=Math.min(k[1],V.y),k[2]=Math.max(k[2],V.x),k[3]=Math.max(k[3],V.y)}k[0]<Pi&&k[1]<Pi&&k[2]>=0&&k[3]>=0&&w.insert(v,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Eo.VectorTile(new lh(this.rawTileData)).layers,this.sourceLayerCoder=new ou(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const p=t.params||{},m=Pi/t.tileSize/t.scale,v=_o(p.filter),w=t.queryGeometry,E=t.queryPadding*m,M=cu(w),k=this.grid.query(M.minX-E,M.minY-E,M.maxX+E,M.maxY+E),F=cu(t.cameraQueryGeometry),V=this.grid3D.query(F.minX-E,F.minY-E,F.maxX+E,F.maxY+E,(K,ut,yt,ct)=>function(mt,Et,It,Wt,Kt){for(const Ot of mt)if(Et<=Ot.x&&It<=Ot.y&&Wt>=Ot.x&&Kt>=Ot.y)return!0;const Nt=[new Jt(Et,It),new Jt(Et,Kt),new Jt(Wt,Kt),new Jt(Wt,It)];if(mt.length>2){for(const Ot of Nt)if(xa(mt,Ot))return!0}for(let Ot=0;Ot<mt.length-1;Ot++)if(sd(mt[Ot],mt[Ot+1],Nt))return!0;return!1}(t.cameraQueryGeometry,K-E,ut-E,yt+E,ct+E));for(const K of V)k.push(K);k.sort(Lp);const G={};let Y;for(let K=0;K<k.length;K++){const ut=k[K];if(ut===Y)continue;Y=ut;const yt=this.featureIndexArray.get(ut);let ct=null;this.loadMatchingFeature(G,yt.bucketIndex,yt.sourceLayerIndex,yt.featureIndex,v,p.layers,p.availableImages,n,o,u,(mt,Et,It)=>(ct||(ct=ta(mt)),Et.queryIntersectsFeature(w,mt,It,ct,this.z,t.transform,m,t.pixelPosMatrix)))}return G}loadMatchingFeature(t,n,o,u,p,m,v,w,E,M,k){const F=this.bucketLayerIDs[n];if(m&&!function(K,ut){for(let yt=0;yt<K.length;yt++)if(ut.indexOf(K[yt])>=0)return!0;return!1}(m,F))return;const V=this.sourceLayerCoder.decode(o),G=this.vtLayers[V].feature(u);if(p.needGeometry){const K=ea(G,!0);if(!p.filter(new Qe(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!p.filter(new Qe(this.tileID.overscaledZ),G))return;const Y=this.getId(G,V);for(let K=0;K<F.length;K++){const ut=F[K];if(m&&m.indexOf(ut)<0)continue;const yt=w[ut];if(!yt)continue;let ct={};Y&&M&&(ct=M.getState(yt.sourceLayer||"_geojsonTileLayer",Y));const mt=$e({},E[ut]);mt.paint=hu(mt.paint,yt.paint,G,ct,v),mt.layout=hu(mt.layout,yt.layout,G,ct,v);const Et=!k||k(G,yt,ct);if(!Et)continue;const It=new au(G,this.z,this.x,this.y,Y);It.layer=mt;let Wt=t[ut];Wt===void 0&&(Wt=t[ut]=[]),Wt.push({featureIndex:u,feature:It,intersectionZ:Et})}}lookupSymbolFeatures(t,n,o,u,p,m,v,w){const E={};this.loadVTLayers();const M=_o(p);for(const k of t)this.loadMatchingFeature(E,o,u,k,M,m,v,w,n);return E}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function hu(i,t,n,o,u){return Fr(i,(p,m)=>{const v=t instanceof et?t.get(m):null;return v&&v.evaluate?v.evaluate(n,o,u):v})}function cu(i){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const p of i)t=Math.min(t,p.x),n=Math.min(n,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return{minX:t,minY:n,maxX:o,maxY:u}}function Lp(i,t){return t-i}var wh;qt("FeatureIndex",lu,{omit:["rawTileData","sourceLayerCoder"]}),h.PerformanceMarkers=void 0,(wh=h.PerformanceMarkers||(h.PerformanceMarkers={})).create="create",wh.load="load",wh.fullLoad="fullLoad";let zl=null,tl=[];const Th=1e3/30,kp={mark(i){performance.mark(i)},frame(i){const t=i;zl!=null&&tl.push(t-zl),zl=t},clearMetrics(){zl=null,tl=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in h.PerformanceMarkers)performance.clearMarks(h.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",h.PerformanceMarkers.create,h.PerformanceMarkers.load),performance.measure("fullLoadTime",h.PerformanceMarkers.create,h.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,n=tl.length,o=1/(tl.reduce((p,m)=>p+m,0)/n/1e3),u=tl.filter(p=>p>Th).reduce((p,m)=>p+(m-Th)/Th,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100}}};h.AJAXError=Vi,h.ARRAY_TYPE=Sn,h.Actor=class{constructor(i,t,n){this.target=i,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Or(["receive","process"],this),this.invoker=new zp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=rn()?i:window}send(i,t,n,o,u=!1){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[p]=n);const m=us(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!n,targetMapId:o,mustQueue:u,sourceMapId:this.mapId,data:es(t,m)},m),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const t=i.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[n];const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o()}else rn()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if(t.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(t.error?n(bn(t.error)):n(null,bn(t.data)))}else{let n=!1;const o=us(this.globalScope)?void 0:[],u=t.hasCallback?(v,w)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:v?es(v):null,data:es(w,o)},o)}:v=>{n=!0};let p=null;const m=bn(t.data);if(this.parent[t.type])p=this.parent[t.type](t.sourceMapId,m,u);else if(this.parent.getWorkerSource){const v=t.type.split(".");p=this.parent.getWorkerSource(t.sourceMapId,v[0],m.source)[v[1]](m,u)}else u(new Error(`Could not find function ${t.type}`));!n&&p&&p.cancel&&(this.cancelCallbacks[i]=p.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.AlphaImage=qa,h.CanonicalTileID=bh,h.CollisionBoxArray=Tt,h.CollisionCircleLayoutArray=class extends z{},h.Color=$,h.DEMData=su,h.DataConstantProperty=it,h.DictionaryCoder=ou,h.EXTENT=Pi,h.ErrorEvent=br,h.EvaluationParameters=Qe,h.Event=nr,h.Evented=Un,h.FeatureIndex=lu,h.FillBucket=rh,h.FillExtrusionBucket=oh,h.GeoJSONFeature=au,h.ImageAtlas=Lc,h.ImagePosition=ch,h.LineBucket=ah,h.LineStripIndexArray=class extends X{},h.LngLat=_i,h.LngLatBounds=na,h.MercatorCoordinate=Ml,h.ONE_EM=ji,h.OverscaledTileID=fr,h.PerformanceUtils=kp,h.PosArray=Qt,h.Properties=oe,h.QuadTriangleArray=class extends Z{},h.RGBAImage=pr,h.RasterBoundsArray=class extends c{},h.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},h.ResourceType=on,h.SegmentVector=be,h.SymbolBucket=Pa,h.Transitionable=l,h.TriangleIndexArray=wn,h.Uniform1f=Js,h.Uniform1i=class extends Ks{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},h.Uniform2f=class extends Ks{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},h.Uniform3f=class extends Ks{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},h.Uniform4f=ya,h.UniformColor=Hh,h.UniformMatrix4f=class extends Ks{constructor(i,t){super(i,t),this.current=td}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},h.UnwrappedTileID=ru,h.ValidationError=Bt,h.ZoomHistory=Wo,h.add=function(i,t,n){return i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2],i},h.addDynamicAttributes=mh,h.asyncAll=function(i,t,n){if(!i.length)return n(null,[]);let o=i.length;const u=new Array(i.length);let p=null;i.forEach((m,v)=>{t(m,(w,E)=>{w&&(p=w),u[v]=E,--o==0&&n(p,u)})})},h.bezier=Se,h.bindAll=Or,h.cacheEntryPossiblyAdded=function(i){Ie++,Ie>yi&&(i.getActor().send("enforceCacheSizeLimit",gi),Ie=0)},h.clamp=ft,h.clearTileCache=function(i){const t=caches.delete(gn);i&&t.catch(i).then(()=>i())},h.clipLine=qc,h.clone=function(i){var t=new Sn(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},h.clone$1=ii,h.clone$2=function(i){var t=new Sn(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},h.collisionCircleLayout=Jd,h.config=ae,h.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},h.create=function(){var i=new Sn(16);return Sn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},h.create$1=ic,h.createExpression=Os,h.createFilter=_o,h.createLayout=mi,h.createStyleLayer=function(i){return i.type==="custom"?new Cp(i):new Mp[i.type](i)},h.cross=function(i,t,n){var o=t[0],u=t[1],p=t[2],m=n[0],v=n[1],w=n[2];return i[0]=u*w-p*v,i[1]=p*m-o*w,i[2]=o*v-u*m,i},h.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},h.dot$1=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},h.ease=Gt,h.emitValidationErrors=ts,h.enforceCacheSizeLimit=function(i){ri(),ne&&ne.then(t=>{t.keys().then(n=>{for(let o=0;o<n.length-i;o++)t.delete(n[o])})})},h.equals=function(i,t){var n=i[0],o=i[1],u=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],M=i[8],k=i[9],F=i[10],V=i[11],G=i[12],Y=i[13],K=i[14],ut=i[15],yt=t[0],ct=t[1],mt=t[2],Et=t[3],It=t[4],Wt=t[5],Kt=t[6],Nt=t[7],Ot=t[8],kt=t[9],Zt=t[10],Ut=t[11],zt=t[12],te=t[13],Yt=t[14],ve=t[15];return Math.abs(n-yt)<=Tn*Math.max(1,Math.abs(n),Math.abs(yt))&&Math.abs(o-ct)<=Tn*Math.max(1,Math.abs(o),Math.abs(ct))&&Math.abs(u-mt)<=Tn*Math.max(1,Math.abs(u),Math.abs(mt))&&Math.abs(p-Et)<=Tn*Math.max(1,Math.abs(p),Math.abs(Et))&&Math.abs(m-It)<=Tn*Math.max(1,Math.abs(m),Math.abs(It))&&Math.abs(v-Wt)<=Tn*Math.max(1,Math.abs(v),Math.abs(Wt))&&Math.abs(w-Kt)<=Tn*Math.max(1,Math.abs(w),Math.abs(Kt))&&Math.abs(E-Nt)<=Tn*Math.max(1,Math.abs(E),Math.abs(Nt))&&Math.abs(M-Ot)<=Tn*Math.max(1,Math.abs(M),Math.abs(Ot))&&Math.abs(k-kt)<=Tn*Math.max(1,Math.abs(k),Math.abs(kt))&&Math.abs(F-Zt)<=Tn*Math.max(1,Math.abs(F),Math.abs(Zt))&&Math.abs(V-Ut)<=Tn*Math.max(1,Math.abs(V),Math.abs(Ut))&&Math.abs(G-zt)<=Tn*Math.max(1,Math.abs(G),Math.abs(zt))&&Math.abs(Y-te)<=Tn*Math.max(1,Math.abs(Y),Math.abs(te))&&Math.abs(K-Yt)<=Tn*Math.max(1,Math.abs(K),Math.abs(Yt))&&Math.abs(ut-ve)<=Tn*Math.max(1,Math.abs(ut),Math.abs(ve))},h.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/to:i.kind==="composite"?We(o/to,u/to,n):t},h.evaluateSizeForZoom=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:m}=i,v=u?ft(Xi.interpolationFactor(u,t,p,m),0,1):0;i.kind==="camera"?o=We(i.minSize,i.maxSize,v):n=v}return{uSizeT:n,uSize:o}},h.evaluateVariableOffset=Wc,h.evented=To,h.exported=gr,h.exported$1=De,h.extend=$e,h.filterObject=mn,h.fromRotation=function(i,t){var n=Math.sin(t),o=Math.cos(t);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},h.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},h.getAnchorAlignment=dh,h.getAnchorJustification=fh,h.getArrayBuffer=vr,h.getImage=er,h.getJSON=function(i,t){return Zr($e(i,{type:"json"}),t)},h.getOverlapMode=vh,h.getRTLTextPluginStatus=ws,h.getReferrer=Es,h.getVideo=function(i,t){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let o=0;o<i.length;o++){const u=window.document.createElement("source");xr(i[o])||(n.crossOrigin="Anonymous"),u.src=i[o],n.appendChild(u)}return{cancel:()=>{}}},h.identity=Xl,h.invert=function(i,t){var n=t[0],o=t[1],u=t[2],p=t[3],m=t[4],v=t[5],w=t[6],E=t[7],M=t[8],k=t[9],F=t[10],V=t[11],G=t[12],Y=t[13],K=t[14],ut=t[15],yt=n*v-o*m,ct=n*w-u*m,mt=n*E-p*m,Et=o*w-u*v,It=o*E-p*v,Wt=u*E-p*w,Kt=M*Y-k*G,Nt=M*K-F*G,Ot=M*ut-V*G,kt=k*K-F*Y,Zt=k*ut-V*Y,Ut=F*ut-V*K,zt=yt*Ut-ct*Zt+mt*kt+Et*Ot-It*Nt+Wt*Kt;return zt?(i[0]=(v*Ut-w*Zt+E*kt)*(zt=1/zt),i[1]=(u*Zt-o*Ut-p*kt)*zt,i[2]=(Y*Wt-K*It+ut*Et)*zt,i[3]=(F*It-k*Wt-V*Et)*zt,i[4]=(w*Ot-m*Ut-E*Nt)*zt,i[5]=(n*Ut-u*Ot+p*Nt)*zt,i[6]=(K*mt-G*Wt-ut*ct)*zt,i[7]=(M*Wt-F*mt+V*ct)*zt,i[8]=(m*Zt-v*Ot+E*Kt)*zt,i[9]=(o*Ot-n*Zt-p*Kt)*zt,i[10]=(G*It-Y*mt+ut*yt)*zt,i[11]=(k*mt-M*It-V*yt)*zt,i[12]=(v*Nt-m*kt-w*Kt)*zt,i[13]=(n*kt-o*Nt+u*Kt)*zt,i[14]=(Y*ct-G*Et-K*yt)*zt,i[15]=(M*Et-k*ct+F*yt)*zt,i):null},h.isImageBitmap=Ci,h.isSafari=us,h.isWorker=rn,h.keysDifference=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},h.lazyLoadRTLTextPlugin=function(){un.isLoading()||un.isLoaded()||ws()!=="deferred"||_a()},h.makeRequest=Zr,h.mapObject=Fr,h.mercatorXfromLng=tu,h.mercatorYfromLat=eu,h.mercatorZfromAltitude=iu,h.mul=ld,h.mul$1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},h.multiply=nc,h.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},h.normalize=function(i,t){var n=t[0],o=t[1],u=t[2],p=n*n+o*o+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=t[0]*p,i[1]=t[1]*p,i[2]=t[2]*p,i},h.number=We,h.ortho=function(i,t,n,o,u,p,m){var v=1/(t-n),w=1/(o-u),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(t+n)*v,i[13]=(u+o)*w,i[14]=(m+p)*E,i[15]=1,i},h.parseCacheControl=cs,h.parseGlyphPbf=function(i){return new lh(i).readFields(lp,[])},h.pbf=lh,h.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Pi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0].layout,n=i.bucket.layers[0]._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new Qe(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Qe(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Qe(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:E}=i.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Qe(w),i.canonical),n["text-size"].possiblyEvaluate(new Qe(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:E}=i.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Qe(w),i.canonical),n["icon-size"].possiblyEvaluate(new Qe(E),i.canonical)]}const u=t.get("text-line-height")*ji,p=t.get("text-rotation-alignment")!=="viewport"&&t.get("symbol-placement")!=="point",m=t.get("text-keep-upright"),v=t.get("text-size");for(const w of i.bucket.features){const E=t.get("text-font").evaluate(w,{},i.canonical).join(","),M=v.evaluate(w,{},i.canonical),k=o.layoutTextSize.evaluate(w,{},i.canonical),F=o.layoutIconSize.evaluate(w,{},i.canonical),V={horizontal:{},vertical:void 0},G=w.text;let Y,K=[0,0];if(G){const ct=G.toString(),mt=t.get("text-letter-spacing").evaluate(w,{},i.canonical)*ji,Et=fa(ct)?mt:0,It=t.get("text-anchor").evaluate(w,{},i.canonical),Wt=t.get("text-variable-anchor");if(!Wt){const Zt=t.get("text-radial-offset").evaluate(w,{},i.canonical);K=Zt?Wc(It,[Zt*ji,ph]):t.get("text-offset").evaluate(w,{},i.canonical).map(Ut=>Ut*ji)}let Kt=p?"center":t.get("text-justify").evaluate(w,{},i.canonical);const Nt=t.get("symbol-placement"),Ot=Nt==="point"?t.get("text-max-width").evaluate(w,{},i.canonical)*ji:0,kt=()=>{i.bucket.allowVerticalPlacement&&$s(ct)&&(V.vertical=wl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,It,"left",Et,K,h.WritingMode.vertical,!0,Nt,k,M))};if(!p&&Wt){const Zt=Kt==="auto"?Wt.map(zt=>fh(zt)):[Kt];let Ut=!1;for(let zt=0;zt<Zt.length;zt++){const te=Zt[zt];if(!V.horizontal[te])if(Ut)V.horizontal[te]=V.horizontal[0];else{const Yt=wl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,"center",te,Et,K,h.WritingMode.horizontal,!1,Nt,k,M);Yt&&(V.horizontal[te]=Yt,Ut=Yt.positionedLines.length===1)}}kt()}else{Kt==="auto"&&(Kt=fh(It));const Zt=wl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,It,Kt,Et,K,h.WritingMode.horizontal,!1,Nt,k,M);Zt&&(V.horizontal[Kt]=Zt),kt(),$s(ct)&&p&&m&&(V.vertical=wl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,It,Kt,Et,K,h.WritingMode.vertical,!1,Nt,k,M))}}let ut=!1;if(w.icon&&w.icon.name){const ct=i.imageMap[w.icon.name];ct&&(Y=fp(i.imagePositions[w.icon.name],t.get("icon-offset").evaluate(w,{},i.canonical),t.get("icon-anchor").evaluate(w,{},i.canonical)),ut=!!ct.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ut:i.bucket.sdfIcons!==ut&&ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ct.pixelRatio!==i.bucket.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const yt=Xc(V.horizontal)||V.vertical;i.bucket.iconsInText=!!yt&&yt.iconsInText,(yt||Y)&&bp(i.bucket,w,V,Y,i.imageMap,o,k,F,K,ut,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},h.perspective=function(i,t,n,o,u){var p,m=1/Math.tan(t/2);return i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(p=1/(o-u)),i[14]=2*u*o*p):(i[10]=-1,i[14]=-2*o),i},h.pick=function(i,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in i&&(n[u]=i[u])}return n},h.plugin=un,h.pointGeometry=Jt,h.polygonIntersectsPolygon=Yh,h.potpack=zc,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.register=qt,h.registerForPluginStateChange=function(i){return i({pluginStatus:Yi,pluginURL:ur}),To.on("pluginStateChange",i),i},h.renderColorRamp=cc,h.rotateX=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[4],m=t[5],v=t[6],w=t[7],E=t[8],M=t[9],k=t[10],F=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*u+E*o,i[5]=m*u+M*o,i[6]=v*u+k*o,i[7]=w*u+F*o,i[8]=E*u-p*o,i[9]=M*u-m*o,i[10]=k*u-v*o,i[11]=F*u-w*o,i},h.rotateZ=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),p=t[0],m=t[1],v=t[2],w=t[3],E=t[4],M=t[5],k=t[6],F=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*u+E*o,i[1]=m*u+M*o,i[2]=v*u+k*o,i[3]=w*u+F*o,i[4]=E*u-p*o,i[5]=M*u-m*o,i[6]=k*u-v*o,i[7]=F*u-w*o,i},h.scale=function(i,t,n){var o=n[0],u=n[1],p=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},h.scale$1=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i},h.setCacheLimits=function(i,t){gi=i,yi=t},h.setRTLTextPlugin=function(i,t,n=!1){if(Yi===bs||Yi===is||Yi===bo)throw new Error("setRTLTextPlugin cannot be called multiple times.");ur=gr.resolveURL(i),Yi=bs,wo=t,ns(),n||_a()},h.spec=wt,h.sphericalToCartesian=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},h.sqrLen=function(i){var t=i[0],n=i[1];return t*t+n*n},h.sub=function(i,t,n){return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i},h.toEvaluationFeature=ea,h.transformMat3=function(i,t,n){var o=t[0],u=t[1],p=t[2];return i[0]=o*n[0]+u*n[3]+p*n[6],i[1]=o*n[1]+u*n[4]+p*n[7],i[2]=o*n[2]+u*n[5]+p*n[8],i},h.transformMat4=fl,h.transformMat4$1=function(i,t,n){var o=t[0],u=t[1];return i[0]=n[0]*o+n[4]*u+n[12],i[1]=n[1]*o+n[5]*u+n[13],i},h.translate=function(i,t,n){var o,u,p,m,v,w,E,M,k,F,V,G,Y=n[0],K=n[1],ut=n[2];return t===i?(i[12]=t[0]*Y+t[4]*K+t[8]*ut+t[12],i[13]=t[1]*Y+t[5]*K+t[9]*ut+t[13],i[14]=t[2]*Y+t[6]*K+t[10]*ut+t[14],i[15]=t[3]*Y+t[7]*K+t[11]*ut+t[15]):(u=t[1],p=t[2],m=t[3],v=t[4],w=t[5],E=t[6],M=t[7],k=t[8],F=t[9],V=t[10],G=t[11],i[0]=o=t[0],i[1]=u,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=E,i[7]=M,i[8]=k,i[9]=F,i[10]=V,i[11]=G,i[12]=o*Y+v*K+k*ut+t[12],i[13]=u*Y+w*K+F*ut+t[13],i[14]=p*Y+E*K+V*ut+t[14],i[15]=m*Y+M*K+G*ut+t[15]),i},h.triggerPluginCompletionEvent=Jo,h.unicodeBlockLookup=Dt,h.uniqueId=function(){return ce++},h.validateCustomStyleLayer=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},h.validateLight=xo,h.validateStyle=Gs,h.vectorTile=Eo,h.warnOnce=ni,h.wrap=ci}),J(["./shared"],function(h){function Pt(N){const C=typeof N;if(C==="number"||C==="boolean"||C==="string"||N==null)return JSON.stringify(N);if(Array.isArray(N)){let $="[";for(const Q of N)$+=`${Pt(Q)},`;return`${$}]`}const B=Object.keys(N).sort();let q="{";for(let $=0;$<B.length;$++)q+=`${JSON.stringify(B[$])}:${Pt(N[B[$]])},`;return`${q}}`}function ee(N){let C="";for(const B of h.refProperties)C+=`/${Pt(N[B])}`;return C}class Se{constructor(C){this.keyCache={},C&&this.replace(C)}replace(C){this._layerConfigs={},this._layers={},this.update(C,[])}update(C,B){for(const $ of C){this._layerConfigs[$.id]=$;const Q=this._layers[$.id]=h.createStyleLayer($);Q._featureFilter=h.createFilter(Q.filter),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(const $ of B)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};const q=function($,Q){const st={};for(let tt=0;tt<$.length;tt++){const at=Q&&Q[$[tt].id]||ee($[tt]);Q&&(Q[$[tt].id]=at);let xt=st[at];xt||(xt=st[at]=[]),xt.push($[tt])}const nt=[];for(const tt in st)nt.push(st[tt]);return nt}(Object.values(this._layerConfigs),this.keyCache);for(const $ of q){const Q=$.map(At=>this._layers[At.id]),st=Q[0];if(st.visibility==="none")continue;const nt=st.source||"";let tt=this.familiesBySource[nt];tt||(tt=this.familiesBySource[nt]={});const at=st.sourceLayer||"_geojsonTileLayer";let xt=tt[at];xt||(xt=tt[at]=[]),xt.push(Q)}}}class Gt{constructor(C){const B={},q=[];for(const nt in C){const tt=C[nt],at=B[nt]={};for(const xt in tt){const At=tt[+xt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const vt={x:0,y:0,w:At.bitmap.width+2,h:At.bitmap.height+2};q.push(vt),at[xt]={rect:vt,metrics:At.metrics}}}const{w:$,h:Q}=h.potpack(q),st=new h.AlphaImage({width:$||1,height:Q||1});for(const nt in C){const tt=C[nt];for(const at in tt){const xt=tt[+at];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const At=B[nt][at].rect;h.AlphaImage.copy(xt.bitmap,st,{x:0,y:0},{x:At.x+1,y:At.y+1},xt.bitmap)}}this.image=st,this.positions=B}}h.register("GlyphAtlas",Gt);class ft{constructor(C){this.tileID=new h.OverscaledTileID(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId}parse(C,B,q,$,Q){this.status="parsing",this.data=C,this.collisionBoxArray=new h.CollisionBoxArray;const st=new h.DictionaryCoder(Object.keys(C.layers).sort()),nt=new h.FeatureIndex(this.tileID,this.promoteId);nt.bucketLayerIDs=[];const tt={},at={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},xt=B.familiesBySource[this.source];for(const he in xt){const me=C.layers[he];if(!me)continue;me.version===1&&h.warnOnce(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const we=st.encode(he),Be=[];for(let vi=0;vi<me.length;vi++){const Ke=me.feature(vi),fi=nt.getId(Ke,he);Be.push({feature:Ke,id:fi,index:vi,sourceLayerIndex:we})}for(const vi of xt[he]){const Ke=vi[0];Ke.source!==this.source&&h.warnOnce(`layer.source = ${Ke.source} does not equal this.source = ${this.source}`),Ke.minzoom&&this.zoom<Math.floor(Ke.minzoom)||Ke.maxzoom&&this.zoom>=Ke.maxzoom||Ke.visibility!=="none"&&(ci(vi,this.zoom,q),(tt[Ke.id]=Ke.createBucket({index:nt.bucketLayerIDs.length,layers:vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:we,sourceID:this.source})).populate(Be,at,this.tileID.canonical),nt.bucketLayerIDs.push(vi.map(fi=>fi.id)))}}let At,vt,Ht,Xt;const Ft=h.mapObject(at.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(Ft).length?$.send("getGlyphs",{uid:this.uid,stacks:Ft},(he,me)=>{At||(At=he,vt=me,Me.call(this))}):vt={};const ie=Object.keys(at.iconDependencies);ie.length?$.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(he,me)=>{At||(At=he,Ht=me,Me.call(this))}):Ht={};const re=Object.keys(at.patternDependencies);function Me(){if(At)return Q(At);if(vt&&Ht&&Xt){const he=new Gt(vt),me=new h.ImageAtlas(Ht,Xt);for(const we in tt){const Be=tt[we];Be instanceof h.SymbolBucket?(ci(Be.layers,this.zoom,q),h.performSymbolLayout({bucket:Be,glyphMap:vt,glyphPositions:he.positions,imageMap:Ht,imagePositions:me.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Be.hasPattern&&(Be instanceof h.LineBucket||Be instanceof h.FillBucket||Be instanceof h.FillExtrusionBucket)&&(ci(Be.layers,this.zoom,q),Be.addFeatures(at,this.tileID.canonical,me.patternPositions))}this.status="done",Q(null,{buckets:Object.values(tt).filter(we=>!we.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,imageAtlas:me,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?Ht:null,glyphPositions:this.returnDependencies?he.positions:null})}}re.length?$.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"patterns"},(he,me)=>{At||(At=he,Xt=me,Me.call(this))}):Xt={},Me.call(this)}}function ci(N,C,B){const q=new h.EvaluationParameters(C);for(const $ of N)$.recalculate(q,B)}function $e(N,C){const B=h.getArrayBuffer(N.request,(q,$,Q,st)=>{q?C(q):$&&C(null,{vectorTile:new h.vectorTile.VectorTile(new h.pbf($)),rawData:$,cacheControl:Q,expires:st})});return()=>{B.cancel(),C()}}class ce{constructor(C,B,q,$){this.actor=C,this.layerIndex=B,this.availableImages=q,this.loadVectorData=$||$e,this.loading={},this.loaded={}}loadTile(C,B){const q=C.uid;this.loading||(this.loading={});const $=!!(C&&C.request&&C.request.collectResourceTiming)&&new h.RequestPerformance(C.request),Q=this.loading[q]=new ft(C);Q.abort=this.loadVectorData(C,(st,nt)=>{if(delete this.loading[q],st||!nt)return Q.status="done",this.loaded[q]=Q,B(st);const tt=nt.rawData,at={};nt.expires&&(at.expires=nt.expires),nt.cacheControl&&(at.cacheControl=nt.cacheControl);const xt={};if($){const At=$.finish();At&&(xt.resourceTiming=JSON.parse(JSON.stringify(At)))}Q.vectorTile=nt.vectorTile,Q.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.actor,(At,vt)=>{if(At||!vt)return B(At);B(null,h.extend({rawTileData:tt.slice(0)},vt,at,xt))}),this.loaded=this.loaded||{},this.loaded[q]=Q})}reloadTile(C,B){const q=this.loaded,$=C.uid,Q=this;if(q&&q[$]){const st=q[$];st.showCollisionBoxes=C.showCollisionBoxes;const nt=(tt,at)=>{const xt=st.reloadCallback;xt&&(delete st.reloadCallback,st.parse(st.vectorTile,Q.layerIndex,this.availableImages,Q.actor,xt)),B(tt,at)};st.status==="parsing"?st.reloadCallback=nt:st.status==="done"&&(st.vectorTile?st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor,nt):nt())}}abortTile(C,B){const q=this.loading,$=C.uid;q&&q[$]&&q[$].abort&&(q[$].abort(),delete q[$]),B()}removeTile(C,B){const q=this.loaded,$=C.uid;q&&q[$]&&delete q[$],B()}}class Or{constructor(){this.loaded={}}loadTile(C,B){const{uid:q,encoding:$,rawImageData:Q}=C,st=h.isImageBitmap(Q)?this.getImageData(Q):Q,nt=new h.DEMData(q,st,$);this.loaded=this.loaded||{},this.loaded[q]=nt,B(null,nt)}getImageData(C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(C.width,C.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=C.width,this.offscreenCanvas.height=C.height,this.offscreenCanvasContext.drawImage(C,0,0,C.width,C.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,C.width+2,C.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new h.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(C){const B=this.loaded,q=C.uid;B&&B[q]&&delete B[q]}}var Fr=function N(C,B){var q,$=C&&C.type;if($==="FeatureCollection")for(q=0;q<C.features.length;q++)N(C.features[q],B);else if($==="GeometryCollection")for(q=0;q<C.geometries.length;q++)N(C.geometries[q],B);else if($==="Feature")N(C.geometry,B);else if($==="Polygon")mn(C.coordinates,B);else if($==="MultiPolygon")for(q=0;q<C.coordinates.length;q++)mn(C.coordinates[q],B);return C};function mn(N,C){if(N.length!==0){ii(N[0],C);for(var B=1;B<N.length;B++)ii(N[B],!C)}}function ii(N,C){for(var B=0,q=0,$=0,Q=N.length,st=Q-1;$<Q;st=$++){var nt=(N[$][0]-N[st][0])*(N[st][1]+N[$][1]),tt=B+nt;q+=Math.abs(B)>=Math.abs(nt)?B-tt+nt:nt-tt+B,B=tt}B+q>=0!=!!C&&N.reverse()}const Ur=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ni{constructor(C){this._feature=C,this.extent=h.EXTENT,this.type=C.type,this.properties=C.tags,"id"in C&&!isNaN(C.id)&&(this.id=parseInt(C.id,10))}loadGeometry(){if(this._feature.type===1){const C=[];for(const B of this._feature.geometry)C.push([new h.pointGeometry(B[0],B[1])]);return C}{const C=[];for(const B of this._feature.geometry){const q=[];for(const $ of B)q.push(new h.pointGeometry($[0],$[1]));C.push(q)}return C}}toGeoJSON(C,B,q){return Ur.call(this,C,B,q)}}class _n{constructor(C){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=C.length,this._features=C}feature(C){return new ni(this._features[C])}}var Qn={exports:{}},rn=h.pointGeometry,cs=h.vectorTile.VectorTileFeature,On=ui;function ui(N,C){this.options=C||{},this.features=N,this.length=N.length}function di(N,C){this.id=typeof N.id=="number"?N.id:void 0,this.type=N.type,this.rawGeometry=N.type===1?[N.geometry]:N.geometry,this.properties=N.tags,this.extent=C||4096}ui.prototype.feature=function(N){return new di(this.features[N],this.options.extent)},di.prototype.loadGeometry=function(){var N=this.rawGeometry;this.geometry=[];for(var C=0;C<N.length;C++){for(var B=N[C],q=[],$=0;$<B.length;$++)q.push(new rn(B[$][0],B[$][1]));this.geometry.push(q)}return this.geometry},di.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var N=this.geometry,C=1/0,B=-1/0,q=1/0,$=-1/0,Q=0;Q<N.length;Q++)for(var st=N[Q],nt=0;nt<st.length;nt++){var tt=st[nt];C=Math.min(C,tt.x),B=Math.max(B,tt.x),q=Math.min(q,tt.y),$=Math.max($,tt.y)}return[C,q,B,$]},di.prototype.toGeoJSON=cs.prototype.toGeoJSON;var us=h.pbf,Ci=On;function gr(N){var C=new us;return function(B,q){for(var $ in B.layers)q.writeMessage(3,Jt,B.layers[$])}(N,C),C.finish()}function Jt(N,C){var B;C.writeVarintField(15,N.version||1),C.writeStringField(1,N.name||""),C.writeVarintField(5,N.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<N.length;B++)q.feature=N.feature(B),C.writeMessage(2,sn,q);var $=q.keys;for(B=0;B<$.length;B++)C.writeStringField(3,$[B]);var Q=q.values;for(B=0;B<Q.length;B++)C.writeMessage(4,gi,Q[B])}function sn(N,C){var B=N.feature;B.id!==void 0&&C.writeVarintField(1,B.id),C.writeMessage(2,ae,N),C.writeVarintField(3,B.type),C.writeMessage(4,Ze,B)}function ae(N,C){var B=N.feature,q=N.keys,$=N.values,Q=N.keycache,st=N.valuecache;for(var nt in B.properties){var tt=B.properties[nt],at=Q[nt];if(tt!==null){at===void 0&&(q.push(nt),Q[nt]=at=q.length-1),C.writeVarint(at);var xt=typeof tt;xt!=="string"&&xt!=="boolean"&&xt!=="number"&&(tt=JSON.stringify(tt));var At=xt+":"+tt,vt=st[At];vt===void 0&&($.push(tt),st[At]=vt=$.length-1),C.writeVarint(vt)}}}function gn(N,C){return(C<<3)+(7&N)}function ne(N){return N<<1^N>>31}function Ze(N,C){for(var B=N.loadGeometry(),q=N.type,$=0,Q=0,st=B.length,nt=0;nt<st;nt++){var tt=B[nt],at=1;q===1&&(at=tt.length),C.writeVarint(gn(1,at));for(var xt=q===3?tt.length-1:tt.length,At=0;At<xt;At++){At===1&&q!==1&&C.writeVarint(gn(2,xt-1));var vt=tt[At].x-$,Ht=tt[At].y-Q;C.writeVarint(ne(vt)),C.writeVarint(ne(Ht)),$+=vt,Q+=Ht}q===3&&C.writeVarint(gn(7,1))}}function gi(N,C){var B=typeof N;B==="string"?C.writeStringField(1,N):B==="boolean"?C.writeBooleanField(7,N):B==="number"&&(N%1!=0?C.writeDoubleField(3,N):N<0?C.writeSVarintField(6,N):C.writeVarintField(5,N))}function yi(N,C,B,q,$,Q){if($-q<=B)return;const st=q+$>>1;ri(N,C,st,q,$,Q%2),yi(N,C,B,q,st-1,Q+1),yi(N,C,B,st+1,$,Q+1)}function ri(N,C,B,q,$,Q){for(;$>q;){if($-q>600){const at=$-q+1,xt=B-q+1,At=Math.log(at),vt=.5*Math.exp(2*At/3),Ht=.5*Math.sqrt(At*vt*(at-vt)/at)*(xt-at/2<0?-1:1);ri(N,C,B,Math.max(q,Math.floor(B-xt*vt/at+Ht)),Math.min($,Math.floor(B+(at-xt)*vt/at+Ht)),Q)}const st=C[2*B+Q];let nt=q,tt=$;for(Ie(N,C,q,B),C[2*$+Q]>st&&Ie(N,C,q,$);nt<tt;){for(Ie(N,C,nt,tt),nt++,tt--;C[2*nt+Q]<st;)nt++;for(;C[2*tt+Q]>st;)tt--}C[2*q+Q]===st?Ie(N,C,q,tt):(tt++,Ie(N,C,tt,$)),tt<=B&&(q=tt+1),B<=tt&&($=tt-1)}}function Ie(N,C,B,q){De(N,B,q),De(C,2*B,2*q),De(C,2*B+1,2*q+1)}function De(N,C,B){const q=N[C];N[C]=N[B],N[B]=q}function Mi(N,C,B,q){const $=N-B,Q=C-q;return $*$+Q*Q}Qn.exports=gr,Qn.exports.fromVectorTileJs=gr,Qn.exports.fromGeojsonVt=function(N,C){C=C||{};var B={};for(var q in N)B[q]=new Ci(N[q].features,C),B[q].name=q,B[q].version=C.version,B[q].extent=C.extent;return gr({layers:B})},Qn.exports.GeoJSONWrapper=Ci;const Ni=N=>N[0],Zi=N=>N[1];class yr{constructor(C,B=Ni,q=Zi,$=64,Q=Float64Array){this.nodeSize=$,this.points=C;const st=C.length<65536?Uint16Array:Uint32Array,nt=this.ids=new st(C.length),tt=this.coords=new Q(2*C.length);for(let at=0;at<C.length;at++)nt[at]=at,tt[2*at]=B(C[at]),tt[2*at+1]=q(C[at]);yi(nt,tt,$,0,nt.length-1,0)}range(C,B,q,$){return function(Q,st,nt,tt,at,xt,At){const vt=[0,Q.length-1,0],Ht=[];let Xt,Ft;for(;vt.length;){const ie=vt.pop(),re=vt.pop(),Me=vt.pop();if(re-Me<=At){for(let we=Me;we<=re;we++)Xt=st[2*we],Ft=st[2*we+1],Xt>=nt&&Xt<=at&&Ft>=tt&&Ft<=xt&&Ht.push(Q[we]);continue}const he=Math.floor((Me+re)/2);Xt=st[2*he],Ft=st[2*he+1],Xt>=nt&&Xt<=at&&Ft>=tt&&Ft<=xt&&Ht.push(Q[he]);const me=(ie+1)%2;(ie===0?nt<=Xt:tt<=Ft)&&(vt.push(Me),vt.push(he-1),vt.push(me)),(ie===0?at>=Xt:xt>=Ft)&&(vt.push(he+1),vt.push(re),vt.push(me))}return Ht}(this.ids,this.coords,C,B,q,$,this.nodeSize)}within(C,B,q){return function($,Q,st,nt,tt,at){const xt=[0,$.length-1,0],At=[],vt=tt*tt;for(;xt.length;){const Ht=xt.pop(),Xt=xt.pop(),Ft=xt.pop();if(Xt-Ft<=at){for(let me=Ft;me<=Xt;me++)Mi(Q[2*me],Q[2*me+1],st,nt)<=vt&&At.push($[me]);continue}const ie=Math.floor((Ft+Xt)/2),re=Q[2*ie],Me=Q[2*ie+1];Mi(re,Me,st,nt)<=vt&&At.push($[ie]);const he=(Ht+1)%2;(Ht===0?st-tt<=re:nt-tt<=Me)&&(xt.push(Ft),xt.push(ie-1),xt.push(he)),(Ht===0?st+tt>=re:nt+tt>=Me)&&(xt.push(ie+1),xt.push(Xt),xt.push(he))}return At}(this.ids,this.coords,C,B,q,this.nodeSize)}}const Nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:N=>N},on=Math.fround||(Vi=new Float32Array(1),N=>(Vi[0]=+N,Vi[0]));var Vi;class Es{constructor(C){this.options=er(Object.create(Nr),C),this.trees=new Array(this.options.maxZoom+1)}load(C){const{log:B,minZoom:q,maxZoom:$,nodeSize:Q}=this.options;B&&console.time("total time");const st=`prepare ${C.length} points`;B&&console.time(st),this.points=C;let nt=[];for(let tt=0;tt<C.length;tt++)C[tt].geometry&&nt.push(Zr(C[tt],tt));this.trees[$+1]=new yr(nt,ds,ir,Q,Float32Array),B&&console.timeEnd(st);for(let tt=$;tt>=q;tt--){const at=+Date.now();nt=this._cluster(nt,tt),this.trees[tt]=new yr(nt,ds,ir,Q,Float32Array),B&&console.log("z%d: %d clusters in %dms",tt,nt.length,+Date.now()-at)}return B&&console.timeEnd("total time"),this}getClusters(C,B){let q=((C[0]+180)%360+360)%360-180;const $=Math.max(-90,Math.min(90,C[1]));let Q=C[2]===180?180:((C[2]+180)%360+360)%360-180;const st=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)q=-180,Q=180;else if(q>Q){const xt=this.getClusters([q,$,180,st],B),At=this.getClusters([-180,$,Q,st],B);return xt.concat(At)}const nt=this.trees[this._limitZoom(B)],tt=nt.range(Ae(q),En(st),Ae(Q),En($)),at=[];for(const xt of tt){const At=nt.points[xt];at.push(At.numPoints?vr(At):this.points[At.index])}return at}getChildren(C){const B=this._getOriginId(C),q=this._getOriginZoom(C),$="No cluster with the specified id.",Q=this.trees[q];if(!Q)throw new Error($);const st=Q.points[B];if(!st)throw new Error($);const nt=this.options.radius/(this.options.extent*Math.pow(2,q-1)),tt=Q.within(st.x,st.y,nt),at=[];for(const xt of tt){const At=Q.points[xt];At.parentId===C&&at.push(At.numPoints?vr(At):this.points[At.index])}if(at.length===0)throw new Error($);return at}getLeaves(C,B,q){const $=[];return this._appendLeaves($,C,B=B||10,q=q||0,0),$}getTile(C,B,q){const $=this.trees[this._limitZoom(C)],Q=Math.pow(2,C),{extent:st,radius:nt}=this.options,tt=nt/st,at=(q-tt)/Q,xt=(q+1+tt)/Q,At={features:[]};return this._addTileFeatures($.range((B-tt)/Q,at,(B+1+tt)/Q,xt),$.points,B,q,Q,At),B===0&&this._addTileFeatures($.range(1-tt/Q,at,1,xt),$.points,Q,q,Q,At),B===Q-1&&this._addTileFeatures($.range(0,at,tt/Q,xt),$.points,-1,q,Q,At),At.features.length?At:null}getClusterExpansionZoom(C){let B=this._getOriginZoom(C)-1;for(;B<=this.options.maxZoom;){const q=this.getChildren(C);if(B++,q.length!==1)break;C=q[0].properties.cluster_id}return B}_appendLeaves(C,B,q,$,Q){const st=this.getChildren(B);for(const nt of st){const tt=nt.properties;if(tt&&tt.cluster?Q+tt.point_count<=$?Q+=tt.point_count:Q=this._appendLeaves(C,tt.cluster_id,q,$,Q):Q<$?Q++:C.push(nt),C.length===q)break}return Q}_addTileFeatures(C,B,q,$,Q,st){for(const nt of C){const tt=B[nt],at=tt.numPoints;let xt,At,vt;if(at)xt=xr(tt),At=tt.x,vt=tt.y;else{const Ft=this.points[tt.index];xt=Ft.properties,At=Ae(Ft.geometry.coordinates[0]),vt=En(Ft.geometry.coordinates[1])}const Ht={type:1,geometry:[[Math.round(this.options.extent*(At*Q-q)),Math.round(this.options.extent*(vt*Q-$))]],tags:xt};let Xt;at?Xt=tt.id:this.options.generateId?Xt=tt.index:this.points[tt.index].id&&(Xt=this.points[tt.index].id),Xt!==void 0&&(Ht.id=Xt),st.features.push(Ht)}}_limitZoom(C){return Math.max(this.options.minZoom,Math.min(Math.floor(+C),this.options.maxZoom+1))}_cluster(C,B){const q=[],{radius:$,extent:Q,reduce:st,minPoints:nt}=this.options,tt=$/(Q*Math.pow(2,B));for(let at=0;at<C.length;at++){const xt=C[at];if(xt.zoom<=B)continue;xt.zoom=B;const At=this.trees[B+1],vt=At.within(xt.x,xt.y,tt),Ht=xt.numPoints||1;let Xt=Ht;for(const Ft of vt){const ie=At.points[Ft];ie.zoom>B&&(Xt+=ie.numPoints||1)}if(Xt>Ht&&Xt>=nt){let Ft=xt.x*Ht,ie=xt.y*Ht,re=st&&Ht>1?this._map(xt,!0):null;const Me=(at<<5)+(B+1)+this.points.length;for(const he of vt){const me=At.points[he];if(me.zoom<=B)continue;me.zoom=B;const we=me.numPoints||1;Ft+=me.x*we,ie+=me.y*we,me.parentId=Me,st&&(re||(re=this._map(xt,!0)),st(re,this._map(me)))}xt.parentId=Me,q.push(tr(Ft/Xt,ie/Xt,Me,Xt,re))}else if(q.push(xt),Xt>1)for(const Ft of vt){const ie=At.points[Ft];ie.zoom<=B||(ie.zoom=B,q.push(ie))}}return q}_getOriginId(C){return C-this.points.length>>5}_getOriginZoom(C){return(C-this.points.length)%32}_map(C,B){if(C.numPoints)return B?er({},C.properties):C.properties;const q=this.points[C.index].properties,$=this.options.map(q);return B&&$===q?er({},$):$}}function tr(N,C,B,q,$){return{x:on(N),y:on(C),zoom:1/0,id:B,parentId:-1,numPoints:q,properties:$}}function Zr(N,C){const[B,q]=N.geometry.coordinates;return{x:on(Ae(B)),y:on(En(q)),zoom:1/0,index:C,parentId:-1}}function vr(N){return{type:"Feature",id:N.id,properties:xr(N),geometry:{type:"Point",coordinates:[(C=N.x,360*(C-.5)),Fn(N.y)]}};var C}function xr(N){const C=N.numPoints,B=C>=1e4?`${Math.round(C/1e3)}k`:C>=1e3?Math.round(C/100)/10+"k":C;return er(er({},N.properties),{cluster:!0,cluster_id:N.id,point_count:C,point_count_abbreviated:B})}function Ae(N){return N/360+.5}function En(N){const C=Math.sin(N*Math.PI/180),B=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return B<0?0:B>1?1:B}function Fn(N){const C=(180-360*N)*Math.PI/180;return 360*Math.atan(Math.exp(C))/Math.PI-90}function er(N,C){for(const B in C)N[B]=C[B];return N}function ds(N){return N.x}function ir(N){return N.y}function nr(N,C,B,q){for(var $,Q=q,st=B-C>>1,nt=B-C,tt=N[C],at=N[C+1],xt=N[B],At=N[B+1],vt=C+3;vt<B;vt+=3){var Ht=br(N[vt],N[vt+1],tt,at,xt,At);if(Ht>Q)$=vt,Q=Ht;else if(Ht===Q){var Xt=Math.abs(vt-st);Xt<nt&&($=vt,nt=Xt)}}Q>q&&($-C>3&&nr(N,C,$,q),N[$+2]=Q,B-$>3&&nr(N,$,B,q))}function br(N,C,B,q,$,Q){var st=$-B,nt=Q-q;if(st!==0||nt!==0){var tt=((N-B)*st+(C-q)*nt)/(st*st+nt*nt);tt>1?(B=$,q=Q):tt>0&&(B+=st*tt,q+=nt*tt)}return(st=N-B)*st+(nt=C-q)*nt}function Un(N,C,B,q){var $={id:N===void 0?null:N,type:C,geometry:B,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var st=Q.geometry,nt=Q.type;if(nt==="Point"||nt==="MultiPoint"||nt==="LineString")wt(Q,st);else if(nt==="Polygon"||nt==="MultiLineString")for(var tt=0;tt<st.length;tt++)wt(Q,st[tt]);else if(nt==="MultiPolygon")for(tt=0;tt<st.length;tt++)for(var at=0;at<st[tt].length;at++)wt(Q,st[tt][at])}($),$}function wt(N,C){for(var B=0;B<C.length;B+=3)N.minX=Math.min(N.minX,C[B]),N.minY=Math.min(N.minY,C[B+1]),N.maxX=Math.max(N.maxX,C[B]),N.maxY=Math.max(N.maxY,C[B+1])}function Bt(N,C,B,q){if(C.geometry){var $=C.geometry.coordinates,Q=C.geometry.type,st=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),nt=[],tt=C.id;if(B.promoteId?tt=C.properties[B.promoteId]:B.generateId&&(tt=q||0),Q==="Point")wr($,nt);else if(Q==="MultiPoint")for(var at=0;at<$.length;at++)wr($[at],nt);else if(Q==="LineString")yn($,nt,st,!1);else if(Q==="MultiLineString"){if(B.lineMetrics){for(at=0;at<$.length;at++)yn($[at],nt=[],st,!1),N.push(Un(tt,"LineString",nt,C.properties));return}Ce($,nt,st,!1)}else if(Q==="Polygon")Ce($,nt,st,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(at=0;at<C.geometry.geometries.length;at++)Bt(N,{id:tt,geometry:C.geometry.geometries[at],properties:C.properties},B,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(at=0;at<$.length;at++){var xt=[];Ce($[at],xt,st,!0),nt.push(xt)}}N.push(Un(tt,Q,nt,C.properties))}}function wr(N,C){C.push(an(N[0])),C.push(Gi(N[1])),C.push(0)}function yn(N,C,B,q){for(var $,Q,st=0,nt=0;nt<N.length;nt++){var tt=an(N[nt][0]),at=Gi(N[nt][1]);C.push(tt),C.push(at),C.push(0),nt>0&&(st+=q?($*at-tt*Q)/2:Math.sqrt(Math.pow(tt-$,2)+Math.pow(at-Q,2))),$=tt,Q=at}var xt=C.length-3;C[2]=1,nr(C,0,xt,B),C[xt+2]=1,C.size=Math.abs(st),C.start=0,C.end=C.size}function Ce(N,C,B,q){for(var $=0;$<N.length;$++){var Q=[];yn(N[$],Q,B,q),C.push(Q)}}function an(N){return N/360+.5}function Gi(N){var C=Math.sin(N*Math.PI/180),B=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return B<0?0:B>1?1:B}function Wi(N,C,B,q,$,Q,st,nt){if(q/=C,Q>=(B/=C)&&st<q)return N;if(st<B||Q>=q)return null;for(var tt=[],at=0;at<N.length;at++){var xt=N[at],At=xt.geometry,vt=xt.type,Ht=$===0?xt.minX:xt.minY,Xt=$===0?xt.maxX:xt.maxY;if(Ht>=B&&Xt<q)tt.push(xt);else if(!(Xt<B||Ht>=q)){var Ft=[];if(vt==="Point"||vt==="MultiPoint")Tr(At,Ft,B,q,$);else if(vt==="LineString")Lt(At,Ft,B,q,$,!1,nt.lineMetrics);else if(vt==="MultiLineString")ue(At,Ft,B,q,$,!1);else if(vt==="Polygon")ue(At,Ft,B,q,$,!0);else if(vt==="MultiPolygon")for(var ie=0;ie<At.length;ie++){var re=[];ue(At[ie],re,B,q,$,!0),re.length&&Ft.push(re)}if(Ft.length){if(nt.lineMetrics&&vt==="LineString"){for(ie=0;ie<Ft.length;ie++)tt.push(Un(xt.id,vt,Ft[ie],xt.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(Ft.length===1?(vt="LineString",Ft=Ft[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=Ft.length===3?"Point":"MultiPoint"),tt.push(Un(xt.id,vt,Ft,xt.tags))}}}return tt.length?tt:null}function Tr(N,C,B,q,$){for(var Q=0;Q<N.length;Q+=3){var st=N[Q+$];st>=B&&st<=q&&(C.push(N[Q]),C.push(N[Q+1]),C.push(N[Q+2]))}}function Lt(N,C,B,q,$,Q,st){for(var nt,tt,at=fe(N),xt=$===0?rr:le,At=N.start,vt=0;vt<N.length-3;vt+=3){var Ht=N[vt],Xt=N[vt+1],Ft=N[vt+2],ie=N[vt+3],re=N[vt+4],Me=$===0?Ht:Xt,he=$===0?ie:re,me=!1;st&&(nt=Math.sqrt(Math.pow(Ht-ie,2)+Math.pow(Xt-re,2))),Me<B?he>B&&(tt=xt(at,Ht,Xt,ie,re,B),st&&(at.start=At+nt*tt)):Me>q?he<q&&(tt=xt(at,Ht,Xt,ie,re,q),st&&(at.start=At+nt*tt)):wi(at,Ht,Xt,Ft),he<B&&Me>=B&&(tt=xt(at,Ht,Xt,ie,re,B),me=!0),he>q&&Me<=q&&(tt=xt(at,Ht,Xt,ie,re,q),me=!0),!Q&&me&&(st&&(at.end=At+nt*tt),C.push(at),at=fe(N)),st&&(At+=nt)}var we=N.length-3;Ht=N[we],Xt=N[we+1],Ft=N[we+2],(Me=$===0?Ht:Xt)>=B&&Me<=q&&wi(at,Ht,Xt,Ft),we=at.length-3,Q&&we>=3&&(at[we]!==at[0]||at[we+1]!==at[1])&&wi(at,at[0],at[1],at[2]),at.length&&C.push(at)}function fe(N){var C=[];return C.size=N.size,C.start=N.start,C.end=N.end,C}function ue(N,C,B,q,$,Q){for(var st=0;st<N.length;st++)Lt(N[st],C,B,q,$,Q,!1)}function wi(N,C,B,q){N.push(C),N.push(B),N.push(q)}function rr(N,C,B,q,$,Q){var st=(Q-C)/(q-C);return N.push(Q),N.push(B+($-B)*st),N.push(1),st}function le(N,C,B,q,$,Q){var st=(Q-B)/($-B);return N.push(C+(q-C)*st),N.push(Q),N.push(1),st}function sr(N,C){for(var B=[],q=0;q<N.length;q++){var $,Q=N[q],st=Q.type;if(st==="Point"||st==="MultiPoint"||st==="LineString")$=Ti(Q.geometry,C);else if(st==="MultiLineString"||st==="Polygon"){$=[];for(var nt=0;nt<Q.geometry.length;nt++)$.push(Ti(Q.geometry[nt],C))}else if(st==="MultiPolygon")for($=[],nt=0;nt<Q.geometry.length;nt++){for(var tt=[],at=0;at<Q.geometry[nt].length;at++)tt.push(Ti(Q.geometry[nt][at],C));$.push(tt)}B.push(Un(Q.id,st,$,Q.tags))}return B}function Ti(N,C){var B=[];B.size=N.size,N.start!==void 0&&(B.start=N.start,B.end=N.end);for(var q=0;q<N.length;q+=3)B.push(N[q]+C,N[q+1],N[q+2]);return B}function ps(N,C){if(N.transformed)return N;var B,q,$,Q=1<<N.z,st=N.x,nt=N.y;for(B=0;B<N.features.length;B++){var tt=N.features[B],at=tt.geometry,xt=tt.type;if(tt.geometry=[],xt===1)for(q=0;q<at.length;q+=2)tt.geometry.push(pi(at[q],at[q+1],C,Q,st,nt));else for(q=0;q<at.length;q++){var At=[];for($=0;$<at[q].length;$+=2)At.push(pi(at[q][$],at[q][$+1],C,Q,st,nt));tt.geometry.push(At)}}return N.transformed=!0,N}function pi(N,C,B,q,$,Q){return[Math.round(B*(N*q-$)),Math.round(B*(C*q-Q))]}function qi(N,C,B,q,$){for(var Q=C===$.maxZoom?0:$.tolerance/((1<<C)*$.extent),st={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:q,z:C,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},nt=0;nt<N.length;nt++){st.numFeatures++,Ue(st,N[nt],Q,$);var tt=N[nt].minX,at=N[nt].minY,xt=N[nt].maxX,At=N[nt].maxY;tt<st.minX&&(st.minX=tt),at<st.minY&&(st.minY=at),xt>st.maxX&&(st.maxX=xt),At>st.maxY&&(st.maxY=At)}return st}function Ue(N,C,B,q){var $=C.geometry,Q=C.type,st=[];if(Q==="Point"||Q==="MultiPoint")for(var nt=0;nt<$.length;nt+=3)st.push($[nt]),st.push($[nt+1]),N.numPoints++,N.numSimplified++;else if(Q==="LineString")Sr(st,$,N,B,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(nt=0;nt<$.length;nt++)Sr(st,$[nt],N,B,Q==="Polygon",nt===0);else if(Q==="MultiPolygon")for(var tt=0;tt<$.length;tt++){var at=$[tt];for(nt=0;nt<at.length;nt++)Sr(st,at[nt],N,B,!0,nt===0)}if(st.length){var xt=C.tags||null;if(Q==="LineString"&&q.lineMetrics){for(var At in xt={},C.tags)xt[At]=C.tags[At];xt.mapbox_clip_start=$.start/$.size,xt.mapbox_clip_end=$.end/$.size}var vt={geometry:st,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:xt};C.id!==null&&(vt.id=C.id),N.features.push(vt)}}function Sr(N,C,B,q,$,Q){var st=q*q;if(q>0&&C.size<($?st:q))B.numPoints+=C.length/3;else{for(var nt=[],tt=0;tt<C.length;tt+=3)(q===0||C[tt+2]>st)&&(B.numSimplified++,nt.push(C[tt]),nt.push(C[tt+1])),B.numPoints++;$&&function(at,xt){for(var At=0,vt=0,Ht=at.length,Xt=Ht-2;vt<Ht;Xt=vt,vt+=2)At+=(at[vt]-at[Xt])*(at[vt+1]+at[Xt+1]);if(At>0===xt)for(vt=0,Ht=at.length;vt<Ht/2;vt+=2){var Ft=at[vt],ie=at[vt+1];at[vt]=at[Ht-2-vt],at[vt+1]=at[Ht-1-vt],at[Ht-2-vt]=Ft,at[Ht-1-vt]=ie}}(nt,Q),N.push(nt)}}function Nn(N,C){var B=(C=this.options=function($,Q){for(var st in Q)$[st]=Q[st];return $}(Object.create(this.options),C)).debug;if(B&&console.time("preprocess data"),C.maxZoom<0||C.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(C.promoteId&&C.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function($,Q){var st=[];if($.type==="FeatureCollection")for(var nt=0;nt<$.features.length;nt++)Bt(st,$.features[nt],Q,nt);else Bt(st,$.type==="Feature"?$:{geometry:$},Q);return st}(N,C);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",C.indexMaxZoom,C.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function($,Q){var st=Q.buffer/Q.extent,nt=$,tt=Wi($,1,-1-st,st,0,-1,2,Q),at=Wi($,1,1-st,2+st,0,-1,2,Q);return(tt||at)&&(nt=Wi($,1,-st,1+st,0,-1,2,Q)||[],tt&&(nt=sr(tt,1).concat(nt)),at&&(nt=nt.concat(sr(at,-1)))),nt}(q,C),q.length&&this.splitTile(q,0,0,0),B&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Vr(N,C,B){return 32*((1<<N)*B+C)+N}function Gr(N,C){const B=N.tileID.canonical;if(!this._geoJSONIndex)return C(null,null);const q=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!q)return C(null,null);const $=new _n(q.features);let Q=Qn.exports($);Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),C(null,{vectorTile:$,rawData:Q.buffer})}Nn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nn.prototype.splitTile=function(N,C,B,q,$,Q,st){for(var nt=[N,C,B,q],tt=this.options,at=tt.debug;nt.length;){q=nt.pop(),B=nt.pop(),C=nt.pop(),N=nt.pop();var xt=1<<C,At=Vr(C,B,q),vt=this.tiles[At];if(!vt&&(at>1&&console.time("creation"),vt=this.tiles[At]=qi(N,C,B,q,tt),this.tileCoords.push({z:C,x:B,y:q}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",C,B,q,vt.numFeatures,vt.numPoints,vt.numSimplified),console.timeEnd("creation"));var Ht="z"+C;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(vt.source=N,$){if(C===tt.maxZoom||C===$)continue;var Xt=1<<$-C;if(B!==Math.floor(Q/Xt)||q!==Math.floor(st/Xt))continue}else if(C===tt.indexMaxZoom||vt.numPoints<=tt.indexMaxPoints)continue;if(vt.source=null,N.length!==0){at>1&&console.time("clipping");var Ft,ie,re,Me,he,me,we=.5*tt.buffer/tt.extent,Be=.5-we,vi=.5+we,Ke=1+we;Ft=ie=re=Me=null,he=Wi(N,xt,B-we,B+vi,0,vt.minX,vt.maxX,tt),me=Wi(N,xt,B+Be,B+Ke,0,vt.minX,vt.maxX,tt),N=null,he&&(Ft=Wi(he,xt,q-we,q+vi,1,vt.minY,vt.maxY,tt),ie=Wi(he,xt,q+Be,q+Ke,1,vt.minY,vt.maxY,tt),he=null),me&&(re=Wi(me,xt,q-we,q+vi,1,vt.minY,vt.maxY,tt),Me=Wi(me,xt,q+Be,q+Ke,1,vt.minY,vt.maxY,tt),me=null),at>1&&console.timeEnd("clipping"),nt.push(Ft||[],C+1,2*B,2*q),nt.push(ie||[],C+1,2*B,2*q+1),nt.push(re||[],C+1,2*B+1,2*q),nt.push(Me||[],C+1,2*B+1,2*q+1)}}},Nn.prototype.getTile=function(N,C,B){var q=this.options,$=q.extent,Q=q.debug;if(N<0||N>24)return null;var st=1<<N,nt=Vr(N,C=(C%st+st)%st,B);if(this.tiles[nt])return ps(this.tiles[nt],$);Q>1&&console.log("drilling down to z%d-%d-%d",N,C,B);for(var tt,at=N,xt=C,At=B;!tt&&at>0;)at--,xt=Math.floor(xt/2),At=Math.floor(At/2),tt=this.tiles[Vr(at,xt,At)];return tt&&tt.source?(Q>1&&console.log("found parent tile z%d-%d-%d",at,xt,At),Q>1&&console.time("drilling down"),this.splitTile(tt.source,at,xt,At,N,C,B),Q>1&&console.timeEnd("drilling down"),this.tiles[nt]?ps(this.tiles[nt],$):null):null};class fs extends ce{constructor(C,B,q,$){super(C,B,q,Gr),$&&(this.loadGeoJSON=$)}loadData(C,B){var q;(q=this._pendingRequest)===null||q===void 0||q.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const $=!!(C&&C.request&&C.request.collectResourceTiming)&&new h.RequestPerformance(C.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(C,(Q,st)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!st)return B(Q);if(typeof st!="object")return B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));{Fr(st,!0);try{if(C.filter){const tt=h.createExpression(C.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(tt.result==="error")throw new Error(tt.value.map(xt=>`${xt.key}: ${xt.message}`).join(", "));st={type:"FeatureCollection",features:st.features.filter(xt=>tt.value.evaluate({zoom:0},xt))}}this._geoJSONIndex=C.cluster?new Es(function({superclusterOptions:tt,clusterProperties:at}){if(!at||!tt)return tt;const xt={},At={},vt={accumulated:null,zoom:0},Ht={properties:null},Xt=Object.keys(at);for(const Ft of Xt){const[ie,re]=at[Ft],Me=h.createExpression(re),he=h.createExpression(typeof ie=="string"?[ie,["accumulated"],["get",Ft]]:ie);xt[Ft]=Me.value,At[Ft]=he.value}return tt.map=Ft=>{Ht.properties=Ft;const ie={};for(const re of Xt)ie[re]=xt[re].evaluate(vt,Ht);return ie},tt.reduce=(Ft,ie)=>{Ht.properties=ie;for(const re of Xt)vt.accumulated=Ft[re],Ft[re]=At[re].evaluate(vt,Ht)},tt}(C)).load(st.features):function(tt,at){return new Nn(tt,at)}(st,C.geojsonVtOptions)}catch(tt){return B(tt)}this.loaded={};const nt={};if($){const tt=$.finish();tt&&(nt.resourceTiming={},nt.resourceTiming[C.source]=JSON.parse(JSON.stringify(tt)))}B(null,nt)}})}reloadTile(C,B){const q=this.loaded;return q&&q[C.uid]?super.reloadTile(C,B):this.loadTile(C,B)}loadGeoJSON(C,B){if(C.request)return h.getJSON(C.request,B);if(typeof C.data=="string")try{B(null,JSON.parse(C.data))}catch{B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`))}else B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(C,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(C,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(C.clusterId))}catch(q){B(q)}}getClusterChildren(C,B){try{B(null,this._geoJSONIndex.getChildren(C.clusterId))}catch(q){B(q)}}getClusterLeaves(C,B){try{B(null,this._geoJSONIndex.getLeaves(C.clusterId,C.limit,C.offset))}catch(q){B(q)}}}class zi{constructor(C){this.self=C,this.actor=new h.Actor(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ce,geojson:fs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,q)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=q},this.self.registerRTLTextPlugin=B=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=B.applyArabicShaping,h.plugin.processBidirectionalText=B.processBidirectionalText,h.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(C,B){this.referrer=B}setImages(C,B,q){this.availableImages[C]=B;for(const $ in this.workerSources[C]){const Q=this.workerSources[C][$];for(const st in Q)Q[st].availableImages=B}q()}setLayers(C,B,q){this.getLayerIndex(C).replace(B),q()}updateLayers(C,B,q){this.getLayerIndex(C).update(B.layers,B.removedIds),q()}loadTile(C,B,q){this.getWorkerSource(C,B.type,B.source).loadTile(B,q)}loadDEMTile(C,B,q){this.getDEMWorkerSource(C,B.source).loadTile(B,q)}reloadTile(C,B,q){this.getWorkerSource(C,B.type,B.source).reloadTile(B,q)}abortTile(C,B,q){this.getWorkerSource(C,B.type,B.source).abortTile(B,q)}removeTile(C,B,q){this.getWorkerSource(C,B.type,B.source).removeTile(B,q)}removeDEMTile(C,B){this.getDEMWorkerSource(C,B.source).removeTile(B)}removeSource(C,B,q){if(!this.workerSources[C]||!this.workerSources[C][B.type]||!this.workerSources[C][B.type][B.source])return;const $=this.workerSources[C][B.type][B.source];delete this.workerSources[C][B.type][B.source],$.removeSource!==void 0?$.removeSource(B,q):q()}loadWorkerSource(C,B,q){try{this.self.importScripts(B.url),q()}catch($){q($.toString())}}syncRTLPluginState(C,B,q){try{h.plugin.setState(B);const $=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&$!=null){this.self.importScripts($);const Q=h.plugin.isParsed();q(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${$}`),Q)}}catch($){q($.toString())}}getAvailableImages(C){let B=this.availableImages[C];return B||(B=[]),B}getLayerIndex(C){let B=this.layerIndexes[C];return B||(B=this.layerIndexes[C]=new Se),B}getWorkerSource(C,B,q){if(this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][B]||(this.workerSources[C][B]={}),!this.workerSources[C][B][q]){const $={send:(Q,st,nt)=>{this.actor.send(Q,st,nt,C)}};this.workerSources[C][B][q]=new this.workerSourceTypes[B]($,this.getLayerIndex(C),this.getAvailableImages(C))}return this.workerSources[C][B][q]}getDEMWorkerSource(C,B){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][B]||(this.demWorkerSources[C][B]=new Or),this.demWorkerSources[C][B]}enforceCacheSizeLimit(C,B){h.enforceCacheSizeLimit(B)}}return h.isWorker()&&(self.worker=new zi(self)),zi}),J(["./shared"],function(h){var Pt=ee;function ee(c){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,d,f=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(f);try{d=new Worker(y),a=!0}catch{a=!1}return d&&d.terminate(),URL.revokeObjectURL(y),a}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var a=document.createElement("canvas");a.width=a.height=1;var d=a.getContext("2d");if(!d)return!1;var f=d.getImageData(0,0,1,1);return f&&f.width===a.width}()?(Se[s=e&&e.failIfMajorPerformanceCaveat]===void 0&&(Se[s]=function(a){var d,f=function(y){var T=document.createElement("canvas"),I=Object.create(ee.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=y,T.getContext("webgl",I)||T.getContext("experimental-webgl",I)}(a);if(!f)return!1;try{d=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!d||f.isContextLost())&&(f.shaderSource(d,"void main() {}"),f.compileShader(d),f.getShaderParameter(d,f.COMPILE_STATUS)===!0)}(s)),Se[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(c)}var Se={};function Gt(c,e){if(Array.isArray(c)){if(!Array.isArray(e)||c.length!==e.length)return!1;for(let s=0;s<c.length;s++)if(!Gt(c[s],e[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&e!==null){if(typeof e!="object"||Object.keys(c).length!==Object.keys(e).length)return!1;for(const s in c)if(!Gt(c[s],e[s]))return!1;return!0}return c===e}ee.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class ft{static testProp(e){if(!ft.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in ft.docStyle)return e[s];return e[0]}static create(e,s,a){const d=window.document.createElement(e);return s!==void 0&&(d.className=s),a&&a.appendChild(d),d}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){ft.docStyle&&ft.selectProp&&(ft.userSelect=ft.docStyle[ft.selectProp],ft.docStyle[ft.selectProp]="none")}static enableDrag(){ft.docStyle&&ft.selectProp&&(ft.docStyle[ft.selectProp]=ft.userSelect)}static setTransform(e,s){e.style[ft.transformProp]=s}static addEventListener(e,s,a,d={}){e.addEventListener(s,a,"passive"in d?d:d.capture)}static removeEventListener(e,s,a,d={}){e.removeEventListener(s,a,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ft.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ft.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ft.suppressClickInternal,!0)},0)}static mousePos(e,s){const a=e.getBoundingClientRect();return new h.pointGeometry(s.clientX-a.left-e.clientLeft,s.clientY-a.top-e.clientTop)}static touchPos(e,s){const a=e.getBoundingClientRect(),d=[];for(let f=0;f<s.length;f++)d.push(new h.pointGeometry(s[f].clientX-a.left-e.clientLeft,s[f].clientY-a.top-e.clientTop));return d}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}ft.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ft.selectProp=ft.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ft.transformProp=ft.testProp(["transform","WebkitTransform"]);class ci{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}normalizeSpriteURL(e,s,a){const d=function(f){const y=f.match($e);if(!y)throw new Error(`Unable to parse URL "${f}"`);return{protocol:y[1],authority:y[2],path:y[3]||"/",params:y[4]?y[4].split("&"):[]}}(e);return d.path+=`${s}${a}`,function(f){const y=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${y}`}(d)}setTransformRequest(e){this._transformRequestFn=e}}const $e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class ce{constructor(e,s,a,d){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(s,d)}update(e,s,a){const{width:d,height:f}=e,y=!(this.size&&this.size[0]===d&&this.size[1]===f||a),{context:T}=this,{gl:I}=T;if(this.useMipmap=Boolean(s&&s.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!s||s.premultiply!==!1)),y)this.size=[d,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.isImageBitmap(e)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,e):I.texImage2D(I.TEXTURE_2D,0,this.format,d,f,0,this.format,I.UNSIGNED_BYTE,e.data);else{const{x:P,y:z}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.isImageBitmap(e)?I.texSubImage2D(I.TEXTURE_2D,0,P,z,I.RGBA,I.UNSIGNED_BYTE,e):I.texSubImage2D(I.TEXTURE_2D,0,P,z,d,f,I.RGBA,I.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(e,s,a){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),a!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,a||e),this.filter=e),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Or(c){const{userImage:e}=c;return!!(e&&e.render&&e.render())&&(c.data.replace(new Uint8Array(e.data.buffer)),!0)}class Fr extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,a);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let a=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(s.content,s)||(this.fire(new h.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,s){if(!e)return!0;let a=0;for(const d of e){if(d[0]<a||d[1]<d[0]||s<d[1])return!1;a=d[1]}return!0}_validateContent(e,s){return!(e&&(e.length!==4||e[0]<0||s.data.width<e[0]||e[1]<0||s.data.height<e[1]||e[2]<0||s.data.width<e[2]||e[3]<0||s.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,s){const a=this.images[e];if(a.data.width!==s.data.width||a.data.height!==s.data.height)throw new Error(`size mismatch between old image (${a.data.width}x${a.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=a.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,s){let a=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(a=!1);this.isLoaded()||a?this._notify(e,s):this.requestors.push({ids:e,callback:s})}_notify(e,s){const a={};for(const d of e){this.images[d]||this.fire(new h.Event("styleimagemissing",{id:d}));const f=this.images[d];f?a[d]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:Boolean(f.userImage&&f.userImage.render)}:h.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],a=this.getImage(e);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const d={w:a.data.width+2,h:a.data.height+2,x:0,y:0},f=new h.ImagePosition(d,a);this.patterns[e]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ce(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:s,h:a}=h.potpack(e),d=this.atlasImage;d.resize({width:s||1,height:a||1});for(const f in this.patterns){const{bin:y}=this.patterns[f],T=y.x+1,I=y.y+1,P=this.images[f].data,z=P.width,O=P.height;h.RGBAImage.copy(P,d,{x:0,y:0},{x:T,y:I},{width:z,height:O}),h.RGBAImage.copy(P,d,{x:0,y:O-1},{x:T,y:I-1},{width:z,height:1}),h.RGBAImage.copy(P,d,{x:0,y:0},{x:T,y:I+O},{width:z,height:1}),h.RGBAImage.copy(P,d,{x:z-1,y:0},{x:T-1,y:I},{width:1,height:O}),h.RGBAImage.copy(P,d,{x:0,y:0},{x:T+z,y:I},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const a=this.images[s];a||h.warnOnce(`Image with ID: "${s}" was not found`),Or(a)&&this.updateImage(s,a)}}}const mn=1e20;function ii(c,e,s,a,d,f,y,T,I){for(let P=e;P<e+a;P++)Ur(c,s*f+P,f,d,y,T,I);for(let P=s;P<s+d;P++)Ur(c,P*f+e,1,a,y,T,I)}function Ur(c,e,s,a,d,f,y){f[0]=0,y[0]=-mn,y[1]=mn,d[0]=c[e];for(let T=1,I=0,P=0;T<a;T++){d[T]=c[e+T*s];const z=T*T;do{const O=f[I];P=(d[T]-d[O]+z-O*O)/(T-O)/2}while(P<=y[I]&&--I>-1);I++,f[I]=T,y[I]=P,y[I+1]=mn}for(let T=0,I=0;T<a;T++){for(;y[I+1]<T;)I++;const P=f[I],z=T-P;c[e+T*s]=d[P]+z*z}}class ni{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e,s){const a=[];for(const d in e)for(const f of e[d])a.push({stack:d,id:f});h.asyncAll(a,({stack:d,id:f},y)=>{let T=this.entries[d];T||(T=this.entries[d]={glyphs:{},requests:{},ranges:{}});let I=T.glyphs[f];if(I!==void 0)return void y(null,{stack:d,id:f,glyph:I});if(I=this._tinySDF(T,d,f),I)return T.glyphs[f]=I,void y(null,{stack:d,id:f,glyph:I});const P=Math.floor(f/256);if(256*P>65535)return void y(new Error("glyphs > 65535 not supported"));if(T.ranges[P])return void y(null,{stack:d,id:f,glyph:I});let z=T.requests[P];z||(z=T.requests[P]=[],ni.loadGlyphRange(d,P,this.url,this.requestManager,(O,Z)=>{if(Z){for(const H in Z)this._doesCharSupportLocalGlyph(+H)||(T.glyphs[+H]=Z[+H]);T.ranges[P]=!0}for(const H of z)H(O,Z);delete T.requests[P]})),z.push((O,Z)=>{O?y(O):Z&&y(null,{stack:d,id:f,glyph:Z[f]||null})})},(d,f)=>{if(d)s(d);else if(f){const y={};for(const{stack:T,id:I,glyph:P}of f)(y[T]||(y[T]={}))[I]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};s(null,y)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(h.unicodeBlockLookup["CJK Unified Ideographs"](e)||h.unicodeBlockLookup["Hangul Syllables"](e)||h.unicodeBlockLookup.Hiragana(e)||h.unicodeBlockLookup.Katakana(e))}_tinySDF(e,s,a){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let T="400";/bold/i.test(s)?T="900":/medium/i.test(s)?T="500":/light/i.test(s)&&(T="200"),f=e.tinySDF=new ni.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:d,fontWeight:T})}const y=f.draw(String.fromCharCode(a));return{id:a,bitmap:new h.AlphaImage({width:y.width||30,height:y.height||30},y.data),metrics:{width:y.glyphWidth||24,height:y.glyphHeight||24,left:y.glyphLeft||0,top:y.glyphTop-27||-8,advance:y.glyphAdvance||24}}}}ni.loadGlyphRange=function(c,e,s,a,d){const f=256*e,y=f+255,T=a.transformRequest(s.replace("{fontstack}",c).replace("{range}",`${f}-${y}`),h.ResourceType.Glyphs);h.getArrayBuffer(T,(I,P)=>{if(I)d(I);else if(P){const z={};for(const O of h.parseGlyphPbf(P))z[O.id]=O;d(null,z)}})},ni.TinySDF=class{constructor({fontSize:c=24,buffer:e=3,radius:s=8,cutoff:a=.25,fontFamily:d="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=s;const T=this.size=c+4*e,I=this._createCanvas(T),P=this.ctx=I.getContext("2d",{willReadFrequently:!0});P.font=`${y} ${f} ${c}px ${d}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(c){const e=document.createElement("canvas");return e.width=e.height=c,e}draw(c){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:a,actualBoundingBoxLeft:d,actualBoundingBoxRight:f}=this.ctx.measureText(c),y=Math.ceil(s),T=Math.min(this.size-this.buffer,Math.ceil(f-d)),I=Math.min(this.size-this.buffer,y+Math.ceil(a)),P=T+2*this.buffer,z=I+2*this.buffer,O=Math.max(P*z,0),Z=new Uint8ClampedArray(O),H={data:Z,width:P,height:z,glyphWidth:T,glyphHeight:I,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(T===0||I===0)return H;const{ctx:j,buffer:W,gridInner:rt,gridOuter:ht}=this;j.clearRect(W,W,T,I),j.fillText(c,W,W+y);const dt=j.getImageData(W,W,T,I);ht.fill(mn,0,O),rt.fill(0,0,O);for(let X=0;X<I;X++)for(let _t=0;_t<T;_t++){const pt=dt.data[4*(X*T+_t)+3]/255;if(pt===0)continue;const Tt=(X+W)*P+_t+W;if(pt===1)ht[Tt]=0,rt[Tt]=mn;else{const St=.5-pt;ht[Tt]=St>0?St*St:0,rt[Tt]=St<0?St*St:0}}ii(ht,0,0,P,z,P,this.f,this.v,this.z),ii(rt,W,W,T,I,P,this.f,this.v,this.z);for(let X=0;X<O;X++){const _t=Math.sqrt(ht[X])-Math.sqrt(rt[X]);Z[X]=Math.round(255-255*(_t/this.radius+this.cutoff))}return H}};const _n=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(c,e){return h.sphericalToCartesian(c.expression.evaluate(e))}interpolate(c,e,s){return{x:h.number(c.x,e.x,s),y:h.number(c.y,e.y,s),z:h.number(c.z,e.z,s)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),Qn="-transition";class rn extends h.Evented{constructor(e){super(),this._transitionable=new h.Transitionable(_n),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(h.validateLight,e,s))for(const a in e){const d=e[a];a.endsWith(Qn)?this._transitionable.setTransition(a.slice(0,-Qn.length),d):this._transitionable.setValue(a,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,a){return(!a||a.validate!==!1)&&h.emitValidationErrors(this,e.call(h.validateStyle,h.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class cs{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const a=e.join(",")+String(s);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,s)),this.dashEntry[a]}getDashRanges(e,s,a){const d=[];let f=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,T=!0;d.push({left:f,right:y,isDash:T,zeroLength:e[0]===0});let I=e[0];for(let P=1;P<e.length;P++){T=!T;const z=e[P];f=I*a,I+=z,y=I*a,d.push({left:f,right:y,isDash:T,zeroLength:z===0})}return d}addRoundDash(e,s,a){const d=s/2;for(let f=-a;f<=a;f++){const y=this.width*(this.nextRow+a+f);let T=0,I=e[T];for(let P=0;P<this.width;P++){P/I.right>1&&(I=e[++T]);const z=Math.abs(P-I.left),O=Math.abs(P-I.right),Z=Math.min(z,O);let H;const j=f/a*(d+1);if(I.isDash){const W=d-Math.abs(j);H=Math.sqrt(Z*Z+W*W)}else H=d-Math.sqrt(Z*Z+j*j);this.data[y+P]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const I=e[T],P=e[T+1];I.zeroLength?e.splice(T,1):P&&P.isDash===I.isDash&&(P.left=I.left,e.splice(T,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,y=e[f];for(let T=0;T<this.width;T++){T/y.right>1&&(y=e[++f]);const I=Math.abs(T-y.left),P=Math.abs(T-y.right),z=Math.min(I,P);this.data[d+T]=Math.max(0,Math.min(255,(y.isDash?z:-z)+128))}}addDash(e,s){const a=s?7:0,d=2*a+1;if(this.nextRow+d>this.height)return h.warnOnce("LineAtlas out of space"),null;let f=0;for(let T=0;T<e.length;T++)f+=e[T];if(f!==0){const T=this.width/f,I=this.getDashRanges(e,this.width,T);s?this.addRoundDash(I,T,a):this.addRegularDash(I)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:f};return this.nextRow+=d,this.dirty=!0,y}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class On{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const a=this.workerPool.acquire(this.id);for(let d=0;d<a.length;d++){const f=new On.Actor(a[d],s,this.id);f.name=`Worker ${d}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s,a){h.asyncAll(this.actors,(d,f)=>{d.send(e,s,f)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ui(c,e,s){const a=function(d,f){if(d)return s(d);if(f){const y=h.pick(h.extend(f,c),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(y.vectorLayers=f.vector_layers,y.vectorLayerIds=y.vectorLayers.map(T=>T.id)),s(null,y)}};return c.url?h.getJSON(e.transformRequest(c.url,h.ResourceType.Source),a):h.exported.frame(()=>a(null,c))}On.Actor=h.Actor;class di{constructor(e,s,a){this.bounds=h.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),a=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*s),d=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*s),f=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*s),y=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*s);return e.x>=a&&e.x<f&&e.y>=d&&e.y<y}}class us extends h.Evented{constructor(e,s,a,d){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(s,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ui(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new h.ErrorEvent(e)):s&&(h.extend(this,s),s.bounds&&(this.tileBounds=new di(s.bounds,this.minzoom,this.maxzoom)),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(a,h.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(y,T){return delete e.request,e.aborted?s(null):y&&y.status!==404?s(y):(T&&T.resourceTiming&&(e.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&e.setExpiryData(T),e.loadVectorData(T,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}d.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=s:e.request=e.actor.send("reloadTile",d,f.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",d,f.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ci extends h.Evented{constructor(e,s,a,d){super(),this.id=e,this.dispatcher=a,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},s),h.extend(this,h.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ui(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new h.ErrorEvent(e)):s&&(h.extend(this,s),s.bounds&&(this.tileBounds=new di(s.bounds,this.minzoom,this.maxzoom)),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=h.getImage(this.map._requestManager.transformRequest(a,h.ResourceType.Tile),(d,f,y)=>{if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(d)e.state="errored",s(d);else if(f){this.map._refreshExpiredTiles&&e.setExpiryData(y);const T=this.map.painter.context,I=T.gl;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new ce(T,f,I.RGBA,{useMipmap:!0}),e.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),T.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax)),e.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(e,s){e.request&&(e.request.cancel(),delete e.request),s()}unloadTile(e,s){e.texture&&this.map.painter.saveTileTexture(e.texture),s()}hasTransition(){return!1}}let gr;class Jt extends Ci{constructor(e,s,a,d){super(e,s,a,d),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function d(f,y){f&&(e.state="errored",s(f)),y&&(e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",s(null))}e.request=h.getImage(this.map._requestManager.transformRequest(a,h.ResourceType.Tile),function(f,y){if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(f)e.state="errored",s(f);else if(y){this.map._refreshExpiredTiles&&e.setExpiryData(y),delete y.cacheControl,delete y.expires;const T=h.isImageBitmap(y)&&(gr==null&&(gr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),gr)?y:h.exported.getImageData(y,1),I={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:T,encoding:this.encoding};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",I,d.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)}_getNeighboringTiles(e){const s=e.canonical,a=Math.pow(2,s.z),d=(s.x-1+a)%a,f=s.x===0?e.wrap-1:e.wrap,y=(s.x+1+a)%a,T=s.x+1===a?e.wrap+1:e.wrap,I={};return I[new h.OverscaledTileID(e.overscaledZ,f,s.z,d,s.y).key]={backfilled:!1},I[new h.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y).key]={backfilled:!1},s.y>0&&(I[new h.OverscaledTileID(e.overscaledZ,f,s.z,d,s.y-1).key]={backfilled:!1},I[new h.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new h.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y-1).key]={backfilled:!1}),s.y+1<a&&(I[new h.OverscaledTileID(e.overscaledZ,f,s.z,d,s.y+1).key]={backfilled:!1},I[new h.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new h.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y+1).key]={backfilled:!1}),I}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class sn extends h.Evented{constructor(e,s,a,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(d),this._data=s.data,this._options=h.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.EXTENT,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData("content"),this}getClusterExpansionZoom(e,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},s),this}getClusterChildren(e,s){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},s),this}getClusterLeaves(e,s,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:s,offset:a},d),this}_updateWorkerData(e){const s=h.extend({},this.workerOptions),a=this._data;typeof a=="string"?(s.request=this.map._requestManager.transformRequest(h.exported.resolveURL(a),h.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(a),this._pendingLoads++,this.fire(new h.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(d,f)=>{if(this._pendingLoads--,this._removed||f&&f.abandoned)return void this.fire(new h.Event("dataabort",{dataType:"source",sourceDataType:e}));let y=null;if(f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y=f.resourceTiming[this.id].slice(0)),d)return void this.fire(new h.ErrorEvent(d));const T={dataType:"source",sourceDataType:e};this._collectResourceTiming&&y&&y.length>0&&h.extend(T,{resourceTiming:y}),this.fire(new h.Event("data",T))})}loaded(){return this._pendingLoads===0}loadTile(e,s){const a=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const d={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(a,d,(f,y)=>(delete e.request,e.unloadVectorData(),e.aborted?s(null):f?s(f):(e.loadVectorData(y,this.map.painter,a==="reloadTile"),s(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ae=h.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gn extends h.Evented{constructor(e,s,a,d){super(),this.id=e,this.dispatcher=a,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}load(e,s){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(a,d)=>{this._loaded=!0,a?this.fire(new h.ErrorEvent(a)):d&&(this.image=d,e&&(this.coordinates=e),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(e){this.coordinates=e;const s=e.map(h.MercatorCoordinate.fromLngLat);this.tileID=function(d){let f=1/0,y=1/0,T=-1/0,I=-1/0;for(const Z of d)f=Math.min(f,Z.x),y=Math.min(y,Z.y),T=Math.max(T,Z.x),I=Math.max(I,Z.y);const P=Math.max(T-f,I-y),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),O=Math.pow(2,z);return new h.CanonicalTileID(z,Math.floor((f+T)/2*O),Math.floor((y+I)/2*O))}(s),this.minzoom=this.maxzoom=this.tileID.z;const a=s.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new h.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,h.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,h.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,h.EXTENT,h.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ce(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const a in this.tiles){const d=this.tiles[a];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ne extends gn{constructor(e,s,a,d){super(e,s,a,d),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,h.ResourceType.Source).url);h.getVideo(this.urls,(s,a)=>{this._loaded=!0,s?this.fire(new h.ErrorEvent(s)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new ce(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const a in this.tiles){const d=this.tiles[a];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ze extends gn{constructor(e,s,a,d){super(e,s,a,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(y=>typeof y!="number"))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,a=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ce(s,this.canvas,a.RGBA,{premultiply:!0});for(const d in this.tiles){const f=this.tiles[d];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const gi={vector:us,raster:Ci,"raster-dem":Jt,geojson:sn,video:ne,image:gn,canvas:Ze};function yi(c,e){const s=h.create();return h.translate(s,s,[1,1,0]),h.scale(s,s,[.5*c.width,.5*c.height,1]),h.multiply(s,s,c.calculatePosMatrix(e.toUnwrapped()))}function ri(c,e,s,a,d,f){const y=function(O,Z,H){if(O)for(const j of O){const W=Z[j];if(W&&W.source===H&&W.type==="fill-extrusion")return!0}else for(const j in Z){const W=Z[j];if(W.source===H&&W.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,c.id),T=f.maxPitchScaleFactor(),I=c.tilesIn(a,T,y);I.sort(Ie);const P=[];for(const O of I)P.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,s,c._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,d,f,T,yi(c.transform,O.tileID))});const z=function(O){const Z={},H={};for(const j of O){const W=j.queryResults,rt=j.wrappedTileID,ht=H[rt]=H[rt]||{};for(const dt in W){const X=W[dt],_t=ht[dt]=ht[dt]||{},pt=Z[dt]=Z[dt]||[];for(const Tt of X)_t[Tt.featureIndex]||(_t[Tt.featureIndex]=!0,pt.push(Tt))}}return Z}(P);for(const O in z)z[O].forEach(Z=>{const H=Z.feature,j=c.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=j});return z}function Ie(c,e){const s=c.tileID,a=e.tileID;return s.overscaledZ-a.overscaledZ||s.canonical.y-a.canonical.y||s.wrap-a.wrap||s.canonical.x-a.canonical.x}class De{constructor(e,s){this.tileID=e,this.uid=h.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<h.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.textures.forEach(s=>e.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(e,s,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,f){const y={};if(!f)return y;for(const T of d){const I=T.layerIds.map(P=>f.getLayer(P)).filter(Boolean);if(I.length!==0){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(P=>I.filter(z=>z.id===P)[0]));for(const P of I)y[P.id]=T}}return y}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const f=this.buckets[d];if(f instanceof h.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const f=this.buckets[d];if(f instanceof h.SymbolBucket&&f.hasRTLText){this.hasRTLText=!0,h.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const d in this.buckets){const f=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.CollisionBoxArray}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const d=this.buckets[a];d.uploadPending()&&d.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ce(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ce(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,a,d,f,y,T,I,P,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:f,scale:y,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:T,queryPadding:this.queryPadding*P},e,s,a):{}}querySourceFeatures(e,s){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const d=a.loadVTLayers(),f=s?s.sourceLayer:"",y=d._geojsonTileLayer||d[f];if(!y)return;const T=h.createFilter(s&&s.filter),{z:I,x:P,y:z}=this.tileID.canonical,O={z:I,x:P,y:z};for(let Z=0;Z<y.length;Z++){const H=y.feature(Z);if(T.needGeometry){const rt=h.toEvaluationFeature(H,!0);if(!T.filter(new h.EvaluationParameters(this.tileID.overscaledZ),rt,this.tileID.canonical))continue}else if(!T.filter(new h.EvaluationParameters(this.tileID.overscaledZ),H))continue;const j=a.getId(H,f),W=new h.GeoJSONFeature(H,I,P,z,j);W.tile=O,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const a=h.parseCacheControl(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let d=!1;if(this.expirationTime>a)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const f=this.expirationTime-s;f?this.expirationTime=a+Math.max(f,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const f=this.buckets[d],y=f.layers[0].sourceLayer||"_geojsonTileLayer",T=a[y],I=e[y];if(!T||!I||Object.keys(I).length===0)continue;f.update(I,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=s&&s.style&&s.style.getLayer(d);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=h.exported.now()+e}setDependencies(e,s){const a={};for(const d of s)a[d]=!0;this.dependencies[e]=a}hasDependency(e,s){for(const a of e){const d=this.dependencies[a];if(d){for(const f of s)if(d[f])return!0}}return!1}}class Mi{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,a){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const f={value:s,timeout:void 0};if(a!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[d].push(f),this.order.push(d),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const a=e.wrapped().key,d=s===void 0?0:this.data[a].indexOf(s),f=this.data[a][d];return this.data[a].splice(d,1),f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const a in this.data)for(const d of this.data[a])e(d.value)||s.push(d);for(const a of s)this.remove(a.value.tileID,a)}}class Ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,a){const d=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},h.extend(this.stateChanges[e][d],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==d&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const f in this.state[e][d])a[f]||(this.deletedStates[e][d][f]=null)}else for(const f in a)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][f]===null&&delete this.deletedStates[e][d][f]}removeFeatureState(e,s,a){if(this.deletedStates[e]===null)return;const d=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&s!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][a]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(a in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][a]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,s){const a=String(s),d=h.extend({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][s];if(f===null)return{};for(const y in f)delete d[y]}return d}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const a={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const f={};for(const y in this.stateChanges[d])this.state[d][y]||(this.state[d][y]={}),h.extend(this.state[d][y],this.stateChanges[d][y]),f[y]=this.state[d][y];a[d]=f}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const f={};if(this.deletedStates[d]===null)for(const y in this.state[d])f[y]={},this.state[d][y]={};else for(const y in this.deletedStates[d]){if(this.deletedStates[d][y]===null)this.state[d][y]={};else for(const T of Object.keys(this.deletedStates[d][y]))delete this.state[d][y][T];f[y]=this.state[d][y]}a[d]=a[d]||{},h.extend(a[d],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const d in e)e[d].setFeatureState(a,s)}}class Zi extends h.Evented{constructor(e,s,a){super(),this.id=e,this.dispatcher=a,this.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(d,f,y,T){const I=new gi[f.type](d,f,y,T);if(I.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${I.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],I),I}(e,s,a,this),this._tiles={},this._cache=new Mi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ni}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s){return this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new h.Event("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const a=this._tiles[s];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(yr).map(e=>e.key)}getRenderableIds(e){const s=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&s.push(this._tiles[a]);return e?s.sort((a,d)=>{const f=a.tileID,y=d.tileID,T=new h.pointGeometry(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),I=new h.pointGeometry(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-y.overscaledZ||I.y-T.y||I.x-T.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(yr).map(a=>a.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=s),this._loadTile(a,this._tileLoaded.bind(this,a,e,s)))}_tileLoaded(e,s,a,d){if(d)return e.state="errored",void(d.status!==404?this._source.fire(new h.ErrorEvent(d,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=h.exported.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.Event("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const f=s[d];if(e.neighboringTiles&&e.neighboringTiles[f]){const y=this.getTileByID(f);a(e,y),a(y,e)}}function a(d,f){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let y=f.tileID.canonical.x-d.tileID.canonical.x;const T=f.tileID.canonical.y-d.tileID.canonical.y,I=Math.pow(2,d.tileID.canonical.z),P=f.tileID.key;y===0&&T===0||Math.abs(T)>1||(Math.abs(y)>1&&(Math.abs(y+I)===1?y+=I:Math.abs(y-I)===1&&(y-=I)),f.dem&&d.dem&&(d.dem.backfillBorder(f.dem,y,T),d.neighboringTiles&&d.neighboringTiles[P]&&(d.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,a,d){for(const f in this._tiles){let y=this._tiles[f];if(d[f]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>a)continue;let T=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const P=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[P.key],y&&y.hasData()&&(T=P)}let I=T;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){d[T.key]=T;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=s?a:null}for(let a=e.overscaledZ-1;a>=s;a--){const d=e.scaledTo(a),f=this._getLoadedTile(d);if(f)return f}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(s*a*5),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const a={};for(const d in this._tiles){const f=this._tiles[d];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),a[f.tileID.key]=f}this._tiles=a;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(e,s){if(this.transform=e,this.terrain=s,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new h.OverscaledTileID(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(a=a.filter(P=>this._source.hasTile(P)))):a=[];const d=e.coveringZoomLevel(this._source),f=Math.max(d-Zi.maxOverzooming,this._source.minzoom),y=Math.max(d+Zi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const z of a)if(z.canonical.z>this._source.minzoom){const O=z.scaledTo(z.canonical.z-1);P[O.key]=O;const Z=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));P[Z.key]=Z}a=a.concat(Object.values(P))}const T=this._updateRetainedTiles(a,d);if(Nr(this._source.type)){const P={},z={},O=Object.keys(T);for(const Z of O){const H=T[Z],j=this._tiles[Z];if(!j||j.fadeEndTime&&j.fadeEndTime<=h.exported.now())continue;const W=this.findLoadedParent(H,f);W&&(this._addTile(W.tileID),P[W.tileID.key]=W.tileID),z[Z]=H}this._retainLoadedChildren(z,d,y,T);for(const Z in P)T[Z]||(this._coveredTiles[Z]=!0,T[Z]=P[Z]);if(s){const Z={},H={};for(const j of a)this._tiles[j.key].hasData()?Z[j.key]=j:H[j.key]=j;for(const j in H){const W=H[j].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(Z[W[0].key]=T[W[0].key]=W[0],Z[W[1].key]=T[W[1].key]=W[1],Z[W[2].key]=T[W[2].key]=W[2],Z[W[3].key]=T[W[3].key]=W[3],delete H[j])}for(const j in H){const W=this.findLoadedParent(H[j],this._source.minzoom);if(W){Z[W.tileID.key]=T[W.tileID.key]=W.tileID;for(const rt in Z)Z[rt].isChildOf(W.tileID)&&delete Z[rt]}}for(const j in this._tiles)Z[j]||(this._coveredTiles[j]=!0)}}for(const P in T)this._tiles[P].clearFadeHold();const I=h.keysDifference(this._tiles,T);for(const P of I){const z=this._tiles[P];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){const a={},d={},f=Math.max(s-Zi.maxOverzooming,this._source.minzoom),y=Math.max(s+Zi.maxUnderzooming,this._source.minzoom),T={};for(const I of e){const P=this._addTile(I);a[I.key]=I,P.hasData()||s<this._source.maxzoom&&(T[I.key]=I)}this._retainLoadedChildren(T,s,y,a);for(const I of e){let P=this._tiles[I.key];if(P.hasData())continue;if(s+1>this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],Z=this.getTile(O);if(Z&&Z.hasData()){a[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(a[O[0].key]&&a[O[1].key]&&a[O[2].key]&&a[O[3].key])continue}let z=P.wasRequested();for(let O=I.overscaledZ-1;O>=f;--O){const Z=I.scaledTo(O);if(d[Z.key]||(d[Z.key]=!0,P=this.getTile(Z),!P&&z&&(P=this._addTile(Z)),P&&(a[Z.key]=Z,z=P.wasRequested(),P.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let a,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){a=this._loadedParentTiles[d.key];break}s.push(d.key);const f=d.scaledTo(d.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;d=f}for(const f of s)this._loadedParentTiles[f]=a}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const a=s;return s||(s=new De(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))),s.uses++,this._tiles[e.key]=s,a||this._source.fire(new h.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=s.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,a){const d=[],f=this.transform;if(!f)return d;const y=a?f.getCameraQueryGeometry(e):e,T=e.map(j=>f.pointCoordinate(j,this.terrain)),I=y.map(j=>f.pointCoordinate(j,this.terrain)),P=this.getIds();let z=1/0,O=1/0,Z=-1/0,H=-1/0;for(const j of I)z=Math.min(z,j.x),O=Math.min(O,j.y),Z=Math.max(Z,j.x),H=Math.max(H,j.y);for(let j=0;j<P.length;j++){const W=this._tiles[P[j]];if(W.holdingForFade())continue;const rt=W.tileID,ht=Math.pow(2,f.zoom-W.tileID.overscaledZ),dt=s*W.queryPadding*h.EXTENT/W.tileSize/ht,X=[rt.getTilePoint(new h.MercatorCoordinate(z,O)),rt.getTilePoint(new h.MercatorCoordinate(Z,H))];if(X[0].x-dt<h.EXTENT&&X[0].y-dt<h.EXTENT&&X[1].x+dt>=0&&X[1].y+dt>=0){const _t=T.map(Tt=>rt.getTilePoint(Tt)),pt=I.map(Tt=>rt.getTilePoint(Tt));d.push({tile:W,tileID:rt,queryGeometry:_t,cameraQueryGeometry:pt,scale:ht})}}return d}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of s)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Nr(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=h.exported.now())return!0}return!1}setFeatureState(e,s,a){this._state.updateState(e=e||"_geojsonTileLayer",s,a)}removeFeatureState(e,s,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,a)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,a){const d=this._tiles[e];d&&d.setDependencies(s,a)}reloadTilesForDependencies(e,s){for(const a in this._tiles)this._tiles[a].hasDependency(e,s)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,s))}}function yr(c,e){const s=Math.abs(2*c.wrap)-+(c.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return c.overscaledZ-e.overscaledZ||a-s||e.canonical.y-c.canonical.y||e.canonical.x-c.canonical.x}function Nr(c){return c==="raster"||c==="image"||c==="video"}Zi.maxOverzooming=10,Zi.maxUnderzooming=3;const on="mapboxgl_preloaded_worker_pool";class Vi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vi.workerCount;)this.workers.push(new Worker(rs.workerUrl));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[on]}numActive(){return Object.keys(this.active).length}}const Es=Math.floor(h.exported.hardwareConcurrency/2);let tr;function Zr(){return tr||(tr=new Vi),tr}function vr(c,e){const s={};for(const a in c)a!=="ref"&&(s[a]=c[a]);return h.refProperties.forEach(a=>{a in e&&(s[a]=e[a])}),s}function xr(c){c=c.slice();const e=Object.create(null);for(let s=0;s<c.length;s++)e[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=vr(c[s],e[c[s].ref]));return c}Vi.workerCount=Math.max(Math.min(Es,6),1);const Ae={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function En(c,e,s){s.push({command:Ae.addSource,args:[c,e[c]]})}function Fn(c,e,s){e.push({command:Ae.removeSource,args:[c]}),s[c]=!0}function er(c,e,s,a){Fn(c,s,a),En(c,e,s)}function ds(c,e,s){let a;for(a in c[s])if(Object.prototype.hasOwnProperty.call(c[s],a)&&a!=="data"&&!Gt(c[s][a],e[s][a]))return!1;for(a in e[s])if(Object.prototype.hasOwnProperty.call(e[s],a)&&a!=="data"&&!Gt(c[s][a],e[s][a]))return!1;return!0}function ir(c,e,s,a,d,f){let y;for(y in e=e||{},c=c||{})Object.prototype.hasOwnProperty.call(c,y)&&(Gt(c[y],e[y])||s.push({command:f,args:[a,y,e[y],d]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(c,y)&&(Gt(c[y],e[y])||s.push({command:f,args:[a,y,e[y],d]}))}function nr(c){return c.id}function br(c,e){return c[e.id]=e,c}class Un{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.clamp(e,0,1);let s=1,a=this._distances[s];const d=e*this.paddedLength+this.padding;for(;a<d&&s<this._distances.length;)a=this._distances[++s];const f=s-1,y=this._distances[f],T=a-y,I=T>0?(d-y)/T:0;return this.points[f].mult(1-I).add(this.points[s].mult(I))}}function wt(c,e){let s=!0;return c==="always"||c!=="never"&&e!=="never"||(s=!1),s}class Bt{constructor(e,s,a){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(s/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,a,d,f){this._forEachCell(s,a,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(e,s,a,d){this._forEachCell(s-d,a-d,s+d,a+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(a),this.circles.push(d)}_insertBoxCell(e,s,a,d,f,y){this.boxCells[f].push(y)}_insertCircleCell(e,s,a,d,f,y){this.circleCells[f].push(y)}_query(e,s,a,d,f,y,T){if(a<0||e>this.width||d<0||s>this.height)return[];const I=[];if(e<=0&&s<=0&&this.width<=a&&this.height<=d){if(f)return[{key:null,x1:e,y1:s,x2:a,y2:d}];for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],O=this.circles[3*P+1],Z=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:z-Z,y1:O-Z,x2:z+Z,y2:O+Z})}}else this._forEachCell(e,s,a,d,this._queryCell,I,{hitTest:f,overlapMode:y,seenUids:{box:{},circle:{}}},T);return I}query(e,s,a,d){return this._query(e,s,a,d,!1,null)}hitTest(e,s,a,d,f,y){return this._query(e,s,a,d,!0,f,y).length>0}hitTestCircle(e,s,a,d,f){const y=e-a,T=e+a,I=s-a,P=s+a;if(T<0||y>this.width||P<0||I>this.height)return!1;const z=[];return this._forEachCell(y,I,T,P,this._queryCellCircle,z,{hitTest:!0,overlapMode:d,circle:{x:e,y:s,radius:a},seenUids:{box:{},circle:{}}},f),z.length>0}_queryCell(e,s,a,d,f,y,T,I){const{seenUids:P,hitTest:z,overlapMode:O}=T,Z=this.boxCells[f];if(Z!==null){const j=this.bboxes;for(const W of Z)if(!P.box[W]){P.box[W]=!0;const rt=4*W,ht=this.boxKeys[W];if(e<=j[rt+2]&&s<=j[rt+3]&&a>=j[rt+0]&&d>=j[rt+1]&&(!I||I(ht))&&(!z||!wt(O,ht.overlapMode))&&(y.push({key:ht,x1:j[rt],y1:j[rt+1],x2:j[rt+2],y2:j[rt+3]}),z))return!0}}const H=this.circleCells[f];if(H!==null){const j=this.circles;for(const W of H)if(!P.circle[W]){P.circle[W]=!0;const rt=3*W,ht=this.circleKeys[W];if(this._circleAndRectCollide(j[rt],j[rt+1],j[rt+2],e,s,a,d)&&(!I||I(ht))&&(!z||!wt(O,ht.overlapMode))){const dt=j[rt],X=j[rt+1],_t=j[rt+2];if(y.push({key:ht,x1:dt-_t,y1:X-_t,x2:dt+_t,y2:X+_t}),z)return!0}}}return!1}_queryCellCircle(e,s,a,d,f,y,T,I){const{circle:P,seenUids:z,overlapMode:O}=T,Z=this.boxCells[f];if(Z!==null){const j=this.bboxes;for(const W of Z)if(!z.box[W]){z.box[W]=!0;const rt=4*W,ht=this.boxKeys[W];if(this._circleAndRectCollide(P.x,P.y,P.radius,j[rt+0],j[rt+1],j[rt+2],j[rt+3])&&(!I||I(ht))&&!wt(O,ht.overlapMode))return y.push(!0),!0}}const H=this.circleCells[f];if(H!==null){const j=this.circles;for(const W of H)if(!z.circle[W]){z.circle[W]=!0;const rt=3*W,ht=this.circleKeys[W];if(this._circlesCollide(j[rt],j[rt+1],j[rt+2],P.x,P.y,P.radius)&&(!I||I(ht))&&!wt(O,ht.overlapMode))return y.push(!0),!0}}}_forEachCell(e,s,a,d,f,y,T,I){const P=this._convertToXCellCoord(e),z=this._convertToYCellCoord(s),O=this._convertToXCellCoord(a),Z=this._convertToYCellCoord(d);for(let H=P;H<=O;H++)for(let j=z;j<=Z;j++)if(f.call(this,e,s,a,d,this.xCellCount*j+H,y,T,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,a,d,f,y){const T=d-e,I=f-s,P=a+y;return P*P>T*T+I*I}_circleAndRectCollide(e,s,a,d,f,y,T){const I=(y-d)/2,P=Math.abs(e-(d+I));if(P>I+a)return!1;const z=(T-f)/2,O=Math.abs(s-(f+z));if(O>z+a)return!1;if(P<=I||O<=z)return!0;const Z=P-I,H=O-z;return Z*Z+H*H<=a*a}}function wr(c,e,s,a,d){const f=h.create();return e?(h.scale(f,f,[1/d,1/d,1]),s||h.rotateZ(f,f,a.angle)):h.multiply(f,a.labelPlaneMatrix,c),f}function yn(c,e,s,a,d){if(e){const f=h.clone(c);return h.scale(f,f,[d,d,1]),s||h.rotateZ(f,f,-a.angle),f}return a.glCoordMatrix}function Ce(c,e,s){let a;s?(a=[c.x,c.y,s(c.x,c.y),1],h.transformMat4(a,a,e)):(a=[c.x,c.y,0,1],sr(a,a,e));const d=a[3];return{point:new h.pointGeometry(a[0]/d,a[1]/d),signedDistanceFromCamera:d}}function an(c,e){return .5+c/e*.5}function Gi(c,e){const s=c[0]/c[3],a=c[1]/c[3];return s>=-e[0]&&s<=e[0]&&a>=-e[1]&&a<=e[1]}function Wi(c,e,s,a,d,f,y,T,I,P){const z=a?c.textSizeData:c.iconSizeData,O=h.evaluateSizeForZoom(z,s.transform.zoom),Z=[256/s.width*2+1,256/s.height*2+1],H=a?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;H.clear();const j=c.lineVertexArray,W=a?c.text.placedSymbolArray:c.icon.placedSymbolArray,rt=s.transform.width/s.transform.height;let ht=!1;for(let dt=0;dt<W.length;dt++){const X=W.get(dt);if(X.hidden||X.writingMode===h.WritingMode.vertical&&!ht){le(X.numGlyphs,H);continue}let _t;if(ht=!1,P?(_t=[X.anchorX,X.anchorY,P(X.anchorX,X.anchorY),1],h.transformMat4(_t,_t,e)):(_t=[X.anchorX,X.anchorY,0,1],sr(_t,_t,e)),!Gi(_t,Z)){le(X.numGlyphs,H);continue}const pt=an(s.transform.cameraToCenterDistance,_t[3]),Tt=h.evaluateSizeForFeature(z,O,X),St=y?Tt/pt:Tt*pt,Mt=new h.pointGeometry(X.anchorX,X.anchorY),bt=Ce(Mt,d,P).point,Vt={},Rt=fe(X,St,!1,T,e,d,f,c.glyphOffsetArray,j,H,bt,Mt,Vt,rt,I,P);ht=Rt.useVertical,(Rt.notEnoughRoom||ht||Rt.needsFlipping&&fe(X,St,!0,T,e,d,f,c.glyphOffsetArray,j,H,bt,Mt,Vt,rt,I,P).notEnoughRoom)&&le(X.numGlyphs,H)}a?c.text.dynamicLayoutVertexBuffer.updateData(H):c.icon.dynamicLayoutVertexBuffer.updateData(H)}function Tr(c,e,s,a,d,f,y,T,I,P,z,O,Z){const H=T.glyphStartIndex+T.numGlyphs,j=T.lineStartIndex,W=T.lineStartIndex+T.lineLength,rt=e.getoffsetX(T.glyphStartIndex),ht=e.getoffsetX(H-1),dt=wi(c*rt,s,a,d,f,y,T.segment,j,W,I,P,z,O,Z);if(!dt)return null;const X=wi(c*ht,s,a,d,f,y,T.segment,j,W,I,P,z,O,Z);return X?{first:dt,last:X}:null}function Lt(c,e,s,a){return c===h.WritingMode.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*a?{useVertical:!0}:(c===h.WritingMode.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function fe(c,e,s,a,d,f,y,T,I,P,z,O,Z,H,j,W){const rt=e/24,ht=c.lineOffsetX*rt,dt=c.lineOffsetY*rt;let X;if(c.numGlyphs>1){const _t=c.glyphStartIndex+c.numGlyphs,pt=c.lineStartIndex,Tt=c.lineStartIndex+c.lineLength,St=Tr(rt,T,ht,dt,s,z,O,c,I,f,Z,j,W);if(!St)return{notEnoughRoom:!0};const Mt=Ce(St.first.point,y,W).point,bt=Ce(St.last.point,y,W).point;if(a&&!s){const Vt=Lt(c.writingMode,Mt,bt,H);if(Vt)return Vt}X=[St.first];for(let Vt=c.glyphStartIndex+1;Vt<_t-1;Vt++)X.push(wi(rt*T.getoffsetX(Vt),ht,dt,s,z,O,c.segment,pt,Tt,I,f,Z,j,W));X.push(St.last)}else{if(a&&!s){const pt=Ce(O,d,W).point,Tt=c.lineStartIndex+c.segment+1,St=new h.pointGeometry(I.getx(Tt),I.gety(Tt)),Mt=Ce(St,d,W),bt=Mt.signedDistanceFromCamera>0?Mt.point:ue(O,St,pt,1,d,W),Vt=Lt(c.writingMode,pt,bt,H);if(Vt)return Vt}const _t=wi(rt*T.getoffsetX(c.glyphStartIndex),ht,dt,s,z,O,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,I,f,Z,j,W);if(!_t)return{notEnoughRoom:!0};X=[_t]}for(const _t of X)h.addDynamicAttributes(P,_t.point,_t.angle);return{}}function ue(c,e,s,a,d,f){const y=Ce(c.add(c.sub(e)._unit()),d,f).point,T=s.sub(y);return s.add(T._mult(a/T.mag()))}function wi(c,e,s,a,d,f,y,T,I,P,z,O,Z,H){const j=a?c-e:c+e;let W=j>0?1:-1,rt=0;a&&(W*=-1,rt=Math.PI),W<0&&(rt+=Math.PI);let ht=W>0?T+y:T+y+1,dt=d,X=d,_t=0,pt=0;const Tt=Math.abs(j),St=[];for(;_t+pt<=Tt;){if(ht+=W,ht<T||ht>=I)return null;if(X=dt,St.push(dt),dt=O[ht],dt===void 0){const jt=new h.pointGeometry(P.getx(ht),P.gety(ht)),pe=Ce(jt,z,H);if(pe.signedDistanceFromCamera>0)dt=O[ht]=pe.point;else{const ye=ht-W;dt=ue(_t===0?f:new h.pointGeometry(P.getx(ye),P.gety(ye)),jt,X,Tt-_t+1,z,H)}}_t+=pt,pt=X.dist(dt)}const Mt=(Tt-_t)/pt,bt=dt.sub(X),Vt=bt.mult(Mt)._add(X);Vt._add(bt._unit()._perp()._mult(s*W));const Rt=rt+Math.atan2(dt.y-X.y,dt.x-X.x);return St.push(Vt),{point:Vt,angle:Z?Rt:0,path:St}}const rr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(c,e){for(let s=0;s<c;s++){const a=e.length;e.resize(a+4),e.float32.set(rr,3*a)}}function sr(c,e,s){const a=e[0],d=e[1];return c[0]=s[0]*a+s[4]*d+s[12],c[1]=s[1]*a+s[5]*d+s[13],c[3]=s[3]*a+s[7]*d+s[15],c}const Ti=100;class ps{constructor(e,s=new Bt(e.width+200,e.height+200,25),a=new Bt(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ti,this.screenBottomBoundary=e.height+Ti,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,a,d,f,y){const T=this.projectAndGetPerspectiveRatio(d,e.anchorPointX,e.anchorPointY,y),I=a*T.perspectiveRatio,P=e.x1*I+T.point.x,z=e.y1*I+T.point.y,O=e.x2*I+T.point.x,Z=e.y2*I+T.point.y;return!this.isInsideGrid(P,z,O,Z)||s!=="always"&&this.grid.hitTest(P,z,O,Z,s,f)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[P,z,O,Z],offscreen:this.isOffscreen(P,z,O,Z)}}placeCollisionCircles(e,s,a,d,f,y,T,I,P,z,O,Z,H,j){const W=[],rt=new h.pointGeometry(s.anchorX,s.anchorY),ht=Ce(rt,y,j),dt=an(this.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),X=(z?f/dt:f*dt)/h.ONE_EM,_t=Ce(rt,T,j).point,pt=Tr(X,d,s.lineOffsetX*X,s.lineOffsetY*X,!1,_t,rt,s,a,T,{},!1,j);let Tt=!1,St=!1,Mt=!0;if(pt){const bt=.5*Z*dt+H,Vt=new h.pointGeometry(-100,-100),Rt=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),jt=new Un,pe=pt.first,ye=pt.last;let Qt=[];for(let Le=pe.path.length-1;Le>=1;Le--)Qt.push(pe.path[Le]);for(let Le=1;Le<ye.path.length;Le++)Qt.push(ye.path[Le]);const Ve=2.5*bt;if(I){const Le=Qt.map(ke=>Ce(ke,I,j));Qt=Le.some(ke=>ke.signedDistanceFromCamera<=0)?[]:Le.map(ke=>ke.point)}let Ge=[];if(Qt.length>0){const Le=Qt[0].clone(),ke=Qt[0].clone();for(let qe=1;qe<Qt.length;qe++)Le.x=Math.min(Le.x,Qt[qe].x),Le.y=Math.min(Le.y,Qt[qe].y),ke.x=Math.max(ke.x,Qt[qe].x),ke.y=Math.max(ke.y,Qt[qe].y);Ge=Le.x>=Vt.x&&ke.x<=Rt.x&&Le.y>=Vt.y&&ke.y<=Rt.y?[Qt]:ke.x<Vt.x||Le.x>Rt.x||ke.y<Vt.y||Le.y>Rt.y?[]:h.clipLine([Qt],Vt.x,Vt.y,Rt.x,Rt.y)}for(const Le of Ge){jt.reset(Le,.25*bt);let ke=0;ke=jt.length<=.5*bt?1:Math.ceil(jt.paddedLength/Ve)+1;for(let qe=0;qe<ke;qe++){const Di=qe/Math.max(ke-1,1),kr=jt.lerp(Di),dr=kr.x+Ti,Dr=kr.y+Ti;W.push(dr,Dr,bt,0);const Ts=dr-bt,Kn=Dr-bt,wn=dr+bt,ss=Dr+bt;if(Mt=Mt&&this.isOffscreen(Ts,Kn,wn,ss),St=St||this.isInsideGrid(Ts,Kn,wn,ss),e!=="always"&&this.grid.hitTestCircle(dr,Dr,bt,e,O)&&(Tt=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Tt}}}}return{circles:!P&&Tt||!St||dt<this.perspectiveRatioCutoff?[]:W,offscreen:Mt,collisionDetected:Tt}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let a=1/0,d=1/0,f=-1/0,y=-1/0;for(const z of e){const O=new h.pointGeometry(z.x+Ti,z.y+Ti);a=Math.min(a,O.x),d=Math.min(d,O.y),f=Math.max(f,O.x),y=Math.max(y,O.y),s.push(O)}const T=this.grid.query(a,d,f,y).concat(this.ignoredGrid.query(a,d,f,y)),I={},P={};for(const z of T){const O=z.key;if(I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]={}),I[O.bucketInstanceId][O.featureIndex])continue;const Z=[new h.pointGeometry(z.x1,z.y1),new h.pointGeometry(z.x2,z.y1),new h.pointGeometry(z.x2,z.y2),new h.pointGeometry(z.x1,z.y2)];h.polygonIntersectsPolygon(s,Z)&&(I[O.bucketInstanceId][O.featureIndex]=!0,P[O.bucketInstanceId]===void 0&&(P[O.bucketInstanceId]=[]),P[O.bucketInstanceId].push(O.featureIndex))}return P}insertCollisionBox(e,s,a,d,f,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:f,collisionGroupID:y,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,a,d,f,y){const T=a?this.ignoredGrid:this.grid,I={bucketInstanceId:d,featureIndex:f,collisionGroupID:y,overlapMode:s};for(let P=0;P<e.length;P+=4)T.insertCircle(I,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,s,a,d){let f;return d?(f=[s,a,d(s,a),1],h.transformMat4(f,f,e)):(f=[s,a,0,1],sr(f,f,e)),{point:new h.pointGeometry((f[0]/f[3]+1)/2*this.transform.width+Ti,(-f[1]/f[3]+1)/2*this.transform.height+Ti),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(e,s,a,d){return a<Ti||e>=this.screenRightBoundary||d<Ti||s>this.screenBottomBoundary}isInsideGrid(e,s,a,d){return a>=0&&e<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=h.identity([]);return h.translate(e,e,[-100,-100,0]),e}}function pi(c,e,s){return e*(h.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}class qi{constructor(e,s,a,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):d&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ue{constructor(e,s,a,d,f){this.text=new qi(e?e.text:null,s,a,f),this.icon=new qi(e?e.icon:null,s,d,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sr{constructor(e,s,a){this.text=e,this.icon=s,this.skipFade=a}}class Nn{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class Vr{constructor(e,s,a,d,f){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=a,this.bucketIndex=d,this.tileID=f}}class Gr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:a=>a.collisionGroupID===s}}return this.collisionGroups[e]}}function fs(c,e,s,a,d){const{horizontalAlign:f,verticalAlign:y}=h.getAnchorAlignment(c),T=-(f-.5)*e,I=-(y-.5)*s,P=h.evaluateVariableOffset(c,a);return new h.pointGeometry(T+P[0]*d,I+P[1]*d)}function zi(c,e,s,a,d,f){const{x1:y,x2:T,y1:I,y2:P,anchorPointX:z,anchorPointY:O}=c,Z=new h.pointGeometry(e,s);return a&&Z._rotate(d?f:-f),{x1:y+Z.x,y1:I+Z.y,x2:T+Z.x,y2:P+Z.y,anchorPointX:z,anchorPointY:O}}class N{constructor(e,s,a,d,f){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new ps(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Gr(d),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,s,a,d){const f=a.getBucket(s),y=a.latestFeatureIndex;if(!f||!y||s.id!==f.layerIds[0])return;const T=a.collisionBoxArray,I=f.layers[0].layout,P=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/h.EXTENT,O=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),Z=I.get("text-pitch-alignment")==="map",H=I.get("text-rotation-alignment")==="map",j=pi(a,1,this.transform.zoom),W=wr(O,Z,H,this.transform,j);let rt=null;if(Z){const dt=yn(O,Z,H,this.transform,j);rt=h.multiply([],this.transform.labelPlaneMatrix,dt)}this.retainedQueryData[f.bucketInstanceId]=new Vr(f.bucketInstanceId,y,f.sourceLayerIndex,f.index,a.tileID);const ht={bucket:f,layout:I,posMatrix:O,textLabelPlaneMatrix:W,labelToScreenMatrix:rt,scale:P,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const dt of f.sortKeyRanges){const{sortKey:X,symbolInstanceStart:_t,symbolInstanceEnd:pt}=dt;e.push({sortKey:X,symbolInstanceStart:_t,symbolInstanceEnd:pt,parameters:ht})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:ht})}attemptAnchorPlacement(e,s,a,d,f,y,T,I,P,z,O,Z,H,j,W,rt){const ht=[Z.textOffset0,Z.textOffset1],dt=fs(e,a,d,ht,f),X=this.collisionIndex.placeCollisionBox(zi(s,dt.x,dt.y,y,T,this.transform.angle),O,I,P,z.predicate,rt);if((!W||this.collisionIndex.placeCollisionBox(zi(W,dt.x,dt.y,y,T,this.transform.angle),O,I,P,z.predicate,rt).box.length!==0)&&X.box.length>0){let _t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(_t=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:ht,width:a,height:d,anchor:e,textBoxScale:f,prevAnchor:_t},this.markUsedJustification(H,e,Z,j),H.allowVerticalPlacement&&(this.markUsedOrientation(H,j,Z),this.placedOrientations[Z.crossTileID]=j),{shift:dt,placedGlyphBoxes:X}}}placeLayerBucketPart(e,s,a){const{bucket:d,layout:f,posMatrix:y,textLabelPlaneMatrix:T,labelToScreenMatrix:I,textPixelRatio:P,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:Z,collisionGroup:H}=e.parameters,j=f.get("text-optional"),W=f.get("icon-optional"),rt=h.getOverlapMode(f,"text-overlap","text-allow-overlap"),ht=rt==="always",dt=h.getOverlapMode(f,"icon-overlap","icon-allow-overlap"),X=dt==="always",_t=f.get("text-rotation-alignment")==="map",pt=f.get("text-pitch-alignment")==="map",Tt=f.get("icon-text-fit")!=="none",St=f.get("symbol-z-order")==="viewport-y",Mt=ht&&(X||!d.hasIconData()||W),bt=X&&(ht||!d.hasTextData()||j);!d.collisionArrays&&O&&d.deserializeCollisionBoxes(O);const Vt=(Rt,jt)=>{if(s[Rt.crossTileID])return;if(z)return void(this.placements[Rt.crossTileID]=new Sr(!1,!1,!1));let pe=!1,ye=!1,Qt=!0,Ve=null,Ge={box:null,offscreen:null},Le={box:null,offscreen:null},ke=null,qe=null,Di=null,kr=0,dr=0,Dr=0;jt.textFeatureIndex?kr=jt.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(kr=Rt.featureIndex),jt.verticalTextFeatureIndex&&(dr=jt.verticalTextFeatureIndex);const Ts=this.retainedQueryData[d.bucketInstanceId].tileID,Kn=this.terrain?(Ei,be)=>this.terrain.getElevation(Ts,Ei,be):null;for(const Ei of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const be=jt[Ei];be&&(be.elevation=Kn?Kn(be.anchorPointX,be.anchorPointY):0)}const wn=jt.textBox;if(wn){const Ei=Ne=>{let Bi=h.WritingMode.horizontal;if(d.allowVerticalPlacement&&!Ne&&this.prevPlacement){const Ri=this.prevPlacement.placedOrientations[Rt.crossTileID];Ri&&(this.placedOrientations[Rt.crossTileID]=Ri,Bi=Ri,this.markUsedOrientation(d,Bi,Rt))}return Bi},be=(Ne,Bi)=>{if(d.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&jt.verticalTextBox){for(const Ri of d.writingModes)if(Ri===h.WritingMode.vertical?(Ge=Bi(),Le=Ge):Ge=Ne(),Ge&&Ge.box&&Ge.box.length)break}else Ge=Ne()};if(f.get("text-variable-anchor")){let Ne=f.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt.crossTileID]){const oi=this.prevPlacement.variableOffsets[Rt.crossTileID];Ne.indexOf(oi.anchor)>0&&(Ne=Ne.filter(Jn=>Jn!==oi.anchor),Ne.unshift(oi.anchor))}const Bi=(oi,Jn,Xs)=>{const Ua=oi.x2-oi.x1,So=oi.y2-oi.y1,cl=Rt.textBoxScale,Na=Tt&&dt==="never"?Jn:null;let Ss={box:[],offscreen:!1};const Ks=rt!=="never"?2*Ne.length:Ne.length;for(let Js=0;Js<Ks;++Js){const ya=this.attemptAnchorPlacement(Ne[Js%Ne.length],oi,Ua,So,cl,_t,pt,P,y,H,Js>=Ne.length?rt:"never",Rt,d,Xs,Na,Kn);if(ya&&(Ss=ya.placedGlyphBoxes,Ss&&Ss.box&&Ss.box.length)){pe=!0,Ve=ya.shift;break}}return Ss};be(()=>Bi(wn,jt.iconBox,h.WritingMode.horizontal),()=>{const oi=jt.verticalTextBox;return d.allowVerticalPlacement&&!(Ge&&Ge.box&&Ge.box.length)&&Rt.numVerticalGlyphVertices>0&&oi?Bi(oi,jt.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null}}),Ge&&(pe=Ge.box,Qt=Ge.offscreen);const Ri=Ei(Ge&&Ge.box);if(!pe&&this.prevPlacement){const oi=this.prevPlacement.variableOffsets[Rt.crossTileID];oi&&(this.variableOffsets[Rt.crossTileID]=oi,this.markUsedJustification(d,oi.anchor,Rt,Ri))}}else{const Ne=(Bi,Ri)=>{const oi=this.collisionIndex.placeCollisionBox(Bi,rt,P,y,H.predicate,Kn);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(d,Ri,Rt),this.placedOrientations[Rt.crossTileID]=Ri),oi};be(()=>Ne(wn,h.WritingMode.horizontal),()=>{const Bi=jt.verticalTextBox;return d.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&Bi?Ne(Bi,h.WritingMode.vertical):{box:null,offscreen:null}}),Ei(Ge&&Ge.box&&Ge.box.length)}}if(ke=Ge,pe=ke&&ke.box&&ke.box.length>0,Qt=ke&&ke.offscreen,Rt.useRuntimeCollisionCircles){const Ei=d.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex),be=h.evaluateSizeForFeature(d.textSizeData,Z,Ei),Ne=f.get("text-padding");qe=this.collisionIndex.placeCollisionCircles(rt,Ei,d.lineVertexArray,d.glyphOffsetArray,be,y,T,I,a,pt,H.predicate,Rt.collisionCircleDiameter,Ne,Kn),qe.circles.length&&qe.collisionDetected&&!a&&h.warnOnce("Collisions detected, but collision boxes are not shown"),pe=ht||qe.circles.length>0&&!qe.collisionDetected,Qt=Qt&&qe.offscreen}if(jt.iconFeatureIndex&&(Dr=jt.iconFeatureIndex),jt.iconBox){const Ei=be=>{const Ne=Tt&&Ve?zi(be,Ve.x,Ve.y,_t,pt,this.transform.angle):be;return this.collisionIndex.placeCollisionBox(Ne,dt,P,y,H.predicate,Kn)};Le&&Le.box&&Le.box.length&&jt.verticalIconBox?(Di=Ei(jt.verticalIconBox),ye=Di.box.length>0):(Di=Ei(jt.iconBox),ye=Di.box.length>0),Qt=Qt&&Di.offscreen}const ss=j||Rt.numHorizontalGlyphVertices===0&&Rt.numVerticalGlyphVertices===0,ga=W||Rt.numIconVertices===0;if(ss||ga?ga?ss||(ye=ye&&pe):pe=ye&&pe:ye=pe=ye&&pe,pe&&ke&&ke.box&&this.collisionIndex.insertCollisionBox(ke.box,rt,f.get("text-ignore-placement"),d.bucketInstanceId,Le&&Le.box&&dr?dr:kr,H.ID),ye&&Di&&this.collisionIndex.insertCollisionBox(Di.box,dt,f.get("icon-ignore-placement"),d.bucketInstanceId,Dr,H.ID),qe&&(pe&&this.collisionIndex.insertCollisionCircles(qe.circles,rt,f.get("text-ignore-placement"),d.bucketInstanceId,kr,H.ID),a)){const Ei=d.bucketInstanceId;let be=this.collisionCircleArrays[Ei];be===void 0&&(be=this.collisionCircleArrays[Ei]=new Nn);for(let Ne=0;Ne<qe.circles.length;Ne+=4)be.circles.push(qe.circles[Ne+0]),be.circles.push(qe.circles[Ne+1]),be.circles.push(qe.circles[Ne+2]),be.circles.push(qe.collisionDetected?1:0)}if(Rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Rt.crossTileID]=new Sr(pe||Mt,ye||bt,Qt||d.justReloaded),s[Rt.crossTileID]=!0};if(St){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Rt=d.getSortedSymbolIndexes(this.transform.angle);for(let jt=Rt.length-1;jt>=0;--jt){const pe=Rt[jt];Vt(d.symbolInstances.get(pe),d.collisionArrays[pe])}}else for(let Rt=e.symbolInstanceStart;Rt<e.symbolInstanceEnd;Rt++)Vt(d.symbolInstances.get(Rt),d.collisionArrays[Rt]);if(a&&d.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[d.bucketInstanceId];h.invert(Rt.invProjMatrix,y),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(e,s,a,d){let f;f=d===h.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(s)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const T of y)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=f>=0&&T!==f?0:a.crossTileID)}markUsedOrientation(e,s,a){const d=s===h.WritingMode.horizontal||s===h.WritingMode.horizontalOnly?s:0,f=s===h.WritingMode.vertical?s:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const T of y)e.text.placedSymbolArray.get(T).placedOrientation=d;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let a=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(e):1,f=s?s.opacities:{},y=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const I in this.placements){const P=this.placements[I],z=f[I];z?(this.opacities[I]=new Ue(z,d,P.text,P.icon),a=a||P.text!==z.text.placed||P.icon!==z.icon.placed):(this.opacities[I]=new Ue(null,d,P.text,P.icon,P.skipFade),a=a||P.text||P.icon)}for(const I in f){const P=f[I];if(!this.opacities[I]){const z=new Ue(P,d,!1,!1);z.isHidden()||(this.opacities[I]=z,a=a||P.text.placed||P.icon.placed)}}for(const I in y)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=y[I]);for(const I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const a={};for(const d of s){const f=d.getBucket(e);f&&d.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,a,d.collisionBoxArray)}}updateBucketOpacities(e,s,a){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0].layout,f=new Ue(null,0,!1,!1,!0),y=d.get("text-allow-overlap"),T=d.get("icon-allow-overlap"),I=d.get("text-variable-anchor"),P=d.get("text-rotation-alignment")==="map",z=d.get("text-pitch-alignment")==="map",O=d.get("icon-text-fit")!=="none",Z=new Ue(null,0,y&&(T||!e.hasIconData()||d.get("icon-optional")),T&&(y||!e.hasTextData()||d.get("text-optional")),!0);!e.collisionArrays&&a&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(a);const H=(j,W,rt)=>{for(let ht=0;ht<W/4;ht++)j.opacityVertexArray.emplaceBack(rt)};for(let j=0;j<e.symbolInstances.length;j++){const W=e.symbolInstances.get(j),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:ht,crossTileID:dt}=W;let X=this.opacities[dt];s[dt]?X=f:X||(X=Z,this.opacities[dt]=X),s[dt]=!0;const _t=W.numIconVertices>0,pt=this.placedOrientations[W.crossTileID],Tt=pt===h.WritingMode.vertical,St=pt===h.WritingMode.horizontal||pt===h.WritingMode.horizontalOnly;if(rt>0||ht>0){const Mt=at(X.text);H(e.text,rt,Tt?xt:Mt),H(e.text,ht,St?xt:Mt);const bt=X.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(jt=>{jt>=0&&(e.text.placedSymbolArray.get(jt).hidden=bt||Tt?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=bt||St?1:0);const Vt=this.variableOffsets[W.crossTileID];Vt&&this.markUsedJustification(e,Vt.anchor,W,pt);const Rt=this.placedOrientations[W.crossTileID];Rt&&(this.markUsedJustification(e,"left",W,Rt),this.markUsedOrientation(e,Rt,W))}if(_t){const Mt=at(X.icon),bt=!(O&&W.verticalPlacedIconSymbolIndex&&Tt);W.placedIconSymbolIndex>=0&&(H(e.icon,W.numIconVertices,bt?Mt:xt),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=X.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,W.numVerticalIconVertices,bt?xt:Mt),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=X.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Mt=e.collisionArrays[j];if(Mt){let bt=new h.pointGeometry(0,0);if(Mt.textBox||Mt.verticalTextBox){let Rt=!0;if(I){const jt=this.variableOffsets[dt];jt?(bt=fs(jt.anchor,jt.width,jt.height,jt.textOffset,jt.textBoxScale),P&&bt._rotate(z?this.transform.angle:-this.transform.angle)):Rt=!1}Mt.textBox&&C(e.textCollisionBox.collisionVertexArray,X.text.placed,!Rt||Tt,bt.x,bt.y),Mt.verticalTextBox&&C(e.textCollisionBox.collisionVertexArray,X.text.placed,!Rt||St,bt.x,bt.y)}const Vt=Boolean(!St&&Mt.verticalIconBox);Mt.iconBox&&C(e.iconCollisionBox.collisionVertexArray,X.icon.placed,Vt,O?bt.x:0,O?bt.y:0),Mt.verticalIconBox&&C(e.iconCollisionBox.collisionVertexArray,X.icon.placed,!Vt,O?bt.x:0,O?bt.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=j.invProjMatrix,e.placementViewportMatrix=j.viewportMatrix,e.collisionCircleArray=j.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const a=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function C(c,e,s,a,d){c.emplaceBack(e?1:0,s?1:0,a||0,d||0),c.emplaceBack(e?1:0,s?1:0,a||0,d||0),c.emplaceBack(e?1:0,s?1:0,a||0,d||0),c.emplaceBack(e?1:0,s?1:0,a||0,d||0)}const B=Math.pow(2,25),q=Math.pow(2,24),$=Math.pow(2,17),Q=Math.pow(2,16),st=Math.pow(2,9),nt=Math.pow(2,8),tt=Math.pow(2,1);function at(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const e=c.placed?1:0,s=Math.floor(127*c.opacity);return s*B+e*q+s*$+e*Q+s*st+e*nt+s*tt+e}const xt=0;class At{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,a,d,f){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(y,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<y.length;)if(s.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,f())return!0;return!1}}class vt{constructor(e,s,a,d,f,y,T,I){this.placement=new N(e,s,y,T,I),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,s,a){const d=h.exported.now(),f=()=>{const y=h.exported.now()-d;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=s[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=T)&&(!y.maxzoom||y.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new At(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ht=512/h.EXTENT/2;class Xt{constructor(e,s,a){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let d=0;d<s.length;d++){const f=s.get(d),y=f.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,e)})}}getScaledCoordinates(e,s){const a=Ht/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*h.EXTENT+e.anchorX)*a),y:Math.floor((s.canonical.y*h.EXTENT+e.anchorY)*a)}}findMatches(e,s,a){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<e.length;f++){const y=e.get(f);if(y.crossTileID)continue;const T=this.indexedSymbolInstances[y.key];if(!T)continue;const I=this.getScaledCoordinates(y,s);for(const P of T)if(Math.abs(P.coord.x-I.x)<=d&&Math.abs(P.coord.y-I.y)<=d&&!a[P.crossTileID]){a[P.crossTileID]=!0,y.crossTileID=P.crossTileID;break}}}}class Ft{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ie{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const a in this.indexes){const d=this.indexes[a],f={};for(const y in d){const T=d[y];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),f[T.tileID.key]=T}this.indexes[a]=f}this.lng=e}addBucket(e,s,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const y=this.indexes[f];if(Number(f)>e.overscaledZ)for(const T in y){const I=y[T];I.tileID.isChildOf(e)&&I.findMatches(s.symbolInstances,e,d)}else{const T=y[e.scaledTo(Number(f)).key];T&&T.findMatches(s.symbolInstances,e,d)}}for(let f=0;f<s.symbolInstances.length;f++){const y=s.symbolInstances.get(f);y.crossTileID||(y.crossTileID=a.generate(),d[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Xt(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const a in s.indexedSymbolInstances)for(const d of s.indexedSymbolInstances[a])delete this.usedCrossTileIDs[e][d.crossTileID]}removeStaleBuckets(e){let s=!1;for(const a in this.indexes){const d=this.indexes[a];for(const f in d)e[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,d[f]),delete d[f],s=!0)}return s}}class re{constructor(){this.layerIndexes={},this.crossTileIDs=new Ft,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,a){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new ie);let f=!1;const y={};d.handleWrapJump(a);for(const T of s){const I=T.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(T.tileID,I,this.crossTileIDs)&&(f=!0),y[I.bucketInstanceId]=!0)}return d.removeStaleBuckets(y)&&(f=!0),f}pruneUnusedLayers(e){const s={};e.forEach(a=>{s[a]=!0});for(const a in this.layerIndexes)s[a]||delete this.layerIndexes[a]}}var Me=h.createLayout([{name:"a_pos",type:"Int16",components:2}]);class he extends h.Evented{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=e._cache.max,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const e in this._tiles){const s=this._tiles[e];s.textures.forEach(a=>a.destroy()),s.textures=[]}}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];for(const a of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(a.key),this._tiles[a.key]||(a.posMatrix=new Float64Array(16),h.ortho(a.posMatrix,0,h.EXTENT,0,h.EXTENT,0,1),this._tiles[a.key]=new De(a,this.tileSize))}removeOutdated(e){const s={};this.renderHistory=this.renderHistory.filter((a,d)=>this.renderHistory.indexOf(a)===d).slice(0,this.renderHistorySize);for(const a of this._renderableTilesKeys)s[a]=!0;for(const a of this.renderHistory)s[a]=!0;for(const a in this._tiles)s[a]||(this._tiles[a].clearTextures(e),delete this._tiles[a])}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const a of this._renderableTilesKeys){const d=this._tiles[a].tileID;if(d.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),h.ortho(f.posMatrix,0,h.EXTENT,0,h.EXTENT,0,1),s[a]=f}else if(d.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const y=d.canonical.z-e.canonical.z,T=d.canonical.x-(d.canonical.x>>y<<y),I=d.canonical.y-(d.canonical.y>>y<<y),P=h.EXTENT>>y;h.ortho(f.posMatrix,0,P,0,P,0,1),h.translate(f.posMatrix,f.posMatrix,[-T*P,-I*P,0]),s[a]=f}else if(e.canonical.isChildOf(d.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const y=e.canonical.z-d.canonical.z,T=e.canonical.x-(e.canonical.x>>y<<y),I=e.canonical.y-(e.canonical.y>>y<<y),P=h.EXTENT>>y;h.ortho(f.posMatrix,0,h.EXTENT,0,h.EXTENT,0,1),h.translate(f.posMatrix,f.posMatrix,[T*P,I*P,0]),h.scale(f.posMatrix,f.posMatrix,[1/2**y,1/2**y,0]),s[a]=f}}return s}getSourceTile(e,s){const a=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>a.maxzoom&&(d=a.maxzoom),d<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&s)for(;d>=a.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(d--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=e)}}class me{constructor(e,s,a){this.style=e,this.sourceCache=new he(s),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.elevationOffset=typeof a.elevationOffset=="number"?a.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(e,s,a,d=h.EXTENT){if(!(s>=0&&s<d&&a>=0&&a<d))return this.elevationOffset;let f=0;const y=this.getTerrainData(e);if(y.tile&&y.tile.dem){const T=h.transformMat4$1([],[s/d*h.EXTENT,a/d*h.EXTENT],y.u_terrain_matrix),I=[T[0]*y.tile.dem.dim,T[1]*y.tile.dem.dim],P=[Math.floor(I[0]),Math.floor(I[1])],z=y.tile.dem.get(P[0],P[1]),O=y.tile.dem.get(P[0],P[1]+1),Z=y.tile.dem.get(P[0]+1,P[1]),H=y.tile.dem.get(P[0]+1,P[1]+1);f=h.number(h.number(z,O,I[0]-P[0]),h.number(Z,H,I[0]-P[0]),I[1]-P[1])}return f}rememberForRerender(e,s){for(const a in this.sourceCache._tiles){const d=this.sourceCache._tiles[a];(d.tileID.equals(s)||d.tileID.isChildOf(s))&&(e===this.sourceCache.sourceCache.id&&(d.timeLoaded=Date.now()),this._rerender[e]=this._rerender[e]||{},this._rerender[e][d.tileID.key]=!0)}}needsRerender(e,s){return this._rerender[e]&&this._rerender[e][s.key]}clearRerenderCache(){this._rerender={}}getElevation(e,s,a,d=h.EXTENT){return(this.getDEMElevation(e,s,a,d)+this.elevationOffset)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.style.map.painter.context,f=new h.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ce(d,f,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ce(d,new h.RGBAImage({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.identity([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const d=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new ce(d,s.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),s.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const a=s&&s+s.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const d=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?f=e.canonical.z-d:h.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>f<<f),T=e.canonical.y-(e.canonical.y>>f<<f),I=h.fromScaling(new Float64Array(16),[1/(h.EXTENT<<f),1/(h.EXTENT<<f),0]);h.translate(I,I,[y*h.EXTENT,T*h.EXTENT,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const e=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=e.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(e){const s=this.style.map.painter,a=s.width/devicePixelRatio,d=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ce(s.context,{width:a,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ce(s.context,{width:a,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(a,d,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,a,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,y=0;f<this._coordsTextureSize;f++)for(let T=0;T<this._coordsTextureSize;T++,y+=4)s[y+0]=255&T,s[y+1]=255&f,s[y+2]=T>>8<<4|f>>8,s[y+3]=0;const a=new h.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),d=new ce(e,a,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){const s=new Uint8Array(4),a=this.style.map.painter,d=a.context,f=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(e.x,a.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,s),d.bindFramebuffer.set(null);const y=s[0]+(s[2]>>4<<8),T=s[1]+((15&s[2])<<8),I=this.coordsIndex[255-s[3]],P=I&&this.sourceCache.getTileByID(I);if(!P)return null;const z=this._coordsTextureSize,O=(1<<P.tileID.canonical.z)*z;return new h.MercatorCoordinate((P.tileID.canonical.x*z+y)/O,(P.tileID.canonical.y*z+T)/O,this.getElevation(P.tileID,y,T,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.style.map.painter.context,s=new h.PosArray,a=new h.TriangleIndexArray,d=this.meshSize,f=h.EXTENT/d,y=d*d;for(let T=0;T<=d;T++)for(let I=0;I<=d;I++)s.emplaceBack(I*f,T*f);for(let T=0;T<y;T+=d+1)for(let I=0;I<d;I++)a.emplaceBack(I+T,d+I+T+1,d+I+T+2),a.emplaceBack(I+T,d+I+T+2,I+T+1);return this._mesh={indexBuffer:e.createIndexBuffer(a),vertexBuffer:e.createVertexBuffer(s,Me.members),segments:h.SegmentVector.simpleSegment(0,0,s.length,a.length)},this._mesh}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return s&&s.dem&&(a.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,a.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),a}}const we=(c,e)=>h.emitValidationErrors(c,e&&e.filter(s=>s.identifier!=="source.canvas")),Be=h.pick(Ae,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),vi=h.pick(Ae,["setCenter","setZoom","setBearing","setPitch"]),Ke=function(){const c={},e=h.spec.$version;for(const s in h.spec.$root){const a=h.spec.$root[s];if(a.required){let d=null;d=s==="version"?e:a.type==="array"?[]:{},d!=null&&(c[s]=d)}}return c}();class fi extends h.Evented{constructor(e,s={}){super(),this.map=e,this.dispatcher=new On(Zr(),this),this.imageManager=new Fr,this.imageManager.setEventedParent(this),this.glyphManager=new ni(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new cs(256,512),this.crossTileSymbolIndex=new re,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const a=this;this._rtlTextPluginCallback=fi.registerForPluginStateChange(d=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(f,y)=>{if(h.triggerPluginCompletionEvent(f),y&&y.every(T=>T))for(const T in a.sourceCaches)a.sourceCaches[T].reload()})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const f=this.sourceCaches[d.sourceId];if(!f)return;const y=f.getSource();if(y&&y.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===y.id&&this._validateLayer(I)}})}loadURL(e,s={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const a=typeof s.validate!="boolean"||s.validate,d=this.map._requestManager.transformRequest(e,h.ResourceType.Style);this._request=h.getJSON(d,(f,y)=>{this._request=null,f?this.fire(new h.ErrorEvent(f)):y&&this._load(y,a)})}loadJSON(e,s={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(e,s.validate!==!1)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(Ke,!1)}_load(e,s){if(s&&we(this,h.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const d in e.sources)this.addSource(d,e.sources[d],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);const a=xr(this.stylesheet.layers);this._order=a.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of a)d=h.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new rn(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(s,a,d,f){let y,T,I;const P=d>1?"@2x":"";let z=h.getJSON(a.transformRequest(a.normalizeSpriteURL(s,P,".json"),h.ResourceType.SpriteJSON),(H,j)=>{z=null,I||(I=H,y=j,Z())}),O=h.getImage(a.transformRequest(a.normalizeSpriteURL(s,P,".png"),h.ResourceType.SpriteImage),(H,j)=>{O=null,I||(I=H,T=j,Z())});function Z(){if(I)f(I);else if(y&&T){const H=h.exported.getImageData(T),j={};for(const W in y){const{width:rt,height:ht,x:dt,y:X,sdf:_t,pixelRatio:pt,stretchX:Tt,stretchY:St,content:Mt}=y[W],bt=new h.RGBAImage({width:rt,height:ht});h.RGBAImage.copy(H,bt,{x:dt,y:X},{x:0,y:0},{width:rt,height:ht}),j[W]={data:bt,pixelRatio:pt,sdf:_t,stretchX:Tt,stretchY:St,content:Mt}}f(null,j)}}return{cancel(){z&&(z.cancel(),z=null),O&&(O.cancel(),O=null)}}}(e,this.map._requestManager,this.map.getPixelRatio(),(s,a)=>{if(this._spriteRequest=null,s)this.fire(new h.ErrorEvent(s));else if(a)for(const d in a)this.imageManager.addImage(d,a[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const a=e.sourceLayer;if(!a)return;const d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(a)===-1)&&this.fire(new h.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const s=[];for(const a of e){const d=this._layers[a];d.type!=="custom"&&s.push(d.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const y in this._updatedSources){const T=this._updatedSources[y];if(T==="reload")this._reloadSource(y);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(y)}}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const a={};for(const d in this.sourceCaches){const f=this.sourceCaches[d];a[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const d in a){const f=this.sourceCaches[d];a[d]!==f.used&&f.fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,s&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(e){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),e){const s=this.sourceCaches[e.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);this.terrain=new me(this,s,e),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=a=>{a.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=a=>{a.tile&&(a.sourceId===e.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(a.sourceId,a.tile.tileID)):a.source.type==="geojson"&&this.terrain.rememberForRerender(a.sourceId,a.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new h.Event("terrain",{terrain:e}))}setState(e){if(this._checkLoaded(),we(this,h.validateStyle(e)))return!1;(e=h.clone$1(e)).layers=xr(e.layers);const s=function(d,f){if(!d)return[{command:Ae.setStyle,args:[f]}];let y=[];try{if(!Gt(d.version,f.version))return[{command:Ae.setStyle,args:[f]}];Gt(d.center,f.center)||y.push({command:Ae.setCenter,args:[f.center]}),Gt(d.zoom,f.zoom)||y.push({command:Ae.setZoom,args:[f.zoom]}),Gt(d.bearing,f.bearing)||y.push({command:Ae.setBearing,args:[f.bearing]}),Gt(d.pitch,f.pitch)||y.push({command:Ae.setPitch,args:[f.pitch]}),Gt(d.sprite,f.sprite)||y.push({command:Ae.setSprite,args:[f.sprite]}),Gt(d.glyphs,f.glyphs)||y.push({command:Ae.setGlyphs,args:[f.glyphs]}),Gt(d.transition,f.transition)||y.push({command:Ae.setTransition,args:[f.transition]}),Gt(d.light,f.light)||y.push({command:Ae.setLight,args:[f.light]});const T={},I=[];(function(z,O,Z,H){let j;for(j in O=O||{},z=z||{})Object.prototype.hasOwnProperty.call(z,j)&&(Object.prototype.hasOwnProperty.call(O,j)||Fn(j,Z,H));for(j in O)Object.prototype.hasOwnProperty.call(O,j)&&(Object.prototype.hasOwnProperty.call(z,j)?Gt(z[j],O[j])||(z[j].type==="geojson"&&O[j].type==="geojson"&&ds(z,O,j)?Z.push({command:Ae.setGeoJSONSourceData,args:[j,O[j].data]}):er(j,O,Z,H)):En(j,O,Z))})(d.sources,f.sources,I,T);const P=[];d.layers&&d.layers.forEach(z=>{T[z.source]?y.push({command:Ae.removeLayer,args:[z.id]}):P.push(z)}),y=y.concat(I),function(z,O,Z){O=O||[];const H=(z=z||[]).map(nr),j=O.map(nr),W=z.reduce(br,{}),rt=O.reduce(br,{}),ht=H.slice(),dt=Object.create(null);let X,_t,pt,Tt,St,Mt,bt;for(X=0,_t=0;X<H.length;X++)pt=H[X],Object.prototype.hasOwnProperty.call(rt,pt)?_t++:(Z.push({command:Ae.removeLayer,args:[pt]}),ht.splice(ht.indexOf(pt,_t),1));for(X=0,_t=0;X<j.length;X++)pt=j[j.length-1-X],ht[ht.length-1-X]!==pt&&(Object.prototype.hasOwnProperty.call(W,pt)?(Z.push({command:Ae.removeLayer,args:[pt]}),ht.splice(ht.lastIndexOf(pt,ht.length-_t),1)):_t++,Mt=ht[ht.length-X],Z.push({command:Ae.addLayer,args:[rt[pt],Mt]}),ht.splice(ht.length-X,0,pt),dt[pt]=!0);for(X=0;X<j.length;X++)if(pt=j[X],Tt=W[pt],St=rt[pt],!dt[pt]&&!Gt(Tt,St))if(Gt(Tt.source,St.source)&&Gt(Tt["source-layer"],St["source-layer"])&&Gt(Tt.type,St.type)){for(bt in ir(Tt.layout,St.layout,Z,pt,null,Ae.setLayoutProperty),ir(Tt.paint,St.paint,Z,pt,null,Ae.setPaintProperty),Gt(Tt.filter,St.filter)||Z.push({command:Ae.setFilter,args:[pt,St.filter]}),Gt(Tt.minzoom,St.minzoom)&&Gt(Tt.maxzoom,St.maxzoom)||Z.push({command:Ae.setLayerZoomRange,args:[pt,St.minzoom,St.maxzoom]}),Tt)Object.prototype.hasOwnProperty.call(Tt,bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&(bt.indexOf("paint.")===0?ir(Tt[bt],St[bt],Z,pt,bt.slice(6),Ae.setPaintProperty):Gt(Tt[bt],St[bt])||Z.push({command:Ae.setLayerProperty,args:[pt,bt,St[bt]]}));for(bt in St)Object.prototype.hasOwnProperty.call(St,bt)&&!Object.prototype.hasOwnProperty.call(Tt,bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&(bt.indexOf("paint.")===0?ir(Tt[bt],St[bt],Z,pt,bt.slice(6),Ae.setPaintProperty):Gt(Tt[bt],St[bt])||Z.push({command:Ae.setLayerProperty,args:[pt,bt,St[bt]]}))}else Z.push({command:Ae.removeLayer,args:[pt]}),Mt=ht[ht.lastIndexOf(pt)+1],Z.push({command:Ae.addLayer,args:[St,Mt]})}(P,f.layers,y)}catch(T){console.warn("Unable to compute style diff:",T),y=[{command:Ae.setStyle,args:[f]}]}return y}(this.serialize(),e).filter(d=>!(d.command in vi));if(s.length===0)return!1;const a=s.filter(d=>!(d.command in Be));if(a.length>0)throw new Error(`Unimplemented: ${a.map(d=>d.command).join(", ")}.`);return s.forEach(d=>{d.command!=="setTransition"&&this[d.command].apply(this,d.args)}),this.stylesheet=e,!0}addImage(e,s){if(this.getImage(e))return this.fire(new h.ErrorEvent(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.ErrorEvent(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.validateStyle.source,`sources.${e}`,s,null,a))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=this.sourceCaches[e]=new Zi(e,s,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new h.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,a={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new h.ErrorEvent(new Error(`Layer "${d}" already exists on this map.`)));let f;if(e.type==="custom"){if(we(this,h.validateCustomStyleLayer(e)))return;f=h.createStyleLayer(e)}else{if(typeof e.source=="object"&&(this.addSource(d,e.source),e=h.clone$1(e),e=h.extend(e,{source:d})),this._validate(h.validateStyle.layer,`layers.${d}`,e,{arrayIndex:-1},a))return;f=h.createStyleLayer(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[f.id]=f.serialize()}const y=s?this._order.indexOf(s):this._order.length;if(s&&y===-1)this.fire(new h.ErrorEvent(new Error(`Cannot add layer "${d}" before non-existing layer "${s}".`)));else{if(this._order.splice(y,0,d),this._layerOrderChanged=!0,this._layers[d]=f,this._removedLayers[d]&&f.source&&f.type!=="custom"){const T=this._removedLayers[d];delete this._removedLayers[d],T.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const a=this._order.indexOf(e);this._order.splice(a,1);const d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new h.ErrorEvent(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new h.ErrorEvent(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,a){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===s&&d.maxzoom===a||(s!=null&&(d.minzoom=s),a!=null&&(d.maxzoom=a),this._updateLayer(d)):this.fire(new h.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,a={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!Gt(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(h.validateStyle.filter,`layers.${d.id}.filter`,s,null,a)||(d.filter=h.clone$1(s),this._updateLayer(d)))}else this.fire(new h.ErrorEvent(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,s,a,d={}){this._checkLoaded();const f=this.getLayer(e);f?Gt(f.getLayoutProperty(s),a)||(f.setLayoutProperty(s,a,d),this._updateLayer(f)):this.fire(new h.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const a=this.getLayer(e);if(a)return a.getLayoutProperty(s);this.fire(new h.ErrorEvent(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,a,d={}){this._checkLoaded();const f=this.getLayer(e);f?Gt(f.getPaintProperty(s),a)||(f.setPaintProperty(s,a,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new h.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const a=e.source,d=e.sourceLayer,f=this.sourceCaches[a];if(f===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const y=f.getSource().type;y==="geojson"&&d?this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||d?(e.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),f.setFeatureState(d,e.id,s)):this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const a=e.source,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const f=d.getSource().type,y=f==="vector"?e.sourceLayer:void 0;f!=="vector"||y?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(y,e.id,s):this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,a=e.sourceLayer,d=this.sourceCaches[s];if(d!==void 0)return d.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),d.getFeatureState(a,e.id)):void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:h.mapObject(this.sourceCaches,e=>e.serialize()),layers:this._serializeLayers(this._order)},e=>e!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=y=>this._layers[y].type==="fill-extrusion",a={},d=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T)){a[T]=y;for(const I of e){const P=I[T];if(P)for(const z of P)d.push(z)}}}d.sort((y,T)=>T.intersectionZ-y.intersectionZ);const f=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T))for(let I=d.length-1;I>=0;I--){const P=d[I].feature;if(a[P.layer.id]<y)break;f.push(P),d.pop()}else for(const I of e){const P=I[T];if(P)for(const z of P)f.push(z.feature)}}return f}queryRenderedFeatures(e,s,a){s&&s.filter&&this._validate(h.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const y of s.layers){const T=this._layers[y];if(!T)return this.fire(new h.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];d[T.source]=!0}}const f=[];s.availableImages=this._availableImages;for(const y in this.sourceCaches)s.layers&&!d[y]||f.push(ri(this.sourceCaches[y],this._layers,this._serializedLayers,e,s,a));return this.placement&&f.push(function(y,T,I,P,z,O,Z){const H={},j=O.queryRenderedSymbols(P),W=[];for(const rt of Object.keys(j).map(Number))W.push(Z[rt]);W.sort(Ie);for(const rt of W){const ht=rt.featureIndex.lookupSymbolFeatures(j[rt.bucketInstanceId],T,rt.bucketIndex,rt.sourceLayerIndex,z.filter,z.layers,z.availableImages,y);for(const dt in ht){const X=H[dt]=H[dt]||[],_t=ht[dt];_t.sort((pt,Tt)=>{const St=rt.featureSortOrder;if(St){const Mt=St.indexOf(pt.featureIndex);return St.indexOf(Tt.featureIndex)-Mt}return Tt.featureIndex-pt.featureIndex});for(const pt of _t)X.push(pt)}}for(const rt in H)H[rt].forEach(ht=>{const dt=ht.feature,X=I[y[rt].source].getFeatureState(dt.layer["source-layer"],dt.id);dt.source=dt.layer.source,dt.layer["source-layer"]&&(dt.sourceLayer=dt.layer["source-layer"]),dt.state=X});return H}(this._layers,this._serializedLayers,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,s){s&&s.filter&&this._validate(h.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const a=this.sourceCaches[e];return a?function(d,f){const y=d.getRenderableIds().map(P=>d.getTileByID(P)),T=[],I={};for(let P=0;P<y.length;P++){const z=y[P],O=z.tileID.canonical.key;I[O]||(I[O]=!0,z.querySourceFeatures(T,f))}return T}(a,s):[]}addSourceType(e,s,a){return fi.getSourceType(e)?a(new Error(`A source type called "${e}" already exists.`)):(fi.setSourceType(e,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:s.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const a=this.light.getLight();let d=!1;for(const y in e)if(!Gt(e[y],a[y])){d=!0;break}if(!d)return;const f={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(f)}_validate(e,s,a,d,f={}){return(!f||f.validate!==!1)&&we(this,e.call(h.validateStyle,h.extend({key:s,style:this.serialize(),value:a,styleSpec:h.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const s=this.sourceCaches[e];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,a,d,f=!1){let y=!1,T=!1;const I={};for(const P of this._order){const z=this._layers[P];if(z.type!=="symbol")continue;if(!I[z.source]){const Z=this.sourceCaches[z.source];I[z.source]=Z.getRenderableIds(!0).map(H=>Z.getTileByID(H)).sort((H,j)=>j.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(j.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(z,I[z.source],e.center.lng);y=y||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),e.zoom))&&(this.pauseablePlacement=new vt(e,this.terrain,this._order,f,s,a,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),T=!0),y&&this.pauseablePlacement.placement.setStale()),T||y)for(const P of this._order){const z=this._layers[P];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s,a){this.imageManager.getImages(s.icons,a),this._updateTilesForChangedImages();const d=this.sourceCaches[s.source];d&&d.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(e,s,a){this.glyphManager.getGlyphs(s.stacks,a)}getResource(e,s,a){return h.makeRequest(s,a)}}fi.getSourceType=function(c){return gi[c]},fi.setSourceType=function(c,e){gi[c]=e},fi.registerForPluginStateChange=h.registerForPluginStateChange;var Ee="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const je={prelude:Oe(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Oe(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Oe(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Oe(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Oe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Oe(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Oe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Oe("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Oe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Oe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Oe(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Oe(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Oe(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Oe(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Oe(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Oe(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Oe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Oe(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Oe(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Oe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Oe(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Oe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Oe(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Oe(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Oe(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Oe(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Oe("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ee),terrainDepth:Oe("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ee),terrainCoords:Oe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ee)};function Oe(c,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),d=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=f?f.concat(d):d,T={};return{fragmentSource:c=c.replace(s,(I,P,z,O,Z)=>(T[Z]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${z} ${O} ${Z};
#else
uniform ${z} ${O} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${z} ${O} ${Z} = u_${Z};
#endif
`)),vertexSource:e=e.replace(s,(I,P,z,O,Z)=>{const H=O==="float"?"vec2":"vec4",j=Z.match(/color/)?"color":H;return T[Z]?P==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${z} ${H} a_${Z};
varying ${z} ${O} ${Z};
#else
uniform ${z} ${O} u_${Z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${j}(a_${Z}, u_${Z}_t);
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${z} ${H} a_${Z};
#else
uniform ${z} ${O} u_${Z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${z} ${O} ${Z} = a_${Z};
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${z} ${O} ${Z} = unpack_mix_${j}(a_${Z}, u_${Z}_t);
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`}),staticAttributes:a,staticUniforms:y}}class Ir{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,a,d,f,y,T,I,P){this.context=e;let z=this.boundPaintVertexBuffers.length!==d.length;for(let O=0;!z&&O<d.length;O++)this.boundPaintVertexBuffers[O]!==d[O]&&(z=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===a&&!z&&this.boundIndexBuffer===f&&this.boundVertexOffset===y&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===P?(e.bindVertexArrayOES.set(this.vao),T&&T.bind(),f&&f.dynamicDraw&&f.bind(),I&&I.bind(),P&&P.bind()):this.freshBind(s,a,d,f,y,T,I,P)}freshBind(e,s,a,d,f,y,T,I){let P;const z=e.numAttributes,O=this.context,Z=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=I;else{P=O.currentNumAttributes||0;for(let H=z;H<P;H++)Z.disableVertexAttribArray(H)}s.enableAttributes(Z,e);for(const H of a)H.enableAttributes(Z,e);y&&y.enableAttributes(Z,e),T&&T.enableAttributes(Z,e),I&&I.enableAttributes(Z,e),s.bind(),s.setVertexAttribPointers(Z,e,f);for(const H of a)H.bind(),H.setVertexAttribPointers(Z,e,f);y&&(y.bind(),y.setVertexAttribPointers(Z,e,f)),d&&d.bind(),T&&(T.bind(),T.setVertexAttribPointers(Z,e,f)),I&&(I.bind(),I.setVertexAttribPointers(Z,e,f)),O.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Er(c){const e=[];for(let s=0;s<c.length;s++){if(c[s]===null)continue;const a=c[s].split(" ");e.push(a.pop())}return e}class so{constructor(e,s,a,d,f,y,T){const I=e.gl;this.program=I.createProgram();const P=Er(a.staticAttributes),z=d?d.getBinderAttributes():[],O=P.concat(z),Z=je.prelude.staticUniforms?Er(je.prelude.staticUniforms):[],H=a.staticUniforms?Er(a.staticUniforms):[],j=d?d.getBinderUniforms():[],W=Z.concat(H).concat(j),rt=[];for(const St of W)rt.indexOf(St)<0&&rt.push(St);const ht=d?d.defines():[];y&&ht.push("#define OVERDRAW_INSPECTOR;"),T&&ht.push("#define TERRAIN3D;");const dt=ht.concat(je.prelude.fragmentSource,a.fragmentSource).join(`
`),X=ht.concat(je.prelude.vertexSource,a.vertexSource).join(`
`),_t=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(_t,dt),I.compileShader(_t),I.attachShader(this.program,_t);const pt=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(pt,X),I.compileShader(pt),I.attachShader(this.program,pt),this.attributes={};const Tt={};this.numAttributes=O.length;for(let St=0;St<this.numAttributes;St++)O[St]&&(I.bindAttribLocation(this.program,St,O[St]),this.attributes[O[St]]=St);I.linkProgram(this.program),I.deleteShader(pt),I.deleteShader(_t);for(let St=0;St<rt.length;St++){const Mt=rt[St];if(Mt&&!Tt[Mt]){const bt=I.getUniformLocation(this.program,Mt);bt&&(Tt[Mt]=bt)}}this.fixedUniforms=f(e,Tt),this.terrainUniforms=((St,Mt)=>({u_depth:new h.Uniform1i(St,Mt.u_depth),u_terrain:new h.Uniform1i(St,Mt.u_terrain),u_terrain_dim:new h.Uniform1f(St,Mt.u_terrain_dim),u_terrain_matrix:new h.UniformMatrix4f(St,Mt.u_terrain_matrix),u_terrain_unpack:new h.Uniform4f(St,Mt.u_terrain_unpack),u_terrain_offset:new h.Uniform1f(St,Mt.u_terrain_offset),u_terrain_exaggeration:new h.Uniform1f(St,Mt.u_terrain_exaggeration)}))(e,Tt),this.binderUniforms=d?d.getUniforms(e,Tt):[]}draw(e,s,a,d,f,y,T,I,P,z,O,Z,H,j,W,rt,ht,dt){const X=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(d),e.setColorMode(f),e.setCullFace(y),I){e.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,I.depthTexture),e.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,I.texture);for(const pt in this.terrainUniforms)this.terrainUniforms[pt].set(I[pt])}for(const pt in this.fixedUniforms)this.fixedUniforms[pt].set(T[pt]);W&&W.setUniforms(e,this.binderUniforms,H,{zoom:j});let _t=0;switch(s){case X.LINES:_t=2;break;case X.TRIANGLES:_t=3;break;case X.LINE_STRIP:_t=1}for(const pt of Z.get()){const Tt=pt.vaos||(pt.vaos={});(Tt[P]||(Tt[P]=new Ir)).bind(e,this,z,W?W.getPaintVertexBuffers():[],O,pt.vertexOffset,rt,ht,dt),X.drawElements(s,pt.primitiveLength*_t,X.UNSIGNED_SHORT,pt.primitiveOffset*_t*2)}}}function ge(c,e,s){const a=1/pi(s,1,e.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,e.transform.tileZoom)/d,y=f*(s.tileID.canonical.x+s.tileID.wrap*d),T=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[a,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[y>>16,T>>16],u_pixel_coord_lower:[65535&y,65535&T]}}const si=(c,e,s,a)=>{const d=e.style.light,f=d.properties.get("position"),y=[f.x,f.y,f.z],T=h.create$1();d.properties.get("anchor")==="viewport"&&h.fromRotation(T,-e.transform.angle),h.transformMat3(y,y,T);const I=d.properties.get("color");return{u_matrix:c,u_lightpos:y,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+s,u_opacity:a}},Do=(c,e,s,a,d,f,y)=>h.extend(si(c,e,s,a),ge(f,e,y),{u_height_factor:-Math.pow(2,d.overscaledZ)/y.tileSize/8}),qr=c=>({u_matrix:c}),Hi=(c,e,s,a)=>h.extend(qr(c),ge(s,e,a)),sa=(c,e)=>({u_matrix:c,u_world:e}),Ps=(c,e,s,a,d)=>h.extend(Hi(c,e,s,a),{u_world:d}),Pr=(c,e,s,a)=>{const d=c.transform;let f,y;if(a.paint.get("circle-pitch-alignment")==="map"){const T=pi(s,1,d.zoom);f=!0,y=[T,T]}else f=!1,y=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(e.posMatrix,s,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:c.pixelRatio,u_extrude_scale:y}},Je=(c,e,s)=>{const a=pi(s,1,e.zoom),d=Math.pow(2,e.zoom-s.tileID.overscaledZ),f=s.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[e.pixelsToGLUnits[0]/(a*d),e.pixelsToGLUnits[1]/(a*d)],u_overscale_factor:f}},Pn=(c,e,s=1)=>({u_matrix:c,u_color:e,u_overlay:0,u_overlay_scale:s}),Zn=c=>({u_matrix:c}),Ar=(c,e,s,a)=>({u_matrix:c,u_extrude_scale:pi(e,1,s),u_intensity:a});function ms(c,e){const s=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new h.MercatorCoordinate(0,a/s).toLngLat().lat,new h.MercatorCoordinate(0,(a+1)/s).toLngLat().lat]}const Vn=(c,e,s,a)=>{const d=c.transform;return{u_matrix:$r(c,e,s,a),u_ratio:1/pi(e,1,d.zoom),u_device_pixel_ratio:c.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},As=(c,e,s,a,d)=>h.extend(Vn(c,e,s,d),{u_image:0,u_image_height:a}),_s=(c,e,s,a,d)=>{const f=c.transform,y=We(e,f);return{u_matrix:$r(c,e,s,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/pi(e,1,f.zoom),u_device_pixel_ratio:c.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Cr=(c,e,s,a,d,f)=>{const y=c.lineAtlas,T=We(e,c.transform),I=s.layout.get("line-cap")==="round",P=y.getDash(a.from,I),z=y.getDash(a.to,I),O=P.width*d.fromScale,Z=z.width*d.toScale;return h.extend(Vn(c,e,s,f),{u_patternscale_a:[T/O,-P.height/2],u_patternscale_b:[T/Z,-z.height/2],u_sdfgamma:y.width/(256*Math.min(O,Z)*c.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:z.y,u_mix:d.t})};function We(c,e){return 1/pi(c,1,e.tileZoom)}function $r(c,e,s,a){return c.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Cs=(c,e,s,a,d)=>{return{u_matrix:c,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(y=d.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(f=d.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Bo(d.paint.get("raster-hue-rotate"))};var f,y};function Bo(c){c*=Math.PI/180;const e=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Ms=(c,e,s,a,d,f,y,T,I,P)=>{const z=d.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:z.width/z.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:y,u_coord_matrix:T,u_is_text:+I,u_pitch_with_map:+a,u_texsize:P,u_texture:0}},oo=(c,e,s,a,d,f,y,T,I,P,z)=>{const O=d.transform;return h.extend(Ms(c,e,s,a,d,f,y,T,I,P),{u_gamma_scale:a?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:d.pixelRatio,u_is_halo:+z})},_e=(c,e,s,a,d,f,y,T,I,P)=>h.extend(oo(c,e,s,a,d,f,y,T,!0,I,!0),{u_texsize_icon:P,u_texture_icon:1}),Gn=(c,e,s)=>({u_matrix:c,u_opacity:e,u_color:s}),Ye=(c,e,s,a,d,f)=>h.extend(function(y,T,I,P){const z=I.imageManager.getPattern(y.from.toString()),O=I.imageManager.getPattern(y.to.toString()),{width:Z,height:H}=I.imageManager.getPixelSize(),j=Math.pow(2,P.tileID.overscaledZ),W=P.tileSize*Math.pow(2,I.transform.tileZoom)/j,rt=W*(P.tileID.canonical.x+P.tileID.wrap*j),ht=W*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[Z,H],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/pi(P,1,I.transform.tileZoom),u_pixel_coord_upper:[rt>>16,ht>>16],u_pixel_coord_lower:[65535&rt,65535&ht]}}(a,f,s,d),{u_matrix:c,u_opacity:e}),ao={fillExtrusion:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_lightpos:new h.Uniform3f(c,e.u_lightpos),u_lightintensity:new h.Uniform1f(c,e.u_lightintensity),u_lightcolor:new h.Uniform3f(c,e.u_lightcolor),u_vertical_gradient:new h.Uniform1f(c,e.u_vertical_gradient),u_opacity:new h.Uniform1f(c,e.u_opacity)}),fillExtrusionPattern:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_lightpos:new h.Uniform3f(c,e.u_lightpos),u_lightintensity:new h.Uniform1f(c,e.u_lightintensity),u_lightcolor:new h.Uniform3f(c,e.u_lightcolor),u_vertical_gradient:new h.Uniform1f(c,e.u_vertical_gradient),u_height_factor:new h.Uniform1f(c,e.u_height_factor),u_image:new h.Uniform1i(c,e.u_image),u_texsize:new h.Uniform2f(c,e.u_texsize),u_pixel_coord_upper:new h.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(c,e.u_pixel_coord_lower),u_scale:new h.Uniform3f(c,e.u_scale),u_fade:new h.Uniform1f(c,e.u_fade),u_opacity:new h.Uniform1f(c,e.u_opacity)}),fill:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix)}),fillPattern:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_image:new h.Uniform1i(c,e.u_image),u_texsize:new h.Uniform2f(c,e.u_texsize),u_pixel_coord_upper:new h.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(c,e.u_pixel_coord_lower),u_scale:new h.Uniform3f(c,e.u_scale),u_fade:new h.Uniform1f(c,e.u_fade)}),fillOutline:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_world:new h.Uniform2f(c,e.u_world)}),fillOutlinePattern:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_world:new h.Uniform2f(c,e.u_world),u_image:new h.Uniform1i(c,e.u_image),u_texsize:new h.Uniform2f(c,e.u_texsize),u_pixel_coord_upper:new h.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(c,e.u_pixel_coord_lower),u_scale:new h.Uniform3f(c,e.u_scale),u_fade:new h.Uniform1f(c,e.u_fade)}),circle:(c,e)=>({u_camera_to_center_distance:new h.Uniform1f(c,e.u_camera_to_center_distance),u_scale_with_map:new h.Uniform1i(c,e.u_scale_with_map),u_pitch_with_map:new h.Uniform1i(c,e.u_pitch_with_map),u_extrude_scale:new h.Uniform2f(c,e.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(c,e.u_matrix)}),collisionBox:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_camera_to_center_distance:new h.Uniform1f(c,e.u_camera_to_center_distance),u_pixels_to_tile_units:new h.Uniform1f(c,e.u_pixels_to_tile_units),u_extrude_scale:new h.Uniform2f(c,e.u_extrude_scale),u_overscale_factor:new h.Uniform1f(c,e.u_overscale_factor)}),collisionCircle:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_inv_matrix:new h.UniformMatrix4f(c,e.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(c,e.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(c,e.u_viewport_size)}),debug:(c,e)=>({u_color:new h.UniformColor(c,e.u_color),u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_overlay:new h.Uniform1i(c,e.u_overlay),u_overlay_scale:new h.Uniform1f(c,e.u_overlay_scale)}),clippingMask:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix)}),heatmap:(c,e)=>({u_extrude_scale:new h.Uniform1f(c,e.u_extrude_scale),u_intensity:new h.Uniform1f(c,e.u_intensity),u_matrix:new h.UniformMatrix4f(c,e.u_matrix)}),heatmapTexture:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_world:new h.Uniform2f(c,e.u_world),u_image:new h.Uniform1i(c,e.u_image),u_color_ramp:new h.Uniform1i(c,e.u_color_ramp),u_opacity:new h.Uniform1f(c,e.u_opacity)}),hillshade:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_image:new h.Uniform1i(c,e.u_image),u_latrange:new h.Uniform2f(c,e.u_latrange),u_light:new h.Uniform2f(c,e.u_light),u_shadow:new h.UniformColor(c,e.u_shadow),u_highlight:new h.UniformColor(c,e.u_highlight),u_accent:new h.UniformColor(c,e.u_accent)}),hillshadePrepare:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_image:new h.Uniform1i(c,e.u_image),u_dimension:new h.Uniform2f(c,e.u_dimension),u_zoom:new h.Uniform1f(c,e.u_zoom),u_unpack:new h.Uniform4f(c,e.u_unpack)}),line:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_ratio:new h.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(c,e.u_units_to_pixels)}),lineGradient:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_ratio:new h.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(c,e.u_units_to_pixels),u_image:new h.Uniform1i(c,e.u_image),u_image_height:new h.Uniform1f(c,e.u_image_height)}),linePattern:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_texsize:new h.Uniform2f(c,e.u_texsize),u_ratio:new h.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_image:new h.Uniform1i(c,e.u_image),u_units_to_pixels:new h.Uniform2f(c,e.u_units_to_pixels),u_scale:new h.Uniform3f(c,e.u_scale),u_fade:new h.Uniform1f(c,e.u_fade)}),lineSDF:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_ratio:new h.Uniform1f(c,e.u_ratio),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(c,e.u_units_to_pixels),u_patternscale_a:new h.Uniform2f(c,e.u_patternscale_a),u_patternscale_b:new h.Uniform2f(c,e.u_patternscale_b),u_sdfgamma:new h.Uniform1f(c,e.u_sdfgamma),u_image:new h.Uniform1i(c,e.u_image),u_tex_y_a:new h.Uniform1f(c,e.u_tex_y_a),u_tex_y_b:new h.Uniform1f(c,e.u_tex_y_b),u_mix:new h.Uniform1f(c,e.u_mix)}),raster:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_tl_parent:new h.Uniform2f(c,e.u_tl_parent),u_scale_parent:new h.Uniform1f(c,e.u_scale_parent),u_buffer_scale:new h.Uniform1f(c,e.u_buffer_scale),u_fade_t:new h.Uniform1f(c,e.u_fade_t),u_opacity:new h.Uniform1f(c,e.u_opacity),u_image0:new h.Uniform1i(c,e.u_image0),u_image1:new h.Uniform1i(c,e.u_image1),u_brightness_low:new h.Uniform1f(c,e.u_brightness_low),u_brightness_high:new h.Uniform1f(c,e.u_brightness_high),u_saturation_factor:new h.Uniform1f(c,e.u_saturation_factor),u_contrast_factor:new h.Uniform1f(c,e.u_contrast_factor),u_spin_weights:new h.Uniform3f(c,e.u_spin_weights)}),symbolIcon:(c,e)=>({u_is_size_zoom_constant:new h.Uniform1i(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(c,e.u_is_size_feature_constant),u_size_t:new h.Uniform1f(c,e.u_size_t),u_size:new h.Uniform1f(c,e.u_size),u_camera_to_center_distance:new h.Uniform1f(c,e.u_camera_to_center_distance),u_pitch:new h.Uniform1f(c,e.u_pitch),u_rotate_symbol:new h.Uniform1i(c,e.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(c,e.u_aspect_ratio),u_fade_change:new h.Uniform1f(c,e.u_fade_change),u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(c,e.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(c,e.u_coord_matrix),u_is_text:new h.Uniform1i(c,e.u_is_text),u_pitch_with_map:new h.Uniform1i(c,e.u_pitch_with_map),u_texsize:new h.Uniform2f(c,e.u_texsize),u_texture:new h.Uniform1i(c,e.u_texture)}),symbolSDF:(c,e)=>({u_is_size_zoom_constant:new h.Uniform1i(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(c,e.u_is_size_feature_constant),u_size_t:new h.Uniform1f(c,e.u_size_t),u_size:new h.Uniform1f(c,e.u_size),u_camera_to_center_distance:new h.Uniform1f(c,e.u_camera_to_center_distance),u_pitch:new h.Uniform1f(c,e.u_pitch),u_rotate_symbol:new h.Uniform1i(c,e.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(c,e.u_aspect_ratio),u_fade_change:new h.Uniform1f(c,e.u_fade_change),u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(c,e.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(c,e.u_coord_matrix),u_is_text:new h.Uniform1i(c,e.u_is_text),u_pitch_with_map:new h.Uniform1i(c,e.u_pitch_with_map),u_texsize:new h.Uniform2f(c,e.u_texsize),u_texture:new h.Uniform1i(c,e.u_texture),u_gamma_scale:new h.Uniform1f(c,e.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(c,e.u_is_halo)}),symbolTextAndIcon:(c,e)=>({u_is_size_zoom_constant:new h.Uniform1i(c,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(c,e.u_is_size_feature_constant),u_size_t:new h.Uniform1f(c,e.u_size_t),u_size:new h.Uniform1f(c,e.u_size),u_camera_to_center_distance:new h.Uniform1f(c,e.u_camera_to_center_distance),u_pitch:new h.Uniform1f(c,e.u_pitch),u_rotate_symbol:new h.Uniform1i(c,e.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(c,e.u_aspect_ratio),u_fade_change:new h.Uniform1f(c,e.u_fade_change),u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(c,e.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(c,e.u_coord_matrix),u_is_text:new h.Uniform1i(c,e.u_is_text),u_pitch_with_map:new h.Uniform1i(c,e.u_pitch_with_map),u_texsize:new h.Uniform2f(c,e.u_texsize),u_texsize_icon:new h.Uniform2f(c,e.u_texsize_icon),u_texture:new h.Uniform1i(c,e.u_texture),u_texture_icon:new h.Uniform1i(c,e.u_texture_icon),u_gamma_scale:new h.Uniform1f(c,e.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(c,e.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(c,e.u_is_halo)}),background:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_opacity:new h.Uniform1f(c,e.u_opacity),u_color:new h.UniformColor(c,e.u_color)}),backgroundPattern:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_opacity:new h.Uniform1f(c,e.u_opacity),u_image:new h.Uniform1i(c,e.u_image),u_pattern_tl_a:new h.Uniform2f(c,e.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(c,e.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(c,e.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(c,e.u_pattern_br_b),u_texsize:new h.Uniform2f(c,e.u_texsize),u_mix:new h.Uniform1f(c,e.u_mix),u_pattern_size_a:new h.Uniform2f(c,e.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(c,e.u_pattern_size_b),u_scale_a:new h.Uniform1f(c,e.u_scale_a),u_scale_b:new h.Uniform1f(c,e.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(c,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(c,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(c,e.u_tile_units_to_pixels)}),terrain:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_texture:new h.Uniform1i(c,e.u_texture)}),terrainDepth:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix)}),terrainCoords:(c,e)=>({u_matrix:new h.UniformMatrix4f(c,e.u_matrix),u_texture:new h.Uniform1i(c,e.u_texture),u_terrain_coords_id:new h.Uniform1f(c,e.u_terrain_coords_id)})};class zs{constructor(e,s,a){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ks{constructor(e,s,a,d){this.length=s.length,this.attributes=a,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let a=0;a<this.attributes.length;a++){const d=s.attributes[this.attributes[a].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,s,a){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],y=s.attributes[f.name];y!==void 0&&e.vertexAttribPointer(y,f.components,e[Ls[f.type]],!1,this.itemSize,f.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lo extends xe{getDefault(){return h.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ds extends xe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class hi extends xe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class An extends xe{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ro extends xe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Xi extends xe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Oo extends xe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Bs extends xe{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class gs extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Fo extends xe{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ho extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Pe extends xe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Uo extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ln extends xe{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Mr extends xe{getDefault(){return h.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class No extends xe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class oa extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class zr extends xe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class za extends xe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class aa extends xe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class La extends xe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ka extends xe{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Zo extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Da extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class vn extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class co extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class uo extends xe{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class qn extends xe{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class jr extends xe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Vo extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class la extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class po extends xe{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class or extends po{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ha extends po{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Wr{constructor(e,s,a,d){this.context=e,this.width=s,this.height=a;const f=e.gl,y=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new or(e,y),d&&(this.depthAttachment=new ha(e,y)),f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class He{constructor(e,s,a){this.blendFunction=e,this.blendColor=s,this.mask=a}}He.Replace=[1,0],He.disabled=new He(He.Replace,h.Color.transparent,[!1,!1,!1,!1]),He.unblended=new He(He.Replace,h.Color.transparent,[!0,!0,!0,!0]),He.alphaBlended=new He([1,771],h.Color.transparent,[!0,!0,!0,!0]);class Rs{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new lo(this),this.clearDepth=new Ds(this),this.clearStencil=new hi(this),this.colorMask=new An(this),this.depthMask=new Ro(this),this.stencilMask=new Xi(this),this.stencilFunc=new Oo(this),this.stencilOp=new Bs(this),this.stencilTest=new gs(this),this.depthRange=new Fo(this),this.depthTest=new ho(this),this.depthFunc=new Pe(this),this.blend=new Uo(this),this.blendFunc=new ln(this),this.blendColor=new Mr(this),this.blendEquation=new No(this),this.cullFace=new oa(this),this.cullFaceSide=new zr(this),this.frontFace=new za(this),this.program=new aa(this),this.activeTexture=new La(this),this.viewport=new ka(this),this.bindFramebuffer=new Zo(this),this.bindRenderbuffer=new Da(this),this.bindTexture=new vn(this),this.bindVertexBuffer=new co(this),this.bindElementBuffer=new uo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qn(this),this.pixelStoreUnpack=new jr(this),this.pixelStoreUnpackPremultiplyAlpha=new Vo(this),this.pixelStoreUnpackFlipY=new la(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new zs(this,e,s)}createVertexBuffer(e,s,a){return new ks(this,e,s,a)}createRenderbuffer(e,s,a){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,e,s,a),this.bindRenderbuffer.set(null),f}createFramebuffer(e,s,a){return new Wr(this,e,s,a)}clear({color:e,depth:s}){const a=this.gl;let d=0;e&&(d|=a.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(d|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),a.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){Gt(e.blendFunction,He.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class de{constructor(e,s,a){this.func=e,this.mask=s,this.range=a}}de.ReadOnly=!1,de.ReadWrite=!0,de.disabled=new de(519,de.ReadOnly,[0,1]);const Re=7680;class Fe{constructor(e,s,a,d,f,y){this.test=e,this.ref=s,this.mask=a,this.fail=d,this.depthFail=f,this.pass=y}}Fe.disabled=new Fe({func:519,mask:0},0,0,Re,Re,Re);class ze{constructor(e,s,a){this.enable=e,this.mode=s,this.frontFace=a}}let ys;function Hr(c,e,s,a,d,f,y){const T=c.context,I=T.gl,P=c.useProgram("collisionBox"),z=[];let O=0,Z=0;for(let X=0;X<a.length;X++){const _t=a[X],pt=e.getTile(_t),Tt=pt.getBucket(s);if(!Tt)continue;let St=_t.posMatrix;d[0]===0&&d[1]===0||(St=c.translatePosMatrix(_t.posMatrix,pt,d,f));const Mt=y?Tt.textCollisionBox:Tt.iconCollisionBox,bt=Tt.collisionCircleArray;if(bt.length>0){const Vt=h.create(),Rt=St;h.mul(Vt,Tt.placementInvProjMatrix,c.transform.glCoordMatrix),h.mul(Vt,Vt,Tt.placementViewportMatrix),z.push({circleArray:bt,circleOffset:Z,transform:Rt,invTransform:Vt,coord:_t}),O+=bt.length/4,Z=O}Mt&&P.draw(T,I.LINES,de.disabled,Fe.disabled,c.colorModeForRenderPass(),ze.disabled,Je(St,c.transform,pt),c.style.terrain&&c.style.terrain.getTerrainData(_t),s.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,c.transform.zoom,null,null,Mt.collisionVertexBuffer)}if(!y||!z.length)return;const H=c.useProgram("collisionCircle"),j=new h.CollisionCircleLayoutArray;j.resize(4*O),j._trim();let W=0;for(const X of z)for(let _t=0;_t<X.circleArray.length/4;_t++){const pt=4*_t,Tt=X.circleArray[pt+0],St=X.circleArray[pt+1],Mt=X.circleArray[pt+2],bt=X.circleArray[pt+3];j.emplace(W++,Tt,St,Mt,bt,0),j.emplace(W++,Tt,St,Mt,bt,1),j.emplace(W++,Tt,St,Mt,bt,2),j.emplace(W++,Tt,St,Mt,bt,3)}(!ys||ys.length<2*O)&&(ys=function(X){const _t=2*X,pt=new h.QuadTriangleArray;pt.resize(_t),pt._trim();for(let Tt=0;Tt<_t;Tt++){const St=6*Tt;pt.uint16[St+0]=4*Tt+0,pt.uint16[St+1]=4*Tt+1,pt.uint16[St+2]=4*Tt+2,pt.uint16[St+3]=4*Tt+2,pt.uint16[St+4]=4*Tt+3,pt.uint16[St+5]=4*Tt+0}return pt}(O));const rt=T.createIndexBuffer(ys,!0),ht=T.createVertexBuffer(j,h.collisionCircleLayout.members,!0);for(const X of z){const _t={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(dt=c.transform).cameraToCenterDistance,u_viewport_size:[dt.width,dt.height]};H.draw(T,I.TRIANGLES,de.disabled,Fe.disabled,c.colorModeForRenderPass(),ze.disabled,_t,c.style.terrain&&c.style.terrain.getTerrainData(X.coord),s.id,ht,rt,h.SegmentVector.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,c.transform.zoom,null,null,null)}var dt;ht.destroy(),rt.destroy()}ze.disabled=new ze(!1,1029,2305),ze.backCCW=new ze(!0,1029,2305);const Ba=h.identity(new Float32Array(16));function ca(c,e,s,a,d,f){const{horizontalAlign:y,verticalAlign:T}=h.getAnchorAlignment(c),I=-(y-.5)*e,P=-(T-.5)*s,z=h.evaluateVariableOffset(c,a);return new h.pointGeometry((I/d+z[0])*f,(P/d+z[1])*f)}function Go(c,e,s,a,d,f,y,T,I,P,z){const O=c.text.placedSymbolArray,Z=c.text.dynamicLayoutVertexArray,H=c.icon.dynamicLayoutVertexArray,j={};Z.clear();for(let W=0;W<O.length;W++){const rt=O.get(W),ht=c.allowVerticalPlacement&&!rt.placedOrientation,dt=rt.hidden||!rt.crossTileID||ht?null:a[rt.crossTileID];if(dt){const X=new h.pointGeometry(rt.anchorX,rt.anchorY),_t=Ce(X,s?y:f,z),pt=an(d.cameraToCenterDistance,_t.signedDistanceFromCamera);let Tt=h.evaluateSizeForFeature(c.textSizeData,I,rt)*pt/h.ONE_EM;s&&(Tt*=c.tilePixelRatio/T);const{width:St,height:Mt,anchor:bt,textOffset:Vt,textBoxScale:Rt}=dt,jt=ca(bt,St,Mt,Vt,Rt,Tt),pe=s?Ce(X.add(jt),f,z).point:_t.point.add(e?jt.rotate(-d.angle):jt),ye=c.allowVerticalPlacement&&rt.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let Qt=0;Qt<rt.numGlyphs;Qt++)h.addDynamicAttributes(Z,pe,ye);P&&rt.associatedIconIndex>=0&&(j[rt.associatedIconIndex]={shiftedAnchor:pe,angle:ye})}else le(rt.numGlyphs,Z)}if(P){H.clear();const W=c.icon.placedSymbolArray;for(let rt=0;rt<W.length;rt++){const ht=W.get(rt);if(ht.hidden)le(ht.numGlyphs,H);else{const dt=j[rt];if(dt)for(let X=0;X<ht.numGlyphs;X++)h.addDynamicAttributes(H,dt.shiftedAnchor,dt.angle);else le(ht.numGlyphs,H)}}c.icon.dynamicLayoutVertexBuffer.updateData(H)}c.text.dynamicLayoutVertexBuffer.updateData(Z)}function Ra(c,e,s){return s.iconsInText&&e?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function vs(c,e,s,a,d,f,y,T,I,P,z,O){const Z=c.context,H=Z.gl,j=c.transform,W=T==="map",rt=I==="map",ht=T!=="viewport"&&s.layout.get("symbol-placement")!=="point",dt=W&&!rt&&!ht,X=!s.layout.get("symbol-sort-key").isConstant();let _t=!1;const pt=c.depthModeForSublayer(0,de.ReadOnly),Tt=s.layout.get("text-variable-anchor"),St=[];for(const Mt of a){const bt=e.getTile(Mt),Vt=bt.getBucket(s);if(!Vt)continue;const Rt=d?Vt.text:Vt.icon;if(!Rt||!Rt.segments.get().length)continue;const jt=Rt.programConfigurations.get(s.id),pe=d||Vt.sdfIcons,ye=d?Vt.textSizeData:Vt.iconSizeData,Qt=rt||j.pitch!==0,Ve=c.useProgram(Ra(pe,d,Vt),jt),Ge=h.evaluateSizeForZoom(ye,j.zoom),Le=c.style.terrain&&c.style.terrain.getTerrainData(Mt);let ke,qe,Di,kr,dr=[0,0],Dr=null;if(d){if(qe=bt.glyphAtlasTexture,Di=H.LINEAR,ke=bt.glyphAtlasTexture.size,Vt.iconsInText){dr=bt.imageAtlasTexture.size,Dr=bt.imageAtlasTexture;const Jn=ye.kind==="composite"||ye.kind==="camera";kr=Qt||c.options.rotating||c.options.zooming||Jn?H.LINEAR:H.NEAREST}}else{const Jn=s.layout.get("icon-size").constantOr(0)!==1||Vt.iconsNeedLinear;qe=bt.imageAtlasTexture,Di=pe||c.options.rotating||c.options.zooming||Jn||Qt?H.LINEAR:H.NEAREST,ke=bt.imageAtlasTexture.size}const Ts=pi(bt,1,c.transform.zoom),Kn=wr(Mt.posMatrix,rt,W,c.transform,Ts),wn=yn(Mt.posMatrix,rt,W,c.transform,Ts),ss=Tt&&Vt.hasTextData(),ga=s.layout.get("icon-text-fit")!=="none"&&ss&&Vt.hasIconData();if(ht){const Jn=c.style.terrain?(Ua,So)=>c.style.terrain.getElevation(Mt,Ua,So):null,Xs=s.layout.get("text-rotation-alignment")==="map";Wi(Vt,Mt.posMatrix,c,d,Kn,wn,rt,P,Xs,Jn)}const Ei=c.translatePosMatrix(Mt.posMatrix,bt,f,y),be=ht||d&&Tt||ga?Ba:Kn,Ne=c.translatePosMatrix(wn,bt,f,y,!0),Bi=pe&&s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ri;Ri=pe?Vt.iconsInText?_e(ye.kind,Ge,dt,rt,c,Ei,be,Ne,ke,dr):oo(ye.kind,Ge,dt,rt,c,Ei,be,Ne,d,ke,!0):Ms(ye.kind,Ge,dt,rt,c,Ei,be,Ne,d,ke);const oi={program:Ve,buffers:Rt,uniformValues:Ri,atlasTexture:qe,atlasTextureIcon:Dr,atlasInterpolation:Di,atlasInterpolationIcon:kr,isSDF:pe,hasHalo:Bi};if(X&&Vt.canOverlap){_t=!0;const Jn=Rt.segments.get();for(const Xs of Jn)St.push({segments:new h.SegmentVector([Xs]),sortKey:Xs.sortKey,state:oi,terrainData:Le})}else St.push({segments:Rt.segments,sortKey:0,state:oi,terrainData:Le})}_t&&St.sort((Mt,bt)=>Mt.sortKey-bt.sortKey);for(const Mt of St){const bt=Mt.state;if(Z.activeTexture.set(H.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,H.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(Z.activeTexture.set(H.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),bt.isSDF){const Vt=bt.uniformValues;bt.hasHalo&&(Vt.u_is_halo=1,Xr(bt.buffers,Mt.segments,s,c,bt.program,pt,z,O,Vt,Mt.terrainData)),Vt.u_is_halo=0}Xr(bt.buffers,Mt.segments,s,c,bt.program,pt,z,O,bt.uniformValues,Mt.terrainData)}}function Xr(c,e,s,a,d,f,y,T,I,P){const z=a.context;d.draw(z,z.gl.TRIANGLES,f,y,T,ze.disabled,I,P,s.id,c.layoutVertexBuffer,c.indexBuffer,e,s.paint,a.transform.zoom,c.programConfigurations.get(s.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Os(c,e,s,a,d,f,y){const T=c.context.gl,I=s.paint.get("fill-pattern"),P=I&&I.constantOr(1),z=s.getCrossfadeParameters();let O,Z,H,j,W;y?(Z=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=T.LINES):(Z=P?"fillPattern":"fill",O=T.TRIANGLES);for(const rt of a){const ht=e.getTile(rt);if(P&&!ht.patternsLoaded())continue;const dt=ht.getBucket(s);if(!dt)continue;const X=dt.programConfigurations.get(s.id),_t=c.useProgram(Z,X),pt=c.style.terrain&&c.style.terrain.getTerrainData(rt);P&&(c.context.activeTexture.set(T.TEXTURE0),ht.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),X.updatePaintBuffers(z));const Tt=I.constantOr(null);if(Tt&&ht.imageAtlas){const bt=ht.imageAtlas,Vt=bt.patternPositions[Tt.to.toString()],Rt=bt.patternPositions[Tt.from.toString()];Vt&&Rt&&X.setConstantPatternPositions(Vt,Rt)}const St=pt?rt:null,Mt=c.translatePosMatrix(St?St.posMatrix:rt.posMatrix,ht,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(y){j=dt.indexBuffer2,W=dt.segments2;const bt=[T.drawingBufferWidth,T.drawingBufferHeight];H=Z==="fillOutlinePattern"&&P?Ps(Mt,c,z,ht,bt):sa(Mt,bt)}else j=dt.indexBuffer,W=dt.segments,H=P?Hi(Mt,c,z,ht):qr(Mt);_t.draw(c.context,O,d,c.stencilModeForClipping(rt),f,ze.disabled,H,pt,s.id,dt.layoutVertexBuffer,j,W,s.paint,c.transform.zoom,X)}}function Fs(c,e,s,a,d,f,y){const T=c.context,I=T.gl,P=s.paint.get("fill-extrusion-pattern"),z=P.constantOr(1),O=s.getCrossfadeParameters(),Z=s.paint.get("fill-extrusion-opacity");for(const H of a){const j=e.getTile(H),W=j.getBucket(s);if(!W)continue;const rt=c.style.terrain&&c.style.terrain.getTerrainData(H),ht=W.programConfigurations.get(s.id),dt=c.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ht);z&&(c.context.activeTexture.set(I.TEXTURE0),j.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ht.updatePaintBuffers(O));const X=P.constantOr(null);if(X&&j.imageAtlas){const St=j.imageAtlas,Mt=St.patternPositions[X.to.toString()],bt=St.patternPositions[X.from.toString()];Mt&&bt&&ht.setConstantPatternPositions(Mt,bt)}const _t=c.translatePosMatrix(H.posMatrix,j,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pt=s.paint.get("fill-extrusion-vertical-gradient"),Tt=z?Do(_t,c,pt,Z,H,O,j):si(_t,c,pt,Z);dt.draw(T,T.gl.TRIANGLES,d,f,y,ze.backCCW,Tt,rt,s.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,s.paint,c.transform.zoom,ht,c.style.terrain&&W.centroidVertexBuffer)}}function fo(c,e,s,a,d,f,y){const T=c.context,I=T.gl,P=s.fbo;if(!P)return;const z=c.useProgram("hillshade"),O=c.style.terrain&&c.style.terrain.getTerrainData(e);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),z.draw(T,I.TRIANGLES,d,f,y,ze.disabled,((Z,H,j,W)=>{const rt=j.paint.get("hillshade-shadow-color"),ht=j.paint.get("hillshade-highlight-color"),dt=j.paint.get("hillshade-accent-color");let X=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=Z.transform.angle);const _t=!Z.options.moving;return{u_matrix:W?W.posMatrix:Z.transform.calculatePosMatrix(H.tileID.toUnwrapped(),_t),u_image:0,u_latrange:ms(0,H.tileID),u_light:[j.paint.get("hillshade-exaggeration"),X],u_shadow:rt,u_highlight:ht,u_accent:dt}})(c,s,a,O?e:null),O,a.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}function ua(c,e,s,a,d,f){const y=c.context,T=y.gl,I=e.dem;if(I&&I.data){const P=I.dim,z=I.stride,O=I.getPixels();if(y.activeTexture.set(T.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||c.getTileTexture(z),e.demTexture){const H=e.demTexture;H.update(O,{premultiply:!1}),H.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else e.demTexture=new ce(y,O,T.RGBA,{premultiply:!1}),e.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);y.activeTexture.set(T.TEXTURE0);let Z=e.fbo;if(!Z){const H=new ce(y,{width:P,height:P,data:null},T.RGBA);H.bind(T.LINEAR,T.CLAMP_TO_EDGE),Z=e.fbo=y.createFramebuffer(P,P,!0),Z.colorAttachment.set(H.texture)}y.bindFramebuffer.set(Z.framebuffer),y.viewport.set([0,0,P,P]),c.useProgram("hillshadePrepare").draw(y,T.TRIANGLES,a,d,f,ze.disabled,((H,j)=>{const W=j.stride,rt=h.create();return h.ortho(rt,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(rt,rt,[0,-h.EXTENT,0]),{u_matrix:rt,u_image:1,u_dimension:[W,W],u_zoom:H.overscaledZ,u_unpack:j.getUnpackVector()}})(e.tileID,I),null,s.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ki(c,e,s,a,d,f){const y=a.paint.get("raster-fade-duration");if(!f&&y>0){const T=h.exported.now(),I=(T-c.timeAdded)/y,P=e?(T-e.timeAdded)/y:-1,z=s.getSource(),O=d.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),Z=!e||Math.abs(e.tileID.overscaledZ-O)>Math.abs(c.tileID.overscaledZ-O),H=Z&&c.refreshedUponExpiration?1:h.clamp(Z?I:1-P,0,1);return c.refreshedUponExpiration&&I>=1&&(c.refreshedUponExpiration=!1),e?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const ar=new h.Color(1,0,0,1),Cn=new h.Color(0,1,0,1),$n=new h.Color(0,0,1,1),qo=new h.Color(1,0,1,1),Kr=new h.Color(0,1,1,1);function Jr(c,e,s,a){Yr(c,0,e+s/2,c.transform.width,s,a)}function lr(c,e,s,a){Yr(c,e-s/2,0,s,c.transform.height,a)}function Yr(c,e,s,a,d,f){const y=c.context,T=y.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*c.pixelRatio,s*c.pixelRatio,a*c.pixelRatio,d*c.pixelRatio),y.clear({color:f}),T.disable(T.SCISSOR_TEST)}function mo(c,e,s){const a=c.context,d=a.gl,f=s.posMatrix,y=c.useProgram("debug"),T=de.disabled,I=Fe.disabled,P=c.colorModeForRenderPass(),z="$debug",O=c.style.terrain&&c.style.terrain.getTerrainData(s);a.activeTexture.set(d.TEXTURE0),c.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE);const Z=e.getTileByID(s.key).latestRawTileData,H=Math.floor((Z&&Z.byteLength||0)/1024),j=e.getTile(s).tileSize,W=512/Math.min(j,512)*(s.overscaledZ/c.transform.zoom)*.5;let rt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(rt+=` => ${s.overscaledZ}`),function(ht,dt){ht.initDebugOverlayCanvas();const X=ht.debugOverlayCanvas,_t=ht.context.gl,pt=ht.debugOverlayCanvas.getContext("2d");pt.clearRect(0,0,X.width,X.height),pt.shadowColor="white",pt.shadowBlur=2,pt.lineWidth=1.5,pt.strokeStyle="white",pt.textBaseline="top",pt.font="bold 36px Open Sans, sans-serif",pt.fillText(dt,5,5),pt.strokeText(dt,5,5),ht.debugOverlayTexture.update(X),ht.debugOverlayTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE)}(c,`${rt} ${H}kB`),y.draw(a,d.TRIANGLES,T,I,He.alphaBlended,ze.disabled,Pn(f,h.Color.transparent,W),null,z,c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments),y.draw(a,d.LINE_STRIP,T,I,P,ze.disabled,Pn(f,h.Color.red),O,z,c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments)}function _o(c,e,s){const a=c.context,d=a.gl,f=c.colorModeForRenderPass(),y=new de(d.LEQUAL,de.ReadWrite,c.depthRangeFor3D),T=c.useProgram("terrain"),I=e.getTerrainMesh(),P=e.getTerrainData(s.tileID);a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]),a.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,e.getRTTFramebuffer().colorAttachment.get());const z=c.transform.calculatePosMatrix(s.tileID.toUnwrapped());T.draw(a,d.TRIANGLES,y,Fe.disabled,f,ze.backCCW,{u_matrix:z,u_texture:0},P,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function hr(c,e,s,a){const d=c.context,f=s.tileSize*e.qualityFactor;s.textures[a]||(s.textures[a]=c.getTileTexture(f)||new ce(d,{width:f,height:f,data:null},d.gl.RGBA),s.textures[a].bind(d.gl.LINEAR,d.gl.CLAMP_TO_EDGE),a===0&&e.sourceCache.renderHistory.unshift(s.tileID.key));const y=e.getRTTFramebuffer();y.colorAttachment.set(s.textures[a].texture),d.bindFramebuffer.set(y.framebuffer),d.viewport.set([0,0,f,f])}class Us{constructor(e){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=e,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=e.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const e=this.painter.style,s=e.terrain;for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const d=e.sourceCaches[a].getVisibleCoordinates();for(const f of d){const y=s.sourceCache.getTerrainCoords(f);for(const T in y)this._coordsDescendingInv[a][T]||(this._coordsDescendingInv[a][T]=[]),this._coordsDescendingInv[a][T].push(y[T])}}for(const a of e._order){const d=e._layers[a],f=d.source;if(this._renderToTexture[d.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const y in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][y]=this._coordsDescendingInv[f][y].map(T=>T.key).sort().join()}}return this._renderableTiles.forEach(a=>{for(const d in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[d][a.tileID.key];f&&f!==a.textureCoords[d]&&a.clearTextures(this.painter),s.needsRerender(d,a.tileID)&&a.clearTextures(this.painter)}this._rerender[a.tileID.key]=!a.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(e){const s=e.type,a=this.painter,d=a.style._order,f=a.currentLayer,y=f+1===d.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(d[f]),!y))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&y){this._prevType=s;const T=this._stacks.length-1,I=this._stacks[T]||[];for(const P of this._renderableTiles){if(hr(a,a.style.terrain,P,T),this._rerender[P.tileID.key]){a.context.clear({color:h.Color.transparent});for(let z=0;z<I.length;z++){const O=a.style._layers[I[z]],Z=O.source?this._coordsDescendingInv[O.source][P.tileID.key]:[P.tileID];a._renderTileClippingMasks(O,Z),a.renderLayer(a,a.style.sourceCaches[O.source],O,Z),O.source&&(P.textureCoords[O.source]=this._coordsDescendingInvStr[O.source][P.tileID.key])}}_o(a,a.style.terrain,P)}if(s==="hillshade"){this._stacks.push([d[f]]);for(const P of this._renderableTiles){const z=this._coordsDescendingInv[e.source][P.tileID.key];hr(a,a.style.terrain,P,this._stacks.length-1),a.context.clear({color:h.Color.transparent}),a._renderTileClippingMasks(e,z),a.renderLayer(a,a.style.sourceCaches[e.source],e,z),_o(a,a.style.terrain,P)}return!0}return this._renderToTexture[s]}return!1}}const Ns={symbol:function(c,e,s,a,d){if(c.renderPass!=="translucent")return;const f=Fe.disabled,y=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(T,I,P,z,O,Z,H){const j=I.transform,W=O==="map",rt=Z==="map";for(const ht of T){const dt=z.getTile(ht),X=dt.getBucket(P);if(!X||!X.text||!X.text.segments.get().length)continue;const _t=h.evaluateSizeForZoom(X.textSizeData,j.zoom),pt=pi(dt,1,I.transform.zoom),Tt=wr(ht.posMatrix,rt,W,I.transform,pt),St=P.layout.get("icon-text-fit")!=="none"&&X.hasIconData();if(_t){const Mt=Math.pow(2,j.zoom-dt.tileID.overscaledZ);Go(X,W,rt,H,j,Tt,ht.posMatrix,Mt,_t,St,I.style.terrain?(bt,Vt)=>I.style.terrain.getElevation(ht,bt,Vt):null)}}}(a,c,s,e,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),d),s.paint.get("icon-opacity").constantOr(1)!==0&&vs(c,e,s,a,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),f,y),s.paint.get("text-opacity").constantOr(1)!==0&&vs(c,e,s,a,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),f,y),e.map.showCollisionBoxes&&(Hr(c,e,s,a,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Hr(c,e,s,a,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,e,s,a){if(c.renderPass!=="translucent")return;const d=s.paint.get("circle-opacity"),f=s.paint.get("circle-stroke-width"),y=s.paint.get("circle-stroke-opacity"),T=!s.layout.get("circle-sort-key").isConstant();if(d.constantOr(1)===0&&(f.constantOr(1)===0||y.constantOr(1)===0))return;const I=c.context,P=I.gl,z=c.depthModeForSublayer(0,de.ReadOnly),O=Fe.disabled,Z=c.colorModeForRenderPass(),H=[];for(let j=0;j<a.length;j++){const W=a[j],rt=e.getTile(W),ht=rt.getBucket(s);if(!ht)continue;const dt=ht.programConfigurations.get(s.id),X=c.useProgram("circle",dt),_t=ht.layoutVertexBuffer,pt=ht.indexBuffer,Tt=c.style.terrain&&c.style.terrain.getTerrainData(W),St={programConfiguration:dt,program:X,layoutVertexBuffer:_t,indexBuffer:pt,uniformValues:Pr(c,W,rt,s),terrainData:Tt};if(T){const Mt=ht.segments.get();for(const bt of Mt)H.push({segments:new h.SegmentVector([bt]),sortKey:bt.sortKey,state:St})}else H.push({segments:ht.segments,sortKey:0,state:St})}T&&H.sort((j,W)=>j.sortKey-W.sortKey);for(const j of H){const{programConfiguration:W,program:rt,layoutVertexBuffer:ht,indexBuffer:dt,uniformValues:X,terrainData:_t}=j.state;rt.draw(I,P.TRIANGLES,z,O,Z,ze.disabled,X,_t,s.id,ht,dt,j.segments,s.paint,c.transform.zoom,W)}},heatmap:function(c,e,s,a){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const d=c.context,f=d.gl,y=Fe.disabled,T=new He([f.ONE,f.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(I,P,z){const O=I.gl;I.activeTexture.set(O.TEXTURE1),I.viewport.set([0,0,P.width/4,P.height/4]);let Z=z.heatmapFbo;if(Z)O.bindTexture(O.TEXTURE_2D,Z.colorAttachment.get()),I.bindFramebuffer.set(Z.framebuffer);else{const H=O.createTexture();O.bindTexture(O.TEXTURE_2D,H),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),Z=z.heatmapFbo=I.createFramebuffer(P.width/4,P.height/4,!1),function(j,W,rt,ht){const dt=j.gl;dt.texImage2D(dt.TEXTURE_2D,0,dt.RGBA,W.width/4,W.height/4,0,dt.RGBA,j.extRenderToTextureHalfFloat?j.extTextureHalfFloat.HALF_FLOAT_OES:dt.UNSIGNED_BYTE,null),ht.colorAttachment.set(rt)}(I,P,H,Z)}})(d,c,s),d.clear({color:h.Color.transparent});for(let I=0;I<a.length;I++){const P=a[I];if(e.hasRenderableParent(P))continue;const z=e.getTile(P),O=z.getBucket(s);if(!O)continue;const Z=O.programConfigurations.get(s.id),H=c.useProgram("heatmap",Z),{zoom:j}=c.transform;H.draw(d,f.TRIANGLES,de.disabled,y,T,ze.disabled,Ar(P.posMatrix,z,j,s.paint.get("heatmap-intensity")),null,s.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,s.paint,c.transform.zoom,Z)}d.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(d,f){const y=d.context,T=y.gl,I=f.heatmapFbo;if(!I)return;y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.colorAttachment.get()),y.activeTexture.set(T.TEXTURE1);let P=f.colorRampTexture;P||(P=f.colorRampTexture=new ce(y,f.colorRamp,T.RGBA)),P.bind(T.LINEAR,T.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(y,T.TRIANGLES,de.disabled,Fe.disabled,d.colorModeForRenderPass(),ze.disabled,((z,O,Z,H)=>{const j=h.create();h.ortho(j,0,z.width,z.height,0,0,1);const W=z.context.gl;return{u_matrix:j,u_world:[W.drawingBufferWidth,W.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}})(d,f),null,f.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,f.paint,d.transform.zoom)}(c,s))},line:function(c,e,s,a){if(c.renderPass!=="translucent")return;const d=s.paint.get("line-opacity"),f=s.paint.get("line-width");if(d.constantOr(1)===0||f.constantOr(1)===0)return;const y=c.depthModeForSublayer(0,de.ReadOnly),T=c.colorModeForRenderPass(),I=s.paint.get("line-dasharray"),P=s.paint.get("line-pattern"),z=P.constantOr(1),O=s.paint.get("line-gradient"),Z=s.getCrossfadeParameters(),H=z?"linePattern":I?"lineSDF":O?"lineGradient":"line",j=c.context,W=j.gl;let rt=!0;for(const ht of a){const dt=e.getTile(ht);if(z&&!dt.patternsLoaded())continue;const X=dt.getBucket(s);if(!X)continue;const _t=X.programConfigurations.get(s.id),pt=c.context.program.get(),Tt=c.useProgram(H,_t),St=rt||Tt.program!==pt,Mt=c.style.terrain&&c.style.terrain.getTerrainData(ht),bt=P.constantOr(null);if(bt&&dt.imageAtlas){const jt=dt.imageAtlas,pe=jt.patternPositions[bt.to.toString()],ye=jt.patternPositions[bt.from.toString()];pe&&ye&&_t.setConstantPatternPositions(pe,ye)}const Vt=Mt?ht:null,Rt=z?_s(c,dt,s,Z,Vt):I?Cr(c,dt,s,I,Z,Vt):O?As(c,dt,s,X.lineClipsArray.length,Vt):Vn(c,dt,s,Vt);if(z)j.activeTexture.set(W.TEXTURE0),dt.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),_t.updatePaintBuffers(Z);else if(I&&(St||c.lineAtlas.dirty))j.activeTexture.set(W.TEXTURE0),c.lineAtlas.bind(j);else if(O){const jt=X.gradients[s.id];let pe=jt.texture;if(s.gradientVersion!==jt.version){let ye=256;if(s.stepInterpolant){const Qt=e.getSource().maxzoom,Ve=ht.canonical.z===Qt?Math.ceil(1<<c.transform.maxZoom-ht.canonical.z):1;ye=h.clamp(h.nextPowerOfTwo(X.maxLineLength/h.EXTENT*1024*Ve),256,j.maxTextureSize)}jt.gradient=h.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ye,image:jt.gradient||void 0,clips:X.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new ce(j,jt.gradient,W.RGBA),jt.version=s.gradientVersion,pe=jt.texture}j.activeTexture.set(W.TEXTURE0),pe.bind(s.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Tt.draw(j,W.TRIANGLES,y,c.stencilModeForClipping(ht),T,ze.disabled,Rt,Mt,s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,c.transform.zoom,_t,X.layoutVertexBuffer2),rt=!1}},fill:function(c,e,s,a){const d=s.paint.get("fill-color"),f=s.paint.get("fill-opacity");if(f.constantOr(1)===0)return;const y=c.colorModeForRenderPass(),T=s.paint.get("fill-pattern"),I=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&d.constantOr(h.Color.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===I){const P=c.depthModeForSublayer(1,c.renderPass==="opaque"?de.ReadWrite:de.ReadOnly);Os(c,e,s,a,P,y,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const P=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,de.ReadOnly);Os(c,e,s,a,P,y,!0)}},"fill-extrusion":function(c,e,s,a){const d=s.paint.get("fill-extrusion-opacity");if(d!==0&&c.renderPass==="translucent"){const f=new de(c.context.gl.LEQUAL,de.ReadWrite,c.depthRangeFor3D);if(d!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Fs(c,e,s,a,f,Fe.disabled,He.disabled),Fs(c,e,s,a,f,c.stencilModeFor3D(),c.colorModeForRenderPass());else{const y=c.colorModeForRenderPass();Fs(c,e,s,a,f,Fe.disabled,y)}}},hillshade:function(c,e,s,a){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const d=c.context,f=c.depthModeForSublayer(0,de.ReadOnly),y=c.colorModeForRenderPass(),[T,I]=c.renderPass==="translucent"?c.stencilConfigForOverlap(a):[{},a];for(const P of I){const z=e.getTile(P);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&c.renderPass==="offscreen"?ua(c,z,s,f,Fe.disabled,y):c.renderPass==="translucent"&&fo(c,P,z,s,f,T[P.overscaledZ],y)}d.viewport.set([0,0,c.width,c.height])},raster:function(c,e,s,a){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!a.length)return;const d=c.context,f=d.gl,y=e.getSource(),T=c.useProgram("raster"),I=c.colorModeForRenderPass(),[P,z]=y instanceof gn?[{},a]:c.stencilConfigForOverlap(a),O=z[z.length-1].overscaledZ,Z=!c.options.moving;for(const H of z){const j=c.depthModeForSublayer(H.overscaledZ-O,s.paint.get("raster-opacity")===1?de.ReadWrite:de.ReadOnly,f.LESS),W=e.getTile(H);W.registerFadeDuration(s.paint.get("raster-fade-duration"));const rt=e.findLoadedParent(H,0),ht=Ki(W,rt,e,s,c.transform,c.style.terrain);let dt,X;const _t=s.paint.get("raster-resampling")==="nearest"?f.NEAREST:f.LINEAR;d.activeTexture.set(f.TEXTURE0),W.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),d.activeTexture.set(f.TEXTURE1),rt?(rt.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),dt=Math.pow(2,rt.tileID.overscaledZ-W.tileID.overscaledZ),X=[W.tileID.canonical.x*dt%1,W.tileID.canonical.y*dt%1]):W.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST);const pt=c.style.terrain&&c.style.terrain.getTerrainData(H),Tt=pt?H:null,St=Tt?Tt.posMatrix:c.transform.calculatePosMatrix(H.toUnwrapped(),Z),Mt=Cs(St,X||[0,0],dt||1,ht,s);y instanceof gn?T.draw(d,f.TRIANGLES,j,Fe.disabled,I,ze.disabled,Mt,pt,s.id,y.boundsBuffer,c.quadTriangleIndexBuffer,y.boundsSegments):T.draw(d,f.TRIANGLES,j,P[H.overscaledZ],I,ze.disabled,Mt,pt,s.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,e,s,a){const d=s.paint.get("background-color"),f=s.paint.get("background-opacity");if(f===0)return;const y=c.context,T=y.gl,I=c.transform,P=I.tileSize,z=s.paint.get("background-pattern");if(c.isPatternMissing(z))return;const O=!z&&d.a===1&&f===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==O)return;const Z=Fe.disabled,H=c.depthModeForSublayer(0,O==="opaque"?de.ReadWrite:de.ReadOnly),j=c.colorModeForRenderPass(),W=c.useProgram(z?"backgroundPattern":"background"),rt=a||I.coveringTiles({tileSize:P,terrain:c.style.terrain});z&&(y.activeTexture.set(T.TEXTURE0),c.imageManager.bind(c.context));const ht=s.getCrossfadeParameters();for(const dt of rt){const X=a?dt.posMatrix:c.transform.calculatePosMatrix(dt.toUnwrapped()),_t=z?Ye(X,f,c,z,{tileID:dt,tileSize:P},ht):Gn(X,f,d),pt=c.style.terrain&&c.style.terrain.getTerrainData(dt);W.draw(y,T.TRIANGLES,H,Z,j,ze.disabled,_t,pt,s.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}},debug:function(c,e,s){for(let a=0;a<s.length;a++)mo(c,e,s[a])},custom:function(c,e,s){const a=c.context,d=s.implementation;if(c.renderPass==="offscreen"){const f=d.prerender;f&&(c.setCustomLayerDefaults(),a.setColorMode(c.colorModeForRenderPass()),f.call(d,a.gl,c.transform.customLayerMatrix()),a.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),a.setColorMode(c.colorModeForRenderPass()),a.setStencilMode(Fe.disabled);const f=d.renderingMode==="3d"?new de(c.context.gl.LEQUAL,de.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,de.ReadOnly);a.setDepthMode(f),d.render(a.gl,c.transform.customLayerMatrix()),a.setDirty(),c.setBaseState(),a.bindFramebuffer.set(null)}}};class Zs{constructor(e,s){this.context=new Rs(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.create(),renderTime:0},this.setup(),this.numSublayers=Zi.maxUnderzooming+Zi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new re,this.gpuTimers={}}resize(e,s,a){if(this.width=e*a,this.height=s*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,s=new h.PosArray;s.emplaceBack(0,0),s.emplaceBack(h.EXTENT,0),s.emplaceBack(0,h.EXTENT),s.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(s,Me.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const a=new h.PosArray;a.emplaceBack(0,0),a.emplaceBack(h.EXTENT,0),a.emplaceBack(0,h.EXTENT),a.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=e.createVertexBuffer(a,Me.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const d=new h.RasterBoundsArray;d.emplaceBack(0,0,0,0),d.emplaceBack(h.EXTENT,0,h.EXTENT,0),d.emplaceBack(0,h.EXTENT,0,h.EXTENT),d.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(d,ae.members),this.rasterBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const f=new h.PosArray;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,Me.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const y=new h.LineStripIndexArray;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const T=new h.TriangleIndexArray;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T),this.emptyTexture=new ce(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new Fe({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=h.create();h.ortho(a,0,this.width,this.height,0,0,1),h.scale(a,a,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,de.disabled,this.stencilClearMode,He.disabled,ze.disabled,Zn(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const a=this.context,d=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(He.disabled),a.setDepthMode(de.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of s){const T=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(y);f.draw(a,d.TRIANGLES,de.disabled,new Fe({func:d.ALWAYS,mask:0},T,255,d.KEEP,d.KEEP,d.REPLACE),He.disabled,ze.disabled,Zn(y.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Fe({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Fe({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,a=e.sort((y,T)=>T.overscaledZ-y.overscaledZ),d=a[a.length-1].overscaledZ,f=a[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const y={};for(let T=0;T<f;T++)y[T+d]=new Fe({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[y,a]}return[{[d]:Fe.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new He([e.CONSTANT_COLOR,e.ONE],new h.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?He.unblended:He.alphaBlended}depthModeForSublayer(e,s,a){if(!this.opaquePassEnabledForLayer())return de.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new de(a||this.context.gl.LEQUAL,s,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const a=this.style._order,d=this.style.sourceCaches,f=this.style.terrain&&new Us(this);for(const P in d){const z=d[P];z.used&&z.prepare(this.context)}const y={},T={},I={};for(const P in d){const z=d[P];y[P]=z.getVisibleCoordinates(),T[P]=y[P].slice().reverse(),I[P]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<a.length;P++)if(this.style._layers[a[P]].is3D()){this.opaquePassCutoff=P;break}if(f){this.opaquePassCutoff=0;const P=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!h.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(h.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,O){const Z=z.context,H=Z.gl,j=He.unblended,W=new de(H.LEQUAL,de.ReadWrite,[0,1]),rt=O.getTerrainMesh(),ht=O.sourceCache.getRenderableTiles(),dt=z.useProgram("terrainDepth");Z.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),Z.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),Z.clear({color:h.Color.transparent,depth:1});for(const X of ht){const _t=O.getTerrainData(X.tileID),pt=z.transform.calculatePosMatrix(X.tileID.toUnwrapped());dt.draw(Z,H.TRIANGLES,W,Fe.disabled,j,ze.backCCW,{u_matrix:pt},_t,"terrain",rt.vertexBuffer,rt.indexBuffer,rt.segments)}Z.bindFramebuffer.set(null),Z.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,O){const Z=z.context,H=Z.gl,j=He.unblended,W=new de(H.LEQUAL,de.ReadWrite,[0,1]),rt=O.getTerrainMesh(),ht=O.getCoordsTexture(),dt=O.sourceCache.getRenderableTiles(),X=z.useProgram("terrainCoords");Z.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),Z.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),Z.clear({color:h.Color.transparent,depth:1}),O.coordsIndex=[];for(const _t of dt){const pt=O.getTerrainData(_t.tileID);Z.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,ht.texture);const Tt=z.transform.calculatePosMatrix(_t.tileID.toUnwrapped());X.draw(Z,H.TRIANGLES,W,Fe.disabled,j,ze.backCCW,{u_matrix:Tt,u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0},pt,"terrain",rt.vertexBuffer,rt.indexBuffer,rt.segments),O.coordsIndex.push(_t.tileID.key)}Z.bindFramebuffer.set(null),Z.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const P of a){const z=this.style._layers[P];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const O=T[z.source];(z.type==="custom"||O.length)&&this.renderLayer(this,d[z.source],z,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.Color.black:h.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!f)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[a[this.currentLayer]],z=d[P.source],O=y[P.source];this._renderTileClippingMasks(P,O),this.renderLayer(this,z,P,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const P=this.style._layers[a[this.currentLayer]],z=d[P.source];if(f&&f.renderLayer(P))continue;const O=(P.type==="symbol"?I:T)[P.source];this._renderTileClippingMasks(P,y[P.source]),this.renderLayer(this,z,P,O)}if(this.options.showTileBoundaries){let P,z;Object.values(this.style._layers).forEach(O=>{O.source&&!O.isHidden(this.transform.zoom)&&(O.source!==(z&&z.id)&&(z=this.style.sourceCaches[O.source]),(!P||P.getSource().maxzoom<z.getSource().maxzoom)&&(P=z))}),P&&Ns.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const z=P.transform.padding;Jr(P,P.transform.height-(z.top||0),3,ar),Jr(P,z.bottom||0,3,Cn),lr(P,z.left||0,3,$n),lr(P,P.transform.width-(z.right||0),3,qo);const O=P.transform.centerPoint;(function(Z,H,j,W){Yr(Z,H-1,j-10,2,20,W),Yr(Z,H-10,j-1,20,2,W)})(P,O.x,P.transform.height-O.y,Kr)}(this),this.context.setDefault()}renderLayer(e,s,a,d){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(d||[]).length)&&(this.id=a.id,this.gpuTimingStart(a),Ns[a.type](e,s,a,d,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let a=this.gpuTimers[e.id];a||(a=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),a.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,a.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const s={};for(const a in e){const d=e[a],f=this.context.extTimerQuery,y=f.getQueryObjectEXT(d.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(d.query),s[a]=y}return s}translatePosMatrix(e,s,a,d,f){if(!a[0]&&!a[1])return e;const y=f?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(y){const P=Math.sin(y),z=Math.cos(y);a=[a[0]*z-a[1]*P,a[0]*P+a[1]*z]}const T=[f?a[0]:pi(s,a[0],this.transform.zoom),f?a[1]:pi(s,a[1],this.transform.zoom),0],I=new Float32Array(16);return h.translate(I,e,T),I}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!s||!a}useProgram(e,s){this.cache=this.cache||{};const a=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new so(this.context,e,je[e],s,ao[e],this._showOverdrawInspector,this.style.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class go{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,a){const d=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=1/(T=h.transformMat4([],T,e))[3]/s*d;return h.mul$1(T,T,[I,I,1/T[3],I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=h.sub([],f[T[0]],f[T[1]]),P=h.sub([],f[T[2]],f[T[1]]),z=h.normalize([],h.cross([],I,P)),O=-h.dot(z,f[T[1]]);return z.concat(O)});return new go(f,y)}}class hn{constructor(e,s){this.min=e,this.max=s,this.center=h.scale$1([],h.add([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],a=h.clone$2(this.min),d=h.clone$2(this.max);for(let f=0;f<s.length;f++)a[f]=s[f]?this.min[f]:this.center[f],d[f]=s[f]?this.center[f]:this.max[f];return d[2]=this.max[2],new hn(a,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let d=0;d<e.planes.length;d++){const f=e.planes[d];let y=0;for(let T=0;T<s.length;T++)h.dot$1(f,s[T])>=0&&y++;if(y===0)return 0;y!==s.length&&(a=!1)}if(a)return 2;for(let d=0;d<3;d++){let f=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const I=e.points[T][d]-this.min[d];f=Math.min(f,I),y=Math.max(y,I)}if(y<0||f>this.max[d]-this.min[d])return 0}return 1}}class xs{constructor(e=0,s=0,a=0,d=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(a)||a<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=a,this.right=d}interpolate(e,s,a){return s.top!=null&&e.top!=null&&(this.top=h.number(e.top,s.top,a)),s.bottom!=null&&e.bottom!=null&&(this.bottom=h.number(e.bottom,s.bottom,a)),s.left!=null&&e.left!=null&&(this.left=h.number(e.left,s.left,a)),s.right!=null&&e.right!=null&&(this.right=h.number(e.right,s.right,a)),this}getCenter(e,s){const a=h.clamp((this.left+e-this.right)/2,0,e),d=h.clamp((this.top+s-this.bottom)/2,0,s);return new h.pointGeometry(a,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new xs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class jn{constructor(e,s,a,d,f){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=a??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new xs,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const e=new jn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e._elevation=this._elevation,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._calcMatrices(),e}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-h.wrap(e,-180,180)*Math.PI/180;var a;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(a=new h.ARRAY_TYPE(4),h.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),function(d,f,y){var T=f[0],I=f[1],P=f[2],z=f[3],O=Math.sin(y),Z=Math.cos(y);d[0]=T*Z+P*O,d[1]=I*Z+z*O,d[2]=T*-O+P*Z,d[3]=I*-O+z*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=h.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,a){this._unmodified=!1,this._edgeInsets.interpolate(e,s,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new h.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new h.pointGeometry(0,0)),d=this.pointCoordinate(new h.pointGeometry(this.width,0)),f=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new h.pointGeometry(0,this.height)),T=Math.floor(Math.min(a.x,d.x,f.x,y.x)),I=Math.floor(Math.max(a.x,d.x,f.x,y.x)),P=1;for(let z=T-P;z<=I+P;z++)z!==0&&s.push(new h.UnwrappedTileID(z,e))}return s}coveringTiles(e){var s,a;let d=this.coveringZoomLevel(e);const f=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),T=h.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,d),P=[I*y.x,I*y.y,0],z=[I*T.x,I*T.y,0],O=go.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d);let Z=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=d);const H=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,j=X=>({aabb:new hn([X*I,0,0],[(X+1)*I,I,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),W=[],rt=[],ht=d,dt=e.reparseOverscaled?f:d;if(this._renderWorldCopies)for(let X=1;X<=3;X++)W.push(j(-X)),W.push(j(X));for(W.push(j(0));W.length>0;){const X=W.pop(),_t=X.x,pt=X.y;let Tt=X.fullyVisible;if(!Tt){const jt=X.aabb.intersects(O);if(jt===0)continue;Tt=jt===2}const St=e.terrain?P:z,Mt=X.aabb.distanceX(St),bt=X.aabb.distanceY(St),Vt=Math.max(Math.abs(Mt),Math.abs(bt)),Rt=H+(1<<ht-X.zoom)-2;if(X.zoom===ht||Vt>Rt&&X.zoom>=Z){const jt=ht-X.zoom,pe=P[0]-.5-(_t<<jt),ye=P[1]-.5-(pt<<jt);rt.push({tileID:new h.OverscaledTileID(X.zoom===ht?dt:X.zoom,X.wrap,X.zoom,_t,pt),distanceSq:h.sqrLen([z[0]-.5-_t,z[1]-.5-pt]),tileDistanceToCamera:Math.sqrt(pe*pe+ye*ye)})}else for(let jt=0;jt<4;jt++){const pe=(_t<<1)+jt%2,ye=(pt<<1)+(jt>>1),Qt=X.zoom+1;let Ve=X.aabb.quadrant(jt);if(e.terrain){const Ge=new h.OverscaledTileID(Qt,X.wrap,Qt,pe,ye),Le=e.terrain.getMinMaxElevation(Ge),ke=(s=Le.minElevation)!==null&&s!==void 0?s:this.elevation,qe=(a=Le.maxElevation)!==null&&a!==void 0?a:this.elevation;Ve=new hn([Ve.min[0],Ve.min[1],ke],[Ve.max[0],Ve.max[1],qe])}W.push({aabb:Ve,zoom:Qt,x:pe,y:ye,wrap:X.wrap,fullyVisible:Tt})}}return rt.sort((X,_t)=>X.distanceSq-_t.distanceSq).map(X=>X.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=h.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new h.pointGeometry(h.mercatorXfromLng(e.lng)*this.worldSize,h.mercatorYfromLat(s)*this.worldSize)}unproject(e){return new h.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(e){this.freezeElevation||(this.elevation=e?this.getElevation(this._center,e):0)}getElevation(e,s){const a=h.MercatorCoordinate.fromLngLat(e),d=(1<<this.tileZoom)*h.EXTENT,f=a.x*d,y=a.y*d,T=Math.floor(f/h.EXTENT),I=Math.floor(y/h.EXTENT),P=new h.OverscaledTileID(this.tileZoom,0,this.tileZoom,T,I);return s.getElevation(P,f%h.EXTENT,y%h.EXTENT,h.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.pointLocation(this.centerPoint,e),a=this.getElevation(s,e);if(!(this.elevation-a))return;const d=this.getCameraPosition(),f=h.MercatorCoordinate.fromLngLat(d.lngLat,d.altitude),y=h.MercatorCoordinate.fromLngLat(s,a),T=f.x-y.x,I=f.y-y.y,P=f.z-y.z,z=Math.sqrt(T*T+I*I+P*P),O=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=a,this._center=s,this.zoom=O}setLocationAtPoint(e,s){const a=this.pointCoordinate(s),d=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),y=new h.MercatorCoordinate(f.x-(a.x-d.x),f.y-(a.y-d.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),this.getElevation(e,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return h.MercatorCoordinate.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const Z=s.pointCoordinate(e);if(Z!=null)return Z}const a=[e.x,e.y,0,1],d=[e.x,e.y,1,1];h.transformMat4(a,a,this.pixelMatrixInverse),h.transformMat4(d,d,this.pixelMatrixInverse);const f=a[3],y=d[3],T=a[1]/f,I=d[1]/y,P=a[2]/f,z=d[2]/y,O=P===z?0:(0-P)/(z-P);return new h.MercatorCoordinate(h.number(a[0]/f,d[0]/y,O)/this.worldSize,h.number(T,I,O)/this.worldSize)}coordinatePoint(e,s=0,a=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,s,1];return h.transformMat4(d,d,a),new h.pointGeometry(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new h.LngLatBounds().extend(this.pointLocation(new h.pointGeometry(0,e))).extend(this.pointLocation(new h.pointGeometry(this.width,e))).extend(this.pointLocation(new h.pointGeometry(this.width,this.height))).extend(this.pointLocation(new h.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new h.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,s=!1){const a=e.key,d=s?this._alignedPosMatrixCache:this._posMatrixCache;if(d[a])return d[a];const f=e.canonical,y=this.worldSize/this.zoomScale(f.z),T=f.x+Math.pow(2,f.z)*e.wrap,I=h.identity(new Float64Array(16));return h.translate(I,I,[T*y,f.y*y,0]),h.scale(I,I,[y/h.EXTENT,y/h.EXTENT,1]),h.multiply(I,s?this.alignedProjMatrix:this.projMatrix,I),d[a]=new Float32Array(I),d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,s,a,d,f=-90,y=90,T=-180,I=180;const P=this.size,z=this._unmodified;if(this.latRange){const H=this.latRange;f=h.mercatorYfromLat(H[1])*this.worldSize,y=h.mercatorYfromLat(H[0])*this.worldSize,e=y-f<P.y?P.y/(y-f):0}if(this.lngRange){const H=this.lngRange;T=h.wrap(h.mercatorXfromLng(H[0])*this.worldSize,0,this.worldSize),I=h.wrap(h.mercatorXfromLng(H[1])*this.worldSize,0,this.worldSize),I<T&&(I+=this.worldSize),s=I-T<P.x?P.x/(I-T):0}const O=this.point,Z=Math.max(s||0,e||0);if(Z)return this.center=this.unproject(new h.pointGeometry(s?(I+T)/2:O.x,e?(y+f)/2:O.y)),this.zoom+=this.scaleZoom(Z),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const H=O.y,j=P.y/2;H-j<f&&(d=f+j),H+j>y&&(d=y-j)}if(this.lngRange){const H=(T+I)/2,j=h.wrap(O.x,H-this.worldSize/2,H+this.worldSize/2),W=P.x/2;j-W<T&&(a=T+W),j+W>I&&(a=I-W)}a===void 0&&d===void 0||(this.center=this.unproject(new h.pointGeometry(a!==void 0?a:O.x,d!==void 0?d:O.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let d=h.identity(new Float64Array(16));h.scale(d,d,[this.width/2,-this.height/2,1]),h.translate(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=h.identity(new Float64Array(16)),h.scale(d,d,[1,-1,1]),h.translate(d,d,[-1,-1,0]),h.scale(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const f=Math.PI/2+this._pitch,y=this._fov*(.5+e.y/this.height),T=Math.sin(y)*this.cameraToSeaLevelDistance/Math.sin(h.clamp(Math.PI-f-y,.01,Math.PI-.01)),I=this.getHorizon(),P=2*Math.atan(I/this.cameraToCenterDistance)*(.5+e.y/(2*I)),z=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(h.clamp(Math.PI-f-P,.01,Math.PI-.01)),O=Math.cos(Math.PI/2-this._pitch)*T+this.cameraToSeaLevelDistance,Z=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,H=1.01*Math.min(O,Z),j=this.height/50;d=new Float64Array(16),h.perspective(d,this._fov,this.width/this.height,j,H),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,h.scale(d,d,[1,-1,1]),h.translate(d,d,[0,0,-this.cameraToCenterDistance]),h.rotateX(d,d,this._pitch),h.rotateZ(d,d,this.angle),h.translate(d,d,[-s,-a,0]),this.mercatorMatrix=h.scale([],d,[this.worldSize,this.worldSize,this.worldSize]),h.scale(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,d),h.translate(d,d,[0,0,-this.elevation]),this.projMatrix=d,this.invProjMatrix=h.invert([],d),this.pixelMatrix3D=h.multiply(new Float64Array(16),this.labelPlaneMatrix,d);const W=this.width%2/2,rt=this.height%2/2,ht=Math.cos(this.angle),dt=Math.sin(this.angle),X=s-Math.round(s)+ht*W+dt*rt,_t=a-Math.round(a)+ht*rt+dt*W,pt=new Float64Array(d);if(h.translate(pt,pt,[X>.5?X-1:X,_t>.5?_t-1:_t,0]),this.alignedProjMatrix=pt,d=h.invert(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new h.pointGeometry(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let a=s.x,d=s.y,f=s.x,y=s.y;for(const T of e)a=Math.min(a,T.x),d=Math.min(d,T.y),f=Math.max(f,T.x),y=Math.max(y,T.y);return[new h.pointGeometry(a,d),new h.pointGeometry(f,d),new h.pointGeometry(f,y),new h.pointGeometry(a,y),new h.pointGeometry(a,d)]}}}class da{constructor(e){this._hashName=e&&encodeURIComponent(e),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,a){let d=!1,f=null;const y=()=>{f=null,d&&(s(),f=setTimeout(y,300),d=!1)};return()=>(d=!0,f||y(),f)}(this._updateHashUnthrottled.bind(this))}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const s=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,d=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),y=Math.round(s.lng*f)/f,T=Math.round(s.lat*f)/f,I=this._map.getBearing(),P=this._map.getPitch();let z="";if(z+=e?`/${y}/${T}/${a}`:`${a}/${T}/${y}`,(I||P)&&(z+="/"+Math.round(10*I)/10),P&&(z+=`/${Math.round(P)}`),this._hashName){const O=this._hashName;let Z=!1;const H=window.location.hash.slice(1).split("&").map(j=>{const W=j.split("=")[0];return W===O?(Z=!0,`${W}=${z}`):j}).filter(j=>j);return Z||H.push(`${O}=${z}`),`#${H.join("&")}`}return`#${z}`}_getCurrentHash(){const e=window.location.hash.replace("#","");if(this._hashName){let s;return e.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(s=a)}),(s&&s[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:s,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch{}}}const cn={linearity:.3,easing:h.bezier(0,0,.3,1)},Vs=h.extend({deceleration:2500,maxSpeed:1400},cn),$o=h.extend({deceleration:20,maxSpeed:1400},cn),yo=h.extend({deceleration:1e3,maxSpeed:360},cn),cr=h.extend({deceleration:1e3,maxSpeed:90},cn);class vo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=h.exported.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const f=Wn(s.pan.mag(),a,h.extend({},Vs,e||{}));d.offset=s.pan.mult(f.amount/s.pan.mag()),d.center=this._map.transform.center,Lr(d,f)}if(s.zoom){const f=Wn(s.zoom,a,$o);d.zoom=this._map.transform.zoom+f.amount,Lr(d,f)}if(s.bearing){const f=Wn(s.bearing,a,yo);d.bearing=this._map.transform.bearing+h.clamp(f.amount,-179,179),Lr(d,f)}if(s.pitch){const f=Wn(s.pitch,a,cr);d.pitch=this._map.transform.pitch+f.amount,Lr(d,f)}if(d.zoom||d.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),h.extend(d,{noMoveStart:!0})}}function Lr(c,e){(!c.duration||c.duration<e.duration)&&(c.duration=e.duration,c.easing=e.easing)}function Wn(c,e,s){const{maxSpeed:a,linearity:d,deceleration:f}=s,y=h.clamp(c*d/(e/1e3),-a,a),T=Math.abs(y)/(f*d);return{easing:s.easing,duration:1e3*T,amount:y*(T/2)}}class Li extends h.Event{constructor(e,s,a,d={}){const f=ft.mousePos(s.getCanvasContainer(),a),y=s.unproject(f);super(e,h.extend({point:f,lngLat:y,originalEvent:a},d)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Qr extends h.Event{constructor(e,s,a){const d=e==="touchend"?a.changedTouches:a.touches,f=ft.touchPos(s.getCanvasContainer(),d),y=f.map(I=>s.unproject(I)),T=f.reduce((I,P,z,O)=>I.add(P.div(O.length)),new h.pointGeometry(0,0));super(e,{points:f,point:T,lngLats:y,lngLat:s.unproject(T),originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ji extends h.Event{constructor(e,s,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Oa{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ji(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Li(e.type,this._map,e))}mouseup(e){this._map.fire(new Li(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Li(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Li(e.type,this._map,e))}mouseover(e){this._map.fire(new Li(e.type,this._map,e))}mouseout(e){this._map.fire(new Li(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Qr(e.type,this._map,e))}touchmove(e){this._map.fire(new Qr(e.type,this._map,e))}touchend(e){this._map.fire(new Qr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Qr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Li(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Li(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pa{constructor(e,s){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(ft.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const a=s;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=a,this._box||(this._box=ft.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(d.x,a.x),y=Math.max(d.x,a.x),T=Math.min(d.y,a.y),I=Math.max(d.y,a.y);ft.setTransform(this._box,`translate(${f}px,${T}px)`),this._box.style.width=y-f+"px",this._box.style.height=I-T+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const a=this._startPos,d=s;if(this.reset(),ft.suppressClick(),a.x!==d.x||a.y!==d.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(a,d,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(ft.remove(this._box),this._box=null),ft.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new h.Event(e,{originalEvent:s}))}}function Hn(c,e){if(c.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${c.length}, points ${e.length}`);const s={};for(let a=0;a<c.length;a++)s[c[a].identifier]=e[a];return s}class Gs{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(d){const f=new h.pointGeometry(0,0);for(const y of d)f._add(y);return f.div(d.length)}(s),this.touches=Hn(a,s)))}touchmove(e,s,a){if(this.aborted||!this.centroid)return;const d=Hn(a,s);for(const f in this.touches){const y=this.touches[f],T=d[f];(!T||T.dist(y)>30)&&(this.aborted=!0)}}touchend(e,s,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class xo{constructor(e){this.singleTap=new Gs(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,a){this.singleTap.touchstart(e,s,a)}touchmove(e,s,a){this.singleTap.touchmove(e,s,a)}touchend(e,s,a){const d=this.singleTap.touchend(e,s,a);if(d){const f=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(d)<30;if(f&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Fa{constructor(){this._zoomIn=new xo({numTouches:1,numTaps:2}),this._zoomOut=new xo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,a){this._zoomIn.touchstart(e,s,a),this._zoomOut.touchstart(e,s,a)}touchmove(e,s,a){this._zoomIn.touchmove(e,s,a),this._zoomOut.touchmove(e,s,a)}touchend(e,s,a){const d=this._zoomIn.touchend(e,s,a),f=this._zoomOut.touchend(e,s,a);return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(d)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xn={0:1,2:2};class ts{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,s){return!1}_move(e,s){return{}}mousedown(e,s){if(this._lastPoint)return;const a=ft.mouseButton(e);this._correctButton(e,a)&&(this._lastPoint=s,this._eventButton=a)}mousemoveWindow(e,s){const a=this._lastPoint;if(a){if(e.preventDefault(),function(d,f){const y=Xn[f];return d.buttons===void 0||(d.buttons&y)!==y}(e,this._eventButton))this.reset();else if(this._moved||!(s.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(a,s)}}mouseupWindow(e){this._lastPoint&&ft.mouseButton(e)===this._eventButton&&(this._moved&&ft.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qs extends ts{mousedown(e,s){super.mousedown(e,s),this._lastPoint&&(this._active=!0)}_correctButton(e,s){return s===0&&!e.ctrlKey}_move(e,s){return{around:s,panDelta:s.sub(e)}}}class xn extends ts{_correctButton(e,s){return s===0&&e.ctrlKey||s===2}_move(e,s){const a=.8*(s.x-e.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(e){e.preventDefault()}}class qt extends ts{_correctButton(e,s){return s===0&&e.ctrlKey||s===2}_move(e,s){const a=-.5*(s.y-e.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(e){e.preventDefault()}}class jo{constructor(e,s){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,s,a){return this._calculateTransform(e,s,a)}touchmove(e,s,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,s,a)}touchend(e,s,a){this._calculateTransform(e,s,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,a){a.length>0&&(this._active=!0);const d=Hn(a,s),f=new h.pointGeometry(0,0),y=new h.pointGeometry(0,0);let T=0;for(const P in d){const z=d[P],O=this._touches[P];O&&(f._add(z),y._add(z.sub(O)),T++,d[P]=z)}if(this._touches=d,T<this._minTouches||!y.mag())return;const I=y.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(T),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class es{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,s,a){return{}}touchstart(e,s,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,a){if(!this._firstTwoTouches)return;e.preventDefault();const[d,f]=this._firstTwoTouches,y=bn(a,s,d),T=bn(a,s,f);if(!y||!T)return;const I=this._aroundCenter?null:y.add(T).div(2);return this._move([y,T],I,e)}touchend(e,s,a){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,y=bn(a,s,d),T=bn(a,s,f);y&&T||(this._active&&ft.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bn(c,e,s){for(let a=0;a<c.length;a++)if(c[a].identifier===s)return e[a]}function Wo(c,e){return Math.log(c/e)/Math.LN2}class Dt extends es{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Wo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wo(this._distance,a),pinchAround:s}}}function $s(c,e){return 180*c.angleWith(e)/Math.PI}class fa extends es{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s){const a=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$s(this._vector,a),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,a=$s(e,this._startVector);return Math.abs(a)<s}}function Ho(c){return Math.abs(c.y)>Math.abs(c.x)}class zn extends es{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,a){super.touchstart(e,s,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,Ho(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,f,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,a){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,f=s.mag()>=2;if(!d&&!f)return;if(!d||!f)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==s.y>0;return Ho(e)&&Ho(s)&&y}}const Xo={panStep:100,bearingStep:15,pitchStep:10};class Ko{constructor(){const e=Xo;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,a=0,d=0,f=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,d=0),{cameraAnimation:T=>{const I=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:js,zoom:s?Math.round(I)+s*(e.shiftKey?2:1):I,bearing:T.getBearing()+a*this._bearingStep,pitch:T.getPitch()+d*this._pitchStep,offset:[-f*this._panStep,-y*this._panStep],center:T.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function js(c){return c*(2-c)}const ma=4.000244140625;class bs{constructor(e,s){this._map=e,this._el=e.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;e.preventDefault()}let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=h.exported.now(),d=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,s!==0&&s%ma==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ft.mousePos(this._el,e);this._around=h.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>ma?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&I!==0&&(I=1/I);const P=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(P*I))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,d=this._easing;let f,y=!1;if(this._type==="wheel"&&a&&d){const T=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),I=d(T);f=h.number(a,s,I),T<1?this._frameId||(this._frameId=!0):y=!0}else f=s,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=h.ease;if(this._prevEase){const a=this._prevEase,d=(h.exported.now()-a.start)/a.duration,f=a.easing(d+.01)-a.easing(d),y=.27/Math.sqrt(f*f+1e-4)*.01,T=Math.sqrt(.0729-y*y);s=h.bezier(y,T,.25,1)}return this._prevEase={start:h.exported.now(),duration:e,easing:s},s}reset(){this._active=!1}}class is{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bo{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(e.shiftKey?-1:1),around:a.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo{constructor(){this._tap=new xo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,s,a){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=s[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(e,s,a))}touchmove(e,s,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const d=s[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,s,a)}touchend(e,s,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(e,s,a)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yi{constructor(e,s,a){this._el=e,this._mousePan=s,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ur{constructor(e,s,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jo{constructor(e,s,a,d){this._el=e,this._touchZoom=s,this._touchRotate=a,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ns=c=>c.zoom||c.drag||c.pitch||c.rotate;class To extends h.Event{}function ws(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class _a{constructor(e,s){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vo(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),h.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,f,y]of this._listeners)ft.addEventListener(d,f,d===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,s,a]of this._listeners)ft.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const s=this._map,a=s.getCanvasContainer();this._add("mapEvent",new Oa(s,e));const d=s.boxZoom=new pa(s,e);this._add("boxZoom",d);const f=new Fa,y=new bo;s.doubleClickZoom=new is(y,f),this._add("tapZoom",f),this._add("clickZoom",y);const T=new wo;this._add("tapDragZoom",T);const I=s.touchPitch=new zn(s);this._add("touchPitch",I);const P=new xn(e),z=new qt(e);s.dragRotate=new ur(e,P,z),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const O=new qs(e),Z=new jo(e,s);s.dragPan=new Yi(a,O,Z),this._add("mousePan",O),this._add("touchPan",Z,["touchZoom","touchRotate"]);const H=new fa,j=new Dt;s.touchZoomRotate=new Jo(a,j,H,T),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]);const W=s.scrollZoom=new bs(s,this);this._add("scrollZoom",W,["mousePan"]);const rt=s.keyboard=new Ko;this._add("keyboard",rt),this._add("blockableMapEvent",new Mn(s));for(const ht of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[ht]&&s[ht].enable(e[ht])}_add(e,s,a){this._handlers.push({handlerName:e,handler:s,allowed:a}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ns(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,s,a){for(const d in e)if(d!==a&&(!s||s.indexOf(d)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const s=[];for(const a of e)this._el.contains(a.target)&&s.push(a);return s}handleEvent(e,s){if(e.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=e.type==="renderFrame"?void 0:e,d={needsRenderFrame:!1},f={},y={},T=e.touches,I=T?this._getMapTouches(T):void 0,P=I?ft.touchPos(this._el,I):ft.mousePos(this._el,e);for(const{handlerName:Z,handler:H,allowed:j}of this._handlers){if(!H.isEnabled())continue;let W;this._blockedByActive(y,j,Z)?H.reset():H[s||e.type]&&(W=H[s||e.type](e,P,I),this.mergeHandlerResult(d,f,W,Z,a),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||H.isActive())&&(y[Z]=H)}const z={};for(const Z in this._previousActiveHandlers)y[Z]||(z[Z]=a);this._previousActiveHandlers=y,(Object.keys(z).length||ws(d))&&(this._changes.push([d,f,z]),this._triggerRenderFrame()),(Object.keys(y).length||ws(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=d;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(e,s,a,d,f){if(!a)return;h.extend(e,a);const y={handlerName:d,originalEvent:a.originalEvent||f};a.zoomDelta!==void 0&&(s.zoom=y),a.panDelta!==void 0&&(s.drag=y),a.pitchDelta!==void 0&&(s.pitch=y),a.bearingDelta!==void 0&&(s.rotate=y)}_applyChanges(){const e={},s={},a={};for(const[d,f,y]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new h.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),h.extend(s,f),h.extend(a,y);this._updateMapTransform(e,s,a),this._changes=[]}_updateMapTransform(e,s,a){const d=this._map,f=d.transform,y=d.style&&d.style.terrain;if(!(ws(e)||y&&this._drag))return this._fireEvents(s,a,!0);let{panDelta:T,zoomDelta:I,bearingDelta:P,pitchDelta:z,around:O,pinchAround:Z}=e;Z!==void 0&&(O=Z),d._stop(!0),O=O||d.transform.centerPoint;const H=f.pointLocation(T?O.sub(T):O);P&&(f.bearing+=P),z&&(f.pitch+=z),I&&(f.zoom+=I),y?s.drag&&!this._drag?(this._drag={center:f.centerPoint,lngLat:f.pointLocation(O),point:O,handlerName:s.drag.handlerName},d.fire(new h.Event("freezeElevation",{freeze:!0}))):this._drag&&a[this._drag.handlerName]?(d.fire(new h.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(f.center=f.pointLocation(f.centerPoint.sub(T))):f.setLocationAtPoint(H,O),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,a,!0)}_fireEvents(e,s,a){const d=ns(this._eventsInProgress),f=ns(e),y={};for(const z in e){const{originalEvent:O}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=O),this._eventsInProgress[z]=e[z]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const z in y)this._fireEvent(z,y[z]);f&&this._fireEvent("move",f.originalEvent);for(const z in e){const{originalEvent:O}=e[z];this._fireEvent(z,O)}const T={};let I;for(const z in this._eventsInProgress){const{handlerName:O,originalEvent:Z}=this._eventsInProgress[z];this._handlersById[O].isActive()||(delete this._eventsInProgress[z],I=s[O]||Z,T[`${z}end`]=I)}for(const z in T)this._fireEvent(z,T[z]);const P=ns(this._eventsInProgress);if(a&&(d||f)&&!P){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;z?(O(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new h.Event("moveend",{originalEvent:I})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new h.Event(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new To("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const un={extend:(c,...e)=>h.extend(c,...e),run(c){c()},logToElement(c,e=!1,s="log"){const a=window.document.getElementById(s);a&&(e&&(a.innerHTML=""),a.innerHTML+=`<br>${c}`)}};class Qe extends h.Evented{constructor(e,s){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,a){return e=h.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,h.extend({offset:e},s),a)}panTo(e,s,a){return this.easeTo(h.extend({center:e},s),a)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,a){return this.easeTo(h.extend({zoom:e},s),a)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,a){return this.easeTo(h.extend({bearing:e},s),a)}resetNorth(e,s){return this.rotateTo(0,h.extend({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=h.LngLatBounds.convert(e);const a=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,s)}_cameraForBoxAndBearing(e,s,a,d){const f={top:0,bottom:0,right:0,left:0};if(typeof(d=h.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const pt=d.padding;d.padding={top:pt,bottom:pt,right:pt,left:pt}}d.padding=h.extend(f,d.padding);const y=this.transform,T=y.padding,I=y.project(h.LngLat.convert(e)),P=y.project(h.LngLat.convert(s)),z=I.rotate(-a*Math.PI/180),O=P.rotate(-a*Math.PI/180),Z=new h.pointGeometry(Math.max(z.x,O.x),Math.max(z.y,O.y)),H=new h.pointGeometry(Math.min(z.x,O.x),Math.min(z.y,O.y)),j=Z.sub(H),W=(y.width-(T.left+T.right+d.padding.left+d.padding.right))/j.x,rt=(y.height-(T.top+T.bottom+d.padding.top+d.padding.bottom))/j.y;if(rt<0||W<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ht=Math.min(y.scaleZoom(y.scale*Math.min(W,rt)),d.maxZoom),dt=h.pointGeometry.convert(d.offset),X=new h.pointGeometry((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(a*Math.PI/180),_t=dt.add(X).mult(y.scale/y.zoomScale(ht));return{center:y.unproject(I.add(P).div(2).sub(_t)),zoom:ht,bearing:a}}fitBounds(e,s,a){return this._fitInternal(this.cameraForBounds(e,s),s,a)}fitScreenCoordinates(e,s,a,d,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(e)),this.transform.pointLocation(h.pointGeometry.convert(s)),a,d),d,f)}_fitInternal(e,s,a){return e?(delete(s=h.extend(e,s)).padding,s.linear?this.easeTo(s,a):this.flyTo(s,a)):this}jumpTo(e,s){this.stop();const a=this.transform;let d=!1,f=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(d=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=h.LngLat.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(f=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this.fire(new h.Event("movestart",s)).fire(new h.Event("move",s)),d&&this.fire(new h.Event("zoomstart",s)).fire(new h.Event("zoom",s)).fire(new h.Event("zoomend",s)),f&&this.fire(new h.Event("rotatestart",s)).fire(new h.Event("rotate",s)).fire(new h.Event("rotateend",s)),y&&this.fire(new h.Event("pitchstart",s)).fire(new h.Event("pitch",s)).fire(new h.Event("pitchend",s)),this.fire(new h.Event("moveend",s))}calculateCameraOptionsFromTo(e,s,a,d=0){const f=h.MercatorCoordinate.fromLngLat(e,s),y=h.MercatorCoordinate.fromLngLat(a,d),T=y.x-f.x,I=y.y-f.y,P=y.z-f.z,z=Math.hypot(T,I,P);if(z===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(T,I),Z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),H=180*Math.atan2(T,-I)/Math.PI;let j=180*Math.acos(O/z)/Math.PI;return j=P<0?90-j:90+j,{center:y.toLngLat(),zoom:Z,pitch:j,bearing:H}}easeTo(e,s){this._stop(!1,e.easeId),((e=h.extend({offset:[0,0],duration:500,easing:h.ease},e)).animate===!1||!e.essential&&h.exported.prefersReducedMotion)&&(e.duration=0);const a=this.transform,d=this.getZoom(),f=this.getBearing(),y=this.getPitch(),T=this.getPadding(),I="zoom"in e?+e.zoom:d,P="bearing"in e?this._normalizeBearing(e.bearing,f):f,z="pitch"in e?+e.pitch:y,O="padding"in e?e.padding:a.padding,Z=h.pointGeometry.convert(e.offset);let H=a.centerPoint.add(Z);const j=a.pointLocation(H),W=h.LngLat.convert(e.center||j);this._normalizeCenter(W);const rt=a.project(j),ht=a.project(W).sub(rt),dt=a.zoomScale(I-d);let X,_t;e.around&&(X=h.LngLat.convert(e.around),_t=a.locationPoint(X));const pt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==d,this._rotating=this._rotating||f!==P,this._pitching=this._pitching||z!==y,this._padding=!a.isPaddingEqual(O),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,pt),this._ease(Tt=>{if(this._zooming&&(a.zoom=h.number(d,I,Tt)),this._rotating&&(a.bearing=h.number(f,P,Tt)),this._pitching&&(a.pitch=h.number(y,z,Tt)),this._padding&&(a.interpolatePadding(T,O,Tt),H=a.centerPoint.add(Z)),X)a.setLocationAtPoint(X,_t);else{const St=a.zoomScale(a.zoom-d),Mt=I>d?Math.min(2,dt):Math.max(.5,dt),bt=Math.pow(Mt,1-Tt),Vt=a.unproject(rt.add(ht.mult(Tt*bt)).mult(St));a.setLocationAtPoint(a.renderWorldCopies?Vt.wrap():Vt,H)}this._fireMoveEvents(s)},Tt=>{this._afterEase(s,Tt)},e),this}_prepareEase(e,s,a={}){this._moving=!0,this.fire(new h.Event("freezeElevation",{freeze:!0})),s||a.moving||this.fire(new h.Event("movestart",e)),this._zooming&&!a.zooming&&this.fire(new h.Event("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new h.Event("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new h.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new h.Event("move",e)),this._zooming&&this.fire(new h.Event("zoom",e)),this._rotating&&this.fire(new h.Event("rotate",e)),this._pitching&&this.fire(new h.Event("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new h.Event("freezeElevation",{freeze:!1}));const a=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new h.Event("zoomend",e)),d&&this.fire(new h.Event("rotateend",e)),f&&this.fire(new h.Event("pitchend",e)),this.fire(new h.Event("moveend",e))}flyTo(e,s){if(!e.essential&&h.exported.prefersReducedMotion){const Qt=h.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qt,s)}this.stop(),e=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},e);const a=this.transform,d=this.getZoom(),f=this.getBearing(),y=this.getPitch(),T=this.getPadding(),I="zoom"in e?h.clamp(+e.zoom,a.minZoom,a.maxZoom):d,P="bearing"in e?this._normalizeBearing(e.bearing,f):f,z="pitch"in e?+e.pitch:y,O="padding"in e?e.padding:a.padding,Z=a.zoomScale(I-d),H=h.pointGeometry.convert(e.offset);let j=a.centerPoint.add(H);const W=a.pointLocation(j),rt=h.LngLat.convert(e.center||W);this._normalizeCenter(rt);const ht=a.project(W),dt=a.project(rt).sub(ht);let X=e.curve;const _t=Math.max(a.width,a.height),pt=_t/Z,Tt=dt.mag();if("minZoom"in e){const Qt=h.clamp(Math.min(e.minZoom,d,I),a.minZoom,a.maxZoom),Ve=_t/a.zoomScale(Qt-d);X=Math.sqrt(Ve/Tt*2)}const St=X*X;function Mt(Qt){const Ve=(pt*pt-_t*_t+(Qt?-1:1)*St*St*Tt*Tt)/(2*(Qt?pt:_t)*St*Tt);return Math.log(Math.sqrt(Ve*Ve+1)-Ve)}function bt(Qt){return(Math.exp(Qt)-Math.exp(-Qt))/2}function Vt(Qt){return(Math.exp(Qt)+Math.exp(-Qt))/2}const Rt=Mt(0);let jt=function(Qt){return Vt(Rt)/Vt(Rt+X*Qt)},pe=function(Qt){return _t*((Vt(Rt)*(bt(Ve=Rt+X*Qt)/Vt(Ve))-bt(Rt))/St)/Tt;var Ve},ye=(Mt(1)-Rt)/X;if(Math.abs(Tt)<1e-6||!isFinite(ye)){if(Math.abs(_t-pt)<1e-6)return this.easeTo(e,s);const Qt=pt<_t?-1:1;ye=Math.abs(Math.log(pt/_t))/X,pe=function(){return 0},jt=function(Ve){return Math.exp(Qt*X*Ve)}}return e.duration="duration"in e?+e.duration:1e3*ye/("screenSpeed"in e?+e.screenSpeed/X:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==P,this._pitching=z!==y,this._padding=!a.isPaddingEqual(O),this._prepareEase(s,!1),this._ease(Qt=>{const Ve=Qt*ye,Ge=1/jt(Ve);a.zoom=Qt===1?I:d+a.scaleZoom(Ge),this._rotating&&(a.bearing=h.number(f,P,Qt)),this._pitching&&(a.pitch=h.number(y,z,Qt)),this._padding&&(a.interpolatePadding(T,O,Qt),j=a.centerPoint.add(H));const Le=Qt===1?rt:a.unproject(ht.add(dt.mult(pe(Ve))).mult(Ge));a.setLocationAtPoint(a.renderWorldCopies?Le.wrap():Le,j),this._fireMoveEvents(s)},()=>this._afterEase(s),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,s)}if(!e){const a=this.handlers;a&&a.stop(!1)}return this}_ease(e,s,a){a.animate===!1||a.duration===0?(e(1),s()):(this._easeStart=h.exported.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,s){e=h.wrap(e,-180,180);const a=Math.abs(e-s);return Math.abs(e-360-s)<a&&(e-=360),Math.abs(e+360-s)<a&&(e+=360),e}_normalizeCenter(e){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const a=e.lng-s.center.lng;e.lng+=a>180?-360:a<-180?360:0}}class Ws{constructor(e={}){this.options=e,h.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=ft.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ft.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ft.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ft.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const a=this._map._getUIString(`AttributionControl.${s}`);e.title=a,e.setAttribute("aria-label",a)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"&&e.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style.sourceCaches;for(const d in s){const f=s[d];if(f.used||f.usedForTerrain){const y=f.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,f)=>d.length-f.length),e=e.filter((d,f)=>{for(let y=f+1;y<e.length;y++)if(e[y].indexOf(d)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class r{constructor(e={}){this.options=e,h.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ft.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=ft.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ft.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const e=this._container.children;if(e.length){const s=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class l{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,a=s?this._queue.concat(s):this._queue;for(const d of a)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const a of s)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const _={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},b={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},A={showCompass:!0,showZoom:!0,visualizePitch:!1};class U{constructor(e,s,a=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new xn({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,a&&(this.mousePitch=new qt({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ft.addEventListener(s,"mousedown",this.mousedown),ft.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),ft.addEventListener(s,"touchmove",this.touchmove),ft.addEventListener(s,"touchend",this.touchend),ft.addEventListener(s,"touchcancel",this.reset)}down(e,s){this.mouseRotate.mousedown(e,s),this.mousePitch&&this.mousePitch.mousedown(e,s),ft.disableDrag()}move(e,s){const a=this.map,d=this.mouseRotate.mousemoveWindow(e,s);if(d&&d.bearingDelta&&a.setBearing(a.getBearing()+d.bearingDelta),this.mousePitch){const f=this.mousePitch.mousemoveWindow(e,s);f&&f.pitchDelta&&a.setPitch(a.getPitch()+f.pitchDelta)}}off(){const e=this.element;ft.removeEventListener(e,"mousedown",this.mousedown),ft.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ft.removeEventListener(e,"touchmove",this.touchmove),ft.removeEventListener(e,"touchend",this.touchend),ft.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ft.enableDrag(),ft.removeEventListener(window,"mousemove",this.mousemove),ft.removeEventListener(window,"mouseup",this.mouseup)}mousedown(e){this.down(h.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),ft.mousePos(this.element,e)),ft.addEventListener(window,"mousemove",this.mousemove),ft.addEventListener(window,"mouseup",this.mouseup)}mousemove(e){this.move(e,ft.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ft.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=ft.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function et(c,e,s){if(c=new h.LngLat(c.lng,c.lat),e){const a=new h.LngLat(c.lng-360,c.lat),d=new h.LngLat(c.lng+360,c.lat),f=s.locationPoint(c).distSqr(e);s.locationPoint(a).distSqr(e)<f?c=a:s.locationPoint(d).distSqr(e)<f&&(c=d)}for(;Math.abs(c.lng-s.center.lng)>180;){const a=s.locationPoint(c);if(a.x>=0&&a.y>=0&&a.x<=s.width&&a.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const it={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ot(c,e,s){const a=c.classList;for(const d in it)a.remove(`maplibregl-${s}-anchor-${d}`,`mapboxgl-${s}-anchor-${d}`);a.add(`maplibregl-${s}-anchor-${e}`,`mapboxgl-${s}-anchor-${e}`)}class Ct extends h.Evented{constructor(e,s){if(super(),(e instanceof HTMLElement||s)&&(e=h.extend({element:e},s)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=h.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ft.create("div"),this._element.setAttribute("aria-label","Map marker");const a=ft.createNS("http://www.w3.org/2000/svg","svg"),d=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${d}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${d}`);const y=ft.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=ft.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const I=ft.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const dt of P){const X=ft.createNS("http://www.w3.org/2000/svg","ellipse");X.setAttributeNS(null,"opacity","0.04"),X.setAttributeNS(null,"cx","10.5"),X.setAttributeNS(null,"cy","5.80029008"),X.setAttributeNS(null,"rx",dt.rx),X.setAttributeNS(null,"ry",dt.ry),I.appendChild(X)}const z=ft.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const O=ft.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(O);const Z=ft.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const H=ft.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(H);const j=ft.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const W=ft.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const rt=ft.createNS("http://www.w3.org/2000/svg","circle");rt.setAttributeNS(null,"fill","#000000"),rt.setAttributeNS(null,"opacity","0.25"),rt.setAttributeNS(null,"cx","5.5"),rt.setAttributeNS(null,"cy","5.5"),rt.setAttributeNS(null,"r","5.4999962");const ht=ft.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#FFFFFF"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962"),W.appendChild(rt),W.appendChild(ht),T.appendChild(I),T.appendChild(z),T.appendChild(Z),T.appendChild(j),T.appendChild(W),a.appendChild(T),a.setAttributeNS(null,"height",d*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=h.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),ot(this._element,this._anchor,"marker"),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ft.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const s=e.code,a=e.charCode||e.keyCode;s!=="Space"&&s!=="Enter"&&a!==32&&a!==13||this.togglePopup()}_onMapClick(e){const s=e.originalEvent.target,a=this._element;this._popup&&(s===a||a.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=et(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let a="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?a="rotateX(0deg)":this._pitchAlignment==="map"&&(a=`rotateX(${this._map.getPitch()}deg)`),e&&e.type!=="moveend"||(this._pos=this._pos.round()),ft.setTransform(this._element,`${it[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${a} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const d=this._map.unproject(this._pos),f=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=d.distanceTo(this._lngLat)>20*f?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(e){return this._offset=h.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const $t={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let se,oe=0,xi=!1;const ki={maxWidth:100,unit:"metric"};function Hs(c,e,s){const a=s&&s.maxWidth||100,d=c._container.clientHeight/2,f=c.unproject([0,d]),y=c.unproject([a,d]),T=f.distanceTo(y);if(s&&s.unit==="imperial"){const I=3.2808*T;I>5280?$i(e,a,I/5280,c._getUIString("ScaleControl.Miles")):$i(e,a,I,c._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?$i(e,a,T/1852,c._getUIString("ScaleControl.NauticalMiles")):T>=1e3?$i(e,a,T/1e3,c._getUIString("ScaleControl.Kilometers")):$i(e,a,T,c._getUIString("ScaleControl.Meters"))}function $i(c,e,s,a){const d=function(f){const y=Math.pow(10,`${Math.floor(f)}`.length-1);let T=f/y;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){const P=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*P)/P}(T),y*T}(s);c.style.width=e*(d/s)+"px",c.innerHTML=`${d}&nbsp;${a}`}const ti={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yo(c){if(c){if(typeof c=="number"){const e=Math.round(Math.sqrt(.5*Math.pow(c,2)));return{center:new h.pointGeometry(0,0),top:new h.pointGeometry(0,c),"top-left":new h.pointGeometry(e,e),"top-right":new h.pointGeometry(-e,e),bottom:new h.pointGeometry(0,-c),"bottom-left":new h.pointGeometry(e,-e),"bottom-right":new h.pointGeometry(-e,-e),left:new h.pointGeometry(c,0),right:new h.pointGeometry(-c,0)}}if(c instanceof h.pointGeometry||Array.isArray(c)){const e=h.pointGeometry.convert(c);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.pointGeometry.convert(c.center||[0,0]),top:h.pointGeometry.convert(c.top||[0,0]),"top-left":h.pointGeometry.convert(c["top-left"]||[0,0]),"top-right":h.pointGeometry.convert(c["top-right"]||[0,0]),bottom:h.pointGeometry.convert(c.bottom||[0,0]),"bottom-left":h.pointGeometry.convert(c["bottom-left"]||[0,0]),"bottom-right":h.pointGeometry.convert(c["bottom-right"]||[0,0]),left:h.pointGeometry.convert(c.left||[0,0]),right:h.pointGeometry.convert(c.right||[0,0])}}return Yo(new h.pointGeometry(0,0))}const rs={supported:Pt,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends Qe{constructor(c){var e;if(h.PerformanceUtils.mark(h.PerformanceMarkers.create),(c=h.extend({},b,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new jn(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._interactive=c.interactive,this._cooperativeGestures=c.cooperativeGestures,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=c.collectResourceTiming,this._renderTaskQueue=new l,this._controls=[],this._mapId=h.uniqueId(),this._locale=h.extend({},_,c.locale),this._clickTolerance=c.clickTolerance,this._pixelRatio=(e=c.pixelRatio)!==null&&e!==void 0?e:devicePixelRatio,this._requestManager=new ci(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _a(this,c),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=c.hash&&new da(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,h.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new Ws({customAttribution:c.customAttribution})),c.maplibreLogo&&this.addControl(new r,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new h.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new h.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new h.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(c,e){if(e===void 0&&(e=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(s,a.firstChild):a.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(c);return e>-1&&this._controls.splice(e,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}calculateCameraOptionsFromTo(c,e,s,a){return a==null&&this.style.terrain&&(a=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(c,e,s,a)}resize(c){const e=this._containerDimensions(),s=e[0],a=e[1];this._resizeCanvas(s,a,this.getPixelRatio()),this.transform.resize(s,a),this.painter.resize(s,a,this.getPixelRatio());const d=!this._moving;return d&&(this.stop(),this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c))),this.fire(new h.Event("resize",c)),d&&this.fire(new h.Event("moveend",c)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(c){const[e,s]=this._containerDimensions();this._pixelRatio=c,this._resizeCanvas(e,s,c),this.painter.resize(e,s,c)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(c){return this.transform.setMaxBounds(h.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c&&this.setZoom(c),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c&&this.setZoom(c),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c&&this.setPitch(c),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c&&this.setPitch(c),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this._update()}project(c){return this.transform.locationPoint(h.LngLat.convert(c),this.style&&this.style.terrain)}unproject(c){return this.transform.pointLocation(h.pointGeometry.convert(c),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(c,e,s){if(c==="mouseenter"||c==="mouseover"){let a=!1;return{layer:e,listener:s,delegates:{mousemove:f=>{const y=this.getLayer(e)?this.queryRenderedFeatures(f.point,{layers:[e]}):[];y.length?a||(a=!0,s.call(this,new Li(c,this,f.originalEvent,{features:y}))):a=!1},mouseout:()=>{a=!1}}}}if(c==="mouseleave"||c==="mouseout"){let a=!1;return{layer:e,listener:s,delegates:{mousemove:y=>{(this.getLayer(e)?this.queryRenderedFeatures(y.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,s.call(this,new Li(c,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,s.call(this,new Li(c,this,y.originalEvent)))}}}}{const a=d=>{const f=this.getLayer(e)?this.queryRenderedFeatures(d.point,{layers:[e]}):[];f.length&&(d.features=f,s.call(this,d),delete d.features)};return{layer:e,listener:s,delegates:{[c]:a}}}}on(c,e,s){if(s===void 0)return super.on(c,e);const a=this._createDelegatedListener(c,e,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(a);for(const d in a.delegates)this.on(d,a.delegates[d]);return this}once(c,e,s){if(s===void 0)return super.once(c,e);const a=this._createDelegatedListener(c,e,s);for(const d in a.delegates)this.once(d,a.delegates[d]);return this}off(c,e,s){return s===void 0?super.off(c,e):(this._delegatedListeners&&this._delegatedListeners[c]&&(a=>{const d=this._delegatedListeners[c];for(let f=0;f<d.length;f++){const y=d[f];if(y.layer===e&&y.listener===s){for(const T in y.delegates)this.off(T,y.delegates[T]);return d.splice(f,1),this}}})(),this)}queryRenderedFeatures(c,e){if(!this.style)return[];let s;if(e!==void 0||c===void 0||c instanceof h.pointGeometry||Array.isArray(c)||(e=c,c=void 0),e=e||{},(c=c||[[0,0],[this.transform.width,this.transform.height]])instanceof h.pointGeometry||typeof c[0]=="number")s=[h.pointGeometry.convert(c)];else{const a=h.pointGeometry.convert(c[0]),d=h.pointGeometry.convert(c[1]);s=[a,new h.pointGeometry(d.x,a.y),d,new h.pointGeometry(a.x,d.y),a]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(c,e){return this.style.querySourceFeatures(c,e)}setStyle(c,e){return(e=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&c?(this._diffStyle(c,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(c,e))}setTransformRequest(c){return this._requestManager.setTransformRequest(c),this}_getUIString(c){const e=this._locale[c];if(e==null)throw new Error(`Missing UI string '${c}'`);return e}_updateStyle(c,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),c?(this.style=new fi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,e){if(typeof c=="string"){const s=this._requestManager.transformRequest(c,h.ResourceType.Style);h.getJSON(s,(a,d)=>{a?this.fire(new h.ErrorEvent(a)):d&&this._updateDiff(d,e)})}else typeof c=="object"&&this._updateDiff(c,e)}_updateDiff(c,e){try{this.style.setState(c)&&this._update(!0)}catch(s){h.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.warnOnce("There is no style added to the map.")}addSource(c,e){return this._lazyInitEmptyStyle(),this.style.addSource(c,e),this._update(!0)}isSourceLoaded(c){const e=this.style&&this.style.sourceCaches[c];if(e!==void 0)return e.loaded();this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${c}'`)))}setTerrain(c){return this.style.setTerrain(c),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const c=this.style&&this.style.sourceCaches;for(const e in c){const s=c[e]._tiles;for(const a in s){const d=s[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}addSourceType(c,e,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(c,e,s)}removeSource(c){return this.style.removeSource(c),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,e,{pixelRatio:s=1,sdf:a=!1,stretchX:d,stretchY:f,content:y}={}){if(this._lazyInitEmptyStyle(),e instanceof HTMLImageElement||h.isImageBitmap(e)){const{width:T,height:I,data:P}=h.exported.getImageData(e);this.style.addImage(c,{data:new h.RGBAImage({width:T,height:I},P),pixelRatio:s,stretchX:d,stretchY:f,content:y,sdf:a,version:0})}else{if(e.width===void 0||e.height===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:I,data:P}=e,z=e;this.style.addImage(c,{data:new h.RGBAImage({width:T,height:I},new Uint8Array(P)),pixelRatio:s,stretchX:d,stretchY:f,content:y,sdf:a,version:0,userImage:z}),z.onAdd&&z.onAdd(this,c)}}}updateImage(c,e){const s=this.style.getImage(c);if(!s)return this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||h.isImageBitmap(e)?h.exported.getImageData(e):e,{width:d,height:f,data:y}=a;if(d===void 0||f===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==s.data.width||f!==s.data.height)return this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||h.isImageBitmap(e));s.data.replace(y,T),this.style.updateImage(c,s)}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,e){h.getImage(this._requestManager.transformRequest(c,h.ResourceType.Image),e)}listImages(){return this.style.listImages()}addLayer(c,e){return this._lazyInitEmptyStyle(),this.style.addLayer(c,e),this._update(!0)}moveLayer(c,e){return this.style.moveLayer(c,e),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,e,s){return this.style.setLayerZoomRange(c,e,s),this._update(!0)}setFilter(c,e,s={}){return this.style.setFilter(c,e,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,e,s,a={}){return this.style.setPaintProperty(c,e,s,a),this._update(!0)}getPaintProperty(c,e){return this.style.getPaintProperty(c,e)}setLayoutProperty(c,e,s,a={}){return this.style.setLayoutProperty(c,e,s,a),this._update(!0)}getLayoutProperty(c,e){return this.style.getLayoutProperty(c,e)}setLight(c,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(c,e){return this.style.setFeatureState(c,e),this._update()}removeFeatureState(c,e){return this.style.removeFeatureState(c,e),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let c=0,e=0;return this._container&&(c=this._container.clientWidth||400,e=this._container.clientHeight||300),[c,e]}_setupContainer(){const c=this._container;c.classList.add("maplibregl-map","mapboxgl-map");const e=this._canvasContainer=ft.create("div","maplibregl-canvas-container mapboxgl-canvas-container",c);this._interactive&&e.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=ft.create("canvas","maplibregl-canvas mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const a=this._controlContainer=ft.create("div","maplibregl-control-container mapboxgl-control-container",c),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{d[f]=ft.create("div",`maplibregl-ctrl-${f} mapboxgl-ctrl-${f}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const c=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=ft.create("div","maplibregl-cooperative-gesture-screen",c);let e="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map",e="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",a=>{a.key===e&&(this._metaPress=!0)}),document.addEventListener("keyup",a=>{a.key===e&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",a=>{this._onCooperativeGesture(a,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(c,e,s){this._canvas.width=s*c,this._canvas.height=s*e,this._canvas.style.width=`${c}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const c=h.extend({},Pt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);e?(this.painter=new Zs(e,this.transform),h.exported$1.testSupport(e)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(c,e,s){return!e&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_render(c){let e,s=0;const a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(e=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,e),s=h.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(c),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,T=h.exported.now();this.style.zoomHistory.update(y,T);const I=new h.EvaluationParameters(y,{now:T,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=I.crossFadingFactor();P===1&&P===this._crossFadingFactor||(d=!0,this._crossFadingFactor=P),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.PerformanceUtils.mark(h.PerformanceMarkers.load),this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const y=h.exported.now()-s;a.endQueryEXT(a.TIME_ELAPSED_EXT,e),setTimeout(()=>{const T=a.getQueryObjectEXT(e,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(e),this.fire(new h.Event("gpu-timing-frame",{cpuTime:y,gpuTime:T}))},50)}if(this.listens("gpu-timing-layer")){const y=this.painter.collectGpuTimers();setTimeout(()=>{const T=this.painter.queryGpuTimers(y);this.fire(new h.Event("gpu-timing-layer",{layerTimes:T}))},50)}const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,h.PerformanceUtils.mark(h.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ft.remove(this._canvasContainer),ft.remove(this._controlContainer),this._cooperativeGestures&&ft.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),h.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=h.exported.frame(c=>{h.PerformanceUtils.frame(c),this._frame=null,this._render(c)}))}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}_setCacheLimits(c,e){h.setCacheLimits(c,e)}get version(){return"2.4.0"}},NavigationControl:class{constructor(c){this.options=h.extend({},A,c),this._container=ft.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),ft.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),ft.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=ft.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map.getZoom(),e=c===this._map.getMaxZoom(),s=c===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new U(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ft.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(c,e){const s=ft.create("button",c,this._container);return s.type="button",s.addEventListener("click",e),s}_setButtonTitle(c,e){const s=this._map._getUIString(`NavigationControl.${e}`);c.title=s,c.setAttribute("aria-label",s)}},GeolocateControl:class extends h.Evented{constructor(c){super(),this.options=h.extend({},$t,c),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(c){var e;return this._map=c,this._container=ft.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,se!==void 0?e(se):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{se=s.state!=="denied",e(se)}):(se=!!window.navigator.geolocation,e(se)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ft.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,oe=0,xi=!1}_isOutOfMapMaxBounds(c){const e=this._map.getMaxBounds(),s=c.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",c)),this._finish()}}_updateCamera(c){const e=new h.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,a=this._map.getBearing(),d=h.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(s),d,{geolocateSource:!0})}_updateMarker(c){if(c){const e=new h.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map._container.clientHeight/2,e=this._map.unproject([0,c]),s=this._map.unproject([1,c]),a=e.distanceTo(s),d=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&xi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=ft.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),ft.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ft.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ct(this._dotElement),this._circleElement=ft.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ct({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":oe--,xi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),oe++,oe>1?(c={maximumAge:6e5,timeout:0},xi=!0):(c=this.options.positionOptions,xi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ws,LogoControl:r,ScaleControl:class{constructor(c){this.options=h.extend({},ki,c),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Hs(this._map,this._container,this.options)}onAdd(c){return this._map=c,this._container=ft.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ft.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(c){this.options.unit=c,Hs(this._map,this._container,this.options)}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=ft.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ft.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=ft.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);ft.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(c){this.options=c,h.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(c){return this._map=c,this._container=ft.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=ft.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),ft.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ft.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends h.Evented{constructor(c){super(),this.options=h.extend(Object.create(ti),c),h.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ft.remove(this._content),this._container&&(ft.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=h.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const e=document.createDocumentFragment(),s=document.createElement("body");let a;for(s.innerHTML=c;a=s.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ft.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(c){this._container&&this._container.classList.add(c)}removeClassName(c){this._container&&this._container.classList.remove(c)}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){if(this._container)return this._container.classList.toggle(c)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ft.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(c){this._update(c.point)}_onMouseMove(c){this._update(c.point)}_onDrag(c){this._update(c.point)}_update(c){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=ft.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=ft.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(f=>this._container.classList.add(f)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=et(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!c))return;const e=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);let s=this.options.anchor;const a=Yo(this.options.offset);if(!s){const f=this._container.offsetWidth,y=this._container.offsetHeight;let T;T=e.y+a.bottom.y<y?["top"]:e.y>this._map.transform.height-y?["bottom"]:[],e.x<f/2?T.push("left"):e.x>this._map.transform.width-f/2&&T.push("right"),s=T.length===0?"bottom":T.join("-")}const d=e.add(a[s]).round();ft.setTransform(this._container,`${it[s]} translate(${d.x}px,${d.y}px)`),ot(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(mi);c&&c.focus()}_onClose(){this.remove()}},Marker:Ct,Style:fi,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,Evented:h.Evented,AJAXError:h.AJAXError,config:h.config,CanvasSource:Ze,GeoJSONSource:sn,ImageSource:gn,RasterDEMTileSource:Jt,RasterTileSource:Ci,VectorTileSource:us,VideoSource:ne,prewarm:function(){Zr().acquire(on)},clearPrewarmedResources:function(){const c=tr;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(on),tr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Vi.workerCount},set workerCount(c){Vi.workerCount=c},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){h.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){h.clearTileCache(c)},workerUrl:"",addProtocol(c,e){h.config.REGISTERED_PROTOCOLS[c]=e},removeProtocol(c){delete h.config.REGISTERED_PROTOCOLS[c]}};return un.extend(rs,{isSafari:h.isSafari,getPerformanceMetrics:h.PerformanceUtils.getPerformanceMetrics}),rs});var lt=R;return lt})})(Df);const wu=Rh;var Bf=gt.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(g){gt.setOptions(this,g),this._throttledUpdate=gt.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(g){this._container||this._initContainer();const x=this.getPaneName();g.getPane(x).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),g.options.zoomAnimation&&gt.DomEvent.on(g._proxy,gt.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(g){this._map._proxy&&this._map.options.zoomAnimation&&gt.DomEvent.off(this._map._proxy,gt.DomUtil.TRANSITION_END,this._transitionEnd,this);const x=this.getPaneName();g.getPane(x).removeChild(this._container),this._container=null,this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaplibreMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getOpacity:function(){return this.options.opacity},setOpacity:function(g){this.options.opacity=g,this._container.style.opacity=g},getBounds:function(){const g=this.getSize().multiplyBy(.5),x=this._map.latLngToContainerPoint(this._map.getCenter());return gt.latLngBounds(this._map.containerPointToLatLng(x.subtract(g)),this._map.containerPointToLatLng(x.add(g)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_initContainer:function(){if(this._container)return;this._container=gt.DomUtil.create("div","leaflet-gl-layer");const g=this.getSize(),x=this._map.getSize().multiplyBy(this.options.padding);this._container.style.width=g.x+"px",this._container.style.height=g.y+"px";const S=this._map.containerPointToLayerPoint([0,0]).subtract(x);gt.DomUtil.setPosition(this._container,S)},_initGL:function(){if(this._glMap)return;const g=this._map.getCenter(),x=gt.extend({},this.options,{container:this._container,center:[g.lng,g.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new wu.Map(x),this._glMap.once("styledata",function(D){this.fire("styleLoaded")}.bind(this)),this._glMap.transform.latRange=null,this._glMap.transform.maxValidLatitude=1/0,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;const S=this._glMap._actualCanvas;gt.DomUtil.addClass(S,"leaflet-image-layer"),gt.DomUtil.addClass(S,"leaflet-zoom-animated"),this.options.interactive&&gt.DomUtil.addClass(S,"leaflet-interactive"),this.options.className&&gt.DomUtil.addClass(S,this.options.className)},_update:function(g){if(this._offset=this._map.containerPointToLayerPoint([0,0]),this._zooming)return;const x=this.getSize(),S=this._container,D=this._glMap,R=this._map.getSize().multiplyBy(this.options.padding),J=this._map.containerPointToLayerPoint([0,0]).subtract(R);gt.DomUtil.setPosition(S,J),this._transformGL(D),D.transform.width!==x.x||D.transform.height!==x.y?(S.style.width=x.x+"px",S.style.height=x.y+"px",D._resize!==null&&D._resize!==void 0?D._resize():D.resize()):D._update!==null&&D._update!==void 0?D._update():D.update()},_transformGL:function(g){const x=this._map.getCenter(),S=g.transform;S.center=wu.LngLat.convert([x.lng,x.lat]),S.zoom=this._map.getZoom()-1},_pinchZoom:function(g){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(g){const x=this._map.getZoomScale(g.zoom),S=this._map.getSize().multiplyBy(this.options.padding*x),D=this.getSize()._divideBy(2),R=this._map.project(g.center,g.zoom)._subtract(D)._add(this._map._getMapPanePos().add(S))._round(),J=this._map.project(this._map.getBounds().getNorthWest(),g.zoom)._subtract(R);gt.DomUtil.setTransform(this._glMap._actualCanvas,J.subtract(this._offset),x)},_zoomStart:function(g){this._zooming=!0},_zoomEnd:function(){const g=this._map.getZoomScale(this._map.getZoom());gt.DomUtil.setTransform(this._glMap._actualCanvas,null,g),this._zooming=!1,this._update()},_transitionEnd:function(g){gt.Util.requestAnimFrame(function(){const x=this._map.getZoom(),S=this._map.getCenter(),D=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());gt.DomUtil.setTransform(this._glMap._actualCanvas,D,1),this._glMap.once("moveend",gt.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:S,zoom:x-1})},this)}});function Qu(g){return new Bf(g)}var Rf=gt.Layer.extend({options:{key:"ArcGIS:Streets"},initialize:function(g,x){if(x&&gt.setOptions(this,x),this.options.apiKey&&(this.options.apikey=this.options.apiKey),this.options.token&&(this.options.apikey=this.options.token),!(this.options.apikey||this.options.token))throw new Error("API Key or token is required for vectorBasemapLayer.");g&&(this.options.key=g),this._createLayer()},_createLayer:function(){const g=Pf(this.options.key,this.options.apikey);this._maplibreGL=Qu({style:g,pane:this.options.pane,opacity:this.options.opacity}),this._ready=!0,this.fire("ready",{},!0),this._maplibreGL.on("styleLoaded",function(x){this._setupAttribution()}.bind(this))},_setupAttribution:function(){const g=this._map;if(rl.setEsriAttribution(g),this.options.key.length===32){const x=this._maplibreGL.getMaplibreMap().style.stylesheet.sources,S=[];Object.keys(x).forEach(function(D){S.push(x[D].attribution),x[D].copyrightText&&x[D].copyrightText&&x[D].copyrightText!==""&&x[D].attribution!==x[D].copyrightText&&S.push(x[D].copyrightText)}),g.attributionControl.addAttribution('<span class="">'+S.join(", ")+"</span>")}else if(this.options.attributionUrls||(this.options.attributionUrls=this._getAttributionUrls(this.options.key)),this._map&&this.options.attributionUrls){if(this._map.attributionControl){for(let x=0;x<this.options.attributionUrls.length;x++){const S=this.options.attributionUrls[x];zf(S,g)}g.attributionControl.addAttribution('<span class="esri-dynamic-attribution"></span>')}rl._updateMapAttribution({target:this._map})}},_getAttributionUrls:function(g){return g.indexOf("OSM:")===0?["https://static.arcgis.com/attribution/Vector/OpenStreetMap_v2"]:g.indexOf("ArcGIS:Imagery")===0?["https://static.arcgis.com/attribution/World_Imagery","https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]:["https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]},onAdd:function(g){this._map=g,this._initPane(),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},_initPane:function(){if(this.options.pane||(this.options.key.indexOf(":Labels")>-1?this.options.pane="esri-labels":this.options.pane="tilePane"),!this._map.getPane(this.options.pane)){const g=this._map.createPane(this.options.pane);g.style.pointerEvents="none",g.style.zIndex=this.options.pane==="esri-labels"?550:500}},onRemove:function(g){if(g.off("moveend",rl._updateMapAttribution),g.removeLayer(this._maplibreGL),g.attributionControl){const x=document.getElementsByClassName("esri-dynamic-attribution");if(x&&x.length>0){const S=x[0].outerHTML;g.attributionControl.removeAttribution(S)}}},_asyncAdd:function(){const g=this._map;g.on("moveend",rl._updateMapAttribution),this._maplibreGL.addTo(g,this)}});function Of(g,x){return new Rf(g,x)}gt.Layer.extend({options:{pane:"overlayPane",portalUrl:"https://www.arcgis.com"},initialize:function(g,x){if(x&&gt.setOptions(this,x),this.options.apiKey&&(this.options.apikey=this.options.apiKey),this.options.apikey&&(this.options.token=this.options.apikey),!g)throw new Error("An ITEM ID or SERVICE URL is required for vectorTileLayer.");g&&(this.options.key=g),this._createLayer()},_createLayer:function(){Af(this.options.key,this.options,function(g,x,S,D){if(g)throw new Error(g);if(kf(D.tileInfo.spatialReference.wkid)||console.warn('This layer is not guaranteed to display properly because its service does not use the Web Mercator projection. The "tileInfo.spatialReference" property is:',D.tileInfo.spatialReference,`
More information is available at https://github.com/maplibre/maplibre-gl-js/issues/168 and https://github.com/Esri/esri-leaflet-vector/issues/94.`),x=Mf(x,S,D,this.options.token),!this.getAttribution()){const R=Object.keys(x.sources);this.options.attribution=x.sources[R[R.length-1]].attribution,this._map&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution())}this.options.style&&typeof this.options.style=="function"&&(x=this.options.style(x)),this._maplibreGL=Qu({style:x,pane:this.options.pane,opacity:this.options.opacity}),this._ready=!0,this.fire("ready",{},!0)}.bind(this))},onAdd:function(g){this._map=g,this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(g){g.removeLayer(this._maplibreGL)},_asyncAdd:function(){const g=this._map;this._maplibreGL.addTo(g,this)}});const Ff="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",Uf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";function Nf(g){let x,S,D;return{c(){x=Eu("div"),Pu(x,"class","svelte-1aboi1f")},m(R,J){Iu(R,x,J),S||(D=Gp(g[0].call(null,x)),S=!0)},p:Lo,i:Lo,o:Lo,d(R){R&&Fh(x),S=!1,D()}}}function Zf(g){const x="AAPK5f7db353b9a24f2e98c150e6eae03806djhOVrLffVWgu4cP9isr934iNjV7bAWI9z3eWZUQcyu9ADnErqcwxD6abFH43tPy";return[D=>{let R=new gt.Icon({iconUrl:Ff,shadowUrl:Uf,iconAnchor:[12,41],popupAnchor:[0,-41]});gt.Marker.prototype.options.icon=R;const J=new gt.Map(D);J.setView([25.773924,-80.196075],6),Of("ArcGIS:Streets",{apiKey:x}).addTo(J),new Ef({url:"https://sampleserver6.arcgisonline.com/arcgis/rest/services/SampleWorldCities/MapServer/0"}).addTo(J).bindPopup(function(h){return`<p><strong>${h.feature.properties.CITY_NAME}</strong><br /> Population: ${h.feature.properties.POP.toLocaleString("en")}</p>`})}]}let Vf=class extends ku{constructor(x){super(),Lu(this,x,Zf,Nf,Su,{})}};function Gf(g){let x,S,D;return S=new Vf({}),{c(){x=Eu("main"),Kp(S.$$.fragment),Pu(x,"class","svelte-1lux779")},m(R,J){Iu(R,x,J),Mu(S,x,null),D=!0},p:Lo,i(R){D||(Cu(S.$$.fragment,R),D=!0)},o(R){Xp(S.$$.fragment,R),D=!1},d(R){R&&Fh(x),zu(S)}}}class qf extends ku{constructor(x){super(),Lu(this,x,null,Gf,Su,{})}}new qf({target:document.getElementById("app")});
