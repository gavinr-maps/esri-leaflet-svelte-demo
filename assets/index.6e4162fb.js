(function(){const x=document.createElement("link").relList;if(x&&x.supports&&x.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))k(R);new MutationObserver(R=>{for(const Y of R)if(Y.type==="childList")for(const ot of Y.addedNodes)ot.tagName==="LINK"&&ot.rel==="modulepreload"&&k(ot)}).observe(document,{childList:!0,subtree:!0});function S(R){const Y={};return R.integrity&&(Y.integrity=R.integrity),R.referrerpolicy&&(Y.referrerPolicy=R.referrerpolicy),R.crossorigin==="use-credentials"?Y.credentials="include":R.crossorigin==="anonymous"?Y.credentials="omit":Y.credentials="same-origin",Y}function k(R){if(R.ep)return;R.ep=!0;const Y=S(R);fetch(R.href,Y)}})();function ra(){}function bu(g){return g()}function fu(){return Object.create(null)}function Ul(g){g.forEach(bu)}function wu(g){return typeof g=="function"}function Tu(g,x){return g!=g?x==x:g!==x||g&&typeof g=="object"||typeof g=="function"}function Vd(g){return Object.keys(g).length===0}function Gd(g){return g&&wu(g.destroy)?g.destroy:ra}function Su(g,x,S){g.insertBefore(x,S||null)}function Rh(g){g.parentNode.removeChild(g)}function Iu(g){return document.createElement(g)}function Eu(g,x,S){S==null?g.removeAttribute(x):g.getAttribute(x)!==S&&g.setAttribute(x,S)}function qd(g){return Array.from(g.childNodes)}let Oh;function rl(g){Oh=g}const il=[],mu=[],Dl=[],_u=[],$d=Promise.resolve();let Mh=!1;function jd(){Mh||(Mh=!0,$d.then(Pu))}function zh(g){Dl.push(g)}const Ah=new Set;let Ll=0;function Pu(){const g=Oh;do{for(;Ll<il.length;){const x=il[Ll];Ll++,rl(x),Wd(x.$$)}for(rl(null),il.length=0,Ll=0;mu.length;)mu.pop()();for(let x=0;x<Dl.length;x+=1){const S=Dl[x];Ah.has(S)||(Ah.add(S),S())}Dl.length=0}while(il.length);for(;_u.length;)_u.pop()();Mh=!1,Ah.clear(),rl(g)}function Wd(g){if(g.fragment!==null){g.update(),Ul(g.before_update);const x=g.dirty;g.dirty=[-1],g.fragment&&g.fragment.p(g.ctx,x),g.after_update.forEach(zh)}}const Bl=new Set;let Hd;function Au(g,x){g&&g.i&&(Bl.delete(g),g.i(x))}function Xd(g,x,S,k){if(g&&g.o){if(Bl.has(g))return;Bl.add(g),Hd.c.push(()=>{Bl.delete(g),k&&(S&&g.d(1),k())}),g.o(x)}else k&&k()}function Kd(g){g&&g.c()}function Cu(g,x,S,k){const{fragment:R,on_mount:Y,on_destroy:ot,after_update:c}=g.$$;R&&R.m(x,S),k||zh(()=>{const Pt=Y.map(bu).filter(wu);ot?ot.push(...Pt):Ul(Pt),g.$$.on_mount=[]}),c.forEach(zh)}function Mu(g,x){const S=g.$$;S.fragment!==null&&(Ul(S.on_destroy),S.fragment&&S.fragment.d(x),S.on_destroy=S.fragment=null,S.ctx=[])}function Jd(g,x){g.$$.dirty[0]===-1&&(il.push(g),jd(),g.$$.dirty.fill(0)),g.$$.dirty[x/31|0]|=1<<x%31}function zu(g,x,S,k,R,Y,ot,c=[-1]){const Pt=Oh;rl(g);const Jt=g.$$={fragment:null,ctx:null,props:Y,update:ra,not_equal:R,bound:fu(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(x.context||(Pt?Pt.$$.context:[])),callbacks:fu(),dirty:c,skip_bound:!1,root:x.target||Pt.$$.root};ot&&ot(Jt.root);let Se=!1;if(Jt.ctx=S?S(g,x.props||{},(Gt,dt,...ci)=>{const $e=ci.length?ci[0]:dt;return Jt.ctx&&R(Jt.ctx[Gt],Jt.ctx[Gt]=$e)&&(!Jt.skip_bound&&Jt.bound[Gt]&&Jt.bound[Gt]($e),Se&&Jd(g,Gt)),dt}):[],Jt.update(),Se=!0,Ul(Jt.before_update),Jt.fragment=k?k(Jt.ctx):!1,x.target){if(x.hydrate){const Gt=qd(x.target);Jt.fragment&&Jt.fragment.l(Gt),Gt.forEach(Rh)}else Jt.fragment&&Jt.fragment.c();x.intro&&Au(g.$$.fragment),Cu(g,x.target,x.anchor,x.customElement),Pu()}rl(Pt)}class Lu{$destroy(){Mu(this,1),this.$destroy=ra}$on(x,S){const k=this.$$.callbacks[x]||(this.$$.callbacks[x]=[]);return k.push(S),()=>{const R=k.indexOf(S);R!==-1&&k.splice(R,1)}}$set(x){this.$$set&&!Vd(x)&&(this.$$.skip_bound=!0,this.$$set(x),this.$$.skip_bound=!1)}}var ku=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},yt={exports:{}};/* @preserve
 * Leaflet 1.9.2, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2022 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(g,x){(function(S,k){k(x)})(ku,function(S){var k="1.9.2";function R(r){var l,_,b,A;for(_=1,b=arguments.length;_<b;_++){A=arguments[_];for(l in A)r[l]=A[l]}return r}var Y=Object.create||function(){function r(){}return function(l){return r.prototype=l,new r}}();function ot(r,l){var _=Array.prototype.slice;if(r.bind)return r.bind.apply(r,_.call(arguments,1));var b=_.call(arguments,2);return function(){return r.apply(l,b.length?b.concat(_.call(arguments)):arguments)}}var c=0;function Pt(r){return"_leaflet_id"in r||(r._leaflet_id=++c),r._leaflet_id}function Jt(r,l,_){var b,A,N,et;return et=function(){b=!1,A&&(N.apply(_,A),A=!1)},N=function(){b?A=arguments:(r.apply(_,arguments),setTimeout(et,l),b=!0)},N}function Se(r,l,_){var b=l[1],A=l[0],N=b-A;return r===b&&_?r:((r-A)%N+N)%N+A}function Gt(){return!1}function dt(r,l){if(l===!1)return r;var _=Math.pow(10,l===void 0?6:l);return Math.round(r*_)/_}function ci(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function $e(r){return ci(r).split(/\s+/)}function ce(r,l){Object.prototype.hasOwnProperty.call(r,"options")||(r.options=r.options?Y(r.options):{});for(var _ in l)r.options[_]=l[_];return r.options}function Or(r,l,_){var b=[];for(var A in r)b.push(encodeURIComponent(_?A.toUpperCase():A)+"="+encodeURIComponent(r[A]));return(!l||l.indexOf("?")===-1?"?":"&")+b.join("&")}var Fr=/\{ *([\w_ -]+) *\}/g;function mn(r,l){return r.replace(Fr,function(_,b){var A=l[b];if(A===void 0)throw new Error("No value provided for variable "+_);return typeof A=="function"&&(A=A(l)),A})}var ii=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function Ur(r,l){for(var _=0;_<r.length;_++)if(r[_]===l)return _;return-1}var ni="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _n(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}var Yn=0;function rn(r){var l=+new Date,_=Math.max(0,16-(l-Yn));return Yn=l+_,window.setTimeout(r,_)}var cs=window.requestAnimationFrame||_n("RequestAnimationFrame")||rn,On=window.cancelAnimationFrame||_n("CancelAnimationFrame")||_n("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function ui(r,l,_){if(_&&cs===rn)r.call(l);else return cs.call(window,ot(r,l))}function pi(r){r&&On.call(window,r)}var us={__proto__:null,extend:R,create:Y,bind:ot,get lastId(){return c},stamp:Pt,throttle:Jt,wrapNum:Se,falseFn:Gt,formatNum:dt,trim:ci,splitWords:$e,setOptions:ce,getParamString:Or,template:mn,isArray:ii,indexOf:Ur,emptyImageUrl:ni,requestFn:cs,cancelFn:On,requestAnimFrame:ui,cancelAnimFrame:pi};function Ci(){}Ci.extend=function(r){var l=function(){ce(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},_=l.__super__=this.prototype,b=Y(_);b.constructor=l,l.prototype=b;for(var A in this)Object.prototype.hasOwnProperty.call(this,A)&&A!=="prototype"&&A!=="__super__"&&(l[A]=this[A]);return r.statics&&R(l,r.statics),r.includes&&(_r(r.includes),R.apply(null,[b].concat(r.includes))),R(b,r),delete b.statics,delete b.includes,b.options&&(b.options=_.options?Y(_.options):{},R(b.options,r.options)),b._initHooks=[],b.callInitHooks=function(){if(!this._initHooksCalled){_.callInitHooks&&_.callInitHooks.call(this),this._initHooksCalled=!0;for(var N=0,et=b._initHooks.length;N<et;N++)b._initHooks[N].call(this)}},l},Ci.include=function(r){var l=this.prototype.options;return R(this.prototype,r),r.options&&(this.prototype.options=l,this.mergeOptions(r.options)),this},Ci.mergeOptions=function(r){return R(this.prototype.options,r),this},Ci.addInitHook=function(r){var l=Array.prototype.slice.call(arguments,1),_=typeof r=="function"?r:function(){this[r].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(_),this};function _r(r){if(!(typeof L>"u"||!L||!L.Mixin)){r=ii(r)?r:[r];for(var l=0;l<r.length;l++)r[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Yt={on:function(r,l,_){if(typeof r=="object")for(var b in r)this._on(b,r[b],l);else{r=$e(r);for(var A=0,N=r.length;A<N;A++)this._on(r[A],l,_)}return this},off:function(r,l,_){if(!arguments.length)delete this._events;else if(typeof r=="object")for(var b in r)this._off(b,r[b],l);else{r=$e(r);for(var A=arguments.length===1,N=0,et=r.length;N<et;N++)A?this._off(r[N]):this._off(r[N],l,_)}return this},_on:function(r,l,_,b){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(r,l,_)===!1){_===this&&(_=void 0);var A={fn:l,ctx:_};b&&(A.once=!0),this._events=this._events||{},this._events[r]=this._events[r]||[],this._events[r].push(A)}},_off:function(r,l,_){var b,A,N;if(!!this._events&&(b=this._events[r],!!b)){if(arguments.length===1){if(this._firingCount)for(A=0,N=b.length;A<N;A++)b[A].fn=Gt;delete this._events[r];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var et=this._listens(r,l,_);if(et!==!1){var nt=b[et];this._firingCount&&(nt.fn=Gt,this._events[r]=b=b.slice()),b.splice(et,1)}}},fire:function(r,l,_){if(!this.listens(r,_))return this;var b=R({},l,{type:r,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var A=this._events[r];if(A){this._firingCount=this._firingCount+1||1;for(var N=0,et=A.length;N<et;N++){var nt=A[N],lt=nt.fn;nt.once&&this.off(r,lt,nt.ctx),lt.call(nt.ctx||this,b)}this._firingCount--}}return _&&this._propagateEvent(b),this},listens:function(r,l,_,b){typeof r!="string"&&console.warn('"string" type argument expected');var A=l;typeof l!="function"&&(b=!!l,A=void 0,_=void 0);var N=this._events&&this._events[r];if(N&&N.length&&this._listens(r,A,_)!==!1)return!0;if(b){for(var et in this._eventParents)if(this._eventParents[et].listens(r,l,_,b))return!0}return!1},_listens:function(r,l,_){if(!this._events)return!1;var b=this._events[r]||[];if(!l)return!!b.length;_===this&&(_=void 0);for(var A=0,N=b.length;A<N;A++)if(b[A].fn===l&&b[A].ctx===_)return A;return!1},once:function(r,l,_){if(typeof r=="object")for(var b in r)this._on(b,r[b],l,!0);else{r=$e(r);for(var A=0,N=r.length;A<N;A++)this._on(r[A],l,_,!0)}return this},addEventParent:function(r){return this._eventParents=this._eventParents||{},this._eventParents[Pt(r)]=r,this},removeEventParent:function(r){return this._eventParents&&delete this._eventParents[Pt(r)],this},_propagateEvent:function(r){for(var l in this._eventParents)this._eventParents[l].fire(r.type,R({layer:r.target,propagatedFrom:r.target},r),!0)}};Yt.addEventListener=Yt.on,Yt.removeEventListener=Yt.clearAllEventListeners=Yt.off,Yt.addOneTimeEventListener=Yt.once,Yt.fireEvent=Yt.fire,Yt.hasEventListeners=Yt.listens;var sn=Ci.extend(Yt);function ae(r,l,_){this.x=_?Math.round(r):r,this.y=_?Math.round(l):l}var gn=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(r){return this.clone()._add(re(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(re(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new ae(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new ae(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=gn(this.x),this.y=gn(this.y),this},distanceTo:function(r){r=re(r);var l=r.x-this.x,_=r.y-this.y;return Math.sqrt(l*l+_*_)},equals:function(r){return r=re(r),r.x===this.x&&r.y===this.y},contains:function(r){return r=re(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+dt(this.x)+", "+dt(this.y)+")"}};function re(r,l,_){return r instanceof ae?r:ii(r)?new ae(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new ae(r.x,r.y):new ae(r,l,_)}function Ze(r,l){if(!!r)for(var _=l?[r,l]:r,b=0,A=_.length;b<A;b++)this.extend(_[b])}Ze.prototype={extend:function(r){var l,_;if(!r)return this;if(r instanceof ae||typeof r[0]=="number"||"x"in r)l=_=re(r);else if(r=gi(r),l=r.min,_=r.max,!l||!_)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=_.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(_.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(_.y,this.max.y)),this},getCenter:function(r){return re((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return re(this.min.x,this.max.y)},getTopRight:function(){return re(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var l,_;return typeof r[0]=="number"||r instanceof ae?r=re(r):r=gi(r),r instanceof Ze?(l=r.min,_=r.max):l=_=r,l.x>=this.min.x&&_.x<=this.max.x&&l.y>=this.min.y&&_.y<=this.max.y},intersects:function(r){r=gi(r);var l=this.min,_=this.max,b=r.min,A=r.max,N=A.x>=l.x&&b.x<=_.x,et=A.y>=l.y&&b.y<=_.y;return N&&et},overlaps:function(r){r=gi(r);var l=this.min,_=this.max,b=r.min,A=r.max,N=A.x>l.x&&b.x<_.x,et=A.y>l.y&&b.y<_.y;return N&&et},isValid:function(){return!!(this.min&&this.max)},pad:function(r){var l=this.min,_=this.max,b=Math.abs(l.x-_.x)*r,A=Math.abs(l.y-_.y)*r;return gi(re(l.x-b,l.y-A),re(_.x+b,_.y+A))},equals:function(r){return r?(r=gi(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight())):!1}};function gi(r,l){return!r||r instanceof Ze?r:new Ze(r,l)}function yi(r,l){if(!!r)for(var _=l?[r,l]:r,b=0,A=_.length;b<A;b++)this.extend(_[b])}yi.prototype={extend:function(r){var l=this._southWest,_=this._northEast,b,A;if(r instanceof Pe)b=r,A=r;else if(r instanceof yi){if(b=r._southWest,A=r._northEast,!b||!A)return this}else return r?this.extend(De(r)||ri(r)):this;return!l&&!_?(this._southWest=new Pe(b.lat,b.lng),this._northEast=new Pe(A.lat,A.lng)):(l.lat=Math.min(b.lat,l.lat),l.lng=Math.min(b.lng,l.lng),_.lat=Math.max(A.lat,_.lat),_.lng=Math.max(A.lng,_.lng)),this},pad:function(r){var l=this._southWest,_=this._northEast,b=Math.abs(l.lat-_.lat)*r,A=Math.abs(l.lng-_.lng)*r;return new yi(new Pe(l.lat-b,l.lng-A),new Pe(_.lat+b,_.lng+A))},getCenter:function(){return new Pe((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Pe(this.getNorth(),this.getWest())},getSouthEast:function(){return new Pe(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){typeof r[0]=="number"||r instanceof Pe||"lat"in r?r=De(r):r=ri(r);var l=this._southWest,_=this._northEast,b,A;return r instanceof yi?(b=r.getSouthWest(),A=r.getNorthEast()):b=A=r,b.lat>=l.lat&&A.lat<=_.lat&&b.lng>=l.lng&&A.lng<=_.lng},intersects:function(r){r=ri(r);var l=this._southWest,_=this._northEast,b=r.getSouthWest(),A=r.getNorthEast(),N=A.lat>=l.lat&&b.lat<=_.lat,et=A.lng>=l.lng&&b.lng<=_.lng;return N&&et},overlaps:function(r){r=ri(r);var l=this._southWest,_=this._northEast,b=r.getSouthWest(),A=r.getNorthEast(),N=A.lat>l.lat&&b.lat<_.lat,et=A.lng>l.lng&&b.lng<_.lng;return N&&et},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,l){return r?(r=ri(r),this._southWest.equals(r.getSouthWest(),l)&&this._northEast.equals(r.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ri(r,l){return r instanceof yi?r:new yi(r,l)}function Pe(r,l,_){if(isNaN(r)||isNaN(l))throw new Error("Invalid LatLng object: ("+r+", "+l+")");this.lat=+r,this.lng=+l,_!==void 0&&(this.alt=+_)}Pe.prototype={equals:function(r,l){if(!r)return!1;r=De(r);var _=Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng));return _<=(l===void 0?1e-9:l)},toString:function(r){return"LatLng("+dt(this.lat,r)+", "+dt(this.lng,r)+")"},distanceTo:function(r){return Ni.distance(this,De(r))},wrap:function(){return Ni.wrapLatLng(this)},toBounds:function(r){var l=180*r/40075017,_=l/Math.cos(Math.PI/180*this.lat);return ri([this.lat-l,this.lng-_],[this.lat+l,this.lng+_])},clone:function(){return new Pe(this.lat,this.lng,this.alt)}};function De(r,l,_){return r instanceof Pe?r:ii(r)&&typeof r[0]!="object"?r.length===3?new Pe(r[0],r[1],r[2]):r.length===2?new Pe(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new Pe(r.lat,"lng"in r?r.lng:r.lon,r.alt):l===void 0?null:new Pe(r,l,_)}var Mi={latLngToPoint:function(r,l){var _=this.projection.project(r),b=this.scale(l);return this.transformation._transform(_,b)},pointToLatLng:function(r,l){var _=this.scale(l),b=this.transformation.untransform(r,_);return this.projection.unproject(b)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var l=this.projection.bounds,_=this.scale(r),b=this.transformation.transform(l.min,_),A=this.transformation.transform(l.max,_);return new Ze(b,A)},infinite:!1,wrapLatLng:function(r){var l=this.wrapLng?Se(r.lng,this.wrapLng,!0):r.lng,_=this.wrapLat?Se(r.lat,this.wrapLat,!0):r.lat,b=r.alt;return new Pe(_,l,b)},wrapLatLngBounds:function(r){var l=r.getCenter(),_=this.wrapLatLng(l),b=l.lat-_.lat,A=l.lng-_.lng;if(b===0&&A===0)return r;var N=r.getSouthWest(),et=r.getNorthEast(),nt=new Pe(N.lat-b,N.lng-A),lt=new Pe(et.lat-b,et.lng-A);return new yi(nt,lt)}},Ni=R({},Mi,{wrapLng:[-180,180],R:6371e3,distance:function(r,l){var _=Math.PI/180,b=r.lat*_,A=l.lat*_,N=Math.sin((l.lat-r.lat)*_/2),et=Math.sin((l.lng-r.lng)*_/2),nt=N*N+Math.cos(b)*Math.cos(A)*et*et,lt=2*Math.atan2(Math.sqrt(nt),Math.sqrt(1-nt));return this.R*lt}}),Zi=6378137,gr={R:Zi,MAX_LATITUDE:85.0511287798,project:function(r){var l=Math.PI/180,_=this.MAX_LATITUDE,b=Math.max(Math.min(_,r.lat),-_),A=Math.sin(b*l);return new ae(this.R*r.lng*l,this.R*Math.log((1+A)/(1-A))/2)},unproject:function(r){var l=180/Math.PI;return new Pe((2*Math.atan(Math.exp(r.y/this.R))-Math.PI/2)*l,r.x*l/this.R)},bounds:function(){var r=Zi*Math.PI;return new Ze([-r,-r],[r,r])}()};function Nr(r,l,_,b){if(ii(r)){this._a=r[0],this._b=r[1],this._c=r[2],this._d=r[3];return}this._a=r,this._b=l,this._c=_,this._d=b}Nr.prototype={transform:function(r,l){return this._transform(r.clone(),l)},_transform:function(r,l){return l=l||1,r.x=l*(this._a*r.x+this._b),r.y=l*(this._c*r.y+this._d),r},untransform:function(r,l){return l=l||1,new ae((r.x/l-this._b)/this._a,(r.y/l-this._d)/this._c)}};function on(r,l,_,b){return new Nr(r,l,_,b)}var Vi=R({},Ni,{code:"EPSG:3857",projection:gr,transformation:function(){var r=.5/(Math.PI*gr.R);return on(r,.5,-r,.5)}()}),Es=R({},Vi,{code:"EPSG:900913"});function Qn(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Zr(r,l){var _="",b,A,N,et,nt,lt;for(b=0,N=r.length;b<N;b++){for(nt=r[b],A=0,et=nt.length;A<et;A++)lt=nt[A],_+=(A?"L":"M")+lt.x+" "+lt.y;_+=l?U.svg?"z":"x":""}return _||"M0 0"}var yr=document.documentElement.style,vr="ActiveXObject"in window,Ae=vr&&!document.addEventListener,En="msLaunchUri"in navigator&&!("documentMode"in document),Fn=zi("webkit"),tr=zi("android"),ps=zi("android 2")||zi("android 3"),er=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ir=tr&&zi("Google")&&er<537&&!("AudioNode"in window),xr=!!window.opera,Un=!En&&zi("chrome"),wt=zi("gecko")&&!Fn&&!xr&&!vr,Bt=!Un&&zi("safari"),br=zi("phantom"),yn="OTransition"in yr,Ce=navigator.platform.indexOf("Win")===0,an=vr&&"transition"in yr,Gi="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ps,Wi="MozPerspective"in yr,wr=!window.L_DISABLE_3D&&(an||Gi||Wi)&&!yn&&!br,Lt=typeof orientation<"u"||zi("mobile"),me=Lt&&Fn,ue=Lt&&Gi,wi=!window.PointerEvent&&window.MSPointerEvent,nr=!!(window.PointerEvent||wi),le="ontouchstart"in window||!!window.TouchEvent,rr=!window.L_NO_TOUCH&&(le||nr),Ti=Lt&&xr,ds=Lt&&wt,di=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,qi=function(){var r=!1;try{var l=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassiveEventSupport",Gt,l),window.removeEventListener("testPassiveEventSupport",Gt,l)}catch{}return r}(),Ue=function(){return!!document.createElement("canvas").getContext}(),Tr=!!(document.createElementNS&&Qn("svg").createSVGRect),Nn=!!Tr&&function(){var r=document.createElement("div");return r.innerHTML="<svg/>",(r.firstChild&&r.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Vr=!Tr&&function(){try{var r=document.createElement("div");r.innerHTML='<v:shape adj="1"/>';var l=r.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}}(),Gr=navigator.platform.indexOf("Mac")===0,fs=navigator.platform.indexOf("Linux")===0;function zi(r){return navigator.userAgent.toLowerCase().indexOf(r)>=0}var U={ie:vr,ielt9:Ae,edge:En,webkit:Fn,android:tr,android23:ps,androidStock:ir,opera:xr,chrome:Un,gecko:wt,safari:Bt,phantom:br,opera12:yn,win:Ce,ie3d:an,webkit3d:Gi,gecko3d:Wi,any3d:wr,mobile:Lt,mobileWebkit:me,mobileWebkit3d:ue,msPointer:wi,pointer:nr,touch:rr,touchNative:le,mobileOpera:Ti,mobileGecko:ds,retina:di,passiveEvents:qi,canvas:Ue,svg:Tr,vml:Vr,inlineSvg:Nn,mac:Gr,linux:fs},C=U.msPointer?"MSPointerDown":"pointerdown",B=U.msPointer?"MSPointerMove":"pointermove",q=U.msPointer?"MSPointerUp":"pointerup",$=U.msPointer?"MSPointerCancel":"pointercancel",Q={touchstart:C,touchmove:B,touchend:q,touchcancel:$},st={touchstart:ne,touchmove:Ft,touchend:Ft,touchcancel:Ft},it={},tt=!1;function at(r,l,_){return l==="touchstart"&&Xt(),st[l]?(_=st[l].bind(this,_),r.addEventListener(Q[l],_,!1),_):(console.warn("wrong event specified:",l),L.Util.falseFn)}function xt(r,l,_){if(!Q[l]){console.warn("wrong event specified:",l);return}r.removeEventListener(Q[l],_,!1)}function At(r){it[r.pointerId]=r}function vt(r){it[r.pointerId]&&(it[r.pointerId]=r)}function Ht(r){delete it[r.pointerId]}function Xt(){tt||(document.addEventListener(C,At,!0),document.addEventListener(B,vt,!0),document.addEventListener(q,Ht,!0),document.addEventListener($,Ht,!0),tt=!0)}function Ft(r,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var _ in it)l.touches.push(it[_]);l.changedTouches=[l],r(l)}}function ne(r,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&hi(l),Ft(r,l)}function se(r){var l={},_,b;for(b in r)_=r[b],l[b]=_&&_.bind?_.bind(r):_;return r=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var Me=200;function he(r,l){r.addEventListener("dblclick",l);var _=0,b;function A(N){if(N.detail!==1){b=N.detail;return}if(!(N.pointerType==="mouse"||N.sourceCapabilities&&!N.sourceCapabilities.firesTouchEvents)){var et=Bo(N);if(!(et.some(function(lt){return lt instanceof HTMLLabelElement&&lt.attributes.for})&&!et.some(function(lt){return lt instanceof HTMLInputElement||lt instanceof HTMLSelectElement}))){var nt=Date.now();nt-_<=Me?(b++,b===2&&l(se(N))):b=1,_=nt}}}return r.addEventListener("click",A),{dblclick:l,simDblclick:A}}function _e(r,l){r.removeEventListener("dblclick",l.dblclick),r.removeEventListener("click",l.simDblclick)}var we=Ps(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Be=Ps(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),vi=Be==="webkitTransition"||Be==="OTransition"?Be+"End":"transitionend";function Ke(r){return typeof r=="string"?document.getElementById(r):r}function fi(r,l){var _=r.style[l]||r.currentStyle&&r.currentStyle[l];if((!_||_==="auto")&&document.defaultView){var b=document.defaultView.getComputedStyle(r,null);_=b?b[l]:null}return _==="auto"?null:_}function Ie(r,l,_){var b=document.createElement(r);return b.className=l||"",_&&_.appendChild(b),b}function je(r){var l=r.parentNode;l&&l.removeChild(r)}function Oe(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function Sr(r){var l=r.parentNode;l&&l.lastChild!==r&&l.appendChild(r)}function Ir(r){var l=r.parentNode;l&&l.firstChild!==r&&l.insertBefore(r,l.firstChild)}function so(r,l){if(r.classList!==void 0)return r.classList.contains(l);var _=qr(r);return _.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(_)}function ge(r,l){if(r.classList!==void 0)for(var _=$e(l),b=0,A=_.length;b<A;b++)r.classList.add(_[b]);else if(!so(r,l)){var N=qr(r);ko(r,(N?N+" ":"")+l)}}function si(r,l){r.classList!==void 0?r.classList.remove(l):ko(r,ci((" "+qr(r)+" ").replace(" "+l+" "," ")))}function ko(r,l){r.className.baseVal===void 0?r.className=l:r.className.baseVal=l}function qr(r){return r.correspondingElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function Hi(r,l){"opacity"in r.style?r.style.opacity=l:"filter"in r.style&&sa(r,l)}function sa(r,l){var _=!1,b="DXImageTransform.Microsoft.Alpha";try{_=r.filters.item(b)}catch{if(l===1)return}l=Math.round(l*100),_?(_.Enabled=l!==100,_.Opacity=l):r.style.filter+=" progid:"+b+"(opacity="+l+")"}function Ps(r){for(var l=document.documentElement.style,_=0;_<r.length;_++)if(r[_]in l)return r[_];return!1}function Er(r,l,_){var b=l||new ae(0,0);r.style[we]=(U.ie3d?"translate("+b.x+"px,"+b.y+"px)":"translate3d("+b.x+"px,"+b.y+"px,0)")+(_?" scale("+_+")":"")}function Je(r,l){r._leaflet_pos=l,U.any3d?Er(r,l):(r.style.left=l.x+"px",r.style.top=l.y+"px")}function Pn(r){return r._leaflet_pos||new ae(0,0)}var Zn,Pr,ms;if("onselectstart"in document)Zn=function(){fe(window,"selectstart",hi)},Pr=function(){Ye(window,"selectstart",hi)};else{var Vn=Ps(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Zn=function(){if(Vn){var r=document.documentElement.style;ms=r[Vn],r[Vn]="none"}},Pr=function(){Vn&&(document.documentElement.style[Vn]=ms,ms=void 0)}}function As(){fe(window,"dragstart",hi)}function _s(){Ye(window,"dragstart",hi)}var Ar,We;function $r(r){for(;r.tabIndex===-1;)r=r.parentNode;!r.style||(Cs(),Ar=r,We=r.style.outline,r.style.outline="none",fe(window,"keydown",Cs))}function Cs(){!Ar||(Ar.style.outline=We,Ar=void 0,We=void 0,Ye(window,"keydown",Cs))}function Do(r){do r=r.parentNode;while((!r.offsetWidth||!r.offsetHeight)&&r!==document.body);return r}function Ms(r){var l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}var oo={__proto__:null,TRANSFORM:we,TRANSITION:Be,TRANSITION_END:vi,get:Ke,getStyle:fi,create:Ie,remove:je,empty:Oe,toFront:Sr,toBack:Ir,hasClass:so,addClass:ge,removeClass:si,setClass:ko,getClass:qr,setOpacity:Hi,testProp:Ps,setTransform:Er,setPosition:Je,getPosition:Pn,get disableTextSelection(){return Zn},get enableTextSelection(){return Pr},disableImageDrag:As,enableImageDrag:_s,preventOutline:$r,restoreOutline:Cs,getSizedParentNode:Do,getScale:Ms};function fe(r,l,_,b){if(l&&typeof l=="object")for(var A in l)Ls(r,A,l[A],_);else{l=$e(l);for(var N=0,et=l.length;N<et;N++)Ls(r,l[N],_,b)}return this}var Gn="_leaflet_events";function Ye(r,l,_,b){if(arguments.length===1)ao(r),delete r[Gn];else if(l&&typeof l=="object")for(var A in l)ks(r,A,l[A],_);else if(l=$e(l),arguments.length===2)ao(r,function(nt){return Ur(l,nt)!==-1});else for(var N=0,et=l.length;N<et;N++)ks(r,l[N],_,b);return this}function ao(r,l){for(var _ in r[Gn]){var b=_.split(/\d/)[0];(!l||l(b))&&ks(r,b,null,null,_)}}var zs={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ls(r,l,_,b){var A=l+Pt(_)+(b?"_"+Pt(b):"");if(r[Gn]&&r[Gn][A])return this;var N=function(nt){return _.call(b||r,nt||window.event)},et=N;!U.touchNative&&U.pointer&&l.indexOf("touch")===0?N=at(r,l,N):U.touch&&l==="dblclick"?N=he(r,N):"addEventListener"in r?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?r.addEventListener(zs[l]||l,N,U.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(N=function(nt){nt=nt||window.event,gs(r,nt)&&et(nt)},r.addEventListener(zs[l],N,!1)):r.addEventListener(l,et,!1):r.attachEvent("on"+l,N),r[Gn]=r[Gn]||{},r[Gn][A]=N}function ks(r,l,_,b,A){A=A||l+Pt(_)+(b?"_"+Pt(b):"");var N=r[Gn]&&r[Gn][A];if(!N)return this;!U.touchNative&&U.pointer&&l.indexOf("touch")===0?xt(r,l,N):U.touch&&l==="dblclick"?_e(r,N):"removeEventListener"in r?r.removeEventListener(zs[l]||l,N,!1):r.detachEvent("on"+l,N),r[Gn][A]=null}function xe(r){return r.stopPropagation?r.stopPropagation():r.originalEvent?r.originalEvent._stopped=!0:r.cancelBubble=!0,this}function lo(r){return Ls(r,"wheel",xe),this}function Ds(r){return fe(r,"mousedown touchstart dblclick contextmenu",xe),r._leaflet_disable_click=!0,this}function hi(r){return r.preventDefault?r.preventDefault():r.returnValue=!1,this}function An(r){return hi(r),xe(r),this}function Bo(r){if(r.composedPath)return r.composedPath();for(var l=[],_=r.target;_;)l.push(_),_=_.parentNode;return l}function Xi(r,l){if(!l)return new ae(r.clientX,r.clientY);var _=Ms(l),b=_.boundingClientRect;return new ae((r.clientX-b.left)/_.x-l.clientLeft,(r.clientY-b.top)/_.y-l.clientTop)}var Ro=U.linux&&U.chrome?window.devicePixelRatio:U.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Bs(r){return U.edge?r.wheelDeltaY/2:r.deltaY&&r.deltaMode===0?-r.deltaY/Ro:r.deltaY&&r.deltaMode===1?-r.deltaY*20:r.deltaY&&r.deltaMode===2?-r.deltaY*60:r.deltaX||r.deltaZ?0:r.wheelDelta?(r.wheelDeltaY||r.wheelDelta)/2:r.detail&&Math.abs(r.detail)<32765?-r.detail*20:r.detail?r.detail/-32765*60:0}function gs(r,l){var _=l.relatedTarget;if(!_)return!0;try{for(;_&&_!==r;)_=_.parentNode}catch{return!1}return _!==r}var Oo={__proto__:null,on:fe,off:Ye,stopPropagation:xe,disableScrollPropagation:lo,disableClickPropagation:Ds,preventDefault:hi,stop:An,getPropagationPath:Bo,getMousePosition:Xi,getWheelDelta:Bs,isExternalTarget:gs,addListener:fe,removeListener:Ye},ho=sn.extend({run:function(r,l,_,b){this.stop(),this._el=r,this._inProgress=!0,this._duration=_||.25,this._easeOutPower=1/Math.max(b||.5,.2),this._startPos=Pn(r),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){!this._inProgress||(this._step(!0),this._complete())},_animate:function(){this._animId=ui(this._animate,this),this._step()},_step:function(r){var l=+new Date-this._startTime,_=this._duration*1e3;l<_?this._runFrame(this._easeOut(l/_),r):(this._runFrame(1),this._complete())},_runFrame:function(r,l){var _=this._startPos.add(this._offset.multiplyBy(r));l&&_._round(),Je(this._el,_),this.fire("step")},_complete:function(){pi(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(r){return 1-Math.pow(1-r,this._easeOutPower)}}),Ee=sn.extend({options:{crs:Vi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(r,l){l=ce(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(r),this._initLayout(),this._onResize=ot(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(De(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Be&&U.any3d&&!U.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),fe(this._proxy,vi,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(r,l,_){if(l=l===void 0?this._zoom:this._limitZoom(l),r=this._limitCenter(De(r),l,this.options.maxBounds),_=_||{},this._stop(),this._loaded&&!_.reset&&_!==!0){_.animate!==void 0&&(_.zoom=R({animate:_.animate},_.zoom),_.pan=R({animate:_.animate,duration:_.duration},_.pan));var b=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(r,l,_.zoom):this._tryAnimatedPan(r,_.pan);if(b)return clearTimeout(this._sizeTimer),this}return this._resetView(r,l,_.pan&&_.pan.noMoveStart),this},setZoom:function(r,l){return this._loaded?this.setView(this.getCenter(),r,{zoom:l}):(this._zoom=r,this)},zoomIn:function(r,l){return r=r||(U.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+r,l)},zoomOut:function(r,l){return r=r||(U.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-r,l)},setZoomAround:function(r,l,_){var b=this.getZoomScale(l),A=this.getSize().divideBy(2),N=r instanceof ae?r:this.latLngToContainerPoint(r),et=N.subtract(A).multiplyBy(1-1/b),nt=this.containerPointToLatLng(A.add(et));return this.setView(nt,l,{zoom:_})},_getBoundsCenterZoom:function(r,l){l=l||{},r=r.getBounds?r.getBounds():ri(r);var _=re(l.paddingTopLeft||l.padding||[0,0]),b=re(l.paddingBottomRight||l.padding||[0,0]),A=this.getBoundsZoom(r,!1,_.add(b));if(A=typeof l.maxZoom=="number"?Math.min(l.maxZoom,A):A,A===1/0)return{center:r.getCenter(),zoom:A};var N=b.subtract(_).divideBy(2),et=this.project(r.getSouthWest(),A),nt=this.project(r.getNorthEast(),A),lt=this.unproject(et.add(nt).divideBy(2).add(N),A);return{center:lt,zoom:A}},fitBounds:function(r,l){if(r=ri(r),!r.isValid())throw new Error("Bounds are not valid.");var _=this._getBoundsCenterZoom(r,l);return this.setView(_.center,_.zoom,l)},fitWorld:function(r){return this.fitBounds([[-90,-180],[90,180]],r)},panTo:function(r,l){return this.setView(r,this._zoom,{pan:l})},panBy:function(r,l){if(r=re(r).round(),l=l||{},!r.x&&!r.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(r))return this._resetView(this.unproject(this.project(this.getCenter()).add(r)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new ho,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){ge(this._mapPane,"leaflet-pan-anim");var _=this._getMapPanePos().subtract(r).round();this._panAnim.run(this._mapPane,_,l.duration||.25,l.easeLinearity)}else this._rawPanBy(r),this.fire("move").fire("moveend");return this},flyTo:function(r,l,_){if(_=_||{},_.animate===!1||!U.any3d)return this.setView(r,l,_);this._stop();var b=this.project(this.getCenter()),A=this.project(r),N=this.getSize(),et=this._zoom;r=De(r),l=l===void 0?et:l;var nt=Math.max(N.x,N.y),lt=nt*this.getZoomScale(et,l),Ct=A.distanceTo(b)||1,Wt=1.42,oe=Wt*Wt;function ie(a){var p=a?-1:1,f=a?lt:nt,y=lt*lt-nt*nt+p*oe*oe*Ct*Ct,T=2*f*oe*Ct,I=y/T,P=Math.sqrt(I*I+1)-I,z=P<1e-9?-18:Math.log(P);return z}function xi(a){return(Math.exp(a)-Math.exp(-a))/2}function ki(a){return(Math.exp(a)+Math.exp(-a))/2}function Hs(a){return xi(a)/ki(a)}var $i=ie(0);function ti(a){return nt*(ki($i)/ki($i+Wt*a))}function mi(a){return nt*(ki($i)*Hs($i+Wt*a)-xi($i))/oe}function Jo(a){return 1-Math.pow(1-a,1.5)}var rs=Date.now(),h=(ie(1)-$i)/Wt,e=_.duration?1e3*_.duration:1e3*h*.8;function s(){var a=(Date.now()-rs)/e,p=Jo(a)*h;a<=1?(this._flyToFrame=ui(s,this),this._move(this.unproject(b.add(A.subtract(b).multiplyBy(mi(p)/Ct)),et),this.getScaleZoom(nt/ti(p),et),{flyTo:!0})):this._move(r,l)._moveEnd(!0)}return this._moveStart(!0,_.noMoveStart),s.call(this),this},flyToBounds:function(r,l){var _=this._getBoundsCenterZoom(r,l);return this.flyTo(_.center,_.zoom,l)},setMaxBounds:function(r){return r=ri(r),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),r.isValid()?(this.options.maxBounds=r,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(r){var l=this.options.minZoom;return this.options.minZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(r):this},setMaxZoom:function(r){var l=this.options.maxZoom;return this.options.maxZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(r):this},panInsideBounds:function(r,l){this._enforcingBounds=!0;var _=this.getCenter(),b=this._limitCenter(_,this._zoom,ri(r));return _.equals(b)||this.panTo(b,l),this._enforcingBounds=!1,this},panInside:function(r,l){l=l||{};var _=re(l.paddingTopLeft||l.padding||[0,0]),b=re(l.paddingBottomRight||l.padding||[0,0]),A=this.project(this.getCenter()),N=this.project(r),et=this.getPixelBounds(),nt=gi([et.min.add(_),et.max.subtract(b)]),lt=nt.getSize();if(!nt.contains(N)){this._enforcingBounds=!0;var Ct=N.subtract(nt.getCenter()),Wt=nt.extend(N).getSize().subtract(lt);A.x+=Ct.x<0?-Wt.x:Wt.x,A.y+=Ct.y<0?-Wt.y:Wt.y,this.panTo(this.unproject(A),l),this._enforcingBounds=!1}return this},invalidateSize:function(r){if(!this._loaded)return this;r=R({animate:!1,pan:!0},r===!0?{animate:!0}:r);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var _=this.getSize(),b=l.divideBy(2).round(),A=_.divideBy(2).round(),N=b.subtract(A);return!N.x&&!N.y?this:(r.animate&&r.pan?this.panBy(N):(r.pan&&this._rawPanBy(N),this.fire("move"),r.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(ot(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:_}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(r){if(r=this._locateOptions=R({timeout:1e4,watch:!1},r),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=ot(this._handleGeolocationResponse,this),_=ot(this._handleGeolocationError,this);return r.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,_,r):navigator.geolocation.getCurrentPosition(l,_,r),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(r){if(!!this._container._leaflet_id){var l=r.code,_=r.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+_+"."})}},_handleGeolocationResponse:function(r){if(!!this._container._leaflet_id){var l=r.coords.latitude,_=r.coords.longitude,b=new Pe(l,_),A=b.toBounds(r.coords.accuracy*2),N=this._locateOptions;if(N.setView){var et=this.getBoundsZoom(A);this.setView(b,N.maxZoom?Math.min(et,N.maxZoom):et)}var nt={latlng:b,bounds:A,timestamp:r.timestamp};for(var lt in r.coords)typeof r.coords[lt]=="number"&&(nt[lt]=r.coords[lt]);this.fire("locationfound",nt)}},addHandler:function(r,l){if(!l)return this;var _=this[r]=new l(this);return this._handlers.push(_),this.options[r]&&_.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),je(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(pi(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var r;for(r in this._layers)this._layers[r].remove();for(r in this._panes)je(this._panes[r]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(r,l){var _="leaflet-pane"+(r?" leaflet-"+r.replace("Pane","")+"-pane":""),b=Ie("div",_,l||this._mapPane);return r&&(this._panes[r]=b),b},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var r=this.getPixelBounds(),l=this.unproject(r.getBottomLeft()),_=this.unproject(r.getTopRight());return new yi(l,_)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(r,l,_){r=ri(r),_=re(_||[0,0]);var b=this.getZoom()||0,A=this.getMinZoom(),N=this.getMaxZoom(),et=r.getNorthWest(),nt=r.getSouthEast(),lt=this.getSize().subtract(_),Ct=gi(this.project(nt,b),this.project(et,b)).getSize(),Wt=U.any3d?this.options.zoomSnap:1,oe=lt.x/Ct.x,ie=lt.y/Ct.y,xi=l?Math.max(oe,ie):Math.min(oe,ie);return b=this.getScaleZoom(xi,b),Wt&&(b=Math.round(b/(Wt/100))*(Wt/100),b=l?Math.ceil(b/Wt)*Wt:Math.floor(b/Wt)*Wt),Math.max(A,Math.min(N,b))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ae(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(r,l){var _=this._getTopLeftPoint(r,l);return new Ze(_,_.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(r){return this.options.crs.getProjectedBounds(r===void 0?this.getZoom():r)},getPane:function(r){return typeof r=="string"?this._panes[r]:r},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(r,l){var _=this.options.crs;return l=l===void 0?this._zoom:l,_.scale(r)/_.scale(l)},getScaleZoom:function(r,l){var _=this.options.crs;l=l===void 0?this._zoom:l;var b=_.zoom(r*_.scale(l));return isNaN(b)?1/0:b},project:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(De(r),l)},unproject:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(re(r),l)},layerPointToLatLng:function(r){var l=re(r).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(r){var l=this.project(De(r))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(r){return this.options.crs.wrapLatLng(De(r))},wrapLatLngBounds:function(r){return this.options.crs.wrapLatLngBounds(ri(r))},distance:function(r,l){return this.options.crs.distance(De(r),De(l))},containerPointToLayerPoint:function(r){return re(r).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(r){return re(r).add(this._getMapPanePos())},containerPointToLatLng:function(r){var l=this.containerPointToLayerPoint(re(r));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(r){return this.layerPointToContainerPoint(this.latLngToLayerPoint(De(r)))},mouseEventToContainerPoint:function(r){return Xi(r,this._container)},mouseEventToLayerPoint:function(r){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(r))},mouseEventToLatLng:function(r){return this.layerPointToLatLng(this.mouseEventToLayerPoint(r))},_initContainer:function(r){var l=this._container=Ke(r);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");fe(l,"scroll",this._onScroll,this),this._containerId=Pt(l)},_initLayout:function(){var r=this._container;this._fadeAnimated=this.options.fadeAnimation&&U.any3d,ge(r,"leaflet-container"+(U.touch?" leaflet-touch":"")+(U.retina?" leaflet-retina":"")+(U.ielt9?" leaflet-oldie":"")+(U.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=fi(r,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&(r.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var r=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Je(this._mapPane,new ae(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ge(r.markerPane,"leaflet-zoom-hide"),ge(r.shadowPane,"leaflet-zoom-hide"))},_resetView:function(r,l,_){Je(this._mapPane,new ae(0,0));var b=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var A=this._zoom!==l;this._moveStart(A,_)._move(r,l)._moveEnd(A),this.fire("viewreset"),b&&this.fire("load")},_moveStart:function(r,l){return r&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(r,l,_,b){l===void 0&&(l=this._zoom);var A=this._zoom!==l;return this._zoom=l,this._lastCenter=r,this._pixelOrigin=this._getNewPixelOrigin(r),b?_&&_.pinch&&this.fire("zoom",_):((A||_&&_.pinch)&&this.fire("zoom",_),this.fire("move",_)),this},_moveEnd:function(r){return r&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return pi(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(r){Je(this._mapPane,this._getMapPanePos().subtract(r))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(r){this._targets={},this._targets[Pt(this._container)]=this;var l=r?Ye:fe;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),U.any3d&&this.options.transform3DLimit&&(r?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){pi(this._resizeRequest),this._resizeRequest=ui(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var r=this._getMapPanePos();Math.max(Math.abs(r.x),Math.abs(r.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(r,l){for(var _=[],b,A=l==="mouseout"||l==="mouseover",N=r.target||r.srcElement,et=!1;N;){if(b=this._targets[Pt(N)],b&&(l==="click"||l==="preclick")&&this._draggableMoved(b)){et=!0;break}if(b&&b.listens(l,!0)&&(A&&!gs(N,r)||(_.push(b),A))||N===this._container)break;N=N.parentNode}return!_.length&&!et&&!A&&this.listens(l,!0)&&(_=[this]),_},_isClickDisabled:function(r){for(;r&&r!==this._container;){if(r._leaflet_disable_click)return!0;r=r.parentNode}},_handleDOMEvent:function(r){var l=r.target||r.srcElement;if(!(!this._loaded||l._leaflet_disable_events||r.type==="click"&&this._isClickDisabled(l))){var _=r.type;_==="mousedown"&&$r(l),this._fireDOMEvent(r,_)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(r,l,_){if(r.type==="click"){var b=R({},r);b.type="preclick",this._fireDOMEvent(b,b.type,_)}var A=this._findEventTargets(r,l);if(_){for(var N=[],et=0;et<_.length;et++)_[et].listens(l,!0)&&N.push(_[et]);A=N.concat(A)}if(!!A.length){l==="contextmenu"&&hi(r);var nt=A[0],lt={originalEvent:r};if(r.type!=="keypress"&&r.type!=="keydown"&&r.type!=="keyup"){var Ct=nt.getLatLng&&(!nt._radius||nt._radius<=10);lt.containerPoint=Ct?this.latLngToContainerPoint(nt.getLatLng()):this.mouseEventToContainerPoint(r),lt.layerPoint=this.containerPointToLayerPoint(lt.containerPoint),lt.latlng=Ct?nt.getLatLng():this.layerPointToLatLng(lt.layerPoint)}for(et=0;et<A.length;et++)if(A[et].fire(l,lt,!0),lt.originalEvent._stopped||A[et].options.bubblingMouseEvents===!1&&Ur(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(r){return r=r.dragging&&r.dragging.enabled()?r:this,r.dragging&&r.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var r=0,l=this._handlers.length;r<l;r++)this._handlers[r].disable()},whenReady:function(r,l){return this._loaded?r.call(l||this,{target:this}):this.on("load",r,l),this},_getMapPanePos:function(){return Pn(this._mapPane)||new ae(0,0)},_moved:function(){var r=this._getMapPanePos();return r&&!r.equals([0,0])},_getTopLeftPoint:function(r,l){var _=r&&l!==void 0?this._getNewPixelOrigin(r,l):this.getPixelOrigin();return _.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(r,l){var _=this.getSize()._divideBy(2);return this.project(r,l)._subtract(_)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(r,l,_){var b=this._getNewPixelOrigin(_,l);return this.project(r,l)._subtract(b)},_latLngBoundsToNewLayerBounds:function(r,l,_){var b=this._getNewPixelOrigin(_,l);return gi([this.project(r.getSouthWest(),l)._subtract(b),this.project(r.getNorthWest(),l)._subtract(b),this.project(r.getSouthEast(),l)._subtract(b),this.project(r.getNorthEast(),l)._subtract(b)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(r){return this.latLngToLayerPoint(r).subtract(this._getCenterLayerPoint())},_limitCenter:function(r,l,_){if(!_)return r;var b=this.project(r,l),A=this.getSize().divideBy(2),N=new Ze(b.subtract(A),b.add(A)),et=this._getBoundsOffset(N,_,l);return et.round().equals([0,0])?r:this.unproject(b.add(et),l)},_limitOffset:function(r,l){if(!l)return r;var _=this.getPixelBounds(),b=new Ze(_.min.add(r),_.max.add(r));return r.add(this._getBoundsOffset(b,l))},_getBoundsOffset:function(r,l,_){var b=gi(this.project(l.getNorthEast(),_),this.project(l.getSouthWest(),_)),A=b.min.subtract(r.min),N=b.max.subtract(r.max),et=this._rebound(A.x,-N.x),nt=this._rebound(A.y,-N.y);return new ae(et,nt)},_rebound:function(r,l){return r+l>0?Math.round(r-l)/2:Math.max(0,Math.ceil(r))-Math.max(0,Math.floor(l))},_limitZoom:function(r){var l=this.getMinZoom(),_=this.getMaxZoom(),b=U.any3d?this.options.zoomSnap:1;return b&&(r=Math.round(r/b)*b),Math.max(l,Math.min(_,r))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){si(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(r,l){var _=this._getCenterOffset(r)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(_)?!1:(this.panBy(_,l),!0)},_createAnimProxy:function(){var r=this._proxy=Ie("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(r),this.on("zoomanim",function(l){var _=we,b=this._proxy.style[_];Er(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),b===this._proxy.style[_]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){je(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var r=this.getCenter(),l=this.getZoom();Er(this._proxy,this.project(r,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(r){this._animatingZoom&&r.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(r,l,_){if(this._animatingZoom)return!0;if(_=_||{},!this._zoomAnimated||_.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var b=this.getZoomScale(l),A=this._getCenterOffset(r)._divideBy(1-1/b);return _.animate!==!0&&!this.getSize().contains(A)?!1:(ui(function(){this._moveStart(!0,!1)._animateZoom(r,l,!0)},this),!0)},_animateZoom:function(r,l,_,b){!this._mapPane||(_&&(this._animatingZoom=!0,this._animateToCenter=r,this._animateToZoom=l,ge(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:r,zoom:l,noUpdate:b}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(ot(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){!this._animatingZoom||(this._mapPane&&si(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Fo(r,l){return new Ee(r,l)}var ln=Ci.extend({options:{position:"topright"},initialize:function(r){ce(this,r)},getPosition:function(){return this.options.position},setPosition:function(r){var l=this._map;return l&&l.removeControl(this),this.options.position=r,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(r){this.remove(),this._map=r;var l=this._container=this.onAdd(r),_=this.getPosition(),b=r._controlCorners[_];return ge(l,"leaflet-control"),_.indexOf("bottom")!==-1?b.insertBefore(l,b.firstChild):b.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(je(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(r){this._map&&r&&r.screenX>0&&r.screenY>0&&this._map.getContainer().focus()}}),Cr=function(r){return new ln(r)};Ee.include({addControl:function(r){return r.addTo(this),this},removeControl:function(r){return r.remove(),this},_initControlPos:function(){var r=this._controlCorners={},l="leaflet-",_=this._controlContainer=Ie("div",l+"control-container",this._container);function b(A,N){var et=l+A+" "+l+N;r[A+N]=Ie("div",et,_)}b("top","left"),b("top","right"),b("bottom","left"),b("bottom","right")},_clearControlPos:function(){for(var r in this._controlCorners)je(this._controlCorners[r]);je(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Uo=ln.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(r,l,_,b){return _<b?-1:b<_?1:0}},initialize:function(r,l,_){ce(this,_),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var b in r)this._addLayer(r[b],b);for(b in l)this._addLayer(l[b],b,!0)},onAdd:function(r){this._initLayout(),this._update(),this._map=r,r.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(r){return ln.prototype.addTo.call(this,r),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(r,l){return this._addLayer(r,l),this._map?this._update():this},addOverlay:function(r,l){return this._addLayer(r,l,!0),this._map?this._update():this},removeLayer:function(r){r.off("add remove",this._onLayerChange,this);var l=this._getLayer(Pt(r));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){ge(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var r=this._map.getSize().y-(this._container.offsetTop+50);return r<this._section.clientHeight?(ge(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=r+"px"):si(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return si(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var r="leaflet-control-layers",l=this._container=Ie("div",r),_=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Ds(l),lo(l);var b=this._section=Ie("section",r+"-list");_&&(this._map.on("click",this.collapse,this),fe(l,{mouseenter:function(){fe(b,"click",hi),this.expand(),setTimeout(function(){Ye(b,"click",hi)})},mouseleave:this.collapse},this));var A=this._layersLink=Ie("a",r+"-toggle",l);A.href="#",A.title="Layers",A.setAttribute("role","button"),fe(A,"click",hi),fe(A,"focus",this.expand,this),_||this.expand(),this._baseLayersList=Ie("div",r+"-base",b),this._separator=Ie("div",r+"-separator",b),this._overlaysList=Ie("div",r+"-overlays",b),l.appendChild(b)},_getLayer:function(r){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&Pt(this._layers[l].layer)===r)return this._layers[l]},_addLayer:function(r,l,_){this._map&&r.on("add remove",this._onLayerChange,this),this._layers.push({layer:r,name:l,overlay:_}),this.options.sortLayers&&this._layers.sort(ot(function(b,A){return this.options.sortFunction(b.layer,A.layer,b.name,A.name)},this)),this.options.autoZIndex&&r.setZIndex&&(this._lastZIndex++,r.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Oe(this._baseLayersList),Oe(this._overlaysList),this._layerControlInputs=[];var r,l,_,b,A=0;for(_=0;_<this._layers.length;_++)b=this._layers[_],this._addItem(b),l=l||b.overlay,r=r||!b.overlay,A+=b.overlay?0:1;return this.options.hideSingleBase&&(r=r&&A>1,this._baseLayersList.style.display=r?"":"none"),this._separator.style.display=l&&r?"":"none",this},_onLayerChange:function(r){this._handlingClick||this._update();var l=this._getLayer(Pt(r.target)),_=l.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;_&&this._map.fire(_,l)},_createRadioElement:function(r,l){var _='<input type="radio" class="leaflet-control-layers-selector" name="'+r+'"'+(l?' checked="checked"':"")+"/>",b=document.createElement("div");return b.innerHTML=_,b.firstChild},_addItem:function(r){var l=document.createElement("label"),_=this._map.hasLayer(r.layer),b;r.overlay?(b=document.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=_):b=this._createRadioElement("leaflet-base-layers_"+Pt(this),_),this._layerControlInputs.push(b),b.layerId=Pt(r.layer),fe(b,"click",this._onInputClick,this);var A=document.createElement("span");A.innerHTML=" "+r.name;var N=document.createElement("span");l.appendChild(N),N.appendChild(b),N.appendChild(A);var et=r.overlay?this._overlaysList:this._baseLayersList;return et.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){var r=this._layerControlInputs,l,_,b=[],A=[];this._handlingClick=!0;for(var N=r.length-1;N>=0;N--)l=r[N],_=this._getLayer(l.layerId).layer,l.checked?b.push(_):l.checked||A.push(_);for(N=0;N<A.length;N++)this._map.hasLayer(A[N])&&this._map.removeLayer(A[N]);for(N=0;N<b.length;N++)this._map.hasLayer(b[N])||this._map.addLayer(b[N]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,l,_,b=this._map.getZoom(),A=r.length-1;A>=0;A--)l=r[A],_=this._getLayer(l.layerId).layer,l.disabled=_.options.minZoom!==void 0&&b<_.options.minZoom||_.options.maxZoom!==void 0&&b>_.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this}}),oa=function(r,l,_){return new Uo(r,l,_)},Mr=ln.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(r){var l="leaflet-control-zoom",_=Ie("div",l+" leaflet-bar"),b=this.options;return this._zoomInButton=this._createButton(b.zoomInText,b.zoomInTitle,l+"-in",_,this._zoomIn),this._zoomOutButton=this._createButton(b.zoomOutText,b.zoomOutTitle,l+"-out",_,this._zoomOut),this._updateDisabled(),r.on("zoomend zoomlevelschange",this._updateDisabled,this),_},onRemove:function(r){r.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(r){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(r.shiftKey?3:1))},_zoomOut:function(r){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(r.shiftKey?3:1))},_createButton:function(r,l,_,b,A){var N=Ie("a",_,b);return N.innerHTML=r,N.href="#",N.title=l,N.setAttribute("role","button"),N.setAttribute("aria-label",l),Ds(N),fe(N,"click",An),fe(N,"click",A,this),fe(N,"click",this._refocusOnMap,this),N},_updateDisabled:function(){var r=this._map,l="leaflet-disabled";si(this._zoomInButton,l),si(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||r._zoom===r.getMinZoom())&&(ge(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||r._zoom===r.getMaxZoom())&&(ge(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ee.mergeOptions({zoomControl:!0}),Ee.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Mr,this.addControl(this.zoomControl))});var Ca=function(r){return new Mr(r)},aa=ln.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(r){var l="leaflet-control-scale",_=Ie("div",l),b=this.options;return this._addScales(b,l+"-line",_),r.on(b.updateWhenIdle?"moveend":"move",this._update,this),r.whenReady(this._update,this),_},onRemove:function(r){r.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(r,l,_){r.metric&&(this._mScale=Ie("div",l,_)),r.imperial&&(this._iScale=Ie("div",l,_))},_update:function(){var r=this._map,l=r.getSize().y/2,_=r.distance(r.containerPointToLatLng([0,l]),r.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(_)},_updateScales:function(r){this.options.metric&&r&&this._updateMetric(r),this.options.imperial&&r&&this._updateImperial(r)},_updateMetric:function(r){var l=this._getRoundNum(r),_=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,_,l/r)},_updateImperial:function(r){var l=r*3.2808399,_,b,A;l>5280?(_=l/5280,b=this._getRoundNum(_),this._updateScale(this._iScale,b+" mi",b/_)):(A=this._getRoundNum(l),this._updateScale(this._iScale,A+" ft",A/l))},_updateScale:function(r,l,_){r.style.width=Math.round(this.options.maxWidth*_)+"px",r.innerHTML=l},_getRoundNum:function(r){var l=Math.pow(10,(Math.floor(r)+"").length-1),_=r/l;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,l*_}}),Ma=function(r){return new aa(r)},za='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',No=ln.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(U.inlineSvg?za+" ":"")+"Leaflet</a>"},initialize:function(r){ce(this,r),this._attributions={}},onAdd:function(r){r.attributionControl=this,this._container=Ie("div","leaflet-control-attribution"),Ds(this._container);for(var l in r._layers)r._layers[l].getAttribution&&this.addAttribution(r._layers[l].getAttribution());return this._update(),r.on("layeradd",this._addAttribution,this),this._container},onRemove:function(r){r.off("layeradd",this._addAttribution,this)},_addAttribution:function(r){r.layer.getAttribution&&(this.addAttribution(r.layer.getAttribution()),r.layer.once("remove",function(){this.removeAttribution(r.layer.getAttribution())},this))},setPrefix:function(r){return this.options.prefix=r,this._update(),this},addAttribution:function(r){return r?(this._attributions[r]||(this._attributions[r]=0),this._attributions[r]++,this._update(),this):this},removeAttribution:function(r){return r?(this._attributions[r]&&(this._attributions[r]--,this._update()),this):this},_update:function(){if(!!this._map){var r=[];for(var l in this._attributions)this._attributions[l]&&r.push(l);var _=[];this.options.prefix&&_.push(this.options.prefix),r.length&&_.push(r.join(", ")),this._container.innerHTML=_.join(' <span aria-hidden="true">|</span> ')}}});Ee.mergeOptions({attributionControl:!0}),Ee.addInitHook(function(){this.options.attributionControl&&new No().addTo(this)});var La=function(r){return new No(r)};ln.Layers=Uo,ln.Zoom=Mr,ln.Scale=aa,ln.Attribution=No,Cr.layers=oa,Cr.zoom=Ca,Cr.scale=Ma,Cr.attribution=La;var vn=Ci.extend({initialize:function(r){this._map=r},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});vn.addTo=function(r,l){return r.addHandler(l,this),this};var co={Events:Yt},uo=U.touch?"touchstart mousedown":"mousedown",qn=sn.extend({options:{clickTolerance:3},initialize:function(r,l,_,b){ce(this,b),this._element=r,this._dragStartTarget=l||r,this._preventOutline=_},enable:function(){this._enabled||(fe(this._dragStartTarget,uo,this._onDown,this),this._enabled=!0)},disable:function(){!this._enabled||(qn._dragging===this&&this.finishDrag(!0),Ye(this._dragStartTarget,uo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(r){if(!!this._enabled&&(this._moved=!1,!so(this._element,"leaflet-zoom-anim"))){if(r.touches&&r.touches.length!==1){qn._dragging===this&&this.finishDrag();return}if(!(qn._dragging||r.shiftKey||r.which!==1&&r.button!==1&&!r.touches)&&(qn._dragging=this,this._preventOutline&&$r(this._element),As(),Zn(),!this._moving)){this.fire("down");var l=r.touches?r.touches[0]:r,_=Do(this._element);this._startPoint=new ae(l.clientX,l.clientY),this._startPos=Pn(this._element),this._parentScale=Ms(_);var b=r.type==="mousedown";fe(document,b?"mousemove":"touchmove",this._onMove,this),fe(document,b?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(r){if(!!this._enabled){if(r.touches&&r.touches.length>1){this._moved=!0;return}var l=r.touches&&r.touches.length===1?r.touches[0]:r,_=new ae(l.clientX,l.clientY)._subtract(this._startPoint);!_.x&&!_.y||Math.abs(_.x)+Math.abs(_.y)<this.options.clickTolerance||(_.x/=this._parentScale.x,_.y/=this._parentScale.y,hi(r),this._moved||(this.fire("dragstart"),this._moved=!0,ge(document.body,"leaflet-dragging"),this._lastTarget=r.target||r.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ge(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(_),this._moving=!0,this._lastEvent=r,this._updatePosition())}},_updatePosition:function(){var r={originalEvent:this._lastEvent};this.fire("predrag",r),Je(this._element,this._newPos),this.fire("drag",r)},_onUp:function(){!this._enabled||this.finishDrag()},finishDrag:function(r){si(document.body,"leaflet-dragging"),this._lastTarget&&(si(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ye(document,"mousemove touchmove",this._onMove,this),Ye(document,"mouseup touchend touchcancel",this._onUp,this),_s(),Pr(),this._moved&&this._moving&&this.fire("dragend",{noInertia:r,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,qn._dragging=!1}});function jr(r,l){if(!l||!r.length)return r.slice();var _=l*l;return r=ha(r,_),r=po(r,_),r}function Zo(r,l,_){return Math.sqrt(Fe(r,l,_,!0))}function la(r,l,_){return Fe(r,l,_)}function po(r,l){var _=r.length,b=typeof Uint8Array!=void 0+""?Uint8Array:Array,A=new b(_);A[0]=A[_-1]=1,sr(r,A,l,0,_-1);var N,et=[];for(N=0;N<_;N++)A[N]&&et.push(r[N]);return et}function sr(r,l,_,b,A){var N=0,et,nt,lt;for(nt=b+1;nt<=A-1;nt++)lt=Fe(r[nt],r[b],r[A],!0),lt>N&&(et=nt,N=lt);N>_&&(l[et]=1,sr(r,l,_,b,et),sr(r,l,_,et,A))}function ha(r,l){for(var _=[r[0]],b=1,A=0,N=r.length;b<N;b++)Re(r[b],r[A])>l&&(_.push(r[b]),A=b);return A<N-1&&_.push(r[N-1]),_}var Wr;function He(r,l,_,b,A){var N=b?Wr:pe(r,_),et=pe(l,_),nt,lt,Ct;for(Wr=et;;){if(!(N|et))return[r,l];if(N&et)return!1;nt=N||et,lt=Rs(r,l,nt,_,A),Ct=pe(lt,_),nt===N?(r=lt,N=Ct):(l=lt,et=Ct)}}function Rs(r,l,_,b,A){var N=l.x-r.x,et=l.y-r.y,nt=b.min,lt=b.max,Ct,Wt;return _&8?(Ct=r.x+N*(lt.y-r.y)/et,Wt=lt.y):_&4?(Ct=r.x+N*(nt.y-r.y)/et,Wt=nt.y):_&2?(Ct=lt.x,Wt=r.y+et*(lt.x-r.x)/N):_&1&&(Ct=nt.x,Wt=r.y+et*(nt.x-r.x)/N),new ae(Ct,Wt,A)}function pe(r,l){var _=0;return r.x<l.min.x?_|=1:r.x>l.max.x&&(_|=2),r.y<l.min.y?_|=4:r.y>l.max.y&&(_|=8),_}function Re(r,l){var _=l.x-r.x,b=l.y-r.y;return _*_+b*b}function Fe(r,l,_,b){var A=l.x,N=l.y,et=_.x-A,nt=_.y-N,lt=et*et+nt*nt,Ct;return lt>0&&(Ct=((r.x-A)*et+(r.y-N)*nt)/lt,Ct>1?(A=_.x,N=_.y):Ct>0&&(A+=et*Ct,N+=nt*Ct)),et=r.x-A,nt=r.y-N,b?et*et+nt*nt:new ae(A,N)}function ze(r){return!ii(r[0])||typeof r[0][0]!="object"&&typeof r[0][0]<"u"}function ys(r){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ze(r)}function Hr(r,l){var _,b,A,N,et,nt,lt,Ct;if(!r||r.length===0)throw new Error("latlngs not passed");ze(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var Wt=[];for(var oe in r)Wt.push(l.project(De(r[oe])));var ie=Wt.length;for(_=0,b=0;_<ie-1;_++)b+=Wt[_].distanceTo(Wt[_+1])/2;if(b===0)Ct=Wt[0];else for(_=0,N=0;_<ie-1;_++)if(et=Wt[_],nt=Wt[_+1],A=et.distanceTo(nt),N+=A,N>b){lt=(N-b)/A,Ct=[nt.x-lt*(nt.x-et.x),nt.y-lt*(nt.y-et.y)];break}return l.unproject(re(Ct))}var ka={__proto__:null,simplify:jr,pointToSegmentDistance:Zo,closestPointOnSegment:la,clipSegment:He,_getEdgeIntersection:Rs,_getBitCode:pe,_sqClosestPointOnSegment:Fe,isFlat:ze,_flat:ys,polylineCenter:Hr};function ca(r,l,_){var b,A=[1,4,2,8],N,et,nt,lt,Ct,Wt,oe,ie;for(N=0,Wt=r.length;N<Wt;N++)r[N]._code=pe(r[N],l);for(nt=0;nt<4;nt++){for(oe=A[nt],b=[],N=0,Wt=r.length,et=Wt-1;N<Wt;et=N++)lt=r[N],Ct=r[et],lt._code&oe?Ct._code&oe||(ie=Rs(Ct,lt,oe,l,_),ie._code=pe(ie,l),b.push(ie)):(Ct._code&oe&&(ie=Rs(Ct,lt,oe,l,_),ie._code=pe(ie,l),b.push(ie)),b.push(lt));r=b}return r}function Vo(r,l){var _,b,A,N,et,nt,lt,Ct,Wt;if(!r||r.length===0)throw new Error("latlngs not passed");ze(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var oe=[];for(var ie in r)oe.push(l.project(De(r[ie])));var xi=oe.length;for(nt=lt=Ct=0,_=0,b=xi-1;_<xi;b=_++)A=oe[_],N=oe[b],et=A.y*N.x-N.y*A.x,lt+=(A.x+N.x)*et,Ct+=(A.y+N.y)*et,nt+=et*3;return nt===0?Wt=oe[0]:Wt=[lt/nt,Ct/nt],l.unproject(re(Wt))}var Da={__proto__:null,clipPolygon:ca,polygonCenter:Vo},vs={project:function(r){return new ae(r.lng,r.lat)},unproject:function(r){return new Pe(r.y,r.x)},bounds:new Ze([-180,-90],[180,90])},Xr={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Ze([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(r){var l=Math.PI/180,_=this.R,b=r.lat*l,A=this.R_MINOR/_,N=Math.sqrt(1-A*A),et=N*Math.sin(b),nt=Math.tan(Math.PI/4-b/2)/Math.pow((1-et)/(1+et),N/2);return b=-_*Math.log(Math.max(nt,1e-10)),new ae(r.lng*l*_,b)},unproject:function(r){for(var l=180/Math.PI,_=this.R,b=this.R_MINOR/_,A=Math.sqrt(1-b*b),N=Math.exp(-r.y/_),et=Math.PI/2-2*Math.atan(N),nt=0,lt=.1,Ct;nt<15&&Math.abs(lt)>1e-7;nt++)Ct=A*Math.sin(et),Ct=Math.pow((1-Ct)/(1+Ct),A/2),lt=Math.PI/2-2*Math.atan(N*Ct)-et,et+=lt;return new Pe(et*l,r.x*l/_)}},Os={__proto__:null,LonLat:vs,Mercator:Xr,SphericalMercator:gr},Fs=R({},Ni,{code:"EPSG:3395",projection:Xr,transformation:function(){var r=.5/(Math.PI*Xr.R);return on(r,.5,-r,.5)}()}),fo=R({},Ni,{code:"EPSG:4326",projection:vs,transformation:on(1/180,1,-1/180,.5)}),ua=R({},Mi,{projection:vs,transformation:on(1,0,-1,0),scale:function(r){return Math.pow(2,r)},zoom:function(r){return Math.log(r)/Math.LN2},distance:function(r,l){var _=l.lng-r.lng,b=l.lat-r.lat;return Math.sqrt(_*_+b*b)},infinite:!0});Mi.Earth=Ni,Mi.EPSG3395=Fs,Mi.EPSG3857=Vi,Mi.EPSG900913=Es,Mi.EPSG4326=fo,Mi.Simple=ua;var Ki=sn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(r){return r.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(r){return r&&r.removeLayer(this),this},getPane:function(r){return this._map.getPane(r?this.options[r]||r:this.options.pane)},addInteractiveTarget:function(r){return this._map._targets[Pt(r)]=this,this},removeInteractiveTarget:function(r){return delete this._map._targets[Pt(r)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(r){var l=r.target;if(!!l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var _=this.getEvents();l.on(_,this),this.once("remove",function(){l.off(_,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});Ee.include({addLayer:function(r){if(!r._layerAdd)throw new Error("The provided object is not a Layer.");var l=Pt(r);return this._layers[l]?this:(this._layers[l]=r,r._mapToAdd=this,r.beforeAdd&&r.beforeAdd(this),this.whenReady(r._layerAdd,r),this)},removeLayer:function(r){var l=Pt(r);return this._layers[l]?(this._loaded&&r.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:r}),r.fire("remove")),r._map=r._mapToAdd=null,this):this},hasLayer:function(r){return Pt(r)in this._layers},eachLayer:function(r,l){for(var _ in this._layers)r.call(l,this._layers[_]);return this},_addLayers:function(r){r=r?ii(r)?r:[r]:[];for(var l=0,_=r.length;l<_;l++)this.addLayer(r[l])},_addZoomLimit:function(r){(!isNaN(r.options.maxZoom)||!isNaN(r.options.minZoom))&&(this._zoomBoundLayers[Pt(r)]=r,this._updateZoomLevels())},_removeZoomLimit:function(r){var l=Pt(r);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var r=1/0,l=-1/0,_=this._getZoomSpan();for(var b in this._zoomBoundLayers){var A=this._zoomBoundLayers[b].options;r=A.minZoom===void 0?r:Math.min(r,A.minZoom),l=A.maxZoom===void 0?l:Math.max(l,A.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=r===1/0?void 0:r,_!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var or=Ki.extend({initialize:function(r,l){ce(this,l),this._layers={};var _,b;if(r)for(_=0,b=r.length;_<b;_++)this.addLayer(r[_])},addLayer:function(r){var l=this.getLayerId(r);return this._layers[l]=r,this._map&&this._map.addLayer(r),this},removeLayer:function(r){var l=r in this._layers?r:this.getLayerId(r);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(r){var l=typeof r=="number"?r:this.getLayerId(r);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(r){var l=Array.prototype.slice.call(arguments,1),_,b;for(_ in this._layers)b=this._layers[_],b[r]&&b[r].apply(b,l);return this},onAdd:function(r){this.eachLayer(r.addLayer,r)},onRemove:function(r){this.eachLayer(r.removeLayer,r)},eachLayer:function(r,l){for(var _ in this._layers)r.call(l,this._layers[_]);return this},getLayer:function(r){return this._layers[r]},getLayers:function(){var r=[];return this.eachLayer(r.push,r),r},setZIndex:function(r){return this.invoke("setZIndex",r)},getLayerId:function(r){return Pt(r)}}),Cn=function(r,l){return new or(r,l)},zr=or.extend({addLayer:function(r){return this.hasLayer(r)?this:(r.addEventParent(this),or.prototype.addLayer.call(this,r),this.fire("layeradd",{layer:r}))},removeLayer:function(r){return this.hasLayer(r)?(r in this._layers&&(r=this._layers[r]),r.removeEventParent(this),or.prototype.removeLayer.call(this,r),this.fire("layerremove",{layer:r})):this},setStyle:function(r){return this.invoke("setStyle",r)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var r=new yi;for(var l in this._layers){var _=this._layers[l];r.extend(_.getBounds?_.getBounds():_.getLatLng())}return r}}),Go=function(r,l){return new zr(r,l)},Kr=Ci.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(r){ce(this,r)},createIcon:function(r){return this._createIcon("icon",r)},createShadow:function(r){return this._createIcon("shadow",r)},_createIcon:function(r,l){var _=this._getIconUrl(r);if(!_){if(r==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var b=this._createImg(_,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(b,r),(this.options.crossOrigin||this.options.crossOrigin==="")&&(b.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),b},_setIconStyles:function(r,l){var _=this.options,b=_[l+"Size"];typeof b=="number"&&(b=[b,b]);var A=re(b),N=re(l==="shadow"&&_.shadowAnchor||_.iconAnchor||A&&A.divideBy(2,!0));r.className="leaflet-marker-"+l+" "+(_.className||""),N&&(r.style.marginLeft=-N.x+"px",r.style.marginTop=-N.y+"px"),A&&(r.style.width=A.x+"px",r.style.height=A.y+"px")},_createImg:function(r,l){return l=l||document.createElement("img"),l.src=r,l},_getIconUrl:function(r){return U.retina&&this.options[r+"RetinaUrl"]||this.options[r+"Url"]}});function Jr(r){return new Kr(r)}var ar=Kr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(r){return typeof ar.imagePath!="string"&&(ar.imagePath=this._detectIconPath()),(this.options.imagePath||ar.imagePath)+Kr.prototype._getIconUrl.call(this,r)},_stripUrl:function(r){var l=function(_,b,A){var N=b.exec(_);return N&&N[A]};return r=l(r,/^url\((['"])?(.+)\1\)$/,2),r&&l(r,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var r=Ie("div","leaflet-default-icon-path",document.body),l=fi(r,"background-image")||fi(r,"backgroundImage");if(document.body.removeChild(r),l=this._stripUrl(l),l)return l;var _=document.querySelector('link[href$="leaflet.css"]');return _?_.href.substring(0,_.href.length-11-1):""}}),Yr=vn.extend({initialize:function(r){this._marker=r},addHooks:function(){var r=this._marker._icon;this._draggable||(this._draggable=new qn(r,r,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ge(r,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&si(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(r){var l=this._marker,_=l._map,b=this._marker.options.autoPanSpeed,A=this._marker.options.autoPanPadding,N=Pn(l._icon),et=_.getPixelBounds(),nt=_.getPixelOrigin(),lt=gi(et.min._subtract(nt).add(A),et.max._subtract(nt).subtract(A));if(!lt.contains(N)){var Ct=re((Math.max(lt.max.x,N.x)-lt.max.x)/(et.max.x-lt.max.x)-(Math.min(lt.min.x,N.x)-lt.min.x)/(et.min.x-lt.min.x),(Math.max(lt.max.y,N.y)-lt.max.y)/(et.max.y-lt.max.y)-(Math.min(lt.min.y,N.y)-lt.min.y)/(et.min.y-lt.min.y)).multiplyBy(b);_.panBy(Ct,{animate:!1}),this._draggable._newPos._add(Ct),this._draggable._startPos._add(Ct),Je(l._icon,this._draggable._newPos),this._onDrag(r),this._panRequest=ui(this._adjustPan.bind(this,r))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(r){this._marker.options.autoPan&&(pi(this._panRequest),this._panRequest=ui(this._adjustPan.bind(this,r)))},_onDrag:function(r){var l=this._marker,_=l._shadow,b=Pn(l._icon),A=l._map.layerPointToLatLng(b);_&&Je(_,b),l._latlng=A,r.latlng=A,r.oldLatLng=this._oldLatLng,l.fire("move",r).fire("drag",r)},_onDragEnd:function(r){pi(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",r)}}),mo=Ki.extend({options:{icon:new ar,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(r,l){ce(this,l),this._latlng=De(r)},onAdd:function(r){this._zoomAnimated=this._zoomAnimated&&r.options.markerZoomAnimation,this._zoomAnimated&&r.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(r){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&r.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(r){var l=this._latlng;return this._latlng=De(r),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(r){return this.options.zIndexOffset=r,this.update()},getIcon:function(){return this.options.icon},setIcon:function(r){return this.options.icon=r,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var r=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(r)}return this},_initIcon:function(){var r=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),_=r.icon.createIcon(this._icon),b=!1;_!==this._icon&&(this._icon&&this._removeIcon(),b=!0,r.title&&(_.title=r.title),_.tagName==="IMG"&&(_.alt=r.alt||"")),ge(_,l),r.keyboard&&(_.tabIndex="0",_.setAttribute("role","button")),this._icon=_,r.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&fe(_,"focus",this._panOnFocus,this);var A=r.icon.createShadow(this._shadow),N=!1;A!==this._shadow&&(this._removeShadow(),N=!0),A&&(ge(A,l),A.alt=""),this._shadow=A,r.opacity<1&&this._updateOpacity(),b&&this.getPane().appendChild(this._icon),this._initInteraction(),A&&N&&this.getPane(r.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ye(this._icon,"focus",this._panOnFocus,this),je(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&je(this._shadow),this._shadow=null},_setPos:function(r){this._icon&&Je(this._icon,r),this._shadow&&Je(this._shadow,r),this._zIndex=r.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(r){this._icon&&(this._icon.style.zIndex=this._zIndex+r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center).round();this._setPos(l)},_initInteraction:function(){if(!!this.options.interactive&&(ge(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Yr)){var r=this.options.draggable;this.dragging&&(r=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Yr(this),r&&this.dragging.enable()}},setOpacity:function(r){return this.options.opacity=r,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var r=this.options.opacity;this._icon&&Hi(this._icon,r),this._shadow&&Hi(this._shadow,r)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var r=this._map;if(!!r){var l=this.options.icon.options,_=l.iconSize?re(l.iconSize):re(0,0),b=l.iconAnchor?re(l.iconAnchor):re(0,0);r.panInside(this._latlng,{paddingTopLeft:b,paddingBottomRight:_.subtract(b)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function _o(r,l){return new mo(r,l)}var lr=Ki.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(r){this._renderer=r.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(r){return ce(this,r),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&r&&Object.prototype.hasOwnProperty.call(r,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Us=lr.extend({options:{fill:!0,radius:10},initialize:function(r,l){ce(this,l),this._latlng=De(r),this._radius=this.options.radius},setLatLng:function(r){var l=this._latlng;return this._latlng=De(r),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(r){return this.options.radius=this._radius=r,this.redraw()},getRadius:function(){return this._radius},setStyle:function(r){var l=r&&r.radius||this._radius;return lr.prototype.setStyle.call(this,r),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,l=this._radiusY||r,_=this._clickTolerance(),b=[r+_,l+_];this._pxBounds=new Ze(this._point.subtract(b),this._point.add(b))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(r){return r.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ns(r,l){return new Us(r,l)}var Zs=Us.extend({initialize:function(r,l,_){if(typeof l=="number"&&(l=R({},_,{radius:l})),ce(this,l),this._latlng=De(r),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(r){return this._mRadius=r,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var r=[this._radius,this._radiusY||this._radius];return new yi(this._map.layerPointToLatLng(this._point.subtract(r)),this._map.layerPointToLatLng(this._point.add(r)))},setStyle:lr.prototype.setStyle,_project:function(){var r=this._latlng.lng,l=this._latlng.lat,_=this._map,b=_.options.crs;if(b.distance===Ni.distance){var A=Math.PI/180,N=this._mRadius/Ni.R/A,et=_.project([l+N,r]),nt=_.project([l-N,r]),lt=et.add(nt).divideBy(2),Ct=_.unproject(lt).lat,Wt=Math.acos((Math.cos(N*A)-Math.sin(l*A)*Math.sin(Ct*A))/(Math.cos(l*A)*Math.cos(Ct*A)))/A;(isNaN(Wt)||Wt===0)&&(Wt=N/Math.cos(Math.PI/180*l)),this._point=lt.subtract(_.getPixelOrigin()),this._radius=isNaN(Wt)?0:lt.x-_.project([Ct,r-Wt]).x,this._radiusY=lt.y-et.y}else{var oe=b.unproject(b.project(this._latlng).subtract([this._mRadius,0]));this._point=_.latLngToLayerPoint(this._latlng),this._radius=this._point.x-_.latLngToLayerPoint(oe).x}this._updateBounds()}});function go(r,l,_){return new Zs(r,l,_)}var hn=lr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(r,l){ce(this,l),this._setLatLngs(r)},getLatLngs:function(){return this._latlngs},setLatLngs:function(r){return this._setLatLngs(r),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(r){for(var l=1/0,_=null,b=Fe,A,N,et=0,nt=this._parts.length;et<nt;et++)for(var lt=this._parts[et],Ct=1,Wt=lt.length;Ct<Wt;Ct++){A=lt[Ct-1],N=lt[Ct];var oe=b(r,A,N,!0);oe<l&&(l=oe,_=b(r,A,N))}return _&&(_.distance=Math.sqrt(l)),_},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Hr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(r,l){return l=l||this._defaultShape(),r=De(r),l.push(r),this._bounds.extend(r),this.redraw()},_setLatLngs:function(r){this._bounds=new yi,this._latlngs=this._convertLatLngs(r)},_defaultShape:function(){return ze(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(r){for(var l=[],_=ze(r),b=0,A=r.length;b<A;b++)_?(l[b]=De(r[b]),this._bounds.extend(l[b])):l[b]=this._convertLatLngs(r[b]);return l},_project:function(){var r=new Ze;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,r),this._bounds.isValid()&&r.isValid()&&(this._rawPxBounds=r,this._updateBounds())},_updateBounds:function(){var r=this._clickTolerance(),l=new ae(r,r);!this._rawPxBounds||(this._pxBounds=new Ze([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(r,l,_){var b=r[0]instanceof Pe,A=r.length,N,et;if(b){for(et=[],N=0;N<A;N++)et[N]=this._map.latLngToLayerPoint(r[N]),_.extend(et[N]);l.push(et)}else for(N=0;N<A;N++)this._projectLatlngs(r[N],l,_)},_clipPoints:function(){var r=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,_,b,A,N,et,nt,lt;for(_=0,A=0,N=this._rings.length;_<N;_++)for(lt=this._rings[_],b=0,et=lt.length;b<et-1;b++)nt=He(lt[b],lt[b+1],r,b,!0),nt&&(l[A]=l[A]||[],l[A].push(nt[0]),(nt[1]!==lt[b+1]||b===et-2)&&(l[A].push(nt[1]),A++))}},_simplifyPoints:function(){for(var r=this._parts,l=this.options.smoothFactor,_=0,b=r.length;_<b;_++)r[_]=jr(r[_],l)},_update:function(){!this._map||(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(r,l){var _,b,A,N,et,nt,lt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(_=0,N=this._parts.length;_<N;_++)for(nt=this._parts[_],b=0,et=nt.length,A=et-1;b<et;A=b++)if(!(!l&&b===0)&&Zo(r,nt[A],nt[b])<=lt)return!0;return!1}});function xs(r,l){return new hn(r,l)}hn._flat=ys;var $n=hn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Vo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(r){var l=hn.prototype._convertLatLngs.call(this,r),_=l.length;return _>=2&&l[0]instanceof Pe&&l[0].equals(l[_-1])&&l.pop(),l},_setLatLngs:function(r){hn.prototype._setLatLngs.call(this,r),ze(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ze(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var r=this._renderer._bounds,l=this.options.weight,_=new ae(l,l);if(r=new Ze(r.min.subtract(_),r.max.add(_)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}for(var b=0,A=this._rings.length,N;b<A;b++)N=ca(this._rings[b],r,!0),N.length&&this._parts.push(N)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(r){var l=!1,_,b,A,N,et,nt,lt,Ct;if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(N=0,lt=this._parts.length;N<lt;N++)for(_=this._parts[N],et=0,Ct=_.length,nt=Ct-1;et<Ct;nt=et++)b=_[et],A=_[nt],b.y>r.y!=A.y>r.y&&r.x<(A.x-b.x)*(r.y-b.y)/(A.y-b.y)+b.x&&(l=!l);return l||hn.prototype._containsPoint.call(this,r,!0)}});function pa(r,l){return new $n(r,l)}var cn=zr.extend({initialize:function(r,l){ce(this,l),this._layers={},r&&this.addData(r)},addData:function(r){var l=ii(r)?r:r.features,_,b,A;if(l){for(_=0,b=l.length;_<b;_++)A=l[_],(A.geometries||A.geometry||A.features||A.coordinates)&&this.addData(A);return this}var N=this.options;if(N.filter&&!N.filter(r))return this;var et=Vs(r,N);return et?(et.feature=Li(r),et.defaultOptions=et.options,this.resetStyle(et),N.onEachFeature&&N.onEachFeature(r,et),this.addLayer(et)):this},resetStyle:function(r){return r===void 0?this.eachLayer(this.resetStyle,this):(r.options=R({},r.defaultOptions),this._setLayerStyle(r,this.options.style),this)},setStyle:function(r){return this.eachLayer(function(l){this._setLayerStyle(l,r)},this)},_setLayerStyle:function(r,l){r.setStyle&&(typeof l=="function"&&(l=l(r.feature)),r.setStyle(l))}});function Vs(r,l){var _=r.type==="Feature"?r.geometry:r,b=_?_.coordinates:null,A=[],N=l&&l.pointToLayer,et=l&&l.coordsToLatLng||yo,nt,lt,Ct,Wt;if(!b&&!_)return null;switch(_.type){case"Point":return nt=et(b),qo(N,r,nt,l);case"MultiPoint":for(Ct=0,Wt=b.length;Ct<Wt;Ct++)nt=et(b[Ct]),A.push(qo(N,r,nt,l));return new zr(A);case"LineString":case"MultiLineString":return lt=hr(b,_.type==="LineString"?0:1,et),new hn(lt,l);case"Polygon":case"MultiPolygon":return lt=hr(b,_.type==="Polygon"?1:2,et),new $n(lt,l);case"GeometryCollection":for(Ct=0,Wt=_.geometries.length;Ct<Wt;Ct++){var oe=Vs({geometry:_.geometries[Ct],type:"Feature",properties:r.properties},l);oe&&A.push(oe)}return new zr(A);case"FeatureCollection":for(Ct=0,Wt=_.features.length;Ct<Wt;Ct++){var ie=Vs(_.features[Ct],l);ie&&A.push(ie)}return new zr(A);default:throw new Error("Invalid GeoJSON object.")}}function qo(r,l,_,b){return r?r(l,_):new mo(_,b&&b.markersInheritOptions&&b)}function yo(r){return new Pe(r[1],r[0],r[2])}function hr(r,l,_){for(var b=[],A=0,N=r.length,et;A<N;A++)et=l?hr(r[A],l-1,_):(_||yo)(r[A]),b.push(et);return b}function vo(r,l){return r=De(r),r.alt!==void 0?[dt(r.lng,l),dt(r.lat,l),dt(r.alt,l)]:[dt(r.lng,l),dt(r.lat,l)]}function Lr(r,l,_,b){for(var A=[],N=0,et=r.length;N<et;N++)A.push(l?Lr(r[N],ze(r[N])?0:l-1,_,b):vo(r[N],b));return!l&&_&&A.push(A[0]),A}function jn(r,l){return r.feature?R({},r.feature,{geometry:l}):Li(l)}function Li(r){return r.type==="Feature"||r.type==="FeatureCollection"?r:{type:"Feature",properties:{},geometry:r}}var Qr={toGeoJSON:function(r){return jn(this,{type:"Point",coordinates:vo(this.getLatLng(),r)})}};mo.include(Qr),Zs.include(Qr),Us.include(Qr),hn.include({toGeoJSON:function(r){var l=!ze(this._latlngs),_=Lr(this._latlngs,l?1:0,!1,r);return jn(this,{type:(l?"Multi":"")+"LineString",coordinates:_})}}),$n.include({toGeoJSON:function(r){var l=!ze(this._latlngs),_=l&&!ze(this._latlngs[0]),b=Lr(this._latlngs,_?2:l?1:0,!0,r);return l||(b=[b]),jn(this,{type:(_?"Multi":"")+"Polygon",coordinates:b})}}),or.include({toMultiPoint:function(r){var l=[];return this.eachLayer(function(_){l.push(_.toGeoJSON(r).geometry.coordinates)}),jn(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(r){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(r);var _=l==="GeometryCollection",b=[];return this.eachLayer(function(A){if(A.toGeoJSON){var N=A.toGeoJSON(r);if(_)b.push(N.geometry);else{var et=Li(N);et.type==="FeatureCollection"?b.push.apply(b,et.features):b.push(et)}}}),_?jn(this,{geometries:b,type:"GeometryCollection"}):{type:"FeatureCollection",features:b}}});function Ji(r,l){return new cn(r,l)}var Ba=Ji,Mn=Ki.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(r,l,_){this._url=r,this._bounds=ri(l),ce(this,_)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ge(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){je(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(r){return this.options.opacity=r,this._image&&this._updateOpacity(),this},setStyle:function(r){return r.opacity&&this.setOpacity(r.opacity),this},bringToFront:function(){return this._map&&Sr(this._image),this},bringToBack:function(){return this._map&&Ir(this._image),this},setUrl:function(r){return this._url=r,this._image&&(this._image.src=r),this},setBounds:function(r){return this._bounds=ri(r),this._map&&this._reset(),this},getEvents:function(){var r={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var r=this._url.tagName==="IMG",l=this._image=r?this._url:Ie("img");if(ge(l,"leaflet-image-layer"),this._zoomAnimated&&ge(l,"leaflet-zoom-animated"),this.options.className&&ge(l,this.options.className),l.onselectstart=Gt,l.onmousemove=Gt,l.onload=ot(this.fire,this,"load"),l.onerror=ot(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),r){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(r){var l=this._map.getZoomScale(r.zoom),_=this._map._latLngBoundsToNewLayerBounds(this._bounds,r.zoom,r.center).min;Er(this._image,_,l)},_reset:function(){var r=this._image,l=new Ze(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),_=l.getSize();Je(r,l.min),r.style.width=_.x+"px",r.style.height=_.y+"px"},_updateOpacity:function(){Hi(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var r=this.options.errorOverlayUrl;r&&this._url!==r&&(this._url=r,this._image.src=r)},getCenter:function(){return this._bounds.getCenter()}}),da=function(r,l,_){return new Mn(r,l,_)},Wn=Mn.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var r=this._url.tagName==="VIDEO",l=this._image=r?this._url:Ie("video");if(ge(l,"leaflet-image-layer"),this._zoomAnimated&&ge(l,"leaflet-zoom-animated"),this.options.className&&ge(l,this.options.className),l.onselectstart=Gt,l.onmousemove=Gt,l.onloadeddata=ot(this.fire,this,"load"),r){for(var _=l.getElementsByTagName("source"),b=[],A=0;A<_.length;A++)b.push(_[A].src);this._url=_.length>0?b:[l.src];return}ii(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var N=0;N<this._url.length;N++){var et=Ie("source");et.src=this._url[N],l.appendChild(et)}}});function Gs(r,l,_){return new Wn(r,l,_)}var xo=Mn.extend({_initImage:function(){var r=this._image=this._url;ge(r,"leaflet-image-layer"),this._zoomAnimated&&ge(r,"leaflet-zoom-animated"),this.options.className&&ge(r,this.options.className),r.onselectstart=Gt,r.onmousemove=Gt}});function Ra(r,l,_){return new xo(r,l,_)}var Hn=Ki.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(r,l){r&&(r instanceof L.LatLng||ii(r))?(this._latlng=De(r),ce(this,l)):(ce(this,r),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(r){return r=arguments.length?r:this._source._map,r.hasLayer(this)||r.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(r){return this._map?this.close():(arguments.length?this._source=r:r=this._source,this._prepareOpen(),this.openOn(r._map)),this},onAdd:function(r){this._zoomAnimated=r._zoomAnimated,this._container||this._initLayout(),r._fadeAnimated&&Hi(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),r._fadeAnimated&&Hi(this._container,1),this.bringToFront(),this.options.interactive&&(ge(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(r){r._fadeAnimated?(Hi(this._container,0),this._removeTimeout=setTimeout(ot(je,void 0,this._container),200)):je(this._container),this.options.interactive&&(si(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(r){return this._latlng=De(r),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(r){return this._content=r,this.update(),this},getElement:function(){return this._container},update:function(){!this._map||(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var r={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Sr(this._container),this},bringToBack:function(){return this._map&&Ir(this._container),this},_prepareOpen:function(r){var l=this._source;if(!l._map)return!1;if(l instanceof zr){l=null;var _=this._source._layers;for(var b in _)if(_[b]._map){l=_[b];break}if(!l)return!1;this._source=l}if(!r)if(l.getCenter)r=l.getCenter();else if(l.getLatLng)r=l.getLatLng();else if(l.getBounds)r=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(r),this._map&&this.update(),!0},_updateContent:function(){if(!!this._content){var r=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")r.innerHTML=l;else{for(;r.hasChildNodes();)r.removeChild(r.firstChild);r.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(!!this._map){var r=this._map.latLngToLayerPoint(this._latlng),l=re(this.options.offset),_=this._getAnchor();this._zoomAnimated?Je(this._container,r.add(_)):l=l.add(r).add(_);var b=this._containerBottom=-l.y,A=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=b+"px",this._container.style.left=A+"px"}},_getAnchor:function(){return[0,0]}});Ee.include({_initOverlay:function(r,l,_,b){var A=l;return A instanceof r||(A=new r(b).setContent(l)),_&&A.setLatLng(_),A}}),Ki.include({_initOverlay:function(r,l,_,b){var A=_;return A instanceof r?(ce(A,b),A._source=this):(A=l&&!b?l:new r(b,this),A.setContent(_)),A}});var ts=Hn.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(r){return r=arguments.length?r:this._source._map,!r.hasLayer(this)&&r._popup&&r._popup.options.autoClose&&r.removeLayer(r._popup),r._popup=this,Hn.prototype.openOn.call(this,r)},onAdd:function(r){Hn.prototype.onAdd.call(this,r),r.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof lr||this._source.on("preclick",xe))},onRemove:function(r){Hn.prototype.onRemove.call(this,r),r.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof lr||this._source.off("preclick",xe))},getEvents:function(){var r=Hn.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(r.preclick=this.close),this.options.keepInView&&(r.moveend=this._adjustPan),r},_initLayout:function(){var r="leaflet-popup",l=this._container=Ie("div",r+" "+(this.options.className||"")+" leaflet-zoom-animated"),_=this._wrapper=Ie("div",r+"-content-wrapper",l);if(this._contentNode=Ie("div",r+"-content",_),Ds(l),lo(this._contentNode),fe(l,"contextmenu",xe),this._tipContainer=Ie("div",r+"-tip-container",l),this._tip=Ie("div",r+"-tip",this._tipContainer),this.options.closeButton){var b=this._closeButton=Ie("a",r+"-close-button",l);b.setAttribute("role","button"),b.setAttribute("aria-label","Close popup"),b.href="#close",b.innerHTML='<span aria-hidden="true">&#215;</span>',fe(b,"click",function(A){hi(A),this.close()},this)}},_updateLayout:function(){var r=this._contentNode,l=r.style;l.width="",l.whiteSpace="nowrap";var _=r.offsetWidth;_=Math.min(_,this.options.maxWidth),_=Math.max(_,this.options.minWidth),l.width=_+1+"px",l.whiteSpace="",l.height="";var b=r.offsetHeight,A=this.options.maxHeight,N="leaflet-popup-scrolled";A&&b>A?(l.height=A+"px",ge(r,N)):si(r,N),this._containerWidth=this._container.offsetWidth},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center),_=this._getAnchor();Je(this._container,l.add(_))},_adjustPan:function(r){if(!!this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var l=this._map,_=parseInt(fi(this._container,"marginBottom"),10)||0,b=this._container.offsetHeight+_,A=this._containerWidth,N=new ae(this._containerLeft,-b-this._containerBottom);N._add(Pn(this._container));var et=l.layerPointToContainerPoint(N),nt=re(this.options.autoPanPadding),lt=re(this.options.autoPanPaddingTopLeft||nt),Ct=re(this.options.autoPanPaddingBottomRight||nt),Wt=l.getSize(),oe=0,ie=0;et.x+A+Ct.x>Wt.x&&(oe=et.x+A-Wt.x+Ct.x),et.x-oe-lt.x<0&&(oe=et.x-lt.x),et.y+b+Ct.y>Wt.y&&(ie=et.y+b-Wt.y+Ct.y),et.y-ie-lt.y<0&&(ie=et.y-lt.y),(oe||ie)&&l.fire("autopanstart").panBy([oe,ie],{animate:r&&r.type==="moveend"})}},_getAnchor:function(){return re(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),qs=function(r,l){return new ts(r,l)};Ee.mergeOptions({closePopupOnClick:!0}),Ee.include({openPopup:function(r,l,_){return this._initOverlay(ts,r,l,_).openOn(this),this},closePopup:function(r){return r=arguments.length?r:this._popup,r&&r.close(),this}}),Ki.include({bindPopup:function(r,l){return this._popup=this._initOverlay(ts,this._popup,r,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(r){return this._popup&&this._popup._prepareOpen(r||this._latlng)&&this._popup.openOn(this._map),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(r){return this._popup&&this._popup.setContent(r),this},getPopup:function(){return this._popup},_openPopup:function(r){if(!(!this._popup||!this._map)){An(r);var l=r.layer||r.target;if(this._popup._source===l&&!(l instanceof lr)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(r.latlng);return}this._popup._source=l,this.openPopup(r.latlng)}},_movePopup:function(r){this._popup.setLatLng(r.latlng)},_onKeyPress:function(r){r.originalEvent.keyCode===13&&this._openPopup(r)}});var xn=Hn.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(r){Hn.prototype.onAdd.call(this,r),this.setOpacity(this.options.opacity),r.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(r){Hn.prototype.onRemove.call(this,r),r.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var r=Hn.prototype.getEvents.call(this);return this.options.permanent||(r.preclick=this.close),r},_initLayout:function(){var r="leaflet-tooltip",l=r+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ie("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+Pt(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(r){var l,_,b=this._map,A=this._container,N=b.latLngToContainerPoint(b.getCenter()),et=b.layerPointToContainerPoint(r),nt=this.options.direction,lt=A.offsetWidth,Ct=A.offsetHeight,Wt=re(this.options.offset),oe=this._getAnchor();nt==="top"?(l=lt/2,_=Ct):nt==="bottom"?(l=lt/2,_=0):nt==="center"?(l=lt/2,_=Ct/2):nt==="right"?(l=0,_=Ct/2):nt==="left"?(l=lt,_=Ct/2):et.x<N.x?(nt="right",l=0,_=Ct/2):(nt="left",l=lt+(Wt.x+oe.x)*2,_=Ct/2),r=r.subtract(re(l,_,!0)).add(Wt).add(oe),si(A,"leaflet-tooltip-right"),si(A,"leaflet-tooltip-left"),si(A,"leaflet-tooltip-top"),si(A,"leaflet-tooltip-bottom"),ge(A,"leaflet-tooltip-"+nt),Je(A,r)},_updatePosition:function(){var r=this._map.latLngToLayerPoint(this._latlng);this._setPosition(r)},setOpacity:function(r){this.options.opacity=r,this._container&&Hi(this._container,r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center);this._setPosition(l)},_getAnchor:function(){return re(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),qt=function(r,l){return new xn(r,l)};Ee.include({openTooltip:function(r,l,_){return this._initOverlay(xn,r,l,_).openOn(this),this},closeTooltip:function(r){return r.close(),this}}),Ki.include({bindTooltip:function(r,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(xn,this._tooltip,r,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(r){if(!(!r&&this._tooltipHandlersAdded)){var l=r?"off":"on",_={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?_.add=this._openTooltip:(_.mouseover=this._openTooltip,_.mouseout=this.closeTooltip,_.click=this._openTooltip,this._map?this._addFocusListeners():_.add=this._addFocusListeners),this._tooltip.options.sticky&&(_.mousemove=this._moveTooltip),this[l](_),this._tooltipHandlersAdded=!r}},openTooltip:function(r){return this._tooltip&&this._tooltip._prepareOpen(r)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(r){return this._tooltip&&this._tooltip.setContent(r),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(r){var l=r.getElement();l&&(fe(l,"focus",function(){this._tooltip._source=r,this.openTooltip()},this),fe(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(r){var l=r.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(r){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=r.layer||r.target,this.openTooltip(this._tooltip.options.sticky?r.latlng:void 0))},_moveTooltip:function(r){var l=r.latlng,_,b;this._tooltip.options.sticky&&r.originalEvent&&(_=this._map.mouseEventToContainerPoint(r.originalEvent),b=this._map.containerPointToLayerPoint(_),l=this._map.layerPointToLatLng(b)),this._tooltip.setLatLng(l)}});var $o=Kr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(r){var l=r&&r.tagName==="DIV"?r:document.createElement("div"),_=this.options;if(_.html instanceof Element?(Oe(l),l.appendChild(_.html)):l.innerHTML=_.html!==!1?_.html:"",_.bgPos){var b=re(_.bgPos);l.style.backgroundPosition=-b.x+"px "+-b.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function es(r){return new $o(r)}Kr.Default=ar;var bn=Ki.extend({options:{tileSize:256,opacity:1,updateWhenIdle:U.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(r){ce(this,r)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(r){r._addZoomLimit(this)},onRemove:function(r){this._removeAllTiles(),je(this._container),r._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Sr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ir(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(r){return this.options.opacity=r,this._updateOpacity(),this},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var r=this._clampZoom(this._map.getZoom());r!==this._tileZoom&&(this._tileZoom=r,this._updateLevels()),this._update()}return this},getEvents:function(){var r={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=Jt(this._onMoveEnd,this.options.updateInterval,this)),r.move=this._onMove),this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},createTile:function(){return document.createElement("div")},getTileSize:function(){var r=this.options.tileSize;return r instanceof ae?r:new ae(r,r)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(r){for(var l=this.getPane().children,_=-r(-1/0,1/0),b=0,A=l.length,N;b<A;b++)N=l[b].style.zIndex,l[b]!==this._container&&N&&(_=r(_,+N));isFinite(_)&&(this.options.zIndex=_+r(-1,1),this._updateZIndex())},_updateOpacity:function(){if(!!this._map&&!U.ielt9){Hi(this._container,this.options.opacity);var r=+new Date,l=!1,_=!1;for(var b in this._tiles){var A=this._tiles[b];if(!(!A.current||!A.loaded)){var N=Math.min(1,(r-A.loaded)/200);Hi(A.el,N),N<1?l=!0:(A.active?_=!0:this._onOpaqueTile(A),A.active=!0)}}_&&!this._noPrune&&this._pruneTiles(),l&&(pi(this._fadeFrame),this._fadeFrame=ui(this._updateOpacity,this))}},_onOpaqueTile:Gt,_initContainer:function(){this._container||(this._container=Ie("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var r=this._tileZoom,l=this.options.maxZoom;if(r!==void 0){for(var _ in this._levels)_=Number(_),this._levels[_].el.children.length||_===r?(this._levels[_].el.style.zIndex=l-Math.abs(r-_),this._onUpdateLevel(_)):(je(this._levels[_].el),this._removeTilesAtZoom(_),this._onRemoveLevel(_),delete this._levels[_]);var b=this._levels[r],A=this._map;return b||(b=this._levels[r]={},b.el=Ie("div","leaflet-tile-container leaflet-zoom-animated",this._container),b.el.style.zIndex=l,b.origin=A.project(A.unproject(A.getPixelOrigin()),r).round(),b.zoom=r,this._setZoomTransform(b,A.getCenter(),A.getZoom()),Gt(b.el.offsetWidth),this._onCreateLevel(b)),this._level=b,b}},_onUpdateLevel:Gt,_onRemoveLevel:Gt,_onCreateLevel:Gt,_pruneTiles:function(){if(!!this._map){var r,l,_=this._map.getZoom();if(_>this.options.maxZoom||_<this.options.minZoom){this._removeAllTiles();return}for(r in this._tiles)l=this._tiles[r],l.retain=l.current;for(r in this._tiles)if(l=this._tiles[r],l.current&&!l.active){var b=l.coords;this._retainParent(b.x,b.y,b.z,b.z-5)||this._retainChildren(b.x,b.y,b.z,b.z+2)}for(r in this._tiles)this._tiles[r].retain||this._removeTile(r)}},_removeTilesAtZoom:function(r){for(var l in this._tiles)this._tiles[l].coords.z===r&&this._removeTile(l)},_removeAllTiles:function(){for(var r in this._tiles)this._removeTile(r)},_invalidateAll:function(){for(var r in this._levels)je(this._levels[r].el),this._onRemoveLevel(Number(r)),delete this._levels[r];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(r,l,_,b){var A=Math.floor(r/2),N=Math.floor(l/2),et=_-1,nt=new ae(+A,+N);nt.z=+et;var lt=this._tileCoordsToKey(nt),Ct=this._tiles[lt];return Ct&&Ct.active?(Ct.retain=!0,!0):(Ct&&Ct.loaded&&(Ct.retain=!0),et>b?this._retainParent(A,N,et,b):!1)},_retainChildren:function(r,l,_,b){for(var A=2*r;A<2*r+2;A++)for(var N=2*l;N<2*l+2;N++){var et=new ae(A,N);et.z=_+1;var nt=this._tileCoordsToKey(et),lt=this._tiles[nt];if(lt&&lt.active){lt.retain=!0;continue}else lt&&lt.loaded&&(lt.retain=!0);_+1<b&&this._retainChildren(A,N,_+1,b)}},_resetView:function(r){var l=r&&(r.pinch||r.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(r){this._setView(r.center,r.zoom,!0,r.noUpdate)},_clampZoom:function(r){var l=this.options;return l.minNativeZoom!==void 0&&r<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<r?l.maxNativeZoom:r},_setView:function(r,l,_,b){var A=Math.round(l);this.options.maxZoom!==void 0&&A>this.options.maxZoom||this.options.minZoom!==void 0&&A<this.options.minZoom?A=void 0:A=this._clampZoom(A);var N=this.options.updateWhenZooming&&A!==this._tileZoom;(!b||N)&&(this._tileZoom=A,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),A!==void 0&&this._update(r),_||this._pruneTiles(),this._noPrune=!!_),this._setZoomTransforms(r,l)},_setZoomTransforms:function(r,l){for(var _ in this._levels)this._setZoomTransform(this._levels[_],r,l)},_setZoomTransform:function(r,l,_){var b=this._map.getZoomScale(_,r.zoom),A=r.origin.multiplyBy(b).subtract(this._map._getNewPixelOrigin(l,_)).round();U.any3d?Er(r.el,A,b):Je(r.el,A)},_resetGrid:function(){var r=this._map,l=r.options.crs,_=this._tileSize=this.getTileSize(),b=this._tileZoom,A=this._map.getPixelWorldBounds(this._tileZoom);A&&(this._globalTileRange=this._pxBoundsToTileRange(A)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(r.project([0,l.wrapLng[0]],b).x/_.x),Math.ceil(r.project([0,l.wrapLng[1]],b).x/_.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(r.project([l.wrapLat[0],0],b).y/_.x),Math.ceil(r.project([l.wrapLat[1],0],b).y/_.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(r){var l=this._map,_=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),b=l.getZoomScale(_,this._tileZoom),A=l.project(r,this._tileZoom).floor(),N=l.getSize().divideBy(b*2);return new Ze(A.subtract(N),A.add(N))},_update:function(r){var l=this._map;if(!!l){var _=this._clampZoom(l.getZoom());if(r===void 0&&(r=l.getCenter()),this._tileZoom!==void 0){var b=this._getTiledPixelBounds(r),A=this._pxBoundsToTileRange(b),N=A.getCenter(),et=[],nt=this.options.keepBuffer,lt=new Ze(A.getBottomLeft().subtract([nt,-nt]),A.getTopRight().add([nt,-nt]));if(!(isFinite(A.min.x)&&isFinite(A.min.y)&&isFinite(A.max.x)&&isFinite(A.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ct in this._tiles){var Wt=this._tiles[Ct].coords;(Wt.z!==this._tileZoom||!lt.contains(new ae(Wt.x,Wt.y)))&&(this._tiles[Ct].current=!1)}if(Math.abs(_-this._tileZoom)>1){this._setView(r,_);return}for(var oe=A.min.y;oe<=A.max.y;oe++)for(var ie=A.min.x;ie<=A.max.x;ie++){var xi=new ae(ie,oe);if(xi.z=this._tileZoom,!!this._isValidTile(xi)){var ki=this._tiles[this._tileCoordsToKey(xi)];ki?ki.current=!0:et.push(xi)}}if(et.sort(function($i,ti){return $i.distanceTo(N)-ti.distanceTo(N)}),et.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Hs=document.createDocumentFragment();for(ie=0;ie<et.length;ie++)this._addTile(et[ie],Hs);this._level.el.appendChild(Hs)}}}},_isValidTile:function(r){var l=this._map.options.crs;if(!l.infinite){var _=this._globalTileRange;if(!l.wrapLng&&(r.x<_.min.x||r.x>_.max.x)||!l.wrapLat&&(r.y<_.min.y||r.y>_.max.y))return!1}if(!this.options.bounds)return!0;var b=this._tileCoordsToBounds(r);return ri(this.options.bounds).overlaps(b)},_keyToBounds:function(r){return this._tileCoordsToBounds(this._keyToTileCoords(r))},_tileCoordsToNwSe:function(r){var l=this._map,_=this.getTileSize(),b=r.scaleBy(_),A=b.add(_),N=l.unproject(b,r.z),et=l.unproject(A,r.z);return[N,et]},_tileCoordsToBounds:function(r){var l=this._tileCoordsToNwSe(r),_=new yi(l[0],l[1]);return this.options.noWrap||(_=this._map.wrapLatLngBounds(_)),_},_tileCoordsToKey:function(r){return r.x+":"+r.y+":"+r.z},_keyToTileCoords:function(r){var l=r.split(":"),_=new ae(+l[0],+l[1]);return _.z=+l[2],_},_removeTile:function(r){var l=this._tiles[r];!l||(je(l.el),delete this._tiles[r],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(r)}))},_initTile:function(r){ge(r,"leaflet-tile");var l=this.getTileSize();r.style.width=l.x+"px",r.style.height=l.y+"px",r.onselectstart=Gt,r.onmousemove=Gt,U.ielt9&&this.options.opacity<1&&Hi(r,this.options.opacity)},_addTile:function(r,l){var _=this._getTilePos(r),b=this._tileCoordsToKey(r),A=this.createTile(this._wrapCoords(r),ot(this._tileReady,this,r));this._initTile(A),this.createTile.length<2&&ui(ot(this._tileReady,this,r,null,A)),Je(A,_),this._tiles[b]={el:A,coords:r,current:!0},l.appendChild(A),this.fire("tileloadstart",{tile:A,coords:r})},_tileReady:function(r,l,_){l&&this.fire("tileerror",{error:l,tile:_,coords:r});var b=this._tileCoordsToKey(r);_=this._tiles[b],_&&(_.loaded=+new Date,this._map._fadeAnimated?(Hi(_.el,0),pi(this._fadeFrame),this._fadeFrame=ui(this._updateOpacity,this)):(_.active=!0,this._pruneTiles()),l||(ge(_.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:_.el,coords:r})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),U.ielt9||!this._map._fadeAnimated?ui(this._pruneTiles,this):setTimeout(ot(this._pruneTiles,this),250)))},_getTilePos:function(r){return r.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(r){var l=new ae(this._wrapX?Se(r.x,this._wrapX):r.x,this._wrapY?Se(r.y,this._wrapY):r.y);return l.z=r.z,l},_pxBoundsToTileRange:function(r){var l=this.getTileSize();return new Ze(r.min.unscaleBy(l).floor(),r.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var r in this._tiles)if(!this._tiles[r].loaded)return!1;return!0}});function jo(r){return new bn(r)}var Dt=bn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(r,l){this._url=r,l=ce(this,l),l.detectRetina&&U.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(r,l){return this._url===r&&l===void 0&&(l=!0),this._url=r,l||this.redraw(),this},createTile:function(r,l){var _=document.createElement("img");return fe(_,"load",ot(this._tileOnLoad,this,l,_)),fe(_,"error",ot(this._tileOnError,this,l,_)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(_.referrerPolicy=this.options.referrerPolicy),_.alt="",_.src=this.getTileUrl(r),_},getTileUrl:function(r){var l={r:U.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var _=this._globalTileRange.max.y-r.y;this.options.tms&&(l.y=_),l["-y"]=_}return mn(this._url,R(l,this.options))},_tileOnLoad:function(r,l){U.ielt9?setTimeout(ot(r,this,null,l),0):r(null,l)},_tileOnError:function(r,l,_){var b=this.options.errorTileUrl;b&&l.getAttribute("src")!==b&&(l.src=b),r(_,l)},_onTileRemove:function(r){r.tile.onload=null},_getZoomForUrl:function(){var r=this._tileZoom,l=this.options.maxZoom,_=this.options.zoomReverse,b=this.options.zoomOffset;return _&&(r=l-r),r+b},_getSubdomain:function(r){var l=Math.abs(r.x+r.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var r,l;for(r in this._tiles)if(this._tiles[r].coords.z!==this._tileZoom&&(l=this._tiles[r].el,l.onload=Gt,l.onerror=Gt,!l.complete)){l.src=ni;var _=this._tiles[r].coords;je(l),delete this._tiles[r],this.fire("tileabort",{tile:l,coords:_})}},_removeTile:function(r){var l=this._tiles[r];if(!!l)return l.el.setAttribute("src",ni),bn.prototype._removeTile.call(this,r)},_tileReady:function(r,l,_){if(!(!this._map||_&&_.getAttribute("src")===ni))return bn.prototype._tileReady.call(this,r,l,_)}});function $s(r,l){return new Dt(r,l)}var fa=Dt.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(r,l){this._url=r;var _=R({},this.defaultWmsParams);for(var b in l)b in this.options||(_[b]=l[b]);l=ce(this,l);var A=l.detectRetina&&U.retina?2:1,N=this.getTileSize();_.width=N.x*A,_.height=N.y*A,this.wmsParams=_},onAdd:function(r){this._crs=this.options.crs||r.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,Dt.prototype.onAdd.call(this,r)},getTileUrl:function(r){var l=this._tileCoordsToNwSe(r),_=this._crs,b=gi(_.project(l[0]),_.project(l[1])),A=b.min,N=b.max,et=(this._wmsVersion>=1.3&&this._crs===fo?[A.y,A.x,N.y,N.x]:[A.x,A.y,N.x,N.y]).join(","),nt=Dt.prototype.getTileUrl.call(this,r);return nt+Or(this.wmsParams,nt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+et},setParams:function(r,l){return R(this.wmsParams,r),l||this.redraw(),this}});function Wo(r,l){return new fa(r,l)}Dt.WMS=fa,$s.wms=Wo;var zn=Ki.extend({options:{padding:.1},initialize:function(r){ce(this,r),Pt(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&ge(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var r={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(r.zoomanim=this._onAnimZoom),r},_onAnimZoom:function(r){this._updateTransform(r.center,r.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(r,l){var _=this._map.getZoomScale(l,this._zoom),b=this._map.getSize().multiplyBy(.5+this.options.padding),A=this._map.project(this._center,l),N=b.multiplyBy(-_).add(A).subtract(this._map._getNewPixelOrigin(r,l));U.any3d?Er(this._container,N,_):Je(this._container,N)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var r in this._layers)this._layers[r]._reset()},_onZoomEnd:function(){for(var r in this._layers)this._layers[r]._project()},_updatePaths:function(){for(var r in this._layers)this._layers[r]._update()},_update:function(){var r=this.options.padding,l=this._map.getSize(),_=this._map.containerPointToLayerPoint(l.multiplyBy(-r)).round();this._bounds=new Ze(_,_.add(l.multiplyBy(1+r*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Ho=zn.extend({options:{tolerance:0},getEvents:function(){var r=zn.prototype.getEvents.call(this);return r.viewprereset=this._onViewPreReset,r},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){zn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var r=this._container=document.createElement("canvas");fe(r,"mousemove",this._onMouseMove,this),fe(r,"click dblclick mousedown mouseup contextmenu",this._onClick,this),fe(r,"mouseout",this._handleMouseOut,this),r._leaflet_disable_events=!0,this._ctx=r.getContext("2d")},_destroyContainer:function(){pi(this._redrawRequest),delete this._ctx,je(this._container),Ye(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var r;this._redrawBounds=null;for(var l in this._layers)r=this._layers[l],r._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zn.prototype._update.call(this);var r=this._bounds,l=this._container,_=r.getSize(),b=U.retina?2:1;Je(l,r.min),l.width=b*_.x,l.height=b*_.y,l.style.width=_.x+"px",l.style.height=_.y+"px",U.retina&&this._ctx.scale(2,2),this._ctx.translate(-r.min.x,-r.min.y),this.fire("update")}},_reset:function(){zn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(r){this._updateDashArray(r),this._layers[Pt(r)]=r;var l=r._order={layer:r,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(r){this._requestRedraw(r)},_removePath:function(r){var l=r._order,_=l.next,b=l.prev;_?_.prev=b:this._drawLast=b,b?b.next=_:this._drawFirst=_,delete r._order,delete this._layers[Pt(r)],this._requestRedraw(r)},_updatePath:function(r){this._extendRedrawBounds(r),r._project(),r._update(),this._requestRedraw(r)},_updateStyle:function(r){this._updateDashArray(r),this._requestRedraw(r)},_updateDashArray:function(r){if(typeof r.options.dashArray=="string"){var l=r.options.dashArray.split(/[, ]+/),_=[],b,A;for(A=0;A<l.length;A++){if(b=Number(l[A]),isNaN(b))return;_.push(b)}r.options._dashArray=_}else r.options._dashArray=r.options.dashArray},_requestRedraw:function(r){!this._map||(this._extendRedrawBounds(r),this._redrawRequest=this._redrawRequest||ui(this._redraw,this))},_extendRedrawBounds:function(r){if(r._pxBounds){var l=(r.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Ze,this._redrawBounds.extend(r._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(r._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var r=this._redrawBounds;if(r){var l=r.getSize();this._ctx.clearRect(r.min.x,r.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var r,l=this._redrawBounds;if(this._ctx.save(),l){var _=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,_.x,_.y),this._ctx.clip()}this._drawing=!0;for(var b=this._drawFirst;b;b=b.next)r=b.layer,(!l||r._pxBounds&&r._pxBounds.intersects(l))&&r._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(r,l){if(!!this._drawing){var _,b,A,N,et=r._parts,nt=et.length,lt=this._ctx;if(!!nt){for(lt.beginPath(),_=0;_<nt;_++){for(b=0,A=et[_].length;b<A;b++)N=et[_][b],lt[b?"lineTo":"moveTo"](N.x,N.y);l&&lt.closePath()}this._fillStroke(lt,r)}}},_updateCircle:function(r){if(!(!this._drawing||r._empty())){var l=r._point,_=this._ctx,b=Math.max(Math.round(r._radius),1),A=(Math.max(Math.round(r._radiusY),1)||b)/b;A!==1&&(_.save(),_.scale(1,A)),_.beginPath(),_.arc(l.x,l.y/A,b,0,Math.PI*2,!1),A!==1&&_.restore(),this._fillStroke(_,r)}},_fillStroke:function(r,l){var _=l.options;_.fill&&(r.globalAlpha=_.fillOpacity,r.fillStyle=_.fillColor||_.color,r.fill(_.fillRule||"evenodd")),_.stroke&&_.weight!==0&&(r.setLineDash&&r.setLineDash(l.options&&l.options._dashArray||[]),r.globalAlpha=_.opacity,r.lineWidth=_.weight,r.strokeStyle=_.color,r.lineCap=_.lineCap,r.lineJoin=_.lineJoin,r.stroke())},_onClick:function(r){for(var l=this._map.mouseEventToLayerPoint(r),_,b,A=this._drawFirst;A;A=A.next)_=A.layer,_.options.interactive&&_._containsPoint(l)&&(!(r.type==="click"||r.type==="preclick")||!this._map._draggableMoved(_))&&(b=_);this._fireEvent(b?[b]:!1,r)},_onMouseMove:function(r){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(r);this._handleMouseHover(r,l)}},_handleMouseOut:function(r){var l=this._hoveredLayer;l&&(si(this._container,"leaflet-interactive"),this._fireEvent([l],r,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(r,l){if(!this._mouseHoverThrottled){for(var _,b,A=this._drawFirst;A;A=A.next)_=A.layer,_.options.interactive&&_._containsPoint(l)&&(b=_);b!==this._hoveredLayer&&(this._handleMouseOut(r),b&&(ge(this._container,"leaflet-interactive"),this._fireEvent([b],r,"mouseover"),this._hoveredLayer=b)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,r),this._mouseHoverThrottled=!0,setTimeout(ot(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(r,l,_){this._map._fireDOMEvent(l,_||l.type,r)},_bringToFront:function(r){var l=r._order;if(!!l){var _=l.next,b=l.prev;if(_)_.prev=b;else return;b?b.next=_:_&&(this._drawFirst=_),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(r)}},_bringToBack:function(r){var l=r._order;if(!!l){var _=l.next,b=l.prev;if(b)b.next=_;else return;_?_.prev=b:b&&(this._drawLast=b),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(r)}}});function Xo(r){return U.canvas?new Ho(r):null}var js=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(r){return document.createElement("<lvml:"+r+' class="lvml">')}}catch{}return function(r){return document.createElement("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),ma={_initContainer:function(){this._container=Ie("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(zn.prototype._update.call(this),this.fire("update"))},_initPath:function(r){var l=r._container=js("shape");ge(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",r._path=js("path"),l.appendChild(r._path),this._updateStyle(r),this._layers[Pt(r)]=r},_addPath:function(r){var l=r._container;this._container.appendChild(l),r.options.interactive&&r.addInteractiveTarget(l)},_removePath:function(r){var l=r._container;je(l),r.removeInteractiveTarget(l),delete this._layers[Pt(r)]},_updateStyle:function(r){var l=r._stroke,_=r._fill,b=r.options,A=r._container;A.stroked=!!b.stroke,A.filled=!!b.fill,b.stroke?(l||(l=r._stroke=js("stroke")),A.appendChild(l),l.weight=b.weight+"px",l.color=b.color,l.opacity=b.opacity,b.dashArray?l.dashStyle=ii(b.dashArray)?b.dashArray.join(" "):b.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=b.lineCap.replace("butt","flat"),l.joinstyle=b.lineJoin):l&&(A.removeChild(l),r._stroke=null),b.fill?(_||(_=r._fill=js("fill")),A.appendChild(_),_.color=b.fillColor||b.color,_.opacity=b.fillOpacity):_&&(A.removeChild(_),r._fill=null)},_updateCircle:function(r){var l=r._point.round(),_=Math.round(r._radius),b=Math.round(r._radiusY||_);this._setPath(r,r._empty()?"M0 0":"AL "+l.x+","+l.y+" "+_+","+b+" 0,"+65535*360)},_setPath:function(r,l){r._path.v=l},_bringToFront:function(r){Sr(r._container)},_bringToBack:function(r){Ir(r._container)}},bs=U.vml?js:Qn,is=zn.extend({_initContainer:function(){this._container=bs("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=bs("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){je(this._container),Ye(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){zn.prototype._update.call(this);var r=this._bounds,l=r.getSize(),_=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,_.setAttribute("width",l.x),_.setAttribute("height",l.y)),Je(_,r.min),_.setAttribute("viewBox",[r.min.x,r.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(r){var l=r._path=bs("path");r.options.className&&ge(l,r.options.className),r.options.interactive&&ge(l,"leaflet-interactive"),this._updateStyle(r),this._layers[Pt(r)]=r},_addPath:function(r){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(r._path),r.addInteractiveTarget(r._path)},_removePath:function(r){je(r._path),r.removeInteractiveTarget(r._path),delete this._layers[Pt(r)]},_updatePath:function(r){r._project(),r._update()},_updateStyle:function(r){var l=r._path,_=r.options;!l||(_.stroke?(l.setAttribute("stroke",_.color),l.setAttribute("stroke-opacity",_.opacity),l.setAttribute("stroke-width",_.weight),l.setAttribute("stroke-linecap",_.lineCap),l.setAttribute("stroke-linejoin",_.lineJoin),_.dashArray?l.setAttribute("stroke-dasharray",_.dashArray):l.removeAttribute("stroke-dasharray"),_.dashOffset?l.setAttribute("stroke-dashoffset",_.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),_.fill?(l.setAttribute("fill",_.fillColor||_.color),l.setAttribute("fill-opacity",_.fillOpacity),l.setAttribute("fill-rule",_.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(r,l){this._setPath(r,Zr(r._parts,l))},_updateCircle:function(r){var l=r._point,_=Math.max(Math.round(r._radius),1),b=Math.max(Math.round(r._radiusY),1)||_,A="a"+_+","+b+" 0 1,0 ",N=r._empty()?"M0 0":"M"+(l.x-_)+","+l.y+A+_*2+",0 "+A+-_*2+",0 ";this._setPath(r,N)},_setPath:function(r,l){r._path.setAttribute("d",l)},_bringToFront:function(r){Sr(r._path)},_bringToBack:function(r){Ir(r._path)}});U.vml&&is.include(ma);function bo(r){return U.svg||U.vml?new is(r):null}Ee.include({getRenderer:function(r){var l=r.options.renderer||this._getPaneRenderer(r.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(r){if(r==="overlayPane"||r===void 0)return!1;var l=this._paneRenderers[r];return l===void 0&&(l=this._createRenderer({pane:r}),this._paneRenderers[r]=l),l},_createRenderer:function(r){return this.options.preferCanvas&&Xo(r)||bo(r)}});var wo=$n.extend({initialize:function(r,l){$n.prototype.initialize.call(this,this._boundsToLatLngs(r),l)},setBounds:function(r){return this.setLatLngs(this._boundsToLatLngs(r))},_boundsToLatLngs:function(r){return r=ri(r),[r.getSouthWest(),r.getNorthWest(),r.getNorthEast(),r.getSouthEast()]}});function Yi(r,l){return new wo(r,l)}is.create=bs,is.pointsToPath=Zr,cn.geometryToLayer=Vs,cn.coordsToLatLng=yo,cn.coordsToLatLngs=hr,cn.latLngToCoords=vo,cn.latLngsToCoords=Lr,cn.getFeature=jn,cn.asFeature=Li,Ee.mergeOptions({boxZoom:!0});var cr=vn.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane,this._resetStateTimeout=0,r.on("unload",this._destroy,this)},addHooks:function(){fe(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ye(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){je(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(r){if(!r.shiftKey||r.which!==1&&r.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Zn(),As(),this._startPoint=this._map.mouseEventToContainerPoint(r),fe(document,{contextmenu:An,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(r){this._moved||(this._moved=!0,this._box=Ie("div","leaflet-zoom-box",this._container),ge(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(r);var l=new Ze(this._point,this._startPoint),_=l.getSize();Je(this._box,l.min),this._box.style.width=_.x+"px",this._box.style.height=_.y+"px"},_finish:function(){this._moved&&(je(this._box),si(this._container,"leaflet-crosshair")),Pr(),_s(),Ye(document,{contextmenu:An,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(r){if(!(r.which!==1&&r.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(ot(this._resetState,this),0);var l=new yi(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(r){r.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ee.addInitHook("addHandler","boxZoom",cr),Ee.mergeOptions({doubleClickZoom:!0});var Ko=vn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(r){var l=this._map,_=l.getZoom(),b=l.options.zoomDelta,A=r.originalEvent.shiftKey?_-b:_+b;l.options.doubleClickZoom==="center"?l.setZoom(A):l.setZoomAround(r.containerPoint,A)}});Ee.addInitHook("addHandler","doubleClickZoom",Ko),Ee.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ns=vn.extend({addHooks:function(){if(!this._draggable){var r=this._map;this._draggable=new qn(r._mapPane,r._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),r.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),r.on("zoomend",this._onZoomEnd,this),r.whenReady(this._onZoomEnd,this))}ge(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){si(this._map._container,"leaflet-grab"),si(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var r=this._map;if(r._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=ri(this._map.options.maxBounds);this._offsetLimit=gi(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;r.fire("movestart").fire("dragstart"),r.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(r){if(this._map.options.inertia){var l=this._lastTime=+new Date,_=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(_),this._times.push(l),this._prunePositions(l)}this._map.fire("move",r).fire("drag",r)},_prunePositions:function(r){for(;this._positions.length>1&&r-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var r=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(r).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(r,l){return r-(r-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var r=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;r.x<l.min.x&&(r.x=this._viscousLimit(r.x,l.min.x)),r.y<l.min.y&&(r.y=this._viscousLimit(r.y,l.min.y)),r.x>l.max.x&&(r.x=this._viscousLimit(r.x,l.max.x)),r.y>l.max.y&&(r.y=this._viscousLimit(r.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(r)}},_onPreDragWrap:function(){var r=this._worldWidth,l=Math.round(r/2),_=this._initialWorldOffset,b=this._draggable._newPos.x,A=(b-l+_)%r+l-_,N=(b+l+_)%r-l-_,et=Math.abs(A+_)<Math.abs(N+_)?A:N;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=et},_onDragEnd:function(r){var l=this._map,_=l.options,b=!_.inertia||r.noInertia||this._times.length<2;if(l.fire("dragend",r),b)l.fire("moveend");else{this._prunePositions(+new Date);var A=this._lastPos.subtract(this._positions[0]),N=(this._lastTime-this._times[0])/1e3,et=_.easeLinearity,nt=A.multiplyBy(et/N),lt=nt.distanceTo([0,0]),Ct=Math.min(_.inertiaMaxSpeed,lt),Wt=nt.multiplyBy(Ct/lt),oe=Ct/(_.inertiaDeceleration*et),ie=Wt.multiplyBy(-oe/2).round();!ie.x&&!ie.y?l.fire("moveend"):(ie=l._limitOffset(ie,l.options.maxBounds),ui(function(){l.panBy(ie,{duration:oe,easeLinearity:et,noMoveStart:!0,animate:!0})}))}}});Ee.addInitHook("addHandler","dragging",ns),Ee.mergeOptions({keyboard:!0,keyboardPanDelta:80});var To=vn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(r){this._map=r,this._setPanDelta(r.options.keyboardPanDelta),this._setZoomDelta(r.options.zoomDelta)},addHooks:function(){var r=this._map._container;r.tabIndex<=0&&(r.tabIndex="0"),fe(r,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ye(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var r=document.body,l=document.documentElement,_=r.scrollTop||l.scrollTop,b=r.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(b,_)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(r){var l=this._panKeys={},_=this.keyCodes,b,A;for(b=0,A=_.left.length;b<A;b++)l[_.left[b]]=[-1*r,0];for(b=0,A=_.right.length;b<A;b++)l[_.right[b]]=[r,0];for(b=0,A=_.down.length;b<A;b++)l[_.down[b]]=[0,r];for(b=0,A=_.up.length;b<A;b++)l[_.up[b]]=[0,-1*r]},_setZoomDelta:function(r){var l=this._zoomKeys={},_=this.keyCodes,b,A;for(b=0,A=_.zoomIn.length;b<A;b++)l[_.zoomIn[b]]=r;for(b=0,A=_.zoomOut.length;b<A;b++)l[_.zoomOut[b]]=-r},_addHooks:function(){fe(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ye(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(r){if(!(r.altKey||r.ctrlKey||r.metaKey)){var l=r.keyCode,_=this._map,b;if(l in this._panKeys)(!_._panAnim||!_._panAnim._inProgress)&&(b=this._panKeys[l],r.shiftKey&&(b=re(b).multiplyBy(3)),_.panBy(b),_.options.maxBounds&&_.panInsideBounds(_.options.maxBounds));else if(l in this._zoomKeys)_.setZoom(_.getZoom()+(r.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&_._popup&&_._popup.options.closeOnEscapeKey)_.closePopup();else return;An(r)}}});Ee.addInitHook("addHandler","keyboard",To),Ee.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ws=vn.extend({addHooks:function(){fe(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ye(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(r){var l=Bs(r),_=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(r),this._startTime||(this._startTime=+new Date);var b=Math.max(_-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(ot(this._performZoom,this),b),An(r)},_performZoom:function(){var r=this._map,l=r.getZoom(),_=this._map.options.zoomSnap||0;r._stop();var b=this._delta/(this._map.options.wheelPxPerZoomLevel*4),A=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,N=_?Math.ceil(A/_)*_:A,et=r._limitZoom(l+(this._delta>0?N:-N))-l;this._delta=0,this._startTime=null,et&&(r.options.scrollWheelZoom==="center"?r.setZoom(l+et):r.setZoomAround(this._lastMousePos,l+et))}});Ee.addInitHook("addHandler","scrollWheelZoom",ws);var _a=600;Ee.mergeOptions({tapHold:U.touchNative&&U.safari&&U.mobile,tapTolerance:15});var un=vn.extend({addHooks:function(){fe(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ye(this._map._container,"touchstart",this._onDown,this)},_onDown:function(r){if(clearTimeout(this._holdTimeout),r.touches.length===1){var l=r.touches[0];this._startPos=this._newPos=new ae(l.clientX,l.clientY),this._holdTimeout=setTimeout(ot(function(){this._cancel(),this._isTapValid()&&(fe(document,"touchend",hi),fe(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),_a),fe(document,"touchend touchcancel contextmenu",this._cancel,this),fe(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function r(){Ye(document,"touchend",hi),Ye(document,"touchend touchcancel",r)},_cancel:function(){clearTimeout(this._holdTimeout),Ye(document,"touchend touchcancel contextmenu",this._cancel,this),Ye(document,"touchmove",this._onMove,this)},_onMove:function(r){var l=r.touches[0];this._newPos=new ae(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(r,l){var _=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});_._simulated=!0,l.target.dispatchEvent(_)}});Ee.addInitHook("addHandler","tapHold",un),Ee.mergeOptions({touchZoom:U.touch,bounceAtZoomLimits:!0});var Qe=vn.extend({addHooks:function(){ge(this._map._container,"leaflet-touch-zoom"),fe(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){si(this._map._container,"leaflet-touch-zoom"),Ye(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(r){var l=this._map;if(!(!r.touches||r.touches.length!==2||l._animatingZoom||this._zooming)){var _=l.mouseEventToContainerPoint(r.touches[0]),b=l.mouseEventToContainerPoint(r.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(_.add(b)._divideBy(2))),this._startDist=_.distanceTo(b),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),fe(document,"touchmove",this._onTouchMove,this),fe(document,"touchend touchcancel",this._onTouchEnd,this),hi(r)}},_onTouchMove:function(r){if(!(!r.touches||r.touches.length!==2||!this._zooming)){var l=this._map,_=l.mouseEventToContainerPoint(r.touches[0]),b=l.mouseEventToContainerPoint(r.touches[1]),A=_.distanceTo(b)/this._startDist;if(this._zoom=l.getScaleZoom(A,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&A<1||this._zoom>l.getMaxZoom()&&A>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,A===1)return}else{var N=_._add(b)._divideBy(2)._subtract(this._centerPoint);if(A===1&&N.x===0&&N.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(N),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),pi(this._animRequest);var et=ot(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ui(et,this,!0),hi(r)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,pi(this._animRequest),Ye(document,"touchmove",this._onTouchMove,this),Ye(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ee.addInitHook("addHandler","touchZoom",Qe),Ee.BoxZoom=cr,Ee.DoubleClickZoom=Ko,Ee.Drag=ns,Ee.Keyboard=To,Ee.ScrollWheelZoom=ws,Ee.TapHold=un,Ee.TouchZoom=Qe,S.Bounds=Ze,S.Browser=U,S.CRS=Mi,S.Canvas=Ho,S.Circle=Zs,S.CircleMarker=Us,S.Class=Ci,S.Control=ln,S.DivIcon=$o,S.DivOverlay=Hn,S.DomEvent=Oo,S.DomUtil=oo,S.Draggable=qn,S.Evented=sn,S.FeatureGroup=zr,S.GeoJSON=cn,S.GridLayer=bn,S.Handler=vn,S.Icon=Kr,S.ImageOverlay=Mn,S.LatLng=Pe,S.LatLngBounds=yi,S.Layer=Ki,S.LayerGroup=or,S.LineUtil=ka,S.Map=Ee,S.Marker=mo,S.Mixin=co,S.Path=lr,S.Point=ae,S.PolyUtil=Da,S.Polygon=$n,S.Polyline=hn,S.Popup=ts,S.PosAnimation=ho,S.Projection=Os,S.Rectangle=wo,S.Renderer=zn,S.SVG=is,S.SVGOverlay=xo,S.TileLayer=Dt,S.Tooltip=xn,S.Transformation=Nr,S.Util=us,S.VideoOverlay=Wn,S.bind=ot,S.bounds=gi,S.canvas=Xo,S.circle=go,S.circleMarker=Ns,S.control=Cr,S.divIcon=es,S.extend=R,S.featureGroup=Go,S.geoJSON=Ji,S.geoJson=Ba,S.gridLayer=jo,S.icon=Jr,S.imageOverlay=da,S.latLng=De,S.latLngBounds=ri,S.layerGroup=Cn,S.map=Fo,S.marker=_o,S.point=re,S.polygon=pa,S.polyline=xs,S.popup=qs,S.rectangle=Yi,S.setOptions=ce,S.stamp=Pt,S.svg=bo,S.svgOverlay=Ra,S.tileLayer=$s,S.tooltip=qt,S.transformation=on,S.version=k,S.videoOverlay=Gs;var Ws=window.L;S.noConflict=function(){return window.L=Ws,this},window.L=S})})(yt,yt.exports);var Nl=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,Mo=document.documentElement.style.pointerEvents==="",zo={cors:Nl,pointerEvents:Mo},Yd={attributionWidthOffset:55},gu=0;function Zl(g){var x="";g.f=g.f||"json";for(var S in g)if(Object.prototype.hasOwnProperty.call(g,S)){var k=g[S],R=Object.prototype.toString.call(k),Y;x.length&&(x+="&"),R==="[object Array]"?Y=Object.prototype.toString.call(k[0])==="[object Object]"?JSON.stringify(k):k.join(","):R==="[object Object]"?Y=JSON.stringify(k):R==="[object Date]"?Y=k.valueOf():Y=k,x+=encodeURIComponent(S)+"="+encodeURIComponent(Y)}return x}function Fh(g,x){var S=new window.XMLHttpRequest;return S.onerror=function(k){S.onreadystatechange=yt.exports.Util.falseFn,g.call(x,{error:{code:500,message:"XMLHttpRequest error"}},null)},S.onreadystatechange=function(){var k,R;if(S.readyState===4){try{k=JSON.parse(S.responseText)}catch{k=null,R={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!R&&k.error&&(R=k.error,k=null),S.onerror=yt.exports.Util.falseFn,g.call(x,R,k)}},S.ontimeout=function(){this.onerror()},S}function Qd(g,x,S,k){var R=Fh(S,k);return R.open("POST",g),typeof k<"u"&&k!==null&&typeof k.options<"u"&&(R.timeout=k.options.timeout),R.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),R.send(Zl(x)),R}function Du(g,x,S,k){var R=Fh(S,k);return R.open("GET",g+"?"+Zl(x),!0),typeof k<"u"&&k!==null&&typeof k.options<"u"&&(R.timeout=k.options.timeout,k.options.withCredentials&&(R.withCredentials=!0)),R.send(null),R}function Aa(g,x,S,k){var R=Zl(x),Y=Fh(S,k),ot=(g+"?"+R).length;if(ot<=2e3&&zo.cors?Y.open("GET",g+"?"+R):ot>2e3&&zo.cors&&(Y.open("POST",g),Y.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof k<"u"&&k!==null&&typeof k.options<"u"&&(Y.timeout=k.options.timeout,k.options.withCredentials&&(Y.withCredentials=!0)),ot<=2e3&&zo.cors)Y.send(null);else if(ot>2e3&&zo.cors)Y.send(R);else{if(ot<=2e3&&!zo.cors)return Uh(g,x,S,k);Lo("a request to "+g+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/");return}return Y}function Uh(g,x,S,k){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var R="c"+gu;x.callback="window._EsriLeafletCallbacks."+R,window._EsriLeafletCallbacks[R]=function(ot){if(window._EsriLeafletCallbacks[R]!==!0){var c,Pt=Object.prototype.toString.call(ot);Pt==="[object Object]"||Pt==="[object Array]"||(c={error:{code:500,message:"Expected array or object as JSONP response"}},ot=null),!c&&ot.error&&(c=ot,ot=null),S.call(k,c,ot),window._EsriLeafletCallbacks[R]=!0}};var Y=yt.exports.DomUtil.create("script",null,document.body);return Y.type="text/javascript",Y.src=g+"?"+Zl(x),Y.id=R,Y.onerror=function(ot){if(ot&&window._EsriLeafletCallbacks[R]!==!0){var c={error:{code:500,message:"An unknown error occurred"}};S.call(k,c),window._EsriLeafletCallbacks[R]=!0}},yt.exports.DomUtil.addClass(Y,"esri-leaflet-jsonp"),gu++,{id:R,url:Y.src,abort:function(){window._EsriLeafletCallbacks._callback[R]({code:0,message:"Request aborted."})}}}var Nh=zo.cors?Du:Uh;Nh.CORS=Du;Nh.JSONP=Uh;function Lo(){console&&console.warn&&console.warn.apply(console,arguments)}var Rl={request:Aa,get:Nh,post:Qd};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var tf=function(x,S,k,R){var Y=(R[0]-k[0])*(x[1]-k[1])-(R[1]-k[1])*(x[0]-k[0]),ot=(S[0]-x[0])*(x[1]-k[1])-(S[1]-x[1])*(x[0]-k[0]),c=(R[1]-k[1])*(S[0]-x[0])-(R[0]-k[0])*(S[1]-x[1]);if(c!==0){var Pt=Y/c,Jt=ot/c;if(Pt>=0&&Pt<=1&&Jt>=0&&Jt<=1)return!0}return!1},ef=function(x,S){for(var k=!1,R=-1,Y=x.length,ot=Y-1;++R<Y;ot=R)(x[R][1]<=S[1]&&S[1]<x[ot][1]||x[ot][1]<=S[1]&&S[1]<x[R][1])&&S[0]<(x[ot][0]-x[R][0])*(S[1]-x[R][1])/(x[ot][1]-x[R][1])+x[R][0]&&(k=!k);return k},nf=function(x,S){for(var k=0;k<x.length;k++)if(x[k]!==S[k])return!1;return!0},Bu=function(x,S){for(var k=0;k<x.length-1;k++)for(var R=0;R<S.length-1;R++)if(tf(x[k],x[k+1],S[R],S[R+1]))return!0;return!1},Lh=function(x){return nf(x[0],x[x.length-1])||x.push(x[0]),x},kh=function(x){var S=0,k=0,R=x.length,Y=x[k],ot;for(k;k<R-1;k++)ot=x[k+1],S+=(ot[0]-Y[0])*(ot[1]+Y[1]),Y=ot;return S>=0},Ru=function(x){var S={};for(var k in x)x.hasOwnProperty(k)&&(S[k]=x[k]);return S},rf=function(x,S){var k=Bu(x,S),R=ef(x,S[0]);return!!(!k&&R)},sf=function(x){for(var S=[],k=[],R,Y,ot,c=0;c<x.length;c++){var Pt=Lh(x[c].slice(0));if(!(Pt.length<4))if(kh(Pt)){var Jt=[Pt.slice().reverse()];S.push(Jt)}else k.push(Pt.slice().reverse())}for(var Se=[];k.length;){ot=k.pop();var Gt=!1;for(R=S.length-1;R>=0;R--)if(Y=S[R][0],rf(Y,ot)){S[R].push(ot),Gt=!0;break}Gt||Se.push(ot)}for(;Se.length;){ot=Se.pop();var dt=!1;for(R=S.length-1;R>=0;R--)if(Y=S[R][0],Bu(Y,ot)){S[R].push(ot),dt=!0;break}dt||S.push([ot.reverse()])}return S.length===1?{type:"Polygon",coordinates:S[0]}:{type:"MultiPolygon",coordinates:S}},of=function(x,S){for(var k=S?[S,"OBJECTID","FID"]:["OBJECTID","FID"],R=0;R<k.length;R++){var Y=k[R];if(Y in x&&(typeof x[Y]=="string"||typeof x[Y]=="number"))return x[Y]}throw Error("No valid id attribute found")},af=function g(x,S){var k={};if(x.features){k.type="FeatureCollection",k.features=[];for(var R=0;R<x.features.length;R++)k.features.push(g(x.features[R],S))}if(typeof x.x=="number"&&typeof x.y=="number"&&(k.type="Point",k.coordinates=[x.x,x.y],typeof x.z=="number"&&k.coordinates.push(x.z)),x.points&&(k.type="MultiPoint",k.coordinates=x.points.slice(0)),x.paths&&(x.paths.length===1?(k.type="LineString",k.coordinates=x.paths[0].slice(0)):(k.type="MultiLineString",k.coordinates=x.paths.slice(0))),x.rings&&(k=sf(x.rings.slice(0))),typeof x.xmin=="number"&&typeof x.ymin=="number"&&typeof x.xmax=="number"&&typeof x.ymax=="number"&&(k.type="Polygon",k.coordinates=[[[x.xmax,x.ymax],[x.xmin,x.ymax],[x.xmin,x.ymin],[x.xmax,x.ymin],[x.xmax,x.ymax]]]),(x.geometry||x.attributes)&&(k.type="Feature",k.geometry=x.geometry?g(x.geometry):null,k.properties=x.attributes?Ru(x.attributes):null,x.attributes))try{k.id=of(x.attributes,S)}catch{}return JSON.stringify(k.geometry)===JSON.stringify({})&&(k.geometry=null),x.spatialReference&&x.spatialReference.wkid&&x.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(x.spatialReference)),k},Ou=function(x){var S=[],k=x.slice(0),R=Lh(k.shift().slice(0));if(R.length>=4){kh(R)||R.reverse(),S.push(R);for(var Y=0;Y<k.length;Y++){var ot=Lh(k[Y].slice(0));ot.length>=4&&(kh(ot)&&ot.reverse(),S.push(ot))}}return S},lf=function(x){for(var S=[],k=0;k<x.length;k++)for(var R=Ou(x[k]),Y=R.length-1;Y>=0;Y--){var ot=R[Y].slice(0);S.push(ot)}return S},hf=function g(x,S){S=S||"OBJECTID";var k={wkid:4326},R={},Y;switch(x.type){case"Point":R.x=x.coordinates[0],R.y=x.coordinates[1],x.coordinates[2]!=null&&(R.z=x.coordinates[2]),R.spatialReference=k;break;case"MultiPoint":R.points=x.coordinates.slice(0),x.coordinates[0][2]!=null&&(R.hasZ=!0),R.spatialReference=k;break;case"LineString":R.paths=[x.coordinates.slice(0)],x.coordinates[0][2]!=null&&(R.hasZ=!0),R.spatialReference=k;break;case"MultiLineString":R.paths=x.coordinates.slice(0),x.coordinates[0][0][2]!=null&&(R.hasZ=!0),R.spatialReference=k;break;case"Polygon":R.rings=Ou(x.coordinates.slice(0)),x.coordinates[0][0][2]!=null&&(R.hasZ=!0),R.spatialReference=k;break;case"MultiPolygon":R.rings=lf(x.coordinates.slice(0)),x.coordinates[0][0][0][2]!=null&&(R.hasZ=!0),R.spatialReference=k;break;case"Feature":x.geometry&&(R.geometry=g(x.geometry,S)),R.attributes=x.properties?Ru(x.properties):{},x.id&&(R.attributes[S]=x.id);break;case"FeatureCollection":for(R=[],Y=0;Y<x.features.length;Y++)R.push(g(x.features[Y],S));break;case"GeometryCollection":for(R=[],Y=0;Y<x.geometries.length;Y++)R.push(g(x.geometries[Y],S));break}return R},Fu='<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',cf='Powered by <a href="https://www.esri.com">Esri</a>';function sl(g,x){return hf(g,x)}function Uu(g,x){return af(g,x)}function Dh(g){if(g.xmin!=="NaN"&&g.ymin!=="NaN"&&g.xmax!=="NaN"&&g.ymax!=="NaN"){var x=yt.exports.latLng(g.ymin,g.xmin),S=yt.exports.latLng(g.ymax,g.xmax);return yt.exports.latLngBounds(x,S)}else return null}function Zh(g){return g=yt.exports.latLngBounds(g),{xmin:g.getSouthWest().lng,ymin:g.getSouthWest().lat,xmax:g.getNorthEast().lng,ymax:g.getNorthEast().lat,spatialReference:{wkid:4326}}}var Nu=/^(OBJECTID|FID|OID|ID)$/i;function Zu(g){var x;if(g.objectIdFieldName)x=g.objectIdFieldName;else if(g.fields){for(var S=0;S<=g.fields.length-1;S++)if(g.fields[S].type==="esriFieldTypeOID"){x=g.fields[S].name;break}if(!x){for(S=0;S<=g.fields.length-1;S++)if(g.fields[S].name.match(Nu)){x=g.fields[S].name;break}}}return x}function Vu(g){for(var x in g.attributes)if(x.match(Nu))return x}function ol(g,x){var S,k=g.features||g.results,R=k&&k.length;x?S=x:S=Zu(g);var Y={type:"FeatureCollection",features:[]};if(R)for(var ot=k.length-1;ot>=0;ot--){var c=Uu(k[ot],S||Vu(k[ot]));Y.features.push(c)}return Y}function Vl(g){return g=yt.exports.Util.trim(g),g[g.length-1]!=="/"&&(g+="/"),g}function al(g){if(g.url.indexOf("?")!==-1){g.requestParams=g.requestParams||{};var x=g.url.substring(g.url.indexOf("?")+1);g.url=g.url.split("?")[0],g.requestParams=JSON.parse('{"'+decodeURI(x).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return g.url=Vl(g.url.split("?")[0]),g}function Gu(g){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(g)}function Bh(g){var x;switch(g){case"Point":x="esriGeometryPoint";break;case"MultiPoint":x="esriGeometryMultipoint";break;case"LineString":x="esriGeometryPolyline";break;case"MultiLineString":x="esriGeometryPolyline";break;case"Polygon":x="esriGeometryPolygon";break;case"MultiPolygon":x="esriGeometryPolygon";break}return x}function Ol(g){return g.getSize().x-Yd.attributionWidthOffset+"px"}function ll(g){if(!!g.attributionControl){if(g.attributionControl._esriAttributionLayerCount||(g.attributionControl._esriAttributionLayerCount=0),g.attributionControl._esriAttributionLayerCount===0){if(!g.attributionControl._esriAttributionAddedOnce){var x=document.createElement("style");x.type="text/css",x.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(x);var S=document.createElement("style");S.type="text/css",S.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+Ol(g)+";}",document.getElementsByTagName("head")[0].appendChild(S),g.on("resize",function(k){g.attributionControl&&(g.attributionControl._container.style.maxWidth=Ol(k.target))}),g.attributionControl._esriAttributionAddedOnce=!0}g.attributionControl.setPrefix(Fu+" | "+cf),yt.exports.DomUtil.addClass(g.attributionControl._container,"esri-truncated-attribution:hover"),yt.exports.DomUtil.addClass(g.attributionControl._container,"esri-truncated-attribution")}g.attributionControl._esriAttributionLayerCount=g.attributionControl._esriAttributionLayerCount+1}}function Gl(g){!g.attributionControl||(g.attributionControl._esriAttributionLayerCount&&g.attributionControl._esriAttributionLayerCount===1&&(g.attributionControl.setPrefix(Fu),yt.exports.DomUtil.removeClass(g.attributionControl._container,"esri-truncated-attribution:hover"),yt.exports.DomUtil.removeClass(g.attributionControl._container,"esri-truncated-attribution")),g.attributionControl._esriAttributionLayerCount=g.attributionControl._esriAttributionLayerCount-1)}function Vh(g){var x={geometry:null,geometryType:null};if(g instanceof yt.exports.LatLngBounds)return x.geometry=Zh(g),x.geometryType="esriGeometryEnvelope",x;if(g.getLatLng&&(g=g.getLatLng()),g instanceof yt.exports.LatLng&&(g={type:"Point",coordinates:[g.lng,g.lat]}),g instanceof yt.exports.GeoJSON&&(g=g.getLayers()[0].feature.geometry,x.geometry=sl(g),x.geometryType=Bh(g.type)),g.toGeoJSON&&(g=g.toGeoJSON()),g.type==="Feature"&&(g=g.geometry),g.type==="Point"||g.type==="LineString"||g.type==="Polygon"||g.type==="MultiPolygon")return x.geometry=sl(g),x.geometryType=Bh(g.type),x;Lo("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function qu(g,x){zo.cors&&Aa(g,{},yt.exports.Util.bind(function(S,k){if(!S){x._esriAttributions=[];for(var R=0;R<k.contributors.length;R++)for(var Y=k.contributors[R],ot=0;ot<Y.coverageAreas.length;ot++){var c=Y.coverageAreas[ot],Pt=yt.exports.latLng(c.bbox[0],c.bbox[1]),Jt=yt.exports.latLng(c.bbox[2],c.bbox[3]);x._esriAttributions.push({attribution:Y.attribution,score:c.score,bounds:yt.exports.latLngBounds(Pt,Jt),minZoom:c.zoomMin,maxZoom:c.zoomMax})}x._esriAttributions.sort(function(Gt,dt){return dt.score-Gt.score});var Se={target:x};Fl(Se)}},this))}function Fl(g){var x=g.target,S=x._esriAttributions;if(!(!x||!x.attributionControl)){var k=x.attributionControl._container.querySelector(".esri-dynamic-attribution");if(k&&S){for(var R="",Y=x.getBounds(),ot=yt.exports.latLngBounds(Y.getSouthWest().wrap(),Y.getNorthEast().wrap()),c=x.getZoom(),Pt=0;Pt<S.length;Pt++){var Jt=S[Pt],Se=Jt.attribution;!R.match(Se)&&Jt.bounds.intersects(ot)&&c>=Jt.minZoom&&c<=Jt.maxZoom&&(R+=", "+Se)}R=R.substr(2),k.innerHTML=R,k.style.maxWidth=Ol(x),x.fire("attributionupdated",{attribution:R})}}}var nl={warn:Lo,cleanUrl:Vl,getUrlParams:al,isArcgisOnline:Gu,geojsonTypeToArcGIS:Bh,responseToFeatureCollection:ol,geojsonToArcGIS:sl,arcgisToGeoJSON:Uu,boundsToExtent:Zh,extentToBounds:Dh,calcAttributionWidth:Ol,setEsriAttribution:ll,_setGeometry:Vh,_getAttributionData:qu,_updateMapAttribution:Fl,_findIdAttributeFromFeature:Vu,_findIdAttributeFromResponse:Zu},Gh=yt.exports.Class.extend({options:{proxy:!1,useCors:Nl},generateSetter:function(g,x){return yt.exports.Util.bind(function(S){return this.params[g]=S,this},x)},initialize:function(g){if(g.request&&g.options?(this._service=g,yt.exports.Util.setOptions(this,g.options)):(yt.exports.Util.setOptions(this,g),this.options.url=Vl(g.url)),this.params=yt.exports.Util.extend({},this.params||{}),this.setters)for(var x in this.setters){var S=this.setters[x];this[x]=this.generateSetter(S,this)}},token:function(g){return this._service?this._service.authenticate(g):this.params.token=g,this},apikey:function(g){return this.token(g)},format:function(g){return this.params.returnUnformattedValues=!g,this},request:function(g,x){return this.options.requestParams&&yt.exports.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,g,x):this._request("request",this.path,this.params,g,x)},_request:function(g,x,S,k,R){var Y=this.options.proxy?this.options.proxy+"?"+this.options.url+x:this.options.url+x;return(g==="get"||g==="request")&&!this.options.useCors?Rl.get.JSONP(Y,S,k,R):Rl[g](Y,S,k,R)}}),uf=Gh.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(g){return this._setGeometryParams(g),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(g,x){return g=yt.exports.latLng(g),this.params.geometry=[g.lng,g.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=x,this.params.inSR=4326,this},where:function(g){return this.params.where=g,this},between:function(g,x){return this.params.time=[g.valueOf(),x.valueOf()],this},simplify:function(g,x){var S=Math.abs(g.getBounds().getWest()-g.getBounds().getEast());return this.params.maxAllowableOffset=S/g.getSize().y*x,this},orderBy:function(g,x){return x=x||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[g,x].join(" "),this},run:function(g,x){return this._cleanParams(),this.options.isModern||Gu(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(S,k){this._trapSQLerrors(S),g.call(x,S,k,k)},this)):this.request(function(S,k){this._trapSQLerrors(S),g.call(x,S,k&&ol(k),k)},this)},count:function(g,x){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(S,k){g.call(this,S,k&&k.count,k)},x)},ids:function(g,x){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(S,k){g.call(this,S,k&&k.objectIds,k)},x)},bounds:function(g,x){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(S,k){k&&k.extent&&Dh(k.extent)?g.call(x,S,Dh(k.extent),k):(S={message:"Invalid Bounds"},g.call(x,S,null,k))},x)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(g){var x=yt.exports.point(g);return this.params.pixelSize=[x.x,x.y],this},layer:function(g){return this.path=g+"/query",this},_trapSQLerrors:function(g){g&&g.code==="400"&&Lo("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(g){this.params.inSR=4326;var x=Vh(g);this.params.geometry=x.geometry,this.params.geometryType=x.geometryType}});function qh(g){return new uf(g)}var pf=Gh.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(g,x){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[g,x].join(":"),this},simplify:function(g,x){var S=Math.abs(g.getBounds().getWest()-g.getBounds().getEast());return this.params.maxAllowableOffset=S/g.getSize().y*x,this},run:function(g,x){return this.request(function(S,k){g.call(x,S,k&&ol(k),k)},x)}});function df(g){return new pf(g)}var $u=Gh.extend({path:"identify",between:function(g,x){return this.params.time=[g.valueOf(),x.valueOf()],this}}),ff=$u.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(g){var x=Zh(g.getBounds()),S=g.getSize();return this.params.imageDisplay=[S.x,S.y,96],this.params.mapExtent=[x.xmin,x.ymin,x.xmax,x.ymax],this},at:function(g){return g.length===2&&(g=yt.exports.latLng(g)),this._setGeometryParams(g),this},layerDef:function(g,x){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[g,x].join(":"),this},simplify:function(g,x){var S=Math.abs(g.getBounds().getWest()-g.getBounds().getEast());return this.params.maxAllowableOffset=S/g.getSize().y*x,this},run:function(g,x){return this.request(function(S,k){if(S)g.call(x,S,void 0,k);else{var R=ol(k);k.results=k.results.reverse();for(var Y=0;Y<R.features.length;Y++){var ot=R.features[Y];ot.layerId=k.results[Y].layerId}g.call(x,void 0,R,k)}})},_setGeometryParams:function(g){var x=Vh(g);this.params.geometry=x.geometry,this.params.geometryType=x.geometryType}});function mf(g){return new ff(g)}var _f=$u.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(g){return g=yt.exports.latLng(g),this.params.geometry=JSON.stringify({x:g.lng,y:g.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(g,x){return this.request(function(S,k){g.call(x,S,k&&this._responseToGeoJSON(k),k)},this)},_responseToGeoJSON:function(g){var x=g.location,S=g.catalogItems,k=g.catalogItemVisibilities,R={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[x.x,x.y]},crs:{type:"EPSG",properties:{code:x.spatialReference.wkid}},properties:{OBJECTID:g.objectId,name:g.name,value:g.value},id:g.objectId}};if(g.properties&&g.properties.Values&&(R.pixel.properties.values=g.properties.Values),S&&S.features&&(R.catalogItems=ol(S),k&&k.length===R.catalogItems.features.length))for(var Y=k.length-1;Y>=0;Y--)R.catalogItems.features[Y].properties.catalogItemVisibility=k[Y];return R}});function gf(g){return new _f(g)}var $h=yt.exports.Evented.extend({options:{proxy:!1,useCors:Nl,timeout:0},initialize:function(g){g=g||{},this._requestQueue=[],this._authenticating=!1,yt.exports.Util.setOptions(this,g),this.options.url=Vl(this.options.url)},get:function(g,x,S,k){return this._request("get",g,x,S,k)},post:function(g,x,S,k){return this._request("post",g,x,S,k)},request:function(g,x,S,k){return this._request("request",g,x,S,k)},metadata:function(g,x){return this._request("get","",{},g,x)},authenticate:function(g){return this._authenticating=!1,this.options.token=g,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(g){this.options.timeout=g},_request:function(g,x,S,k,R){this.fire("requeststart",{url:this.options.url+x,params:S,method:g},!0);var Y=this._createServiceCallback(g,x,S,k,R);if(this.options.token&&(S.token=this.options.token),this.options.requestParams&&yt.exports.Util.extend(S,this.options.requestParams),this._authenticating)this._requestQueue.push([g,x,S,k,R]);else{var ot=this.options.proxy?this.options.proxy+"?"+this.options.url+x:this.options.url+x;return(g==="get"||g==="request")&&!this.options.useCors?Rl.get.JSONP(ot,S,Y,R):Rl[g](ot,S,Y,R)}},_createServiceCallback:function(g,x,S,k,R){return yt.exports.Util.bind(function(Y,ot){Y&&(Y.code===499||Y.code===498)&&(this._authenticating=!0,this._requestQueue.push([g,x,S,k,R]),this.fire("authenticationrequired",{authenticate:yt.exports.Util.bind(this.authenticate,this)},!0),Y.authenticate=yt.exports.Util.bind(this.authenticate,this)),k.call(R,Y,ot),Y?this.fire("requesterror",{url:this.options.url+x,params:S,message:Y.message,code:Y.code,method:g},!0):this.fire("requestsuccess",{url:this.options.url+x,params:S,response:ot,method:g},!0),this.fire("requestend",{url:this.options.url+x,params:S,method:g},!0)},this)},_runQueue:function(){for(var g=this._requestQueue.length-1;g>=0;g--){var x=this._requestQueue[g],S=x.shift();this[S].apply(this,x)}this._requestQueue=[]}}),yf=$h.extend({identify:function(){return mf(this)},find:function(){return df(this)},query:function(){return qh(this)}});function ju(g){return new yf(g)}var vf=$h.extend({query:function(){return qh(this)},identify:function(){return gf(this)}});function xf(g){return new vf(g)}var bf=$h.extend({options:{idAttribute:"OBJECTID"},query:function(){return qh(this)},addFeature:function(g,x,S){this.addFeatures(g,x,S)},addFeatures:function(g,x,S){for(var k=g.features?g.features:[g],R=k.length-1;R>=0;R--)delete k[R].id;return g=sl(g),g=k.length>1?g:[g],this.post("addFeatures",{features:g},function(Y,ot){var c=ot&&ot.addResults?ot.addResults.length>1?ot.addResults:ot.addResults[0]:void 0;x&&x.call(S,Y||ot.addResults[0].error,c)},S)},updateFeature:function(g,x,S){this.updateFeatures(g,x,S)},updateFeatures:function(g,x,S){var k=g.features?g.features:[g];return g=sl(g,this.options.idAttribute),g=k.length>1?g:[g],this.post("updateFeatures",{features:g},function(R,Y){var ot=Y&&Y.updateResults?Y.updateResults.length>1?Y.updateResults:Y.updateResults[0]:void 0;x&&x.call(S,R||Y.updateResults[0].error,ot)},S)},deleteFeature:function(g,x,S){this.deleteFeatures(g,x,S)},deleteFeatures:function(g,x,S){return this.post("deleteFeatures",{objectIds:g},function(k,R){var Y=R&&R.deleteResults?R.deleteResults.length>1?R.deleteResults:R.deleteResults[0]:void 0;x&&x.call(S,k||R.deleteResults[0].error,Y)},S)}});function wf(g){return new bf(g)}var Ui=window.location.protocol!=="https:"?"http:":"https:",yu=yt.exports.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:Ui+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:Mo?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:Ui+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:Ui+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:Ui+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:Ui+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(g,x){var S;if(typeof g=="object"&&g.urlTemplate&&g.options)S=g;else if(typeof g=="string"&&yu.TILES[g])S=yu.TILES[g];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var k=yt.exports.Util.extend(S.options,x);yt.exports.Util.setOptions(this,k),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&S.urlTemplate.indexOf("token=")===-1&&(S.urlTemplate+="?token="+this.options.token),this.options.proxy&&(S.urlTemplate=this.options.proxy+"?"+S.urlTemplate),yt.exports.TileLayer.prototype.initialize.call(this,S.urlTemplate,k)},onAdd:function(g){ll(g),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&qu((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,g),g.on("moveend",Fl),yt.exports.TileLayer.prototype.onAdd.call(this,g)},onRemove:function(g){Gl(g),g.off("moveend",Fl),yt.exports.TileLayer.prototype.onRemove.call(this,g)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var g=this._map.createPane(this.options.pane);g.style.pointerEvents="none",g.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var g='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return g}}),Tf=yt.exports.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(g){g=yt.exports.Util.setOptions(this,g),g=al(g),this.tileUrl=(g.proxy?g.proxy+"?":"")+g.url+"tile/{z}/{y}/{x}"+(g.requestParams&&Object.keys(g.requestParams).length>0?yt.exports.Util.getParamString(g.requestParams):""),g.url.indexOf("{s}")!==-1&&g.subdomains&&(g.url=g.url.replace("{s}",g.subdomains[0])),this.service=ju(g),this.service.addEventParent(this);var x=new RegExp(/tiles.arcgis(online)?\.com/g);x.test(g.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),g.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),yt.exports.TileLayer.prototype.initialize.call(this,this.tileUrl,g)},getTileUrl:function(g){var x=this._getZoomForUrl();return yt.exports.Util.template(this.tileUrl,yt.exports.Util.extend({s:this._getSubdomain(g),x:g.x,y:g.y,z:this._lodMap&&this._lodMap[x]?this._lodMap[x]:x},this.options))},createTile:function(g,x){var S=document.createElement("img");return yt.exports.DomEvent.on(S,"load",yt.exports.Util.bind(this._tileOnLoad,this,x,S)),yt.exports.DomEvent.on(S,"error",yt.exports.Util.bind(this._tileOnError,this,x,S)),this.options.crossOrigin&&(S.crossOrigin=""),S.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?S.src=this.getTileUrl(g):this.once("lodmap",function(){S.src=this.getTileUrl(g)},this),S},onAdd:function(g){ll(g),this._lodMap||this.metadata(function(x,S){if(!x&&S.spatialReference){var k=S.spatialReference.latestWkid||S.spatialReference.wkid;if(!this.options.attribution&&g.attributionControl&&S.copyrightText&&(this.options.attribution=S.copyrightText,g.attributionControl.addAttribution(this.getAttribution())),g.options.crs===yt.exports.CRS.EPSG3857&&(k===102100||k===3857)){this._lodMap={};for(var R=S.tileInfo.lods,Y=Tf.MercatorZoomLevels,ot=0;ot<R.length;ot++){var c=R[ot];for(var Pt in Y){var Jt=Y[Pt];if(this._withinPercentage(c.resolution,Jt,this.options.zoomOffsetAllowance)){this._lodMap[Pt]=c.level;break}}}this.fire("lodmap")}else g.options.crs&&g.options.crs.code&&g.options.crs.code.indexOf(k)>-1||Lo("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),yt.exports.TileLayer.prototype.onAdd.call(this,g)},onRemove:function(g){Gl(g),yt.exports.TileLayer.prototype.onRemove.call(this,g)},metadata:function(g,x){return this.service.metadata(g,x),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(g){var x="?token="+g;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,x):this.tileUrl+x,this.options.token=g,this.service.authenticate(g),this},_withinPercentage:function(g,x,S){var k=Math.abs(g/x-1);return k<S}}),Sf=yt.exports.ImageOverlay.extend({onAdd:function(g){this._topLeft=g.getPixelBounds().min,yt.exports.ImageOverlay.prototype.onAdd.call(this,g)},_reset:function(){this._map.options.crs===yt.exports.CRS.EPSG3857?yt.exports.ImageOverlay.prototype._reset.call(this):yt.exports.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),Wu=yt.exports.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:Nl,attribution:null,interactive:!1,alt:""},onAdd:function(g){ll(g),this.options.zIndex&&(this.options.position=null),this._update=yt.exports.Util.throttle(this._update,this.options.updateInterval,this),g.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?g.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(x,S){!x&&!this.options.attribution&&g.attributionControl&&S.copyrightText&&(this.options.attribution=S.copyrightText,g.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(g){Gl(g),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(g,x){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=yt.exports.popup(x),this._popupFunction=g,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(g){return this.options.zIndex=g,this._currentImage&&this._currentImage.setZIndex(g),this},_setAutoZIndex:function(g){if(!!this._currentImage){for(var x=this._currentImage.getPane().children,S=-g(-1/0,1/0),k=0,R=x.length,Y;k<R;k++)Y=x[k].style.zIndex,x[k]!==this._currentImage._image&&Y&&(S=g(S,+Y));isFinite(S)&&(this.options.zIndex=S+g(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(g){return this.options.opacity=g,this._currentImage&&this._currentImage.setOpacity(g),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(g,x){return this.options.from=g,this.options.to=x,this._update(),this},metadata:function(g,x){return this.service.metadata(g,x),this},authenticate:function(g){return this.service.authenticate(g),this},redraw:function(){this._update()},_renderImage:function(g,x,S){if(this._map){if(S&&(g="data:"+S+";base64,"+g),!g)return;var k=new Sf(g,x,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),R=function(){this._map.removeLayer(k),this.fire("error"),k.off("load",Y,this)},Y=function(ot){if(k.off("error",R,this),this._map){var c=ot.target,Pt=this._currentImage;c._bounds.equals(x)&&c._bounds.equals(this._map.getBounds())?(this._currentImage=c,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),Pt&&this._map&&this._map.removeLayer(Pt),Pt&&Pt._map&&Pt._map.removeLayer(Pt)):this._map.removeLayer(c)}this.fire("load",{bounds:x})};k.once("error",R,this),k.once("load",Y,this)}},_update:function(){if(!!this._map){var g=this._map.getZoom(),x=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(g>this.options.maxZoom||g<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var S=this._buildExportParams();yt.exports.Util.extend(S,this.options.requestParams),S?(this._requestExport(S,x),this.fire("loading",{bounds:x})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(g,x,S,k){if(g=yt.exports.latLng(g),this._shouldRenderPopup&&this._lastClick.equals(g)){var R=this._popupFunction(x,S,k);R&&this._popup.setLatLng(g).setContent(R).openOn(this._map)}},_resetPopupState:function(g){this._shouldRenderPopup=!1,this._lastClick=g.latlng},_calculateBbox:function(){var g=this._map.getPixelBounds(),x=this._map.unproject(g.getBottomLeft()),S=this._map.unproject(g.getTopRight()),k=this._map.options.crs.project(S),R=this._map.options.crs.project(x),Y=yt.exports.bounds(k,R);return[Y.getBottomLeft().x,Y.getBottomLeft().y,Y.getTopRight().x,Y.getTopRight().y].join(",")},_calculateImageSize:function(){var g=this._map.getPixelBounds(),x=this._map.getSize(),S=this._map.unproject(g.getBottomLeft()),k=this._map.unproject(g.getTopRight()),R=this._map.latLngToLayerPoint(k).y,Y=this._map.latLngToLayerPoint(S).y;return(R>0||Y<x.y)&&(x.y=Y-R),x.x+","+x.y}});Wu.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(g){g=al(g),this.service=xf(g),this.service.addEventParent(this),yt.exports.Util.setOptions(this,g)},setPixelType:function(g){return this.options.pixelType=g,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(g){return yt.exports.Util.isArray(g)?this.options.bandIds=g.join(","):this.options.bandIds=g.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(g,x){return yt.exports.Util.isArray(g)?this.options.noData=g.join(","):this.options.noData=g.toString(),x&&(this.options.noDataInterpretation=x),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(g){this.options.renderingRule=g,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(g){this.options.mosaicRule=g,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(g){var x=yt.exports.Util.bind(function(k,R,Y){k||setTimeout(yt.exports.Util.bind(function(){this._renderPopup(g.latlng,k,R,Y)},this),300)},this),S=this.identify().at(g.latlng);this.options.mosaicRule&&S.setMosaicRule(this.options.mosaicRule),S.run(x),this._shouldRenderPopup=!0,this._lastClick=g.latlng},_buildExportParams:function(){var g=parseInt(this._map.options.crs.code.split(":")[1],10),x={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:g,imageSR:g};return this.options.from&&this.options.to&&(x.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(x.pixelType=this.options.pixelType),this.options.interpolation&&(x.interpolation=this.options.interpolation),this.options.compressionQuality&&(x.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(x.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(x.noData=this.options.noData),this.options.noDataInterpretation&&(x.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(x.token=this.service.options.token),this.options.renderingRule&&(x.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(x.mosaicRule=JSON.stringify(this.options.mosaicRule)),x},_requestExport:function(g,x){if(this.options.f==="json")this.service.request("exportImage",g,function(k,R){k||(this.options.token&&(R.href+="?token="+this.options.token),this.options.proxy&&(R.href=this.options.proxy+"?"+R.href),this._renderImage(R.href,x))},this);else{g.f="image";var S=this.options.url+"exportImage"+yt.exports.Util.getParamString(g);this.options.proxy&&(S=this.options.proxy+"?"+S),this._renderImage(S,x)}}});Wu.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(g){g=al(g),this.service=ju(g),this.service.addEventParent(this),yt.exports.Util.setOptions(this,g)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(g){return this.options.dynamicLayers=g,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(g){return this.options.layers=g,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(g){return this.options.layerDefs=g,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(g){return this.options.timeOptions=g,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(g){var x=yt.exports.Util.bind(function(R,Y,ot){R||setTimeout(yt.exports.Util.bind(function(){this._renderPopup(g.latlng,R,Y,ot)},this),300)},this),S;if(this.options.popup?S=this.options.popup.on(this._map).at(g.latlng):S=this.identify().on(this._map).at(g.latlng),S.params.maxAllowableOffset||S.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?S.layers("visible:"+this.options.layers.join(",")):S.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!S.params.layerDefs)for(var k in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,k)&&S.layerDef(k,this.options.layerDefs[k]);S.run(x),this._shouldRenderPopup=!0,this._lastClick=g.latlng},_buildExportParams:function(){var g=parseInt(this._map.options.crs.code.split(":")[1],10),x={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:g,imageSR:g};if(this.options.dynamicLayers&&(x.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;x.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(x.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(x.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(x.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(x.token=this.service.options.token),this.options.proxy&&(x.proxy=this.options.proxy),this.options.disableCache&&(x._ts=Date.now()),x},_requestExport:function(g,x){if(this.options.f==="json")this.service.request("export",g,function(k,R){k||(this.options.token&&R.href&&(R.href+="?token="+this.options.token),this.options.proxy&&R.href&&(R.href=this.options.proxy+"?"+R.href),R.href?this._renderImage(R.href,x):this._renderImage(R.imageData,x,R.contentType))},this);else{g.f="image";var S=this.options.url+"export"+yt.exports.Util.getParamString(g);this.options.proxy&&(S=this.options.proxy+"?"+S),this._renderImage(S,x)}}});var kl=yt.exports.Layer.extend({options:{cellSize:512,updateWhenIdle:yt.exports.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(g){yt.exports.Util.setOptions(this,g)},onAdd:function(g){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(g){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var g={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=yt.exports.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),g.move=this._onMove),g},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var g=this.options.cellSize;return g instanceof yt.exports.Point?g:new yt.exports.Point(g,g)},_pruneCells:function(){if(!!this._map){var g,x;for(g in this._cells)x=this._cells[g],x.retain=x.current;for(g in this._cells)if(x=this._cells[g],x.current&&!x.active){var S=x.coords;this._retainParent(S.x,S.y,S.z,S.z-5)||this._retainChildren(S.x,S.y,S.z,S.z+2)}for(g in this._cells)this._cells[g].retain||this._removeCell(g)}},_removeAllCells:function(){for(var g in this._cells)this._removeCell(g)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(g,x,S,k){var R=Math.floor(g/2),Y=Math.floor(x/2),ot=S-1,c=new yt.exports.Point(+R,+Y);c.z=+ot;var Pt=this._cellCoordsToKey(c),Jt=this._cells[Pt];return Jt&&Jt.active?(Jt.retain=!0,!0):(Jt&&Jt.loaded&&(Jt.retain=!0),ot>k?this._retainParent(R,Y,ot,k):!1)},_retainChildren:function(g,x,S,k){for(var R=2*g;R<2*g+2;R++)for(var Y=2*x;Y<2*x+2;Y++){var ot=new yt.exports.Point(R,Y);ot.z=S+1;var c=this._cellCoordsToKey(ot),Pt=this._cells[c];if(Pt&&Pt.active){Pt.retain=!0;continue}else Pt&&Pt.loaded&&(Pt.retain=!0);S+1<k&&this._retainChildren(R,Y,S+1,k)}},_resetView:function(g){var x=g&&(g.pinch||g.flyTo);x||this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_setView:function(g,x,S,k){var R=Math.round(x);k||(this._cellZoom=R,this._abortLoading&&this._abortLoading(),this._resetGrid(),R!==void 0&&this._update(g),S||this._pruneCells(),this._noPrune=!!S)},_resetGrid:function(){var g=this._map,x=g.options.crs,S=this._cellSize=this.getCellSize(),k=this._cellZoom,R=this._map.getPixelWorldBounds(this._cellZoom);R&&(this._globalCellRange=this._pxBoundsToCellRange(R)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(g.project([0,x.wrapLng[0]],k).x/S.x),Math.ceil(g.project([0,x.wrapLng[1]],k).x/S.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(g.project([x.wrapLat[0],0],k).y/S.x),Math.ceil(g.project([x.wrapLat[1],0],k).y/S.y)]},_onMoveEnd:function(g){var x=g&&(g.pinch||g.flyTo);x||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(g){var x=this._map,S=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),k=x.getZoomScale(S,this._cellZoom),R=x.project(g,this._cellZoom).floor(),Y=x.getSize().divideBy(k*2);return new yt.exports.Bounds(R.subtract(Y),R.add(Y))},_update:function(g){var x=this._map;if(!!x){var S=Math.round(x.getZoom());g===void 0&&(g=x.getCenter());var k=this._getCelldPixelBounds(g),R=this._pxBoundsToCellRange(k),Y=R.getCenter(),ot=[],c=this.options.keepBuffer,Pt=new yt.exports.Bounds(R.getBottomLeft().subtract([c,-c]),R.getTopRight().add([c,-c]));if(!(isFinite(R.min.x)&&isFinite(R.min.y)&&isFinite(R.max.x)&&isFinite(R.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var Jt in this._cells){var Se=this._cells[Jt].coords;(Se.z!==this._cellZoom||!Pt.contains(new yt.exports.Point(Se.x,Se.y)))&&(this._cells[Jt].current=!1)}if(Math.abs(S-this._cellZoom)>1){this._setView(g,S);return}for(var Gt=R.min.y;Gt<=R.max.y;Gt++)for(var dt=R.min.x;dt<=R.max.x;dt++){var ci=new yt.exports.Point(dt,Gt);if(ci.z=this._cellZoom,!!this._isValidCell(ci)){var $e=this._cells[this._cellCoordsToKey(ci)];$e?$e.current=!0:ot.push(ci)}}if(ot.sort(function(Fr,mn){return Fr.distanceTo(Y)-mn.distanceTo(Y)}),ot.length!==0)for(this._loading||(this._loading=!0),dt=0;dt<ot.length;dt++){var ce=this._cellCoordsToKey(ot[dt]),Or=this._keyToCellCoords(ce);this._activeCells[Or]?this._reuseCell(ot[dt]):this._createCell(ot[dt])}}},_isValidCell:function(g){var x=this._map.options.crs;if(!x.infinite){var S=this._globalCellRange;if(!x.wrapLng&&(g.x<S.min.x||g.x>S.max.x)||!x.wrapLat&&(g.y<S.min.y||g.y>S.max.y))return!1}if(!this.options.bounds)return!0;var k=this._cellCoordsToBounds(g);return yt.exports.toLatLngBounds(this.options.bounds).overlaps(k)},_keyToBounds:function(g){return this._cellCoordsToBounds(this._keyToCellCoords(g))},_cellCoordsToNwSe:function(g){var x=this._map,S=this.getCellSize(),k=g.scaleBy(S),R=k.add(S),Y=x.unproject(k,g.z),ot=x.unproject(R,g.z);return[Y,ot]},_cellCoordsToBounds:function(g){var x=this._cellCoordsToNwSe(g),S=new yt.exports.LatLngBounds(x[0],x[1]);return this.options.noWrap||(S=this._map.wrapLatLngBounds(S)),S},_cellCoordsToKey:function(g){return g.x+":"+g.y+":"+g.z},_keyToCellCoords:function(g){var x=g.split(":"),S=new yt.exports.Point(+x[0],+x[1]);return S.z=+x[2],S},_removeCell:function(g){var x=this._cells[g];if(!!x){var S=this._keyToCellCoords(g),k=this._wrapCoords(S),R=this._cellCoordsToBounds(this._wrapCoords(S));x.current=!1,delete this._cells[g],this._activeCells[g]=x,this.cellLeave(R,k,g),this.fire("cellleave",{key:g,coords:k,bounds:R})}},_reuseCell:function(g){var x=this._cellCoordsToKey(g);this._cells[x]=this._activeCells[x],this._cells[x].current=!0;var S=this._wrapCoords(g),k=this._cellCoordsToBounds(this._wrapCoords(g));this.cellEnter(k,S,x),this.fire("cellenter",{key:x,coords:S,bounds:k})},_createCell:function(g){var x=this._cellCoordsToKey(g),S=this._wrapCoords(g),k=this._cellCoordsToBounds(this._wrapCoords(g));this.createCell(k,S,x),this.fire("cellcreate",{key:x,coords:S,bounds:k}),this._cells[x]={coords:g,current:!0},yt.exports.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(g,x,S){var k=this._cellCoordsToKey(g);S=this._cells[k],S&&(S.loaded=+new Date,S.active=!0)},_getCellPos:function(g){return g.scaleBy(this.getCellSize())},_wrapCoords:function(g){var x=new yt.exports.Point(this._wrapX?yt.exports.Util.wrapNum(g.x,this._wrapX):g.x,this._wrapY?yt.exports.Util.wrapNum(g.y,this._wrapY):g.y);return x.z=g.z,x},_pxBoundsToCellRange:function(g){var x=this.getCellSize();return new yt.exports.Bounds(g.min.unscaleBy(x).floor(),g.max.unscaleBy(x).ceil().subtract([1,1]))}});function ro(g){this.values=[].concat(g||[])}ro.prototype.query=function(g){var x=this.getIndex(g);return this.values[x]};ro.prototype.getIndex=function(x){this.dirty&&this.sort();for(var S=0,k=this.values.length-1,R,Y;S<=k;)if(R=(S+k)/2|0,Y=this.values[Math.round(R)],+Y.value<+x)S=R+1;else if(+Y.value>+x)k=R-1;else return R;return Math.abs(~k)};ro.prototype.between=function(x,S){var k=this.getIndex(x),R=this.getIndex(S);if(k===0&&R===0)return[];for(;this.values[k-1]&&this.values[k-1].value===x;)k--;for(;this.values[R+1]&&this.values[R+1].value===S;)R++;return this.values[R]&&this.values[R].value===S&&this.values[R+1]&&R++,this.values.slice(k,R)};ro.prototype.insert=function(x){return this.values.splice(this.getIndex(x.value),0,x),this};ro.prototype.bulkAdd=function(x,S){return this.values=this.values.concat([].concat(x||[])),S?this.sort():this.dirty=!0,this};ro.prototype.sort=function(){return this.values.sort(function(x,S){return+S.value-+x.value}).reverse(),this.dirty=!1,this};var Ch=kl.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(g){if(kl.prototype.initialize.call(this,g),g=al(g),g=yt.exports.Util.setOptions(this,g),this.service=wf(g),this.service.addEventParent(this),this.options.fields[0]!=="*"){for(var x=!1,S=0;S<this.options.fields.length;S++)this.options.fields[S].match(/^(OBJECTID|FID|OID|ID)$/i)&&(x=!0);x===!1&&Lo("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new ro,this._endTimeIndex=new ro):this.options.timeField&&(this._timeIndex=new ro),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(g){return ll(g),this.service.metadata(function(x,S){if(!x){var k=S.supportedQueryFormats,R=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(R=!0),!R&&k&&k.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),S.objectIdField&&(this.service.options.idAttribute=S.objectIdField),!this.options.attribution&&g.attributionControl&&S.copyrightText&&(this.options.attribution=S.copyrightText,g.attributionControl.addAttribution(this.getAttribution()))}},this),g.on("zoomend",this._handleZoomChange,this),kl.prototype.onAdd.call(this,g)},onRemove:function(g){return Gl(g),g.off("zoomend",this._handleZoomChange,this),kl.prototype.onRemove.call(this,g)},getAttribution:function(){return this.options.attribution},createCell:function(g,x){this._visibleZoom()&&this._requestFeatures(g,x)},_requestFeatures:function(g,x,S,k){this._activeRequests++,k=k||0;var R=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:g},!0),this._buildQuery(g,k).run(function(Y,ot,c){c&&c.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===R&&(!Y&&ot&&ot.features.length&&yt.exports.Util.requestAnimFrame(yt.exports.Util.bind(function(){this._addFeatures(ot.features,x),this._postProcessFeatures(g)},this)),!Y&&ot&&!ot.features.length&&this._postProcessFeatures(g),Y&&this._postProcessFeatures(g),S&&S.call(this,Y,ot),c&&(c.exceededTransferLimit||c.properties&&c.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(g,x,S,k+ot.features.length))},this)},_postProcessFeatures:function(g){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:g})},_cacheKey:function(g){return g.z+":"+g.x+":"+g.y},_addFeatures:function(g,x){if(x){var S=this._cacheKey(x);this._cache[S]=this._cache[S]||[]}for(var k=g.length-1;k>=0;k--){var R=g[k].id;this._currentSnapshot.indexOf(R)===-1&&this._currentSnapshot.push(R),typeof S<"u"&&this._cache[S].indexOf(R)===-1&&this._cache[S].push(R)}this.options.timeField&&this._buildTimeIndexes(g),this.createLayers(g)},_buildQuery:function(g,x){var S=this.service.query().intersects(g).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(x))&&(S=S.offset(x)),S.params.resultType="tile",this.options.requestParams&&yt.exports.Util.extend(S.params,this.options.requestParams),this.options.simplifyFactor&&S.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&S.between(this.options.from,this.options.to),S},setWhere:function(g,x,S){this.options.where=g&&g.length?g:"1=1";for(var k=[],R=[],Y=0,ot=null,c=yt.exports.Util.bind(function(dt,ci){if(dt&&(ot=dt),ci)for(var $e=ci.features.length-1;$e>=0;$e--)R.push(ci.features[$e].id);Y--,Y<=0&&this._visibleZoom()&&g===this.options.where&&(this._currentSnapshot=R,yt.exports.Util.requestAnimFrame(yt.exports.Util.bind(function(){this.removeLayers(k),this.addLayers(R),x&&x.call(S,ot)},this)))},this),Pt=this._currentSnapshot.length-1;Pt>=0;Pt--)k.push(this._currentSnapshot[Pt]);this._cache={};for(var Jt in this._cells){Y++;var Se=this._keyToCellCoords(Jt),Gt=this._cellCoordsToBounds(Se);this._requestFeatures(Gt,Se,c)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(g,x,S,k){var R=this.options.from,Y=this.options.to,ot=0,c=null,Pt=yt.exports.Util.bind(function(dt){dt&&(c=dt),this._filterExistingFeatures(R,Y,g,x),ot--,S&&ot<=0&&S.call(k,c)},this);if(this.options.from=g,this.options.to=x,this._filterExistingFeatures(R,Y,g,x),this.options.timeFilterMode==="server")for(var Jt in this._cells){ot++;var Se=this._keyToCellCoords(Jt),Gt=this._cellCoordsToBounds(Se);this._requestFeatures(Gt,Se,Pt)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(g,x,S,k){var R=g&&x?this._getFeaturesInTimeRange(g,x):this._currentSnapshot,Y=this._getFeaturesInTimeRange(S,k);if(Y.indexOf)for(var ot=0;ot<Y.length;ot++){var c=R.indexOf(Y[ot]);c>=0&&R.splice(c,1)}yt.exports.Util.requestAnimFrame(yt.exports.Util.bind(function(){this.removeLayers(R),this.addLayers(Y)},this))},_getFeaturesInTimeRange:function(g,x){var S=[],k;if(this.options.timeField.start&&this.options.timeField.end){var R=this._startTimeIndex.between(g,x),Y=this._endTimeIndex.between(g,x);k=R.concat(Y)}else if(this._timeIndex)k=this._timeIndex.between(g,x);else return Lo("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(var ot=k.length-1;ot>=0;ot--)S.push(k[ot].id);return S},_buildTimeIndexes:function(g){var x,S;if(this.options.timeField.start&&this.options.timeField.end){var k=[],R=[];for(x=g.length-1;x>=0;x--)S=g[x],k.push({id:S.id,value:new Date(S.properties[this.options.timeField.start])}),R.push({id:S.id,value:new Date(S.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(k),this._endTimeIndex.bulkAdd(R)}else{var Y=[];for(x=g.length-1;x>=0;x--)S=g[x],Y.push({id:S.id,value:new Date(S.properties[this.options.timeField])});this._timeIndex.bulkAdd(Y)}},_featureWithinTimeRange:function(g){if(!this.options.from||!this.options.to)return!0;var x=+this.options.from.valueOf(),S=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){var k=+g.properties[this.options.timeField];return k>=x&&k<=S}if(this.options.timeField.start&&this.options.timeField.end){var R=+g.properties[this.options.timeField.start],Y=+g.properties[this.options.timeField.end];return R>=x&&R<=S||Y>=x&&Y<=S||R<=x&&Y>=S}},_visibleZoom:function(){if(!this._map)return!1;var g=this._map.getZoom();return!(g>this.options.maxZoom||g<this.options.minZoom)},_handleZoomChange:function(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot),this._currentSnapshot=[];else for(var g in this._cells){var x=this._cells[g].coords,S=this._cacheKey(x);this._cache[S]&&this.addLayers(this._cache[S])}},authenticate:function(g){return this.service.authenticate(g),this},metadata:function(g,x){return this.service.metadata(g,x),this},query:function(){return this.service.query()},_getMetadata:function(g){if(this._metadata){var x;g(x,this._metadata)}else this.metadata(yt.exports.Util.bind(function(S,k){this._metadata=k,g(S,this._metadata)},this))},addFeature:function(g,x,S){this.addFeatures(g,x,S)},addFeatures:function(g,x,S){this._getMetadata(yt.exports.Util.bind(function(k,R){if(k){x&&x.call(this,k,null);return}var Y=g.features?g.features:[g];this.service.addFeatures(g,yt.exports.Util.bind(function(ot,c){if(!ot){for(var Pt=Y.length-1;Pt>=0;Pt--)Y[Pt].properties[R.objectIdField]=Y.length>1?c[Pt].objectId:c.objectId,Y[Pt].id=Y.length>1?c[Pt].objectId:c.objectId;this._addFeatures(Y)}x&&x.call(S,ot,c)},this))},this))},updateFeature:function(g,x,S){this.updateFeatures(g,x,S)},updateFeatures:function(g,x,S){var k=g.features?g.features:[g];this.service.updateFeatures(g,function(R,Y){if(!R){for(var ot=k.length-1;ot>=0;ot--)this.removeLayers([k[ot].id],!0);this._addFeatures(k)}x&&x.call(S,R,Y)},this)},deleteFeature:function(g,x,S){this.deleteFeatures(g,x,S)},deleteFeatures:function(g,x,S){return this.service.deleteFeatures(g,function(k,R){var Y=R.length?R:[R];if(!k&&Y.length>0)for(var ot=Y.length-1;ot>=0;ot--)this.removeLayers([Y[ot].objectId],!0);x&&x.call(S,k,R)},this)}}),If=Ch.extend({options:{cacheLayers:!0},initialize:function(g){g.apikey&&(g.token=g.apikey),Ch.prototype.initialize.call(this,g),this._originalStyle=this.options.style,this._layers={}},onRemove:function(g){for(var x in this._layers)g.removeLayer(this._layers[x]),this.fire("removefeature",{feature:this._layers[x].feature,permanent:!1},!0);return Ch.prototype.onRemove.call(this,g)},createNewLayer:function(g){var x=yt.exports.GeoJSON.geometryToLayer(g,this.options);return x&&(x.defaultOptions=x.options),x},_updateLayer:function(g,x){var S=[],k=this.options.coordsToLatLng||yt.exports.GeoJSON.coordsToLatLng;switch(x.properties&&(g.feature.properties=x.properties),x.geometry.type){case"Point":S=yt.exports.GeoJSON.coordsToLatLng(x.geometry.coordinates),g.setLatLng(S);break;case"LineString":S=yt.exports.GeoJSON.coordsToLatLngs(x.geometry.coordinates,0,k),g.setLatLngs(S);break;case"MultiLineString":S=yt.exports.GeoJSON.coordsToLatLngs(x.geometry.coordinates,1,k),g.setLatLngs(S);break;case"Polygon":S=yt.exports.GeoJSON.coordsToLatLngs(x.geometry.coordinates,1,k),g.setLatLngs(S);break;case"MultiPolygon":S=yt.exports.GeoJSON.coordsToLatLngs(x.geometry.coordinates,2,k),g.setLatLngs(S);break}this.redraw(g.feature.id)},createLayers:function(g){for(var x=g.length-1;x>=0;x--){var S=g[x],k=this._layers[S.id],R;this._visibleZoom()&&k&&!this._map.hasLayer(k)&&(!this.options.timeField||this._featureWithinTimeRange(S))&&(this._map.addLayer(k),this.fire("addfeature",{feature:k.feature},!0)),k&&(k.setLatLngs||k.setLatLng)&&this._updateLayer(k,S),k||(R=this.createNewLayer(S),R?(R.feature=S,R.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(R.feature,R),this._layers[R.feature.id]=R,this.setFeatureStyle(R.feature.id,this.options.style),this.fire("createfeature",{feature:R.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(S))&&this._map.addLayer(R)):Lo("invalid GeoJSON encountered"))}},addLayers:function(g){for(var x=g.length-1;x>=0;x--){var S=this._layers[g[x]];S&&(!this.options.timeField||this._featureWithinTimeRange(S.feature))&&(this._map.addLayer(S),this.fire("addfeature",{feature:S.feature},!0))}},removeLayers:function(g,x){for(var S=g.length-1;S>=0;S--){var k=g[S],R=this._layers[k];R&&(this.fire("removefeature",{feature:R.feature,permanent:x},!0),this._map.removeLayer(R)),R&&x&&delete this._layers[k]}},cellEnter:function(g,x){this._visibleZoom()&&!this._zooming&&this._map&&yt.exports.Util.requestAnimFrame(yt.exports.Util.bind(function(){var S=this._cacheKey(x),k=this._cellCoordsToKey(x),R=this._cache[S];this._activeCells[k]&&R&&this.addLayers(R)},this))},cellLeave:function(g,x){this._zooming||yt.exports.Util.requestAnimFrame(yt.exports.Util.bind(function(){if(this._map){var S=this._cacheKey(x),k=this._cellCoordsToKey(x),R=this._cache[S],Y=this._map.getBounds();if(!this._activeCells[k]&&R){for(var ot=!0,c=0;c<R.length;c++){var Pt=this._layers[R[c]];Pt&&Pt.getBounds&&Y.intersects(Pt.getBounds())&&(ot=!1)}ot&&this.removeLayers(R,!this.options.cacheLayers),!this.options.cacheLayers&&ot&&(delete this._cache[S],delete this._cells[k],delete this._activeCells[k])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(g){this.resetFeatureStyle(g.feature.id)},this),this},setStyle:function(g){return this.options.style=g,this.eachFeature(function(x){this.setFeatureStyle(x.feature.id,g)},this),this},resetFeatureStyle:function(g){var x=this._layers[g],S=this._originalStyle||yt.exports.Path.prototype.options;return x&&(yt.exports.Util.extend(x.options,x.defaultOptions),this.setFeatureStyle(g,S)),this},setFeatureStyle:function(g,x){var S=this._layers[g];return typeof x=="function"&&(x=x(S.feature)),S.setStyle&&S.setStyle(x),this},eachActiveFeature:function(g,x){if(this._map){var S=this._map.getBounds();for(var k in this._layers)this._currentSnapshot.indexOf(this._layers[k].feature.id)!==-1&&(typeof this._layers[k].getLatLng=="function"&&S.contains(this._layers[k].getLatLng())?g.call(x,this._layers[k]):typeof this._layers[k].getBounds=="function"&&S.intersects(this._layers[k].getBounds())&&g.call(x,this._layers[k]))}return this},eachFeature:function(g,x){for(var S in this._layers)g.call(x,this._layers[S]);return this},getFeature:function(g){return this._layers[g]},bringToBack:function(){this.eachFeature(function(g){g.bringToBack&&g.bringToBack()})},bringToFront:function(){this.eachFeature(function(g){g.bringToFront&&g.bringToFront()})},redraw:function(g){return g&&this._redraw(g),this},_redraw:function(g){var x=this._layers[g],S=x.feature;if(x&&x.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var k=this.options.pointToLayer(S,yt.exports.latLng(S.geometry.coordinates[1],S.geometry.coordinates[0])),R=k.options.icon;x.setIcon(R)}if(x&&x.setStyle&&this.options.pointToLayer){var Y=this.options.pointToLayer(S,yt.exports.latLng(S.geometry.coordinates[1],S.geometry.coordinates[0])),ot=Y.options;this.setFeatureStyle(S.id,ot)}x&&x.setStyle&&this.options.style&&this.resetStyle(S.id)}});function Ef(g,x){var S="https://basemaps-api.arcgis.com/arcgis/rest/services/styles/"+g+"?type=style";return x&&(S=S+"&apiKey="+x),S}function Pf(g,x,S){var k=/^https?:\/\//,R=/\/VectorTileServer\/?$/;if(k.test(g)&&R.test(g)){var Y=g;Xu(Y,x,S)}else{var ot=g;Af(ot,x,S)}}function Hu(g,x,S){var k=x.token?{token:x.token}:{};Aa(g,k,S)}function vu(g,x,S){var k=x.token?{token:x.token}:{},R=x.portalUrl+"/sharing/rest/content/items/"+g;Aa(R,k,S)}function Af(g,x,S){var k=x.portalUrl+"/sharing/rest/content/items/"+g+"/resources/styles/root.json";Ku(k,x,function(R,Y){R?vu(g,x,function(ot,c){ot&&console.error(ot),Xu(c.url,x,S)}):vu(g,x,function(ot,c){ot&&console.error(ot),Hu(c.url,x,function(Pt,Jt){S(Pt,Y,k,Jt,c.url)})})})}function Xu(g,x,S){Hu(g,x,function(k,R){k&&console.error(k);var Y=g;g.charAt(g.length-1)==="/"&&(Y=g.slice(0,g.length-1));var ot;R.defaultStyles.charAt(0)==="/"?ot=Y+R.defaultStyles+"/root.json":ot=Y+"/"+R.defaultStyles+"/root.json",Ku(ot,x,function(c,Pt){c&&console.error(c),S(null,Pt,ot,R,g)})})}function Ku(g,x,S){var k=x.token?{token:x.token}:{};Aa(g,k,S)}function Cf(g,x,S,k){for(var R=Object.keys(g.sources),Y=0;Y<R.length;Y++){var ot=g.sources[R[Y]];ot.url.indexOf("http")===-1&&(ot.url=x.replace("/resources/styles/root.json","")),ot.url.charAt(ot.url.length-1)==="/"&&(ot.url=ot.url.slice(0,ot.url.length-1)),ot.tiles||(S.tiles&&S.tiles[0].charAt(0)!=="/"&&(S.tiles[0]="/"+S.tiles[0]),ot.tiles=[ot.url+S.tiles[0]]),ot.url+="?f=json",ot.url+=k?"&token="+k:"",ot.tiles[0]+=k?"?token="+k:"",ot.minzoom=S.tileInfo.lods[0].level,ot.maxzoom=S.tileInfo.lods[S.tileInfo.lods.length-1].level}var c=g.sources[R[R.length-1]];c.attribution=S.copyrightText||"",c.copyrightText=S.copyrightText||"";for(var Pt=0;Pt<g.layers.length;Pt++){var Jt=g.layers[Pt];Jt.layout&&Jt.layout["text-font"]&&Jt.layout["text-font"].length>1&&(Jt.layout["text-font"]=[Jt.layout["text-font"][0]])}return g.sprite&&g.sprite.indexOf("http")===-1&&(g.sprite=x.replace("styles/root.json",g.sprite.replace("../","")),g.sprite+=k?"?token="+k:""),g.glyphs&&g.glyphs.indexOf("http")===-1&&(g.glyphs=x.replace("styles/root.json",g.glyphs.replace("../","")),g.glyphs+=k?"?token="+k:""),g}function Mf(g,x){zo.cors&&Aa(g,{},function(S,k){if(!S){x._esriAttributions=x._esriAttributions||[];for(var R=0;R<k.contributors.length;R++)for(var Y=k.contributors[R],ot=0;ot<Y.coverageAreas.length;ot++){var c=Y.coverageAreas[ot],Pt=yt.exports.latLng(c.bbox[0],c.bbox[1]),Jt=yt.exports.latLng(c.bbox[2],c.bbox[3]);x._esriAttributions.push({attribution:Y.attribution,score:c.score,bounds:yt.exports.latLngBounds(Pt,Jt),minZoom:c.zoomMin,maxZoom:c.zoomMax})}x._esriAttributions.sort(function(Gt,dt){return dt.score-Gt.score});var Se={target:x};nl._updateMapAttribution(Se)}})}const zf=[3857,102100,102113];function Lf(g){return zf.indexOf(g)>=0}var Ju={exports:{}};(function(g,x){(function(S,k){g.exports=k()})(ku,function(){var S,k,R;function Y(c,Pt){if(!S)S=Pt;else if(!k)k=Pt;else{var Jt="var sharedChunk = {}; ("+S+")(sharedChunk); ("+k+")(sharedChunk);",Se={};S(Se),R=Pt(Se),typeof window<"u"&&(R.workerUrl=window.URL.createObjectURL(new Blob([Jt],{type:"text/javascript"})))}}Y(["exports"],function(c){var Pt=Jt;function Jt(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}function Se(i,t,n,o){const u=new Pt(i,t,n,o);return function(d){return u.solve(d)}}Jt.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<t)return n;var d=this.sampleCurveDerivativeX(n);if(Math.abs(d)<1e-6)break;n-=u/d}var m=0,v=1;for(n=i,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<t));o++)i>u?m=n:v=n,n=.5*(v-m)+m;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};const Gt=Se(.25,.1,.25,1);function dt(i,t,n){return Math.min(n,Math.max(t,i))}function ci(i,t,n){const o=n-t,u=((i-t)%o+o)%o+t;return u===t?n:u}function $e(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let ce=1;function Or(i,t){i.forEach(n=>{t[n]&&(t[n]=t[n].bind(t))})}function Fr(i,t,n){const o={};for(const u in i)o[u]=t.call(n||this,i[u],u,i);return o}function mn(i,t,n){const o={};for(const u in i)t.call(n||this,i[u],u,i)&&(o[u]=i[u]);return o}function ii(i){return Array.isArray(i)?i.map(ii):typeof i=="object"&&i?Fr(i,ii):i}const Ur={};function ni(i){Ur[i]||(typeof console<"u"&&console.warn(i),Ur[i]=!0)}function _n(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function Yn(i){let t=0;for(let n,o,u=0,d=i.length,m=d-1;u<d;m=u++)n=i[u],o=i[m],t+=(o.x-n.x)*(n.y+o.y);return t}function rn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function cs(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,d)=>{const m=u||d;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}let On,ui,pi=null;function us(i){if(pi==null){const t=i.navigator?i.navigator.userAgent:null;pi=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return pi}function Ci(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const _r={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const n=window.document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return n.width=i.width,n.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-t,-t,i.width+2*t,i.height+2*t)},resolveURL:i=>(On||(On=document.createElement("a")),On.href=i,On.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ui==null&&(ui=matchMedia("(prefers-reduced-motion: reduce)")),ui.matches)}};var Yt=sn;function sn(i,t){this.x=i,this.y=t}sn.prototype={clone:function(){return new sn(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,t){var n=Math.cos(i),o=Math.sin(i),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},sn.convert=function(i){return i instanceof sn?i:Array.isArray(i)?new sn(i[0],i[1]):i};const ae={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},gn="mapbox-tiles";let re,Ze,gi=500,yi=50;function ri(){typeof caches>"u"||re||(re=caches.open(gn))}let Pe=1/0;const De={supported:!1,testSupport:function(i){!Zi&&Ni&&(gr?Nr(i):Mi=i)}};let Mi,Ni,Zi=!1,gr=!1;function Nr(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Ni),i.isContextLost())return;De.supported=!0}catch{}i.deleteTexture(t),Zi=!0}typeof document<"u"&&(Ni=document.createElement("img"),Ni.onload=function(){Mi&&Nr(Mi),Mi=null,gr=!0},Ni.onerror=function(){Zi=!0,Mi=null},Ni.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const on={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(on);class Vi extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const Es=rn()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Qn(i,t){const n=new AbortController,o=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Es(),signal:n.signal});let u=!1,d=!1;return i.type==="json"&&o.headers.set("Accept","application/json"),((m,v,w)=>{if(d)return;const E=Date.now();fetch(o).then(M=>M.ok?((D,F,V)=>{(i.type==="arrayBuffer"?D.arrayBuffer():i.type==="json"?D.json():D.text()).then(G=>{d||(F&&V&&function(J,K,ut){if(ri(),!re)return;const gt={status:K.status,statusText:K.statusText,headers:new Headers};K.headers.forEach((mt,Et)=>gt.headers.set(Et,mt));const ct=cs(K.headers.get("Cache-Control")||"");ct["no-store"]||(ct["max-age"]&&gt.headers.set("Expires",new Date(ut+1e3*ct["max-age"]).toUTCString()),new Date(gt.headers.get("Expires")).getTime()-ut<42e4||function(mt,Et){if(Ze===void 0)try{new Response(new ReadableStream),Ze=!0}catch{Ze=!1}Ze?Et(mt.body):mt.blob().then(Et)}(K,mt=>{const Et=new Response(mt,gt);ri(),re&&re.then(It=>It.put(function(jt){const Kt=jt.indexOf("?");return Kt<0?jt:jt.slice(0,Kt)}(J.url),Et)).catch(It=>ni(It.message))}))}(o,F,V),u=!0,t(null,G,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(G=>{d||t(new Error(G.message))})})(M,null,E):M.blob().then(D=>t(new Vi(M.status,M.statusText,i.url,D)))).catch(M=>{M.code!==20&&t(new Error(M.message))})})(),{cancel:()=>{d=!0,u||n.abort()}}}const Zr=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(rn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!rn()){const o=i.url.substring(0,i.url.indexOf("://"));return(ae.REGISTERED_PROTOCOLS[o]||Qn)(i,t)}}if(!(/^file:/.test(n=i.url)||/^file:/.test(Es())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Qn(i,t);if(rn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var n;return function(o,u){const d=new XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in o.headers)d.setRequestHeader(m,o.headers[m]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{u(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(o.type==="json")try{m=JSON.parse(d.response)}catch(v){return u(v)}u(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else{const m=new Blob([d.response],{type:d.getResponseHeader("Content-Type")});u(new Vi(d.status,d.statusText,o.url,m))}},d.send(o.body),{cancel:()=>d.abort()}}(i,t)},yr=function(i,t){return Zr($e(i,{type:"arrayBuffer"}),t)};function vr(i){const t=window.document.createElement("a");return t.href=i,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let En,Fn;En=[],Fn=0;const tr=function(i,t){if(De.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Fn>=ae.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return En.push(d),d}Fn++;let n=!1;const o=()=>{if(!n)for(n=!0,Fn--;En.length&&Fn<ae.MAX_PARALLEL_IMAGE_REQUESTS;){const d=En.shift(),{requestParameters:m,callback:v,cancelled:w}=d;w||(d.cancel=tr(m,v).cancel)}},u=yr(i,(d,m,v,w)=>{o(),d?t(d):m&&function(E,M){typeof createImageBitmap=="function"?function(D,F){const V=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(V).then(G=>{F(null,G)}).catch(G=>{F(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(E,M):function(D,F){const V=new Image;V.onload=()=>{F(null,V),URL.revokeObjectURL(V.src),V.onload=null,window.requestAnimationFrame(()=>{V.src=Ae})},V.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new Blob([new Uint8Array(D)],{type:"image/png"});V.src=D.byteLength?URL.createObjectURL(G):Ae}(E,M)}(m,(E,M)=>{E!=null?t(E):M!=null&&t(null,M,{cacheControl:v,expires:w})})});return{cancel:()=>{u.cancel(),o()}}};function ps(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function er(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class ir{constructor(t,n={}){$e(this,n),this.type=t}}class xr extends ir{constructor(t,n={}){super("error",$e({error:t},n))}}class Un{on(t,n){return this._listeners=this._listeners||{},ps(t,n,this._listeners),this}off(t,n){return er(t,n,this._listeners),er(t,n,this._oneTimeListeners),this}once(t,n){return this._oneTimeListeners=this._oneTimeListeners||{},ps(t,n,this._oneTimeListeners),this}fire(t,n){typeof t=="string"&&(t=new ir(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of u)v.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of d)er(o,v,this._oneTimeListeners),v.call(this,t);const m=this._eventedParent;m&&($e(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof xr&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var wt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Bt{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function br(i){const t=i.value;return t?[new Bt(i.key,t,"constants have been deprecated as of v8")]:[]}function yn(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}function Ce(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function an(i){if(Array.isArray(i))return i.map(an);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=an(i[n]);return t}return Ce(i)}class Gi extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Wi{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Wi(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const wr={kind:"null"},Lt={kind:"number"},me={kind:"string"},ue={kind:"boolean"},wi={kind:"color"},nr={kind:"object"},le={kind:"value"},rr={kind:"collator"},Ti={kind:"formatted"},ds={kind:"padding"},di={kind:"resolvedImage"};function qi(i,t){return{kind:"array",itemType:i,N:t}}function Ue(i){if(i.kind==="array"){const t=Ue(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const Tr=[wr,Lt,me,ue,wi,Ti,nr,qi(le),ds,di];function Nn(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Nn(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of Tr)if(!Nn(n,t))return null}}return`Expected ${Ue(i)} but found ${Ue(t)} instead.`}function Vr(i,t){return t.some(n=>n.kind===i.kind)}function Gr(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}var fs,zi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function U(i){return(i=Math.round(i))<0?0:i>255?255:i}function C(i){return U(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function B(i){return(t=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function q(i,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?i+(t-i)*n*6:2*n<1?t:3*n<2?i+(t-i)*(2/3-n)*6:i}try{fs={}.parseCSSColor=function(i){var t,n=i.replace(/ /g,"").toLowerCase();if(n in zi)return zi[n].slice();if(n[0]==="#")return n.length===4?(t=parseInt(n.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:n.length===7&&(t=parseInt(n.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var o=n.indexOf("("),u=n.indexOf(")");if(o!==-1&&u+1===n.length){var d=n.substr(0,o),m=n.substr(o+1,u-(o+1)).split(","),v=1;switch(d){case"rgba":if(m.length!==4)return null;v=B(m.pop());case"rgb":return m.length!==3?null:[C(m[0]),C(m[1]),C(m[2]),v];case"hsla":if(m.length!==4)return null;v=B(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=B(m[1]),M=B(m[2]),D=M<=.5?M*(E+1):M+E-M*E,F=2*M-D;return[U(255*q(F,D,w+1/3)),U(255*q(F,D,w)),U(255*q(F,D,w-1/3)),v];default:return null}}return null}}catch{}class ${constructor(t,n,o,u=1){this.r=t,this.g=n,this.b=o,this.a=u}static parse(t){if(!t)return;if(t instanceof $)return t;if(typeof t!="string")return;const n=fs(t);return n?new $(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,o,u]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(o)},${u})`}toArray(){const{r:t,g:n,b:o,a:u}=this;return u===0?[0,0,0,0]:[255*t/u,255*n/u,255*o/u,u]}}$.black=new $(0,0,0,1),$.white=new $(1,1,1,1),$.transparent=new $(0,0,0,0),$.red=new $(1,0,0,1);class Q{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class st{constructor(t,n,o,u,d){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=d}}class it{constructor(t){this.sections=t}static fromString(t){return new it([new st(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof it?t:it.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class tt{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof tt)return t;if(typeof t=="number")return new tt([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new tt(t)}}toString(){return JSON.stringify(this.values)}}class at{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new at({name:t,available:!1}):null}}function xt(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function At(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof $||i instanceof Q||i instanceof it||i instanceof tt||i instanceof at)return!0;if(Array.isArray(i)){for(const t of i)if(!At(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!At(i[t]))return!1;return!0}return!1}function vt(i){if(i===null)return wr;if(typeof i=="string")return me;if(typeof i=="boolean")return ue;if(typeof i=="number")return Lt;if(i instanceof $)return wi;if(i instanceof Q)return rr;if(i instanceof it)return Ti;if(i instanceof tt)return ds;if(i instanceof at)return di;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const u=vt(o);if(n){if(n===u)continue;n=le;break}n=u}return qi(n||le,t)}return nr}function Ht(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof $||i instanceof it||i instanceof tt||i instanceof at?i.toString():JSON.stringify(i)}class Xt{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!At(t[1]))return n.error("invalid value");const o=t[1];let u=vt(o);const d=n.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new Xt(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ft{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ne={string:me,number:Lt,boolean:ue,object:nr};class se{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const d=t[0];if(d==="array"){let v,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in ne)||E==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=ne[E],u++}else v=le;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);w=t[2],u++}o=qi(v,w)}else{if(!ne[d])throw new Error(`Types doesn't contain name = ${d}`);o=ne[d]}const m=[];for(;u<t.length;u++){const v=n.parse(t[u],u,le);if(!v)return null;m.push(v)}return new se(o,m)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Nn(this.type,vt(o)))return o;if(n===this.args.length-1)throw new Ft(`Expected value to be of type ${Ue(this.type)}, but found ${Ue(vt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Me={"to-boolean":ue,"to-color":wi,"to-number":Lt,"to-string":me};class he{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Me[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=Me[o],d=[];for(let m=1;m<t.length;m++){const v=n.parse(t[m],m,le);if(!v)return null;d.push(v)}return new he(u,d)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof $)return n;if(typeof n=="string"){const d=t.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:xt(n[0],n[1],n[2],n[3]),!o))return new $(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Ft(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="padding"){let n;for(const o of this.args){n=o.evaluate(t);const u=tt.parse(n);if(u)return u}throw new Ft(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Ft(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?it.fromString(Ht(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?at.fromString(Ht(this.args[0].evaluate(t))):Ht(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const _e=["Unknown","Point","LineString","Polygon"];class we{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_e[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=$.parse(t)),n}}class Be{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=Be.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=m.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,M]of v){w=new Vn(n.registry,n.path,null,n.scope);const D=[];let F=!1;for(let V=1;V<t.length;V++){const G=t[V],J=Array.isArray(E)?E[V-1]:E.type,K=w.parse(G,1+D.length,J);if(!K){F=!0;break}D.push(K)}if(!F)if(Array.isArray(E)&&E.length!==D.length)w.error(`Expected ${E.length} arguments, but found ${D.length} instead.`);else{for(let V=0;V<D.length;V++){const G=Array.isArray(E)?E[V]:E.type,J=D[V];w.concat(V+1).checkSubtype(G,J.type)}if(w.errors.length===0)return new Be(o,d,M,D)}}if(v.length===1)n.errors.push(...w.errors);else{const E=(v.length?v:m).map(([D])=>{return F=D,Array.isArray(F)?`(${F.map(Ue).join(", ")})`:`(${Ue(F.type)}...)`;var F}).join(" | "),M=[];for(let D=1;D<t.length;D++){const F=n.parse(t[D],1+M.length);if(!F)return null;M.push(Ue(F.type))}n.error(`Expected arguments of type ${E}, but found (${M.join(", ")}) instead.`)}return null}static register(t,n){Be.definitions=n;for(const o in n)t[o]=Be}}class vi{constructor(t,n,o){this.type=rr,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ue);if(!u)return null;const d=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ue);if(!d)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,me),!m)?null:new vi(u,d,m)}evaluate(t){return new Q(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}const Ke=8192;function fi(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Ie(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function je(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*Ke),Math.round(o*u*Ke)]}function Oe(i,t,n){const o=i[0]-t[0],u=i[1]-t[1],d=i[0]-n[0],m=i[1]-n[1];return o*m-d*u==0&&o*d<=0&&u*m<=0}function Sr(i,t){let n=!1;for(let m=0,v=t.length;m<v;m++){const w=t[m];for(let E=0,M=w.length;E<M-1;E++){if(Oe(i,w[E],w[E+1]))return!1;(u=w[E])[1]>(o=i)[1]!=(d=w[E+1])[1]>o[1]&&o[0]<(d[0]-u[0])*(o[1]-u[1])/(d[1]-u[1])+u[0]&&(n=!n)}}var o,u,d;return n}function Ir(i,t){for(let n=0;n<t.length;n++)if(Sr(i,t[n]))return!0;return!1}function so(i,t,n,o){const u=o[0]-n[0],d=o[1]-n[1],m=(i[0]-n[0])*d-u*(i[1]-n[1]),v=(t[0]-n[0])*d-u*(t[1]-n[1]);return m>0&&v<0||m<0&&v>0}function ge(i,t,n){for(const E of n)for(let M=0;M<E.length-1;++M)if((v=[(m=E[M+1])[0]-(d=E[M])[0],m[1]-d[1]])[0]*(w=[(u=t)[0]-(o=i)[0],u[1]-o[1]])[1]-v[1]*w[0]!=0&&so(o,u,d,m)&&so(d,m,o,u))return!0;var o,u,d,m,v,w;return!1}function si(i,t){for(let n=0;n<i.length;++n)if(!Sr(i[n],t))return!1;for(let n=0;n<i.length-1;++n)if(ge(i[n],i[n+1],t))return!1;return!0}function ko(i,t){for(let n=0;n<t.length;n++)if(si(i,t[n]))return!0;return!1}function qr(i,t,n){const o=[];for(let u=0;u<i.length;u++){const d=[];for(let m=0;m<i[u].length;m++){const v=je(i[u][m],n);fi(t,v),d.push(v)}o.push(d)}return o}function Hi(i,t,n){const o=[];for(let u=0;u<i.length;u++){const d=qr(i[u],t,n);o.push(d)}return o}function sa(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let d=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;d===0&&(d=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=d}fi(t,i)}function Ps(i,t,n,o){const u=Math.pow(2,o.z)*Ke,d=[o.x*Ke,o.y*Ke],m=[];for(const v of i)for(const w of v){const E=[w.x+d[0],w.y+d[1]];sa(E,t,n,u),m.push(E)}return m}function Er(i,t,n,o){const u=Math.pow(2,o.z)*Ke,d=[o.x*Ke,o.y*Ke],m=[];for(const w of i){const E=[];for(const M of w){const D=[M.x+d[0],M.y+d[1]];fi(t,D),E.push(D)}m.push(E)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of m)for(const E of w)sa(E,t,n,u)}var v;return m}class Je{constructor(t,n){this.type=ue,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(At(t[1])){const o=t[1];if(o.type==="FeatureCollection")for(let u=0;u<o.features.length;++u){const d=o.features[u].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Je(o,o.features[u].geometry)}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Je(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Je(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const v=qr(o.coordinates,d,m),w=Ps(n.geometry(),u,d,m);if(!Ie(u,d))return!1;for(const E of w)if(!Sr(E,v))return!1}if(o.type==="MultiPolygon"){const v=Hi(o.coordinates,d,m),w=Ps(n.geometry(),u,d,m);if(!Ie(u,d))return!1;for(const E of w)if(!Ir(E,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const v=qr(o.coordinates,d,m),w=Er(n.geometry(),u,d,m);if(!Ie(u,d))return!1;for(const E of w)if(!si(E,v))return!1}if(o.type==="MultiPolygon"){const v=Hi(o.coordinates,d,m),w=Er(n.geometry(),u,d,m);if(!Ie(u,d))return!1;for(const E of w)if(!ko(E,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Pn(i){if(i instanceof Be&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Je)return!1;let t=!0;return i.eachChild(n=>{t&&!Pn(n)&&(t=!1)}),t}function Zn(i){if(i instanceof Be&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!Zn(n)&&(t=!1)}),t}function Pr(i,t){if(i instanceof Be&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!Pr(o,t)&&(n=!1)}),n}class ms{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new ms(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Vn{constructor(t,n=[],o,u=new Wi,d=[]){this.registry=t,this.path=n,this.key=n.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=d,this.expectedType=o}parse(t,n,o,u,d={}){return n?this.concat(n,o,u)._parse(t,d):this._parse(t,d)}_parse(t,n){function o(u,d,m){return m==="assert"?new se(d,[u]):m==="coerce"?new he(d,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let m=d.parse(t,this);if(!m)return null;if(this.expectedType){const v=this.expectedType,w=m.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(v.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array"){if(this.checkSubtype(v,w))return null}else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"coerce");else m=o(m,v,n.typeAnnotation||"assert")}if(!(m instanceof Xt)&&m.type.kind!=="resolvedImage"&&As(m)){const v=new we;try{m=new Xt(m.type,m.evaluate(v))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,d=o?this.scope.concat(o):this.scope;return new Vn(this.registry,u,n||null,d,this.errors)}error(t,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Gi(o,t))}checkSubtype(t,n){const o=Nn(t,n);return o&&this.error(o),o}}function As(i){if(i instanceof ms)return As(i.boundExpression);if(i instanceof Be&&i.name==="error"||i instanceof vi||i instanceof Je)return!1;const t=i instanceof he||i instanceof se;let n=!0;return i.eachChild(o=>{n=t?n&&As(o):n&&o instanceof Xt}),!!n&&Pn(i)&&Pr(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _s(i,t){const n=i.length-1;let o,u,d=0,m=n,v=0;for(;d<=m;)if(v=Math.floor((d+m)/2),o=i[v],u=i[v+1],o<=t){if(v===n||t<u)return v;d=v+1}else{if(!(o>t))throw new Ft("Input is not a number.");m=v-1}return 0}class Ar{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,d]of o)this.labels.push(u),this.outputs.push(d)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Lt);if(!o)return null;const u=[];let d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let m=1;m<t.length;m+=2){const v=m===1?-1/0:t[m],w=t[m+1],E=m,M=m+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const D=n.parse(w,M,d);if(!D)return null;d=d||D.type,u.push([v,D])}return new Ar(d,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const d=n.length;return u>=n[d-1]?o[d-1].evaluate(t):o[_s(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function We(i,t,n){return i*(1-n)+t*n}var $r=Object.freeze({__proto__:null,number:We,color:function(i,t,n){return new $(We(i.r,t.r,n),We(i.g,t.g,n),We(i.b,t.b,n),We(i.a,t.a,n))},array:function(i,t,n){return i.map((o,u)=>We(o,t[u],n))},padding:function(i,t,n){const o=i.values,u=t.values;return new tt([We(o[0],u[0],n),We(o[1],u[1],n),We(o[2],u[2],n),We(o[3],u[3],n)])}});const Cs=.95047,Do=1.08883,Ms=4/29,oo=6/29,fe=3*oo*oo,Gn=Math.PI/180,Ye=180/Math.PI;function ao(i){return i>.008856451679035631?Math.pow(i,1/3):i/fe+Ms}function zs(i){return i>oo?i*i*i:fe*(i-Ms)}function Ls(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ks(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function xe(i){const t=ks(i.r),n=ks(i.g),o=ks(i.b),u=ao((.4124564*t+.3575761*n+.1804375*o)/Cs),d=ao((.2126729*t+.7151522*n+.072175*o)/1);return{l:116*d-16,a:500*(u-d),b:200*(d-ao((.0193339*t+.119192*n+.9503041*o)/Do)),alpha:i.a}}function lo(i){let t=(i.l+16)/116,n=isNaN(i.a)?t:t+i.a/500,o=isNaN(i.b)?t:t-i.b/200;return t=1*zs(t),n=Cs*zs(n),o=Do*zs(o),new $(Ls(3.2404542*n-1.5371385*t-.4985314*o),Ls(-.969266*n+1.8760108*t+.041556*o),Ls(.0556434*n-.2040259*t+1.0572252*o),i.alpha)}function Ds(i,t,n){const o=t-i;return i+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const hi={forward:xe,reverse:lo,interpolate:function(i,t,n){return{l:We(i.l,t.l,n),a:We(i.a,t.a,n),b:We(i.b,t.b,n),alpha:We(i.alpha,t.alpha,n)}}},An={forward:function(i){const{l:t,a:n,b:o}=xe(i),u=Math.atan2(o,n)*Ye;return{h:u<0?u+360:u,c:Math.sqrt(n*n+o*o),l:t,alpha:i.a}},reverse:function(i){const t=i.h*Gn,n=i.c;return lo({l:i.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:i.alpha})},interpolate:function(i,t,n){return{h:Ds(i.h,t.h,n),c:We(i.c,t.c,n),l:We(i.l,t.l,n),alpha:We(i.alpha,t.alpha,n)}}};var Bo=Object.freeze({__proto__:null,lab:hi,hcl:An});class Xi{constructor(t,n,o,u,d){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,v]of d)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(t,n,o,u){let d=0;if(t.name==="exponential")d=Ro(n,t.base,o,u);else if(t.name==="linear")d=Ro(n,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;d=new Pt(m[0],m[1],m[2],m[3]).solve(Ro(n,1,o,u))}return d}static parse(t,n){let[o,u,d,...m]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some(M=>typeof M!="number"||M<0||M>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,Lt),!d)return null;const v=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=wi:n.expectedType&&n.expectedType.kind!=="value"&&(w=n.expectedType);for(let E=0;E<m.length;E+=2){const M=m[E],D=m[E+1],F=E+3,V=E+4;if(typeof M!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(v.length&&v[v.length-1][0]>=M)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const G=n.parse(D,V,w);if(!G)return null;w=w||G.type,v.push([M,G])}return w.kind==="number"||w.kind==="color"||w.kind==="padding"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Xi(w,o,u,d,v):n.error(`Type ${Ue(w)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const d=n.length;if(u>=n[d-1])return o[d-1].evaluate(t);const m=_s(n,u),v=Xi.interpolationFactor(this.interpolation,u,n[m],n[m+1]),w=o[m].evaluate(t),E=o[m+1].evaluate(t);return this.operator==="interpolate"?$r[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?An.reverse(An.interpolate(An.forward(w),An.forward(E),v)):hi.reverse(hi.interpolate(hi.forward(w),hi.forward(E),v))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ro(i,t,n,o){const u=o-n,d=i-n;return u===0?0:t===1?d/u:(Math.pow(t,d)-1)/(Math.pow(t,u)-1)}class Bs{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const d=[];for(const v of t.slice(1)){const w=n.parse(v,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,d.push(w)}if(!o)throw new Error("No output type");const m=u&&d.some(v=>Nn(u,v.type));return new Bs(m?le:o,d)}evaluate(t){let n,o=null,u=0;for(const d of this.args)if(u++,o=d.evaluate(t),o&&o instanceof at&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}class gs{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let d=1;d<t.length-1;d+=2){const m=t[d];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const v=n.parse(t[d+1],d+1);if(!v)return null;o.push([m,v])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new gs(o,u):null}outputDefined(){return this.result.outputDefined()}}class Oo{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Lt),u=n.parse(t[2],2,qi(n.expectedType||le));return o&&u?new Oo(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new Ft(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Ft(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Ft(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ho{constructor(t,n){this.type=ue,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,le),u=n.parse(t[2],2,le);return o&&u?Vr(o.type,[ue,me,Lt,wr,le])?new ho(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Gr(n,["boolean","string","number","null"]))throw new Ft(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(vt(n))} instead.`);if(!Gr(o,["string","array"]))throw new Ft(`Expected second argument to be of type array or string, but found ${Ue(vt(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ee{constructor(t,n,o){this.type=Lt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,le),u=n.parse(t[2],2,le);if(!o||!u)return null;if(!Vr(o.type,[ue,me,Lt,wr,le]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(o.type)} instead`);if(t.length===4){const d=n.parse(t[3],3,Lt);return d?new Ee(o,u,d):null}return new Ee(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Gr(n,["boolean","string","number","null"]))throw new Ft(`Expected first argument to be of type boolean, string, number or null, but found ${Ue(vt(n))} instead.`);if(!Gr(o,["string","array"]))throw new Ft(`Expected second argument to be of type array or string, but found ${Ue(vt(o))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(t);return o.indexOf(n,u)}return o.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Fo{constructor(t,n,o,u,d,m){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=d,this.otherwise=m}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const d={},m=[];for(let E=2;E<t.length-1;E+=2){let M=t[E];const D=t[E+1];Array.isArray(M)||(M=[M]);const F=n.concat(E);if(M.length===0)return F.error("Expected at least one branch label.");for(const G of M){if(typeof G!="number"&&typeof G!="string")return F.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return F.error("Numeric branch labels must be integer values.");if(o){if(F.checkSubtype(o,vt(G)))return null}else o=vt(G);if(d[String(G)]!==void 0)return F.error("Branch labels must be unique.");d[String(G)]=m.length}const V=n.parse(D,E,u);if(!V)return null;u=u||V.type,m.push(V)}const v=n.parse(t[1],1,le);if(!v)return null;const w=n.parse(t[t.length-1],t.length-1,u);return w?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new Fo(o,u,v,d,m,w):null}evaluate(t){const n=this.input.evaluate(t);return(vt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ln{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const v=n.parse(t[m],m,ue);if(!v)return null;const w=n.parse(t[m+1],m+1,o);if(!w)return null;u.push([v,w]),o=o||w.type}const d=n.parse(t[t.length-1],t.length-1,o);if(!d)return null;if(!o)throw new Error("Can't infer output type");return new ln(o,u,d)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Cr{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,le),u=n.parse(t[2],2,Lt);if(!o||!u)return null;if(!Vr(o.type,[qi(le),me,le]))return n.error(`Expected first argument to be of type array or string, but found ${Ue(o.type)} instead`);if(t.length===4){const d=n.parse(t[3],3,Lt);return d?new Cr(o.type,o,u,d):null}return new Cr(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);if(!Gr(n,["string","array"]))throw new Ft(`Expected first argument to be of type array or string, but found ${Ue(vt(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(t);return n.slice(o,u)}return n.slice(o)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Uo(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function oa(i,t,n,o){return o.compare(t,n)===0}function Mr(i,t,n){const o=i!=="=="&&i!=="!=";return class Yu{constructor(d,m,v){this.type=ue,this.lhs=d,this.rhs=m,this.collator=v,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const v=d[0];let w=m.parse(d[1],1,le);if(!w)return null;if(!Uo(v,w.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Ue(w.type)}'.`);let E=m.parse(d[2],2,le);if(!E)return null;if(!Uo(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Ue(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Ue(w.type)}' and '${Ue(E.type)}'.`);o&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new se(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new se(w.type,[E])));let M=null;if(d.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(d[3],3,rr),!M)return null}return new Yu(w,E,M)}evaluate(d){const m=this.lhs.evaluate(d),v=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const w=vt(m),E=vt(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new Ft(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=vt(m),E=vt(v);if(w.kind!=="string"||E.kind!=="string")return t(d,m,v)}return this.collator?n(d,m,v,this.collator.evaluate(d)):t(d,m,v)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Ca=Mr("==",function(i,t,n){return t===n},oa),aa=Mr("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!oa(0,t,n,o)}),Ma=Mr("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),za=Mr(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),No=Mr("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),La=Mr(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class vn{constructor(t,n,o,u,d){this.type=me,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Lt);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=n.parse(u.locale,1,me),!d))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,me),!m))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,Lt),!v))return null;let w=null;return u["max-fraction-digits"]&&(w=n.parse(u["max-fraction-digits"],1,Lt),!w)?null:new vn(o,d,m,v,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class co{constructor(t){this.type=Ti,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let d=!1;for(let m=1;m<=t.length-1;++m){const v=t[m];if(d&&typeof v=="object"&&!Array.isArray(v)){d=!1;let w=null;if(v["font-scale"]&&(w=n.parse(v["font-scale"],1,Lt),!w))return null;let E=null;if(v["text-font"]&&(E=n.parse(v["text-font"],1,qi(me)),!E))return null;let M=null;if(v["text-color"]&&(M=n.parse(v["text-color"],1,wi),!M))return null;const D=u[u.length-1];D.scale=w,D.font=E,D.textColor=M}else{const w=n.parse(t[m],1,le);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new co(u)}evaluate(t){return new it(this.sections.map(n=>{const o=n.content.evaluate(t);return vt(o)===di?new st("",o,null,null,null):new st(Ht(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class uo{constructor(t){this.type=di,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,me);return o?new uo(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=at.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class qn{constructor(t){this.type=Lt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Ue(o.type)} instead.`):new qn(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Ft(`Expected value to be of type string or array, but found ${Ue(vt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const jr={"==":Ca,"!=":aa,">":za,"<":Ma,">=":La,"<=":No,array:se,at:Oo,boolean:se,case:ln,coalesce:Bs,collator:vi,format:co,image:uo,in:ho,"index-of":Ee,interpolate:Xi,"interpolate-hcl":Xi,"interpolate-lab":Xi,length:qn,let:gs,literal:Xt,match:Fo,number:se,"number-format":vn,object:se,slice:Cr,step:Ar,string:se,"to-boolean":he,"to-color":he,"to-number":he,"to-string":he,var:ms,within:Je};function Zo(i,[t,n,o,u]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const d=u?u.evaluate(i):1,m=xt(t,n,o,d);if(m)throw new Ft(m);return new $(t/255*d,n/255*d,o/255*d,d)}function la(i,t){return i in t}function po(i,t){const n=t[i];return n===void 0?null:n}function sr(i){return{type:i}}function ha(i){return{result:"success",value:i}}function Wr(i){return{result:"error",value:i}}function He(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Rs(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function pe(i){return!!i.expression&&i.expression.interpolated}function Re(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Fe(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function ze(i){return i}function ys(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),d=i.type||(pe(t)?"exponential":"interval");if(n||t.type==="padding"){const E=n?$.parse:tt.parse;(i=yn({},i)).stops&&(i.stops=i.stops.map(M=>[M[0],E(M[1])])),i.default=E(i.default?i.default:t.default)}if(i.colorSpace&&i.colorSpace!=="rgb"&&!Bo[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,w;if(d==="exponential")m=Vo;else if(d==="interval")m=ca;else if(d==="categorical"){m=ka,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];w=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=Da}if(o){const E={},M=[];for(let V=0;V<i.stops.length;V++){const G=i.stops[V],J=G[0].zoom;E[J]===void 0&&(E[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},M.push(J)),E[J].stops.push([G[0].value,G[1]])}const D=[];for(const V of M)D.push([E[V].zoom,ys(E[V],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Xi.interpolationFactor.bind(void 0,F),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},G)=>Vo({stops:D,base:i.base},t,V).evaluate(V,G)}}if(u){const E=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Xi.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>m(i,t,M,v,w)}}return{kind:"source",evaluate(E,M){const D=M&&M.properties?M.properties[i.property]:void 0;return D===void 0?Hr(i.default,t.default):m(i,t,D,v,w)}}}function Hr(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function ka(i,t,n,o,u){return Hr(typeof n===u?o[n]:void 0,i.default,t.default)}function ca(i,t,n){if(Re(n)!=="number")return Hr(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=_s(i.stops.map(d=>d[0]),n);return i.stops[u][1]}function Vo(i,t,n){const o=i.base!==void 0?i.base:1;if(Re(n)!=="number")return Hr(i.default,t.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const d=_s(i.stops.map(M=>M[0]),n),m=function(M,D,F,V){const G=V-F,J=M-F;return G===0?0:D===1?J/G:(Math.pow(D,J)-1)/(Math.pow(D,G)-1)}(n,o,i.stops[d][0],i.stops[d+1][0]),v=i.stops[d][1],w=i.stops[d+1][1];let E=$r[t.type]||ze;if(i.colorSpace&&i.colorSpace!=="rgb"){const M=Bo[i.colorSpace];E=(D,F)=>M.reverse(M.interpolate(M.forward(D),M.forward(F),m))}return typeof v.evaluate=="function"?{evaluate(...M){const D=v.evaluate.apply(void 0,M),F=w.evaluate.apply(void 0,M);if(D!==void 0&&F!==void 0)return E(D,F,m)}}:E(v,w,m)}function Da(i,t,n){switch(t.type){case"color":n=$.parse(n);break;case"formatted":n=it.fromString(n.toString());break;case"resolvedImage":n=at.fromString(n.toString());break;case"padding":n=tt.parse(n);break;default:Re(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Hr(n,i.default,t.default)}Be.register(jr,{error:[{kind:"error"},[me],(i,[t])=>{throw new Ft(t.evaluate(i))}],typeof:[me,[le],(i,[t])=>Ue(vt(t.evaluate(i)))],"to-rgba":[qi(Lt,4),[wi],(i,[t])=>t.evaluate(i).toArray()],rgb:[wi,[Lt,Lt,Lt],Zo],rgba:[wi,[Lt,Lt,Lt,Lt],Zo],has:{type:ue,overloads:[[[me],(i,[t])=>la(t.evaluate(i),i.properties())],[[me,nr],(i,[t,n])=>la(t.evaluate(i),n.evaluate(i))]]},get:{type:le,overloads:[[[me],(i,[t])=>po(t.evaluate(i),i.properties())],[[me,nr],(i,[t,n])=>po(t.evaluate(i),n.evaluate(i))]]},"feature-state":[le,[me],(i,[t])=>po(t.evaluate(i),i.featureState||{})],properties:[nr,[],i=>i.properties()],"geometry-type":[me,[],i=>i.geometryType()],id:[le,[],i=>i.id()],zoom:[Lt,[],i=>i.globals.zoom],"heatmap-density":[Lt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Lt,[],i=>i.globals.lineProgress||0],accumulated:[le,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Lt,sr(Lt),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[Lt,sr(Lt),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:Lt,overloads:[[[Lt,Lt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[Lt],(i,[t])=>-t.evaluate(i)]]},"/":[Lt,[Lt,Lt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[Lt,[Lt,Lt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[Lt,[Lt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Lt,[Lt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Lt,[Lt],(i,[t])=>Math.log(t.evaluate(i))],log2:[Lt,[Lt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Lt,[Lt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Lt,[Lt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Lt,[Lt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Lt,[Lt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Lt,[Lt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Lt,[Lt],(i,[t])=>Math.atan(t.evaluate(i))],min:[Lt,sr(Lt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[Lt,sr(Lt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[Lt,[Lt],(i,[t])=>Math.abs(t.evaluate(i))],round:[Lt,[Lt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Lt,[Lt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Lt,[Lt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[ue,[me,le],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[ue,[le],(i,[t])=>i.id()===t.value],"filter-type-==":[ue,[me],(i,[t])=>i.geometryType()===t.value],"filter-<":[ue,[me,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[ue,[me,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[ue,[me,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[ue,[me,le],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[ue,[le],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[ue,[le],(i,[t])=>t.value in i.properties()],"filter-has-id":[ue,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ue,[qi(me)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[ue,[qi(le)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[ue,[me,qi(le)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[ue,[me,qi(le)],(i,[t,n])=>function(o,u,d,m){for(;d<=m;){const v=d+m>>1;if(u[v]===o)return!0;u[v]>o?m=v-1:d=v+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:ue,overloads:[[[ue,ue],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[sr(ue),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ue,overloads:[[[ue,ue],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[sr(ue),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[ue,[ue],(i,[t])=>!t.evaluate(i)],"is-supported-script":[ue,[me],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[me,[me],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[me,[me],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[me,sr(le),(i,t)=>t.map(n=>Ht(n.evaluate(i))).join("")],"resolved-locale":[me,[rr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class vs{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new we,this._defaultValue=n?function(o){return o.type==="color"&&Fe(o.default)?new $(0,0,0,0):o.type==="color"?$.parse(o.default)||null:o.type==="padding"?tt.parse(o.default)||null:o.default===void 0?null:o.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,u,d,m){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,d,m){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Ft(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Xr(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in jr}function Os(i,t){const n=new Vn(jr,[],t?function(u){const d={color:wi,string:me,number:Lt,enum:me,boolean:ue,formatted:Ti,padding:ds,resolvedImage:di};return u.type==="array"?qi(d[u.value]||le,u.length):d[u.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ha(new vs(o,t)):Wr(n.errors)}class Fs{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Zn(n.expression)}evaluateWithoutErrorHandling(t,n,o,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,d,m)}evaluate(t,n,o,u,d,m){return this._styleExpression.evaluate(t,n,o,u,d,m)}}class fo{constructor(t,n,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Zn(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,n,o,u,d,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,d,m)}evaluate(t,n,o,u,d,m){return this._styleExpression.evaluate(t,n,o,u,d,m)}interpolationFactor(t,n,o){return this.interpolationType?Xi.interpolationFactor(this.interpolationType,t,n,o):0}}function ua(i,t){const n=Os(i,t);if(n.result==="error")return n;const o=n.value.expression,u=Pn(o);if(!u&&!He(t))return Wr([new Gi("","data expressions not supported")]);const d=Pr(o,["zoom"]);if(!d&&!Rs(t))return Wr([new Gi("","zoom expressions not supported")]);const m=or(o);return m||d?m instanceof Gi?Wr([m]):m instanceof Xi&&!pe(t)?Wr([new Gi("",'"interpolate" expressions cannot be used with this property')]):ha(m?new fo(u?"camera":"composite",n.value,m.labels,m instanceof Xi?m.interpolation:void 0):new Fs(u?"constant":"source",n.value)):Wr([new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ki{constructor(t,n){this._parameters=t,this._specification=n,yn(this,ys(this._parameters,this._specification))}static deserialize(t){return new Ki(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function or(i){let t=null;if(i instanceof gs)t=or(i.result);else if(i instanceof Bs){for(const n of i.args)if(t=or(n),t)break}else(i instanceof Ar||i instanceof Xi)&&i.input instanceof Be&&i.input.name==="zoom"&&(t=i);return t instanceof Gi||i.eachChild(n=>{const o=or(n);o instanceof Gi?t=o:!t&&o?t=new Gi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Gi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Cn(i){const t=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},d=i.style,m=i.styleSpec;let v=[];const w=Re(n);if(w!=="object")return[new Bt(t,n,`object expected, ${w} found`)];for(const E in n){const M=E.split(".")[0],D=o[M]||o["*"];let F;if(u[M])F=u[M];else if(o[M])F=Ji;else if(u["*"])F=u["*"];else{if(!o["*"]){v.push(new Bt(t,n[E],`unknown property "${E}"`));continue}F=Ji}v=v.concat(F({key:(t&&`${t}.`)+E,value:n[E],valueSpec:D,style:d,styleSpec:m,object:n,objectKey:E},n))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&n[E]===void 0&&v.push(new Bt(t,n,`missing required property "${E}"`));return v}function zr(i){const t=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,d=i.key,m=i.arrayElementValidator||Ji;if(Re(t)!=="array")return[new Bt(d,t,`array expected, ${Re(t)} found`)];if(n.length&&t.length!==n.length)return[new Bt(d,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Bt(d,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};u.$version<7&&(v.function=n.function),Re(n.value)==="object"&&(v=n.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(m({array:t,arrayIndex:E,value:t[E],valueSpec:v,style:o,styleSpec:u,key:`${d}[${E}]`}));return w}function Go(i){const t=i.key,n=i.value,o=i.valueSpec;let u=Re(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Bt(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Bt(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Bt(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Kr(i){const t=i.valueSpec,n=Ce(i.value.type);let o,u,d,m={};const v=n!=="categorical"&&i.value.property===void 0,w=!v,E=Re(i.value.stops)==="array"&&Re(i.value.stops[0])==="array"&&Re(i.value.stops[0][0])==="object",M=Cn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(V){if(n==="identity")return[new Bt(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const J=V.value;return G=G.concat(zr({key:V.key,value:J,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:D})),Re(J)==="array"&&J.length===0&&G.push(new Bt(V.key,J,"array must have at least one stop")),G},default:function(V){return Ji({key:V.key,value:V.value,valueSpec:t,style:V.style,styleSpec:V.styleSpec})}}});return n==="identity"&&v&&M.push(new Bt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||M.push(new Bt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!pe(i.valueSpec)&&M.push(new Bt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!He(i.valueSpec)?M.push(new Bt(i.key,i.value,"property functions not supported")):v&&!Rs(i.valueSpec)&&M.push(new Bt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!E||i.value.property!==void 0||M.push(new Bt(i.key,i.value,'"property" property is required')),M;function D(V){let G=[];const J=V.value,K=V.key;if(Re(J)!=="array")return[new Bt(K,J,`array expected, ${Re(J)} found`)];if(J.length!==2)return[new Bt(K,J,`array length 2 expected, length ${J.length} found`)];if(E){if(Re(J[0])!=="object")return[new Bt(K,J,`object expected, ${Re(J[0])} found`)];if(J[0].zoom===void 0)return[new Bt(K,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new Bt(K,J,"object stop key must have value")];if(d&&d>Ce(J[0].zoom))return[new Bt(K,J[0].zoom,"stop zoom values must appear in ascending order")];Ce(J[0].zoom)!==d&&(d=Ce(J[0].zoom),u=void 0,m={}),G=G.concat(Cn({key:`${K}[0]`,value:J[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Go,value:F}}))}else G=G.concat(F({key:`${K}[0]`,value:J[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},J));return Xr(an(J[1]))?G.concat([new Bt(`${K}[1]`,J[1],"expressions are not allowed in function stops.")]):G.concat(Ji({key:`${K}[1]`,value:J[1],valueSpec:t,style:V.style,styleSpec:V.styleSpec}))}function F(V,G){const J=Re(V.value),K=Ce(V.value),ut=V.value!==null?V.value:G;if(o){if(J!==o)return[new Bt(V.key,ut,`${J} stop domain type must match previous stop domain type ${o}`)]}else o=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new Bt(V.key,ut,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&n!=="categorical"){let gt=`number expected, ${J} found`;return He(t)&&n===void 0&&(gt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Bt(V.key,ut,gt)]}return n!=="categorical"||J!=="number"||isFinite(K)&&Math.floor(K)===K?n!=="categorical"&&J==="number"&&u!==void 0&&K<u?[new Bt(V.key,ut,"stop domain values must appear in ascending order")]:(u=K,n==="categorical"&&K in m?[new Bt(V.key,ut,"stop domain values must be unique")]:(m[K]=!0,[])):[new Bt(V.key,ut,`integer expected, found ${K}`)]}}function Jr(i){const t=(i.expressionContext==="property"?ua:Os)(an(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Bt(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Bt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Zn(n))return[new Bt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Zn(n))return[new Bt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Pr(n,["zoom","feature-state"]))return[new Bt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Pn(n))return[new Bt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ar(i){const t=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Ce(n))===-1&&u.push(new Bt(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ce(n))===-1&&u.push(new Bt(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function Yr(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Yr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const mo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function _o(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Yr(i)||(i=Ns(i));const t=Os(i,mo);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,u)=>t.value.evaluate(n,o,{},u),needGeometry:Us(i)}}function lr(i,t){return i<t?-1:i>t?1:0}function Us(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(Us(i[t]))return!0;return!1}function Ns(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Zs(i[1],i[2],"=="):t==="!="?xs(Zs(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Zs(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(Ns))):t==="all"?["all"].concat(i.slice(1).map(Ns)):t==="none"?["all"].concat(i.slice(1).map(Ns).map(xs)):t==="in"?go(i[1],i.slice(2)):t==="!in"?xs(go(i[1],i.slice(2))):t==="has"?hn(i[1]):t==="!has"?xs(hn(i[1])):t!=="within"||i;var n}function Zs(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function go(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(lr)]]:["filter-in-small",i,["literal",t]]}}function hn(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function xs(i){return["!",i]}function $n(i){return Yr(an(i.value))?Jr(yn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pa(i)}function pa(i){const t=i.value,n=i.key;if(Re(t)!=="array")return[new Bt(n,t,`array expected, ${Re(t)} found`)];const o=i.styleSpec;let u,d=[];if(t.length<1)return[new Bt(n,t,"filter array must have at least 1 element")];switch(d=d.concat(ar({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ce(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ce(t[1])==="$type"&&d.push(new Bt(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&d.push(new Bt(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Re(t[1]),u!=="string"&&d.push(new Bt(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=Re(t[m]),Ce(t[1])==="$type"?d=d.concat(ar({key:`${n}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new Bt(`${n}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)d=d.concat(pa({key:`${n}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=Re(t[1]),t.length!==2?d.push(new Bt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new Bt(`${n}[1]`,t[1],`string expected, ${u} found`));break;case"within":u=Re(t[1]),t.length!==2?d.push(new Bt(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="object"&&d.push(new Bt(`${n}[1]`,t[1],`object expected, ${u} found`))}return d}function cn(i,t){const n=i.key,o=i.style,u=i.styleSpec,d=i.value,m=i.objectKey,v=u[`${t}_${i.layerType}`];if(!v)return[];const w=m.match(/^(.*)-transition$/);if(t==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return Ji({key:n,value:d,valueSpec:u.transition,style:o,styleSpec:u});const E=i.valueSpec||v[m];if(!E)return[new Bt(n,d,`unknown property "${m}"`)];let M;if(Re(d)==="string"&&He(E)&&!E.tokens&&(M=/^{([^}]+)}$/.exec(d)))return[new Bt(n,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(m==="text-field"&&o&&!o.glyphs&&D.push(new Bt(n,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&Fe(an(d))&&Ce(d.type)==="identity"&&D.push(new Bt(n,d,'"text-font" does not support identity functions'))),D.concat(Ji({key:i.key,value:d,valueSpec:E,style:o,styleSpec:u,expressionContext:"property",propertyType:t,propertyKey:m}))}function Vs(i){return cn(i,"paint")}function qo(i){return cn(i,"layout")}function yo(i){let t=[];const n=i.value,o=i.key,u=i.style,d=i.styleSpec;n.type||n.ref||t.push(new Bt(o,n,'either "type" or "ref" is required'));let m=Ce(n.type);const v=Ce(n.ref);if(n.id){const w=Ce(n.id);for(let E=0;E<i.arrayIndex;E++){const M=u.layers[E];Ce(M.id)===w&&t.push(new Bt(o,n.id,`duplicate layer id "${n.id}", previously used at line ${M.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&t.push(new Bt(o,n[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{Ce(E.id)===v&&(w=E)}),w?w.ref?t.push(new Bt(o,n.ref,"ref cannot reference another ref layer")):m=Ce(w.type):t.push(new Bt(o,n.ref,`ref layer "${v}" not found`))}else if(m!=="background")if(n.source){const w=u.sources&&u.sources[n.source],E=w&&Ce(w.type);w?E==="vector"&&m==="raster"?t.push(new Bt(o,n.source,`layer "${n.id}" requires a raster source`)):E==="raster"&&m!=="raster"?t.push(new Bt(o,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&m!=="hillshade"?t.push(new Bt(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||E==="geojson"&&w.lineMetrics||t.push(new Bt(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Bt(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Bt(o,n.source,`source "${n.source}" not found`))}else t.push(new Bt(o,n,'missing required property "source"'));return t=t.concat(Cn({key:o,value:n,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ji({key:`${o}.type`,value:n.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:$n,layout:w=>Cn({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>qo(yn({layerType:m},E))}}),paint:w=>Cn({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Vs(yn({layerType:m},E))}})}})),t}function hr(i){const t=i.value,n=i.key,o=Re(t);return o!=="string"?[new Bt(n,t,`string expected, ${o} found`)]:[]}const vo={promoteId:function({key:i,value:t}){if(Re(t)==="string")return hr({key:i,value:t});{const n=[];for(const o in t)n.push(...hr({key:`${i}.${o}`,value:t[o]}));return n}}};function Lr(i){const t=i.value,n=i.key,o=i.styleSpec,u=i.style;if(!t.type)return[new Bt(n,t,'"type" is required')];const d=Ce(t.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=Cn({key:n,value:t,valueSpec:o[`source_${d.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:vo}),m;case"geojson":if(m=Cn({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,objectElementValidators:vo}),t.cluster)for(const v in t.clusterProperties){const[w,E]=t.clusterProperties[v],M=typeof w=="string"?[w,["accumulated"],["get",v]]:w;m.push(...Jr({key:`${n}.${v}.map`,value:E,expressionContext:"cluster-map"})),m.push(...Jr({key:`${n}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return m;case"video":return Cn({key:n,value:t,valueSpec:o.source_video,style:u,styleSpec:o});case"image":return Cn({key:n,value:t,valueSpec:o.source_image,style:u,styleSpec:o});case"canvas":return[new Bt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ar({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:o})}}function jn(i){const t=i.value,n=i.styleSpec,o=n.light,u=i.style;let d=[];const m=Re(t);if(t===void 0)return d;if(m!=="object")return d=d.concat([new Bt("light",t,`object expected, ${m} found`)]),d;for(const v in t){const w=v.match(/^(.*)-transition$/);d=d.concat(w&&o[w[1]]&&o[w[1]].transition?Ji({key:v,value:t[v],valueSpec:n.transition,style:u,styleSpec:n}):o[v]?Ji({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Bt(v,t[v],`unknown property "${v}"`)])}return d}function Li(i){const t=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let d=[];const m=Re(t);if(t===void 0)return d;if(m!=="object")return d=d.concat([new Bt("terrain",t,`object expected, ${m} found`)]),d;for(const v in t)d=d.concat(o[v]?Ji({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Bt(v,t[v],`unknown property "${v}"`)]);return d}const Qr={"*":()=>[],array:zr,boolean:function(i){const t=i.value,n=i.key,o=Re(t);return o!=="boolean"?[new Bt(n,t,`boolean expected, ${o} found`)]:[]},number:Go,color:function(i){const t=i.key,n=i.value,o=Re(n);return o!=="string"?[new Bt(t,n,`color expected, ${o} found`)]:fs(n)===null?[new Bt(t,n,`color expected, "${n}" found`)]:[]},constants:br,enum:ar,filter:$n,function:Kr,layer:yo,object:Cn,source:Lr,light:jn,terrain:Li,string:hr,formatted:function(i){return hr(i).length===0?[]:Jr(i)},resolvedImage:function(i){return hr(i).length===0?[]:Jr(i)},padding:function(i){const t=i.key,n=i.value;if(Re(n)==="array"){if(n.length<1||n.length>4)return[new Bt(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let d=0;d<n.length;d++)u=u.concat(Ji({key:`${t}[${d}]`,value:n[d],valueSpec:o}));return u}return Go({key:t,value:n,valueSpec:{}})}};function Ji(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return n.expression&&Fe(Ce(t))?Kr(i):n.expression&&Xr(an(t))?Jr(i):n.type&&Qr[n.type]?Qr[n.type](i):Cn(yn({},i,{valueSpec:n.type?o[n.type]:n}))}function Ba(i){const t=i.value,n=i.key,o=hr(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Bt(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Bt(n,t,'"glyphs" url must include a "{range}" token'))),o}function Mn(i,t=wt){let n=[];return n=n.concat(Ji({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:Ba,"*":()=>[]}})),i.constants&&(n=n.concat(br({key:"constants",value:i.constants,style:i,styleSpec:t}))),da(n)}function da(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Wn(i){return function(...t){return da(i.apply(this,t))}}Mn.source=Wn(Lr),Mn.light=Wn(jn),Mn.terrain=Wn(Li),Mn.layer=Wn(yo),Mn.filter=Wn($n),Mn.paintProperty=Wn(Vs),Mn.layoutProperty=Wn(qo);const Gs=Mn,xo=Gs.light,Ra=Gs.paintProperty,Hn=Gs.layoutProperty;function ts(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new xr(new Error(o.message))),n=!0;return n}class qs{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(n=m[1])+2*(o=m[2]);for(let w=0;w<this.d*this.d;w++){const E=m[3+w],M=m[3+w+1];u.push(E===M?null:m.subarray(E,M))}const v=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],v),this.bboxes=m.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const d=o/n*t;this.min=-d,this.max=t+d}insert(t,n,o,u,d){this._forEachCell(n,o,u,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,d,m){this.cells[d].push(m)}query(t,n,o,u,d){const m=this.min,v=this.max;if(t<=m&&n<=m&&v<=o&&v<=u&&!d)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,n,o,u,this._queryCell,w,{},d),w}}_queryCell(t,n,o,u,d,m,v,w){const E=this.cells[d];if(E!==null){const M=this.keys,D=this.bboxes;for(let F=0;F<E.length;F++){const V=E[F];if(v[V]===void 0){const G=4*V;(w?w(D[G+0],D[G+1],D[G+2],D[G+3]):t<=D[G+2]&&n<=D[G+3]&&o>=D[G+0]&&u>=D[G+1])?(v[V]=!0,m.push(M[V])):v[V]=!1}}}}_forEachCell(t,n,o,u,d,m,v,w){const E=this._convertToCellCoord(t),M=this._convertToCellCoord(n),D=this._convertToCellCoord(o),F=this._convertToCellCoord(u);for(let V=E;V<=D;V++)for(let G=M;G<=F;G++){const J=this.d*G+V;if((!w||w(this._convertFromCellCoord(V),this._convertFromCellCoord(G),this._convertFromCellCoord(V+1),this._convertFromCellCoord(G+1)))&&d.call(this,t,n,o,u,J,m,v,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let d=n;for(let m=0;m<t.length;m++){const v=t[m];u[3+m]=d,u.set(v,d),d+=v.length}return u[3+t.length]=d,u.set(this.keys,d),d+=this.keys.length,u[3+t.length+1]=d,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new qs(t.buffer)}}const xn={};function qt(i,t,n={}){if(xn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),xn[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}qt("Object",Object),qt("TransferableGridIndex",qs),qt("Color",$),qt("Error",Error),qt("AJAXError",Vi),qt("ResolvedImage",at),qt("StylePropertyFunction",Ki),qt("StyleExpression",vs,{omit:["_evaluator"]}),qt("ZoomDependentExpression",fo),qt("ZoomConstantExpression",Fs),qt("CompoundExpression",Be,{omit:["_evaluate"]});for(const i in jr)jr[i]._classRegistryKey||qt(`Expression_${i}`,jr[i]);function $o(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function es(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if($o(i)||Ci(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return t&&t.push(n.buffer),n}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(es(o,t));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");if(!xn[o])throw new Error(`${o} is not registered.`);const u=n.serialize?n.serialize(i,t):{};if(n.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in i){if(!i.hasOwnProperty(d)||xn[o].omit.indexOf(d)>=0)continue;const m=i[d];u[d]=xn[o].shallow.indexOf(d)>=0?m:es(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(u.$name=o),u}throw new Error("can't serialize object of type "+typeof i)}function bn(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||$o(i)||Ci(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(bn);if(typeof i=="object"){const t=i.$name||"Object";if(!xn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=xn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const d=i[u];o[u]=xn[t].shallow.indexOf(u)>=0?d:bn(d)}return o}throw new Error("can't deserialize object of type "+typeof i)}class jo{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const Dt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function $s(i){for(const t of i)if(zn(t.charCodeAt(0)))return!0;return!1}function fa(i){for(const t of i)if(!Wo(t.charCodeAt(0)))return!1;return!0}function Wo(i){return!(Dt.Arabic(i)||Dt["Arabic Supplement"](i)||Dt["Arabic Extended-A"](i)||Dt["Arabic Presentation Forms-A"](i)||Dt["Arabic Presentation Forms-B"](i))}function zn(i){return!(i!==746&&i!==747&&(i<4352||!(Dt["Bopomofo Extended"](i)||Dt.Bopomofo(i)||Dt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Dt["CJK Compatibility Ideographs"](i)||Dt["CJK Compatibility"](i)||Dt["CJK Radicals Supplement"](i)||Dt["CJK Strokes"](i)||!(!Dt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Dt["CJK Unified Ideographs Extension A"](i)||Dt["CJK Unified Ideographs"](i)||Dt["Enclosed CJK Letters and Months"](i)||Dt["Hangul Compatibility Jamo"](i)||Dt["Hangul Jamo Extended-A"](i)||Dt["Hangul Jamo Extended-B"](i)||Dt["Hangul Jamo"](i)||Dt["Hangul Syllables"](i)||Dt.Hiragana(i)||Dt["Ideographic Description Characters"](i)||Dt.Kanbun(i)||Dt["Kangxi Radicals"](i)||Dt["Katakana Phonetic Extensions"](i)||Dt.Katakana(i)&&i!==12540||!(!Dt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Dt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Dt["Unified Canadian Aboriginal Syllabics"](i)||Dt["Unified Canadian Aboriginal Syllabics Extended"](i)||Dt["Vertical Forms"](i)||Dt["Yijing Hexagram Symbols"](i)||Dt["Yi Syllables"](i)||Dt["Yi Radicals"](i))))}function Ho(i){return!(zn(i)||function(t){return!!(Dt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Dt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Dt["Letterlike Symbols"](t)||Dt["Number Forms"](t)||Dt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Dt["Control Pictures"](t)&&t!==9251||Dt["Optical Character Recognition"](t)||Dt["Enclosed Alphanumerics"](t)||Dt["Geometric Shapes"](t)||Dt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Dt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Dt["CJK Symbols and Punctuation"](t)||Dt.Katakana(t)||Dt["Private Use Area"](t)||Dt["CJK Compatibility Forms"](t)||Dt["Small Form Variants"](t)||Dt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Xo(i){return i>=1424&&i<=2303||Dt["Arabic Presentation Forms-A"](i)||Dt["Arabic Presentation Forms-B"](i)}function js(i,t){return!(!t&&Xo(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Dt.Khmer(i))}function ma(i){for(const t of i)if(Xo(t.charCodeAt(0)))return!0;return!1}const bs="deferred",is="loading",bo="loaded";let wo=null,Yi="unavailable",cr=null;const Ko=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Yi="error"),wo&&wo(i)};function ns(){To.fire(new ir("pluginStateChange",{pluginStatus:Yi,pluginURL:cr}))}const To=new Un,ws=function(){return Yi},_a=function(){if(Yi!==bs||!cr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yi=is,ns(),cr&&yr({url:cr},i=>{i?Ko(i):(Yi=bo,ns())})},un={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yi===bo||un.applyArabicShaping!=null,isLoading:()=>Yi===is,setState(i){if(!rn())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Yi=i.pluginStatus,cr=i.pluginURL},isParsed(){if(!rn())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return un.applyArabicShaping!=null&&un.processBidirectionalText!=null&&un.processStyledBidirectionalText!=null},getPluginURL(){if(!rn())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return cr}};class Qe{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jo,this.transition={})}isSupportedScript(t){return function(n,o){for(const u of n)if(!js(u.charCodeAt(0),o))return!1;return!0}(t,un.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Ws{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,u){if(Fe(o))return new Ki(o,u);if(Xr(o)){const d=ua(o,u);if(d.result==="error")throw new Error(d.value.map(m=>`${m.key}: ${m.message}`).join(", "));return d.value}{let d=o;return u.type==="color"&&typeof o=="string"?d=$.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)||(d=tt.parse(o)),{kind:"constant",evaluate:()=>d}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class r{constructor(t){this.property=t,this.value=new Ws(t,void 0)}transitioned(t,n){return new _(this.property,this.value,n,$e({},t.transition,this.transition),t.now)}untransitioned(){return new _(this.property,this.value,null,{},0)}}class l{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ii(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new r(this._values[t].property)),this._values[t].value=new Ws(this._values[t].property,n===null?void 0:ii(n))}getTransition(t){return ii(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new r(this._values[t].property)),this._values[t].transition=ii(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new b(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new b(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class _{constructor(t,n,o,u,d){this.property=t,this.value=n,this.begin=d+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,d=this.value.possiblyEvaluate(t,n,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return m.possiblyEvaluate(t,n,o);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,n,o),d,function(w){if(w<=0)return 0;if(w>=1)return 1;const E=w*w,M=E*w;return 4*(w<.5?M:3*(w-E)+M-.75)}(v))}}return d}}class b{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new et(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class A{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return ii(this._values[t].value)}setValue(t,n){this._values[t]=new Ws(this._values[t].property,n===null?void 0:ii(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new et(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(t,n,o);return u}}class N{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class et{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class nt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=$r[this.specification.type];return u?u(t,n,o):t}}class lt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new N(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new N(this,{kind:"constant",value:void 0},t.parameters);const u=$r[this.specification.type];return u?new N(this,{kind:"constant",value:u(t.value.value,n.value.value,o)},t.parameters):t}evaluate(t,n,o,u,d,m){return t.kind==="constant"?t.value:t.evaluate(n,o,u,d,m)}}class Ct extends lt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new N(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const d=t.expression.evaluate(n,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,v=this._calculate(m,m,m,n);return new N(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const d=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new N(this,{kind:"constant",value:d},n)}return new N(this,t.expression,n)}evaluate(t,n,o,u,d,m){if(t.kind==="source"){const v=t.evaluate(n,o,u,d,m);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Wt{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const d=t.expression.evaluate(n,null,{},o,u);return this._calculate(d,d,d,n)}return this._calculate(t.expression.evaluate(new Qe(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Qe(Math.floor(n.zoom),n)),t.expression.evaluate(new Qe(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class oe{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class ie{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Ws(o,void 0),d=this.defaultTransitionablePropertyValues[n]=new r(o);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}qt("DataDrivenProperty",lt),qt("DataConstantProperty",nt),qt("CrossFadedDataDrivenProperty",Ct),qt("CrossFadedProperty",Wt),qt("ColorRampProperty",oe);const xi="-transition";class ki extends Un{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new A(n.layout)),n.paint)){this._transitionablePaint=new l(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new et(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Hn,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(xi)?this._transitionablePaint.getTransition(t.slice(0,-xi.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Ra,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(xi))return this._transitionablePaint.setTransition(t.slice(0,-xi.length),n||void 0),!1;{const u=this._transitionablePaint._values[t],d=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||m||d||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mn(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,u,d={}){return(!d||d.validate!==!1)&&ts(this,t.call(Gs,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof N&&He(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Hs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $i{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function mi(i,t=1){let n=0,o=0;return{members:i.map(u=>{const d=Hs[u.type].BYTES_PER_ELEMENT,m=n=Jo(n,Math.max(t,d)),v=u.components||1;return o=Math.max(o,d),n+=d*v,{name:u.name,type:u.type,components:v,offset:m}}),size:Jo(n,Math.max(o,t)),alignment:t}}function Jo(i,t){return Math.ceil(i/t)*t}class rs extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}rs.prototype.bytesPerElement=4,qt("StructArrayLayout2i4",rs);class h extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o,u)}emplace(t,n,o,u,d){const m=4*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=d,t}}h.prototype.bytesPerElement=8,qt("StructArrayLayout4i8",h);class e extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,d,m)}emplace(t,n,o,u,d,m,v){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=d,this.int16[w+4]=m,this.int16[w+5]=v,t}}e.prototype.bytesPerElement=12,qt("StructArrayLayout2i4i12",e);class s extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,d,m)}emplace(t,n,o,u,d,m,v){const w=4*t,E=8*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[E+4]=u,this.uint8[E+5]=d,this.uint8[E+6]=m,this.uint8[E+7]=v,t}}s.prototype.bytesPerElement=8,qt("StructArrayLayout2i4ub8",s);class a extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}a.prototype.bytesPerElement=8,qt("StructArrayLayout2f8",a);class p extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m,v,w,E,M){const D=this.length;return this.resize(D+1),this.emplace(D,t,n,o,u,d,m,v,w,E,M)}emplace(t,n,o,u,d,m,v,w,E,M,D){const F=10*t;return this.uint16[F+0]=n,this.uint16[F+1]=o,this.uint16[F+2]=u,this.uint16[F+3]=d,this.uint16[F+4]=m,this.uint16[F+5]=v,this.uint16[F+6]=w,this.uint16[F+7]=E,this.uint16[F+8]=M,this.uint16[F+9]=D,t}}p.prototype.bytesPerElement=20,qt("StructArrayLayout10ui20",p);class f extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m,v,w,E,M,D,F){const V=this.length;return this.resize(V+1),this.emplace(V,t,n,o,u,d,m,v,w,E,M,D,F)}emplace(t,n,o,u,d,m,v,w,E,M,D,F,V){const G=12*t;return this.int16[G+0]=n,this.int16[G+1]=o,this.int16[G+2]=u,this.int16[G+3]=d,this.uint16[G+4]=m,this.uint16[G+5]=v,this.uint16[G+6]=w,this.uint16[G+7]=E,this.int16[G+8]=M,this.int16[G+9]=D,this.int16[G+10]=F,this.int16[G+11]=V,t}}f.prototype.bytesPerElement=24,qt("StructArrayLayout4i4ui4i24",f);class y extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const d=3*t;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=u,t}}y.prototype.bytesPerElement=12,qt("StructArrayLayout3f12",y);class T extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}T.prototype.bytesPerElement=4,qt("StructArrayLayout1ul4",T);class I extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m,v,w,E){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,u,d,m,v,w,E)}emplace(t,n,o,u,d,m,v,w,E,M){const D=10*t,F=5*t;return this.int16[D+0]=n,this.int16[D+1]=o,this.int16[D+2]=u,this.int16[D+3]=d,this.int16[D+4]=m,this.int16[D+5]=v,this.uint32[F+3]=w,this.uint16[D+8]=E,this.uint16[D+9]=M,t}}I.prototype.bytesPerElement=20,qt("StructArrayLayout6i1ul2ui20",I);class P extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,d,m)}emplace(t,n,o,u,d,m,v){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=u,this.int16[w+3]=d,this.int16[w+4]=m,this.int16[w+5]=v,t}}P.prototype.bytesPerElement=12,qt("StructArrayLayout2i2i2i12",P);class z extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u,d)}emplace(t,n,o,u,d,m){const v=4*t,w=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=u,this.int16[w+6]=d,this.int16[w+7]=m,t}}z.prototype.bytesPerElement=16,qt("StructArrayLayout2f1f2i16",z);class O extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o,u)}emplace(t,n,o,u,d){const m=12*t,v=3*t;return this.uint8[m+0]=n,this.uint8[m+1]=o,this.float32[v+1]=u,this.float32[v+2]=d,t}}O.prototype.bytesPerElement=12,qt("StructArrayLayout2ub2f12",O);class Z extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const d=3*t;return this.uint16[d+0]=n,this.uint16[d+1]=o,this.uint16[d+2]=u,t}}Z.prototype.bytesPerElement=6,qt("StructArrayLayout3ui6",Z);class H extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m,v,w,E,M,D,F,V,G,J,K,ut){const gt=this.length;return this.resize(gt+1),this.emplace(gt,t,n,o,u,d,m,v,w,E,M,D,F,V,G,J,K,ut)}emplace(t,n,o,u,d,m,v,w,E,M,D,F,V,G,J,K,ut,gt){const ct=24*t,mt=12*t,Et=48*t;return this.int16[ct+0]=n,this.int16[ct+1]=o,this.uint16[ct+2]=u,this.uint16[ct+3]=d,this.uint32[mt+2]=m,this.uint32[mt+3]=v,this.uint32[mt+4]=w,this.uint16[ct+10]=E,this.uint16[ct+11]=M,this.uint16[ct+12]=D,this.float32[mt+7]=F,this.float32[mt+8]=V,this.uint8[Et+36]=G,this.uint8[Et+37]=J,this.uint8[Et+38]=K,this.uint32[mt+10]=ut,this.int16[ct+22]=gt,t}}H.prototype.bytesPerElement=48,qt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",H);class j extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,d,m,v,w,E,M,D,F,V,G,J,K,ut,gt,ct,mt,Et,It,jt,Kt,Nt,Ot,kt,Zt){const Ut=this.length;return this.resize(Ut+1),this.emplace(Ut,t,n,o,u,d,m,v,w,E,M,D,F,V,G,J,K,ut,gt,ct,mt,Et,It,jt,Kt,Nt,Ot,kt,Zt)}emplace(t,n,o,u,d,m,v,w,E,M,D,F,V,G,J,K,ut,gt,ct,mt,Et,It,jt,Kt,Nt,Ot,kt,Zt,Ut){const zt=34*t,ee=17*t;return this.int16[zt+0]=n,this.int16[zt+1]=o,this.int16[zt+2]=u,this.int16[zt+3]=d,this.int16[zt+4]=m,this.int16[zt+5]=v,this.int16[zt+6]=w,this.int16[zt+7]=E,this.uint16[zt+8]=M,this.uint16[zt+9]=D,this.uint16[zt+10]=F,this.uint16[zt+11]=V,this.uint16[zt+12]=G,this.uint16[zt+13]=J,this.uint16[zt+14]=K,this.uint16[zt+15]=ut,this.uint16[zt+16]=gt,this.uint16[zt+17]=ct,this.uint16[zt+18]=mt,this.uint16[zt+19]=Et,this.uint16[zt+20]=It,this.uint16[zt+21]=jt,this.uint16[zt+22]=Kt,this.uint32[ee+12]=Nt,this.float32[ee+13]=Ot,this.float32[ee+14]=kt,this.float32[ee+15]=Zt,this.float32[ee+16]=Ut,t}}j.prototype.bytesPerElement=68,qt("StructArrayLayout8i15ui1ul4f68",j);class W extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}W.prototype.bytesPerElement=4,qt("StructArrayLayout1f4",W);class rt extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const d=3*t;return this.int16[d+0]=n,this.int16[d+1]=o,this.int16[d+2]=u,t}}rt.prototype.bytesPerElement=6,qt("StructArrayLayout3i6",rt);class ht extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const d=4*t;return this.uint32[2*t+0]=n,this.uint16[d+2]=o,this.uint16[d+3]=u,t}}ht.prototype.bytesPerElement=8,qt("StructArrayLayout1ul2ui8",ht);class pt extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}pt.prototype.bytesPerElement=4,qt("StructArrayLayout2ui4",pt);class X extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}X.prototype.bytesPerElement=2,qt("StructArrayLayout1ui2",X);class _t extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,n,o,u)}emplace(t,n,o,u,d){const m=4*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=d,t}}_t.prototype.bytesPerElement=16,qt("StructArrayLayout4f16",_t);class ft extends $i{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Yt(this.anchorPointX,this.anchorPointY)}}ft.prototype.size=20;class Tt extends I{get(t){return new ft(this,t)}}qt("CollisionBoxArray",Tt);class St extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}St.prototype.size=48;class Mt extends H{get(t){return new St(this,t)}}qt("PlacedSymbolArray",Mt);class bt extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}bt.prototype.size=68;class Vt extends j{get(t){return new bt(this,t)}}qt("SymbolInstanceArray",Vt);class Rt extends W{getoffsetX(t){return this.float32[1*t+0]}}qt("GlyphOffsetArray",Rt);class $t extends rt{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}qt("SymbolLineVertexArray",$t);class de extends $i{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}de.prototype.size=8;class ye extends ht{get(t){return new de(this,t)}}qt("FeatureIndexArray",ye);class te extends rs{}class Ve extends rs{}class Ge extends rs{}class Le extends e{}class ke extends s{}class qe extends a{}class Di extends p{}class kr extends f{}class ur extends y{}class Dr extends T{}class Ts extends P{}class Xn extends O{}class wn extends Z{}class ss extends pt{}const ga=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ei}=ga;class be{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,u){let d=this.segments[this.segments.length-1];return t>be.MAX_VERTEX_ARRAY_LENGTH&&ni(`Max vertices per segment is ${be.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>be.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u)&&(d={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(d.sortKey=u),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new be([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Ne(i,t){return 256*(i=dt(Math.floor(i),0,255))+dt(Math.floor(t),0,255)}be.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt("SegmentVector",be);const Bi=mi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ri={exports:{}},oi={exports:{}};oi.exports=function(i,t){var n,o,u,d,m,v,w,E;for(o=i.length-(n=3&i.length),u=t,m=3432918353,v=461845907,E=0;E<o;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,u=27492+(65535&(d=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(w=0,n){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Kn={exports:{}};Kn.exports=function(i,t){for(var n,o=i.length,u=t^o,d=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(d)|(255&i.charCodeAt(++d))<<8|(255&i.charCodeAt(++d))<<16|(255&i.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++d;switch(o){case 3:u^=(255&i.charCodeAt(d+2))<<16;case 2:u^=(255&i.charCodeAt(d+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(d)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Xs=oi.exports,Oa=Kn.exports;Ri.exports=Xs,Ri.exports.murmur3=Xs,Ri.exports.murmur2=Oa;class So{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(hl(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=hl(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=n?u=m:o=m+1}const d=[];for(;this.ids[o]===n;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Fa(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new So;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function hl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ri.exports(String(i))}function Fa(i,t,n,o){for(;n<o;){const u=i[n+o>>1];let d=n-1,m=o+1;for(;;){do d++;while(i[d]<u);do m--;while(i[m]>u);if(d>=m)break;Ss(i,d,m),Ss(t,3*d,3*m),Ss(t,3*d+1,3*m+1),Ss(t,3*d+2,3*m+2)}m-n<o-m?(Fa(i,t,n,m),n=m+1):(Fa(i,t,m+1,o),o=m)}}function Ss(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}qt("FeaturePositionMap",So);class Ks{constructor(t,n){this.gl=t.gl,this.location=n}}class Js extends Ks{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ya extends Ks{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class jh extends Ks{constructor(t,n){super(t,n),this.current=$.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const tp=new Float32Array(16);function ql(i){return[Ne(255*i.r,255*i.g),Ne(255*i.b,255*i.a)]}class Ua{constructor(t,n,o){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new jh(t,n):new Js(t,n)}}class va{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,u){const d=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&t.set(d)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new ya(t,n):new Js(t,n)}}class Ys{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,o,u,d){const m=this.paintVertexArray.length,v=this.expression.evaluate(new Qe(0),n,{},u,[],d);this.paintVertexArray.resize(t),this._setPaintValue(m,t,v)}updatePaintArray(t,n,o,u){const d=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,n,d)}_setPaintValue(t,n,o){if(this.type==="color"){const u=ql(o);for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class os{constructor(t,n,o,u,d,m){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,n,o,u,d){const m=this.expression.evaluate(new Qe(this.zoom),n,{},u,[],d),v=this.expression.evaluate(new Qe(this.zoom+1),n,{},u,[],d),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,m,v)}updatePaintArray(t,n,o,u){const d=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,n,d,m)}_setPaintValue(t,n,o,u){if(this.type==="color"){const d=ql(o),m=ql(u);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,d[0],d[1],m[0],m[1])}else{for(let d=t;d<n;d++)this.paintVertexArray.emplace(d,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=dt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new Js(t,n)}}class Io{constructor(t,n,o,u,d,m){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,u,d){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(t,n,o,u){if(!u||!o)return;const{min:d,mid:m,max:v}=o,w=u[d],E=u[m],M=u[v];if(w&&E&&M)for(let D=t;D<n;D++)this.zoomInPaintVertexArray.emplace(D,E.tl[0],E.tl[1],E.br[0],E.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],E.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,E.tl[0],E.tl[1],E.br[0],E.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],E.pixelRatio,M.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Bi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Bi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wh{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const d in t.paint._values){if(!o(d))continue;const m=t.paint.get(d);if(!(m instanceof N&&He(m.property.specification)))continue;const v=ep(d,t.type),w=m.value,E=m.property.specification.type,M=m.property.useIntegerZoom,D=m.property.specification["property-type"],F=D==="cross-faded"||D==="cross-faded-data-driven";if(w.kind==="constant")this.binders[d]=F?new va(w.value,v):new Ua(w.value,v,E),u.push(`/u_${d}`);else if(w.kind==="source"||F){const V=Hh(d,E,"source");this.binders[d]=F?new Io(w,E,M,n,V,t.id):new Ys(w,v,E,V),u.push(`/a_${d}`)}else{const V=Hh(d,E,"composite");this.binders[d]=new os(w,v,E,M,n,V),u.push(`/z_${d}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ys||n instanceof os?n.maxValue:0}populatePaintArrays(t,n,o,u,d){for(const m in this.binders){const v=this.binders[m];(v instanceof Ys||v instanceof os||v instanceof Io)&&v.populatePaintArray(t,n,o,u,d)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof va&&u.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,u,d){let m=!1;for(const v in t){const w=n.getPositions(v);for(const E of w){const M=o.feature(E.index);for(const D in this.binders){const F=this.binders[D];if((F instanceof Ys||F instanceof os||F instanceof Io)&&F.expression.isStateDependent===!0){const V=u.paint.get(D);F.expression=V.value,F.updatePaintArray(E.start,E.end,M,t[v],d),m=!0}}}}return m}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Ua||o instanceof va)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ys||o instanceof os)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Io)for(let u=0;u<Bi.members.length;u++)t.push(Bi.members[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ua||o instanceof va||o instanceof os)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Ua||d instanceof va||d instanceof os){for(const m of d.uniformNames)if(n[m]){const v=d.getBinding(t,n[m],m);o.push({name:m,property:u,binding:v})}}}return o}setUniforms(t,n,o,u){for(const{name:d,property:m,binding:v}of n)this.binders[m].setUniform(v,u,o.get(m),d)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Io){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Ys||o instanceof os)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ys||o instanceof os||o instanceof Io)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ys||n instanceof os||n instanceof Io)&&n.destroy()}}}class Yo{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Wh(u,n,o);this.needsUpload=!1,this._featureMap=new So,this._bufferOffset=0}populatePaintArrays(t,n,o,u,d,m){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,n,u,d,m);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(t,this._featureMap,n,d,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ep(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Hh(i,t,n){const o={color:{source:a,composite:_t},number:{source:W,composite:a}},u=function(d){return{"line-pattern":{source:Di,composite:Di},"fill-pattern":{source:Di,composite:Di},"fill-extrusion-pattern":{source:Di,composite:Di}}[d]}(i);return u&&u[n]||o[t][n]}qt("ConstantBinder",Ua),qt("CrossFadedConstantBinder",va),qt("SourceExpressionBinder",Ys),qt("CrossFadedCompositeBinder",Io),qt("CompositeExpressionBinder",os),qt("ProgramConfiguration",Wh,{omit:["_buffers"]}),qt("ProgramConfigurationSet",Yo);var Pi=8192;const $l=Math.pow(2,14)-1,Xh=-$l-1;function Qo(i){const t=Pi/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let d=0;d<u.length;d++){const m=u[d],v=Math.round(m.x*t),w=Math.round(m.y*t);m.x=dt(v,Xh,$l),m.y=dt(w,Xh,$l),(v<m.x||v>m.x+1||w<m.y||w>m.y+1)&&ni("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ta(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Qo(i):[]}}function cl(i,t,n,o,u){i.emplaceBack(2*t+(o+1)/2,2*n+(u+1)/2)}class jl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ve,this.indexArray=new wn,this.segments=new be,this.programConfigurations=new Yo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const u=this.layers[0],d=[];let m=null,v=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),v=!m.isConstant());for(const{feature:w,id:E,index:M,sourceLayerIndex:D}of t){const F=this.layers[0]._featureFilter.needGeometry,V=ta(w,F);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),V,o))continue;const G=v?m.evaluate(V,{},o):void 0,J={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:M,geometry:F?V.geometry:Qo(w),patterns:{},sortKey:G};d.push(J)}v&&d.sort((w,E)=>w.sortKey-E.sortKey);for(const w of d){const{geometry:E,index:M,sourceLayerIndex:D}=w,F=t[M].feature;this.addFeature(w,E,M,o),n.featureIndex.insert(F,E,M,D,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ei),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u){for(const d of n)for(const m of d){const v=m.x,w=m.y;if(v<0||v>=Pi||w<0||w>=Pi)continue;const E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),M=E.vertexLength;cl(this.layoutVertexArray,v,w,-1,-1),cl(this.layoutVertexArray,v,w,1,-1),cl(this.layoutVertexArray,v,w,1,1),cl(this.layoutVertexArray,v,w,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),E.vertexLength+=4,E.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function Kh(i,t){for(let n=0;n<i.length;n++)if(xa(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(xa(i,t[n]))return!0;return!!Wl(i,t)}function ip(i,t,n){return!!xa(i,t)||!!Hl(t,i,n)}function Jh(i,t){if(i.length===1)return Qh(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(xa(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(Qh(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Wl(i,t[n]))return!0;return!1}function np(i,t,n){if(i.length>1){if(Wl(i,t))return!0;for(let o=0;o<t.length;o++)if(Hl(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Hl(i[o],t,n))return!0;return!1}function Wl(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let d=0;d<t.length-1;d++)if(rp(o,u,t[d],t[d+1]))return!0}return!1}function rp(i,t,n,o){return _n(i,n,o)!==_n(t,n,o)&&_n(i,t,n)!==_n(i,t,o)}function Hl(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(Yh(i,t[u-1],t[u])<o)return!0;return!1}function Yh(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const u=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Qh(i,t){let n,o,u,d=!1;for(let m=0;m<i.length;m++){n=i[m];for(let v=0,w=n.length-1;v<n.length;w=v++)o=n[v],u=n[w],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(d=!d)}return d}function xa(i,t){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const d=i[o],m=i[u];d.y>t.y!=m.y>t.y&&t.x<(m.x-d.x)*(t.y-d.y)/(m.y-d.y)+d.x&&(n=!n)}return n}function sp(i,t,n){const o=n[0],u=n[2];if(i.x<o.x&&t.x<o.x||i.x>u.x&&t.x>u.x||i.y<o.y&&t.y<o.y||i.y>u.y&&t.y>u.y)return!1;const d=_n(i,t,n[0]);return d!==_n(i,t,n[1])||d!==_n(i,t,n[2])||d!==_n(i,t,n[3])}function Na(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function ul(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pl(i,t,n,o,u){if(!t[0]&&!t[1])return i;const d=Yt.convert(t)._mult(u);n==="viewport"&&d._rotate(-o);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(d));return m}qt("CircleBucket",jl,{omit:["layers"]});const op=new ie({"circle-sort-key":new lt(wt.layout_circle["circle-sort-key"])});var ap={paint:new ie({"circle-radius":new lt(wt.paint_circle["circle-radius"]),"circle-color":new lt(wt.paint_circle["circle-color"]),"circle-blur":new lt(wt.paint_circle["circle-blur"]),"circle-opacity":new lt(wt.paint_circle["circle-opacity"]),"circle-translate":new nt(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new nt(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nt(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nt(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(wt.paint_circle["circle-stroke-opacity"])}),layout:op},Tn=1e-6,Sn=typeof Float32Array<"u"?Float32Array:Array;function tc(){var i=new Sn(9);return Sn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Xl(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ec(i,t,n){var o=t[0],u=t[1],d=t[2],m=t[3],v=t[4],w=t[5],E=t[6],M=t[7],D=t[8],F=t[9],V=t[10],G=t[11],J=t[12],K=t[13],ut=t[14],gt=t[15],ct=n[0],mt=n[1],Et=n[2],It=n[3];return i[0]=ct*o+mt*v+Et*D+It*J,i[1]=ct*u+mt*w+Et*F+It*K,i[2]=ct*d+mt*E+Et*V+It*ut,i[3]=ct*m+mt*M+Et*G+It*gt,i[4]=(ct=n[4])*o+(mt=n[5])*v+(Et=n[6])*D+(It=n[7])*J,i[5]=ct*u+mt*w+Et*F+It*K,i[6]=ct*d+mt*E+Et*V+It*ut,i[7]=ct*m+mt*M+Et*G+It*gt,i[8]=(ct=n[8])*o+(mt=n[9])*v+(Et=n[10])*D+(It=n[11])*J,i[9]=ct*u+mt*w+Et*F+It*K,i[10]=ct*d+mt*E+Et*V+It*ut,i[11]=ct*m+mt*M+Et*G+It*gt,i[12]=(ct=n[12])*o+(mt=n[13])*v+(Et=n[14])*D+(It=n[15])*J,i[13]=ct*u+mt*w+Et*F+It*K,i[14]=ct*d+mt*E+Et*V+It*ut,i[15]=ct*m+mt*M+Et*G+It*gt,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Za,lp=ec;function ic(){var i=new Sn(3);return Sn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function nc(i,t,n){var o=new Sn(3);return o[0]=i,o[1]=t,o[2]=n,o}function dl(i,t,n){var o=t[0],u=t[1],d=t[2],m=t[3];return i[0]=n[0]*o+n[4]*u+n[8]*d+n[12]*m,i[1]=n[1]*o+n[5]*u+n[9]*d+n[13]*m,i[2]=n[2]*o+n[6]*u+n[10]*d+n[14]*m,i[3]=n[3]*o+n[7]*u+n[11]*d+n[15]*m,i}function rc(){var i=new Sn(4);return Sn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function sc(i,t){const n=dl([],[i.x,i.y,0,1],t);return new Yt(n[0]/n[3],n[1]/n[3])}ic(),Za=new Sn(4),Sn!=Float32Array&&(Za[0]=0,Za[1]=0,Za[2]=0,Za[3]=0),ic(),nc(1,0,0),nc(0,1,0),rc(),rc(),tc(),function(){var i;i=new Sn(2),Sn!=Float32Array&&(i[0]=0,i[1]=0)}();class oc extends jl{}qt("HeatmapBucket",oc,{omit:["layers"]});var hp={paint:new ie({"heatmap-radius":new lt(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nt(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oe(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nt(wt.paint_heatmap["heatmap-opacity"])})};function Kl(i,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=u,i}function ac(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const u=Kl({},{width:t,height:n},o);Jl(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=u.data}function Jl(i,t,n,o,u,d){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,v=t.data;if(m===v)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<u.height;w++){const E=((n.y+w)*i.width+n.x)*d,M=((o.y+w)*t.width+o.x)*d;for(let D=0;D<u.width*d;D++)v[M+D]=m[E+D]}return t}class Va{constructor(t,n){Kl(this,t,1,n)}resize(t){ac(this,t,1)}clone(){return new Va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,d){Jl(t,n,o,u,d,1)}}class pr{constructor(t,n){Kl(this,t,4,n)}resize(t){ac(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,d){Jl(t,n,o,u,d,4)}}function lc(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new pr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const d=(m,v,w)=>{t[i.evaluationKey]=w;const E=i.expression.evaluate(t);u.data[m+v+0]=Math.floor(255*E.r/E.a),u.data[m+v+1]=Math.floor(255*E.g/E.a),u.data[m+v+2]=Math.floor(255*E.b/E.a),u.data[m+v+3]=Math.floor(255*E.a)};if(i.clips)for(let m=0,v=0;m<o;++m,v+=4*n)for(let w=0,E=0;w<n;w++,E+=4){const M=w/(n-1),{start:D,end:F}=i.clips[m];d(v,E,D*(1-M)+F*M)}else for(let m=0,v=0;m<n;m++,v+=4)d(0,v,m/(n-1));return u}qt("AlphaImage",Va),qt("RGBAImage",pr);var cp={paint:new ie({"hillshade-illumination-direction":new nt(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nt(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nt(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nt(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nt(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nt(wt.paint_hillshade["hillshade-accent-color"])})};const up=mi([{name:"a_pos",components:2,type:"Int16"}],4),{members:pp}=up;var fl={exports:{}};function ml(i,t,n){n=n||2;var o,u,d,m,v,w,E,M=t&&t.length,D=M?t[0]*n:i.length,F=hc(i,0,D,n,!0),V=[];if(!F||F.next===F.prev)return V;if(M&&(F=function(J,K,ut,gt){var ct,mt,Et,It=[];for(ct=0,mt=K.length;ct<mt;ct++)(Et=hc(J,K[ct]*gt,ct<mt-1?K[ct+1]*gt:J.length,gt,!1))===Et.next&&(Et.steiner=!0),It.push(xp(Et));for(It.sort(gp),ct=0;ct<It.length;ct++)ut=yp(It[ct],ut);return ut}(i,t,F,n)),i.length>80*n){o=d=i[0],u=m=i[1];for(var G=n;G<D;G+=n)(v=i[G])<o&&(o=v),(w=i[G+1])<u&&(u=w),v>d&&(d=v),w>m&&(m=w);E=(E=Math.max(d-o,m-u))!==0?32767/E:0}return Ga(F,V,n,o,u,E,0),V}function hc(i,t,n,o,u){var d,m;if(u===th(i,t,n,o)>0)for(d=t;d<n;d+=o)m=pc(d,i[d],i[d+1],m);else for(d=n-o;d>=t;d-=o)m=pc(d,i[d],i[d+1],m);return m&&_l(m,m.next)&&($a(m),m=m.next),m}function ea(i,t){if(!i)return i;t||(t=i);var n,o=i;do if(n=!1,o.steiner||!_l(o,o.next)&&bi(o.prev,o,o.next)!==0)o=o.next;else{if($a(o),(o=t=o.prev)===o.next)break;n=!0}while(n||o!==t);return t}function Ga(i,t,n,o,u,d,m){if(i){!m&&d&&function(M,D,F,V){var G=M;do G.z===0&&(G.z=Yl(G.x,G.y,D,F,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==M);G.prevZ.nextZ=null,G.prevZ=null,function(J){var K,ut,gt,ct,mt,Et,It,jt,Kt=1;do{for(ut=J,J=null,mt=null,Et=0;ut;){for(Et++,gt=ut,It=0,K=0;K<Kt&&(It++,gt=gt.nextZ);K++);for(jt=Kt;It>0||jt>0&&gt;)It!==0&&(jt===0||!gt||ut.z<=gt.z)?(ct=ut,ut=ut.nextZ,It--):(ct=gt,gt=gt.nextZ,jt--),mt?mt.nextZ=ct:J=ct,ct.prevZ=mt,mt=ct;ut=gt}mt.nextZ=null,Kt*=2}while(Et>1)}(G)}(i,o,u,d);for(var v,w,E=i;i.prev!==i.next;)if(v=i.prev,w=i.next,d?fp(i,o,u,d):dp(i))t.push(v.i/n|0),t.push(i.i/n|0),t.push(w.i/n|0),$a(i),i=w.next,E=w.next;else if((i=w)===E){m?m===1?Ga(i=mp(ea(i),t,n),t,n,o,u,d,2):m===2&&_p(i,t,n,o,u,d):Ga(ea(i),t,n,o,u,d,1);break}}}function dp(i){var t=i.prev,n=i,o=i.next;if(bi(t,n,o)>=0)return!1;for(var u=t.x,d=n.x,m=o.x,v=t.y,w=n.y,E=o.y,M=u<d?u<m?u:m:d<m?d:m,D=v<w?v<E?v:E:w<E?w:E,F=u>d?u>m?u:m:d>m?d:m,V=v>w?v>E?v:E:w>E?w:E,G=o.next;G!==t;){if(G.x>=M&&G.x<=F&&G.y>=D&&G.y<=V&&ba(u,v,d,w,m,E,G.x,G.y)&&bi(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function fp(i,t,n,o){var u=i.prev,d=i,m=i.next;if(bi(u,d,m)>=0)return!1;for(var v=u.x,w=d.x,E=m.x,M=u.y,D=d.y,F=m.y,V=v<w?v<E?v:E:w<E?w:E,G=M<D?M<F?M:F:D<F?D:F,J=v>w?v>E?v:E:w>E?w:E,K=M>D?M>F?M:F:D>F?D:F,ut=Yl(V,G,t,n,o),gt=Yl(J,K,t,n,o),ct=i.prevZ,mt=i.nextZ;ct&&ct.z>=ut&&mt&&mt.z<=gt;){if(ct.x>=V&&ct.x<=J&&ct.y>=G&&ct.y<=K&&ct!==u&&ct!==m&&ba(v,M,w,D,E,F,ct.x,ct.y)&&bi(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,mt.x>=V&&mt.x<=J&&mt.y>=G&&mt.y<=K&&mt!==u&&mt!==m&&ba(v,M,w,D,E,F,mt.x,mt.y)&&bi(mt.prev,mt,mt.next)>=0))return!1;mt=mt.nextZ}for(;ct&&ct.z>=ut;){if(ct.x>=V&&ct.x<=J&&ct.y>=G&&ct.y<=K&&ct!==u&&ct!==m&&ba(v,M,w,D,E,F,ct.x,ct.y)&&bi(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;mt&&mt.z<=gt;){if(mt.x>=V&&mt.x<=J&&mt.y>=G&&mt.y<=K&&mt!==u&&mt!==m&&ba(v,M,w,D,E,F,mt.x,mt.y)&&bi(mt.prev,mt,mt.next)>=0)return!1;mt=mt.nextZ}return!0}function mp(i,t,n){var o=i;do{var u=o.prev,d=o.next.next;!_l(u,d)&&cc(u,o,o.next,d)&&qa(u,d)&&qa(d,u)&&(t.push(u.i/n|0),t.push(o.i/n|0),t.push(d.i/n|0),$a(o),$a(o.next),o=i=d),o=o.next}while(o!==i);return ea(o)}function _p(i,t,n,o,u,d){var m=i;do{for(var v=m.next.next;v!==m.prev;){if(m.i!==v.i&&bp(m,v)){var w=uc(m,v);return m=ea(m,m.next),w=ea(w,w.next),Ga(m,t,n,o,u,d,0),void Ga(w,t,n,o,u,d,0)}v=v.next}m=m.next}while(m!==i)}function gp(i,t){return i.x-t.x}function yp(i,t){var n=function(u,d){var m,v=d,w=u.x,E=u.y,M=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var D=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(D<=w&&D>M&&(M=D,m=v.x<v.next.x?v:v.next,D===w))return m}v=v.next}while(v!==d);if(!m)return null;var F,V=m,G=m.x,J=m.y,K=1/0;v=m;do w>=v.x&&v.x>=G&&w!==v.x&&ba(E<J?w:M,E,G,J,E<J?M:w,E,v.x,v.y)&&(F=Math.abs(E-v.y)/(w-v.x),qa(v,u)&&(F<K||F===K&&(v.x>m.x||v.x===m.x&&vp(m,v)))&&(m=v,K=F)),v=v.next;while(v!==V);return m}(i,t);if(!n)return t;var o=uc(n,i);return ea(o,o.next),ea(n,n.next)}function vp(i,t){return bi(i.prev,i,t.prev)<0&&bi(t.next,i,i.next)<0}function Yl(i,t,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xp(i){var t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function ba(i,t,n,o,u,d,m,v){return(u-m)*(t-v)>=(i-m)*(d-v)&&(i-m)*(o-v)>=(n-m)*(t-v)&&(n-m)*(d-v)>=(u-m)*(o-v)}function bp(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&cc(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(i,t)&&(qa(i,t)&&qa(t,i)&&function(n,o){var u=n,d=!1,m=(n.x+o.x)/2,v=(n.y+o.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&m<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==n);return d}(i,t)&&(bi(i.prev,i,t.prev)||bi(i,t.prev,t))||_l(i,t)&&bi(i.prev,i,i.next)>0&&bi(t.prev,t,t.next)>0)}function bi(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function _l(i,t){return i.x===t.x&&i.y===t.y}function cc(i,t,n,o){var u=yl(bi(i,t,n)),d=yl(bi(i,t,o)),m=yl(bi(n,o,i)),v=yl(bi(n,o,t));return u!==d&&m!==v||!(u!==0||!gl(i,n,t))||!(d!==0||!gl(i,o,t))||!(m!==0||!gl(n,i,o))||!(v!==0||!gl(n,t,o))}function gl(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function yl(i){return i>0?1:i<0?-1:0}function qa(i,t){return bi(i.prev,i,i.next)<0?bi(i,t,i.next)>=0&&bi(i,i.prev,t)>=0:bi(i,t,i.prev)<0||bi(i,i.next,t)<0}function uc(i,t){var n=new Ql(i.i,i.x,i.y),o=new Ql(t.i,t.x,t.y),u=i.next,d=t.prev;return i.next=t,t.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,d.next=o,o.prev=d,o}function pc(i,t,n,o){var u=new Ql(i,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function $a(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ql(i,t,n){this.i=i,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function th(i,t,n,o){for(var u=0,d=t,m=n-o;d<n;d+=o)u+=(i[m]-i[d])*(i[d+1]+i[m+1]),m=d;return u}function wp(i,t,n,o,u){dc(i,t,n||0,o||i.length-1,u||Tp)}function dc(i,t,n,o,u){for(;o>n;){if(o-n>600){var d=o-n+1,m=t-n+1,v=Math.log(d),w=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*w*(d-w)/d)*(m-d/2<0?-1:1);dc(i,t,Math.max(n,Math.floor(t-m*w/d+E)),Math.min(o,Math.floor(t+(d-m)*w/d+E)),u)}var M=i[t],D=n,F=o;for(ja(i,n,t),u(i[o],M)>0&&ja(i,n,o);D<F;){for(ja(i,D,F),D++,F--;u(i[D],M)<0;)D++;for(;u(i[F],M)>0;)F--}u(i[n],M)===0?ja(i,n,F):ja(i,++F,o),F<=t&&(n=F+1),t<=F&&(o=F-1)}}function ja(i,t,n){var o=i[t];i[t]=i[n],i[n]=o}function Tp(i,t){return i<t?-1:i>t?1:0}function eh(i,t){const n=i.length;if(n<=1)return[i];const o=[];let u,d;for(let m=0;m<n;m++){const v=Yn(i[m]);v!==0&&(i[m].area=Math.abs(v),d===void 0&&(d=v<0),d===v<0?(u&&o.push(u),u=[i[m]]):u.push(i[m]))}if(u&&o.push(u),t>1)for(let m=0;m<o.length;m++)o[m].length<=t||(wp(o[m],t,1,o[m].length-1,Sp),o[m]=o[m].slice(0,t));return o}function Sp(i,t){return t.area-i.area}function ih(i,t,n){const o=n.patternDependencies;let u=!1;for(const d of t){const m=d.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const v=m.constantOr(null);v&&(u=!0,o[v.to]=!0,o[v.from]=!0)}return u}function nh(i,t,n,o,u){const d=u.patternDependencies;for(const m of t){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:o-1},n,{},u.availableImages),E=v.evaluate({zoom:o},n,{},u.availableImages),M=v.evaluate({zoom:o+1},n,{},u.availableImages);w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,M=M&&M.name?M.name:M,d[w]=!0,d[E]=!0,d[M]=!0,n.patterns[m.id]={min:w,mid:E,max:M}}}return n}fl.exports=ml,fl.exports.default=ml,ml.deviation=function(i,t,n,o){var u=t&&t.length,d=Math.abs(th(i,0,u?t[0]*n:i.length,n));if(u)for(var m=0,v=t.length;m<v;m++)d-=Math.abs(th(i,t[m]*n,m<v-1?t[m+1]*n:i.length,n));var w=0;for(m=0;m<o.length;m+=3){var E=o[m]*n,M=o[m+1]*n,D=o[m+2]*n;w+=Math.abs((i[E]-i[D])*(i[M+1]-i[E+1])-(i[E]-i[M])*(i[D+1]-i[E+1]))}return d===0&&w===0?0:Math.abs((w-d)/d)},ml.flatten=function(i){for(var t=i[0][0].length,n={vertices:[],holes:[],dimensions:t},o=0,u=0;u<i.length;u++){for(var d=0;d<i[u].length;d++)for(var m=0;m<t;m++)n.vertices.push(i[u][d][m]);u>0&&n.holes.push(o+=i[u-1].length)}return n};class rh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ge,this.indexArray=new wn,this.indexArray2=new ss,this.programConfigurations=new Yo(t.layers,t.zoom),this.segments=new be,this.segments2=new be,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ih("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),d=!u.isConstant(),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:M}of t){const D=this.layers[0]._featureFilter.needGeometry,F=ta(v,D);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),F,o))continue;const V=d?u.evaluate(F,{},o,n.availableImages):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:D?F.geometry:Qo(v),patterns:{},sortKey:V};m.push(G)}d&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const D=nh("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(v,w,E,o,{});n.featureIndex.insert(t[E].feature,w,E,M,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,d){for(const m of eh(n,500)){let v=0;for(const V of m)v+=V.length;const w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=w.vertexLength,M=[],D=[];for(const V of m){if(V.length===0)continue;V!==m[0]&&D.push(M.length/2);const G=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),J=G.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(J+V.length-1,J),M.push(V[0].x),M.push(V[0].y);for(let K=1;K<V.length;K++)this.layoutVertexArray.emplaceBack(V[K].x,V[K].y),this.indexArray2.emplaceBack(J+K-1,J+K),M.push(V[K].x),M.push(V[K].y);G.vertexLength+=V.length,G.primitiveLength+=V.length}const F=fl.exports(M,D);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(E+F[V],E+F[V+1],E+F[V+2]);w.vertexLength+=v,w.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,d,u)}}qt("FillBucket",rh,{omit:["layers","patternFeatures"]});const Ip=new ie({"fill-sort-key":new lt(wt.layout_fill["fill-sort-key"])});var Ep={paint:new ie({"fill-antialias":new nt(wt.paint_fill["fill-antialias"]),"fill-opacity":new lt(wt.paint_fill["fill-opacity"]),"fill-color":new lt(wt.paint_fill["fill-color"]),"fill-outline-color":new lt(wt.paint_fill["fill-outline-color"]),"fill-translate":new nt(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new nt(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ct(wt.paint_fill["fill-pattern"])}),layout:Ip};const Pp=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ap=mi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Cp}=Pp;var Eo={},Mp=Yt,fc=wa;function wa(i,t,n,o,u){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(zp,this,t)}function zp(i,t,n){i==1?t.id=n.readVarint():i==2?function(o,u){for(var d=o.readVarint()+o.pos;o.pos<d;){var m=u._keys[o.readVarint()],v=u._values[o.readVarint()];u.properties[m]=v}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function Lp(i){for(var t,n,o=0,u=0,d=i.length,m=d-1;u<d;m=u++)o+=((n=i[m]).x-(t=i[u]).x)*(t.y+n.y);return o}wa.types=["Unknown","Point","LineString","Polygon"],wa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,o=1,u=0,d=0,m=0,v=[];i.pos<n;){if(u<=0){var w=i.readVarint();o=7&w,u=w>>3}if(u--,o===1||o===2)d+=i.readSVarint(),m+=i.readSVarint(),o===1&&(t&&v.push(t),t=[]),t.push(new Mp(d,m));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&v.push(t),v},wa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,o=0,u=0,d=0,m=1/0,v=-1/0,w=1/0,E=-1/0;i.pos<t;){if(o<=0){var M=i.readVarint();n=7&M,o=M>>3}if(o--,n===1||n===2)(u+=i.readSVarint())<m&&(m=u),u>v&&(v=u),(d+=i.readSVarint())<w&&(w=d),d>E&&(E=d);else if(n!==7)throw new Error("unknown command "+n)}return[m,w,v,E]},wa.prototype.toGeoJSON=function(i,t,n){var o,u,d=this.extent*Math.pow(2,n),m=this.extent*i,v=this.extent*t,w=this.loadGeometry(),E=wa.types[this.type];function M(V){for(var G=0;G<V.length;G++){var J=V[G];V[G]=[360*(J.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+v)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(o=0;o<w.length;o++)D[o]=w[o][0];M(w=D);break;case 2:for(o=0;o<w.length;o++)M(w[o]);break;case 3:for(w=function(V){var G=V.length;if(G<=1)return[V];for(var J,K,ut=[],gt=0;gt<G;gt++){var ct=Lp(V[gt]);ct!==0&&(K===void 0&&(K=ct<0),K===ct<0?(J&&ut.push(J),J=[V[gt]]):J.push(V[gt]))}return J&&ut.push(J),ut}(w),o=0;o<w.length;o++)for(u=0;u<w[o].length;u++)M(w[o][u])}w.length===1?w=w[0]:E="Multi"+E;var F={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(F.id=this.id),F};var kp=fc,mc=_c;function _c(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Dp,this,t),this.length=this._features.length}function Dp(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(o){for(var u=null,d=o.readVarint()+o.pos;o.pos<d;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(n))}_c.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new kp(this._pbf,t,this.extent,this._keys,this._values)};var Bp=mc;function Rp(i,t,n){if(i===3){var o=new Bp(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}Eo.VectorTile=function(i,t){this.layers=i.readFields(Rp,{},t)},Eo.VectorTileFeature=fc,Eo.VectorTileLayer=mc;const Op=Eo.VectorTileFeature.types,sh=Math.pow(2,13);function Wa(i,t,n,o,u,d,m,v){i.emplaceBack(t,n,2*Math.floor(o*sh)+m,u*sh*2,d*sh*2,Math.round(v))}class oh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.centroidVertexArray=new te,this.indexArray=new wn,this.programConfigurations=new Yo(t.layers,t.zoom),this.segments=new be,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=ih("fill-extrusion",this.layers,n);for(const{feature:u,id:d,index:m,sourceLayerIndex:v}of t){const w=this.layers[0]._featureFilter.needGeometry,E=ta(u,w);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),E,o))continue;const M={id:d,sourceLayerIndex:v,index:m,geometry:w?E.geometry:Qo(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(nh("fill-extrusion",this.layers,M,this.zoom,n)):this.addFeature(M,M.geometry,m,o,{}),n.featureIndex.insert(u,M.geometry,m,v,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:d}=u;this.addFeature(u,d,u.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cp),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Ap.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,d){const m={x:0,y:0,vertexCount:0};for(const v of eh(n,500)){let w=0;for(const G of v)w+=G.length;let E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of v){if(G.length===0||Up(G))continue;let J=0;for(let K=0;K<G.length;K++){const ut=G[K];if(K>=1){const gt=G[K-1];if(!Fp(ut,gt)){E.vertexLength+4>be.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ct=ut.sub(gt)._perp()._unit(),mt=gt.dist(ut);J+mt>32768&&(J=0),Wa(this.layoutVertexArray,ut.x,ut.y,ct.x,ct.y,0,0,J),Wa(this.layoutVertexArray,ut.x,ut.y,ct.x,ct.y,0,1,J),m.x+=2*ut.x,m.y+=2*ut.y,m.vertexCount+=2,J+=mt,Wa(this.layoutVertexArray,gt.x,gt.y,ct.x,ct.y,0,0,J),Wa(this.layoutVertexArray,gt.x,gt.y,ct.x,ct.y,0,1,J),m.x+=2*gt.x,m.y+=2*gt.y,m.vertexCount+=2;const Et=E.vertexLength;this.indexArray.emplaceBack(Et,Et+2,Et+1),this.indexArray.emplaceBack(Et+1,Et+2,Et+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+w>be.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),Op[t.type]!=="Polygon")continue;const M=[],D=[],F=E.vertexLength;for(const G of v)if(G.length!==0){G!==v[0]&&D.push(M.length/2);for(let J=0;J<G.length;J++){const K=G[J];Wa(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),m.x+=K.x,m.y+=K.y,m.vertexCount+=1,M.push(K.x),M.push(K.y)}}const V=fl.exports(M,D);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(F+V[G],F+V[G+2],F+V[G+1]);E.primitiveLength+=V.length/3,E.vertexLength+=w}for(let v=0;v<m.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(m.x/m.vertexCount),Math.floor(m.y/m.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,d,u)}}function Fp(i,t){return i.x===t.x&&(i.x<0||i.x>Pi)||i.y===t.y&&(i.y<0||i.y>Pi)}function Up(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Pi)||i.every(t=>t.y<0)||i.every(t=>t.y>Pi)}qt("FillExtrusionBucket",oh,{omit:["layers","features"]});var Np={paint:new ie({"fill-extrusion-opacity":new nt(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nt(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nt(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ct(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nt(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ha(i,t){return i.x*t.x+i.y*t.y}function gc(i,t){if(i.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const d=t[n],m=i[0],v=u.sub(o),w=d.sub(o),E=m.sub(o),M=Ha(v,v),D=Ha(v,w),F=Ha(w,w),V=Ha(E,v),G=Ha(E,w),J=M*F-D*D,K=(F*V-D*G)/J,ut=(M*G-D*V)/J,gt=o.z*(1-K-ut)+u.z*K+d.z*ut;if(isFinite(gt))return gt}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Zp=mi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Vp}=Zp,Gp=mi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qp}=Gp,$p=Eo.VectorTileFeature.types,jp=Math.cos(Math.PI/180*37.5),yc=Math.pow(2,14)/.5;class ah{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new qe,this.indexArray=new wn,this.programConfigurations=new Yo(t.layers,t.zoom),this.segments=new be,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ih("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),d=!u.isConstant(),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:M}of t){const D=this.layers[0]._featureFilter.needGeometry,F=ta(v,D);if(!this.layers[0]._featureFilter.filter(new Qe(this.zoom),F,o))continue;const V=d?u.evaluate(F,{},o):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:E,geometry:D?F.geometry:Qo(v),patterns:{},sortKey:V};m.push(G)}d&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:M}=v;if(this.hasPattern){const D=nh("line",this.layers,v,this.zoom,n);this.patternFeatures.push(D)}else this.addFeature(v,w,E,o,{});n.featureIndex.insert(t[E].feature,w,E,M,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,qp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,d){const m=this.layers[0].layout,v=m.get("line-join").evaluate(t,{}),w=m.get("line-cap"),E=m.get("line-miter-limit"),M=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of n)this.addLine(D,t,v,w,E,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,d,u)}addLine(t,n,o,u,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ut=0;ut<t.length-1;ut++)this.totalDistance+=t[ut].dist(t[ut+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=$p[n.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(v?3:2))return;o==="bevel"&&(d=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,D=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let F,V,G,J,K;this.e1=this.e2=-1,v&&(F=t[w-2],K=t[E].sub(F)._unit()._perp());for(let ut=E;ut<w;ut++){if(G=ut===w-1?v?t[E+1]:void 0:t[ut+1],G&&t[ut].equals(G))continue;K&&(J=K),F&&(V=F),F=t[ut],K=G?G.sub(F)._unit()._perp():J,J=J||K;let gt=J.add(K);gt.x===0&&gt.y===0||gt._unit();const ct=J.x*K.x+J.y*K.y,mt=gt.x*K.x+gt.y*K.y,Et=mt!==0?1/mt:1/0,It=2*Math.sqrt(2-2*mt),jt=mt<jp&&V&&G,Kt=J.x*K.y-J.y*K.x>0;if(jt&&ut>E){const kt=F.dist(V);if(kt>2*M){const Zt=F.sub(F.sub(V)._mult(M/kt)._round());this.updateDistance(V,Zt),this.addCurrentVertex(Zt,J,0,0,D),V=Zt}}const Nt=V&&G;let Ot=Nt?o:v?"butt":u;if(Nt&&Ot==="round"&&(Et<m?Ot="miter":Et<=2&&(Ot="fakeround")),Ot==="miter"&&Et>d&&(Ot="bevel"),Ot==="bevel"&&(Et>2&&(Ot="flipbevel"),Et<d&&(Ot="miter")),V&&this.updateDistance(V,F),Ot==="miter")gt._mult(Et),this.addCurrentVertex(F,gt,0,0,D);else if(Ot==="flipbevel"){if(Et>100)gt=K.mult(-1);else{const kt=Et*J.add(K).mag()/J.sub(K).mag();gt._perp()._mult(kt*(Kt?-1:1))}this.addCurrentVertex(F,gt,0,0,D),this.addCurrentVertex(F,gt.mult(-1),0,0,D)}else if(Ot==="bevel"||Ot==="fakeround"){const kt=-Math.sqrt(Et*Et-1),Zt=Kt?kt:0,Ut=Kt?0:kt;if(V&&this.addCurrentVertex(F,J,Zt,Ut,D),Ot==="fakeround"){const zt=Math.round(180*It/Math.PI/20);for(let ee=1;ee<zt;ee++){let Qt=ee/zt;if(Qt!==.5){const ei=Qt-.5;Qt+=Qt*ei*(Qt-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*ei*ei+(.848013+ct*(.215638*ct-1.06021)))}const ve=K.sub(J)._mult(Qt)._add(J)._unit()._mult(Kt?-1:1);this.addHalfVertex(F,ve.x,ve.y,!1,Kt,0,D)}}G&&this.addCurrentVertex(F,K,-Zt,-Ut,D)}else if(Ot==="butt")this.addCurrentVertex(F,gt,0,0,D);else if(Ot==="square"){const kt=V?1:-1;this.addCurrentVertex(F,gt,kt,kt,D)}else Ot==="round"&&(V&&(this.addCurrentVertex(F,J,0,0,D),this.addCurrentVertex(F,J,1,1,D,!0)),G&&(this.addCurrentVertex(F,K,-1,-1,D,!0),this.addCurrentVertex(F,K,0,0,D)));if(jt&&ut<w-1){const kt=F.dist(G);if(kt>2*M){const Zt=F.add(G.sub(F)._mult(M/kt)._round());this.updateDistance(F,Zt),this.addCurrentVertex(Zt,K,0,0,D),F=Zt}}}}addCurrentVertex(t,n,o,u,d,m=!1){const v=n.y*u-n.x,w=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,m,!1,o,d),this.addHalfVertex(t,v,w,m,!0,-u,d),this.distance>yc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,n,o,u,d,m))}addHalfVertex({x:t,y:n},o,u,d,m,v,w){const E=.5*(this.lineClips?this.scaledDistance*(yc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&E)<<2,E>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),w.primitiveLength++),m?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}qt("LineBucket",ah,{omit:["layers","patternFeatures"]});const Wp=new ie({"line-cap":new nt(wt.layout_line["line-cap"]),"line-join":new lt(wt.layout_line["line-join"]),"line-miter-limit":new nt(wt.layout_line["line-miter-limit"]),"line-round-limit":new nt(wt.layout_line["line-round-limit"]),"line-sort-key":new lt(wt.layout_line["line-sort-key"])});var vc={paint:new ie({"line-opacity":new lt(wt.paint_line["line-opacity"]),"line-color":new lt(wt.paint_line["line-color"]),"line-translate":new nt(wt.paint_line["line-translate"]),"line-translate-anchor":new nt(wt.paint_line["line-translate-anchor"]),"line-width":new lt(wt.paint_line["line-width"]),"line-gap-width":new lt(wt.paint_line["line-gap-width"]),"line-offset":new lt(wt.paint_line["line-offset"]),"line-blur":new lt(wt.paint_line["line-blur"]),"line-dasharray":new Wt(wt.paint_line["line-dasharray"]),"line-pattern":new Ct(wt.paint_line["line-pattern"]),"line-gradient":new oe(wt.paint_line["line-gradient"])}),layout:Wp};const xc=new class extends lt{possiblyEvaluate(i,t){return t=new Qe(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,n,o){return t=$e({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,n,o)}}(vc.paint.properties["line-width"].specification);function bc(i,t){return t>0?t+2*i:i}xc.useIntegerZoom=!0;const Hp=mi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xp=mi([{name:"a_projected_pos",components:3,type:"Float32"}],4);mi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Kp=mi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);mi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wc=mi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Jp=mi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yp(i,t,n){return i.sections.forEach(o=>{o.text=function(u,d,m){const v=d.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),un.applyArabicShaping&&(u=un.applyArabicShaping(u)),u}(o.text,t,n)}),i}mi([{name:"triangle",components:3,type:"Uint16"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mi([{type:"Float32",name:"offsetX"}]),mi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Xa={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var ji=24,lh=Xe,Tc=function(i,t,n,o,u){var d,m,v=8*u-o-1,w=(1<<v)-1,E=w>>1,M=-7,D=n?u-1:0,F=n?-1:1,V=i[t+D];for(D+=F,d=V&(1<<-M)-1,V>>=-M,M+=v;M>0;d=256*d+i[t+D],D+=F,M-=8);for(m=d&(1<<-M)-1,d>>=-M,M+=o;M>0;m=256*m+i[t+D],D+=F,M-=8);if(d===0)d=1-E;else{if(d===w)return m?NaN:1/0*(V?-1:1);m+=Math.pow(2,o),d-=E}return(V?-1:1)*m*Math.pow(2,d-o)},Sc=function(i,t,n,o,u,d){var m,v,w,E=8*d-u-1,M=(1<<E)-1,D=M>>1,F=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=o?0:d-1,G=o?1:-1,J=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,m=M):(m=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-m))<1&&(m--,w*=2),(t+=m+D>=1?F/w:F*Math.pow(2,1-D))*w>=2&&(m++,w/=2),m+D>=M?(v=0,m=M):m+D>=1?(v=(t*w-1)*Math.pow(2,u),m+=D):(v=t*Math.pow(2,D-1)*Math.pow(2,u),m=0));u>=8;i[n+V]=255&v,V+=G,v/=256,u-=8);for(m=m<<u|v,E+=u;E>0;i[n+V]=255&m,V+=G,m/=256,E-=8);i[n+V-G]|=128*J};function Xe(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Xe.Varint=0,Xe.Fixed64=1,Xe.Bytes=2,Xe.Fixed32=5;var Po,hh=4294967296,Ic=1/hh,Ec=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qs(i){return i.type===Xe.Bytes?i.readVarint()+i.pos:i.pos+1}function Ta(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Pc(i,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function Qp(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function td(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function ed(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function id(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function nd(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function rd(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function sd(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function od(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function ad(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function vl(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Sa(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function Ac(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function ld(i,t,n){i===1&&n.readMessage(hd,t)}function hd(i,t,n){if(i===3){const{id:o,bitmap:u,width:d,height:m,left:v,top:w,advance:E}=n.readMessage(cd,{});t.push({id:o,bitmap:new Va({width:d+6,height:m+6},u),metrics:{width:d,height:m,left:v,top:w,advance:E}})}}function cd(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}function Cc(i){let t=0,n=0;for(const m of i)t+=m.w*m.h,n=Math.max(n,m.w);i.sort((m,v)=>v.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,d=0;for(const m of i)for(let v=o.length-1;v>=0;v--){const w=o[v];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,d=Math.max(d,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===w.w&&m.h===w.h){const E=o.pop();v<o.length&&(o[v]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(o.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:u,h:d,fill:t/(u*d)||0}}Xe.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),u=o>>3,d=this.pos;this.type=7&o,i(u,t,this),this.pos===d&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=vl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Ac(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=vl(this.buf,this.pos)+vl(this.buf,this.pos+4)*hh;return this.pos+=8,i},readSFixed64:function(){var i=vl(this.buf,this.pos)+Ac(this.buf,this.pos+4)*hh;return this.pos+=8,i},readFloat:function(){var i=Tc(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Tc(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(u,d,m){var v,w,E=m.buf;if(v=(112&(w=E[m.pos++]))>>4,w<128||(v|=(127&(w=E[m.pos++]))<<3,w<128)||(v|=(127&(w=E[m.pos++]))<<10,w<128)||(v|=(127&(w=E[m.pos++]))<<17,w<128)||(v|=(127&(w=E[m.pos++]))<<24,w<128)||(v|=(1&(w=E[m.pos++]))<<31,w<128))return Ta(u,v,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Ec?function(n,o,u){return Ec.decode(n.subarray(o,u))}(this.buf,t,i):function(n,o,u){for(var d="",m=o;m<u;){var v,w,E,M=n[m],D=null,F=M>239?4:M>223?3:M>191?2:1;if(m+F>u)break;F===1?M<128&&(D=M):F===2?(192&(v=n[m+1]))==128&&(D=(31&M)<<6|63&v)<=127&&(D=null):F===3?(w=n[m+2],(192&(v=n[m+1]))==128&&(192&w)==128&&((D=(15&M)<<12|(63&v)<<6|63&w)<=2047||D>=55296&&D<=57343)&&(D=null)):F===4&&(w=n[m+2],E=n[m+3],(192&(v=n[m+1]))==128&&(192&w)==128&&(192&E)==128&&((D=(15&M)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,F=1):D>65535&&(D-=65536,d+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),d+=String.fromCharCode(D),m+=F}return d}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Xe.Bytes)return i.push(this.readVarint(t));var n=Qs(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Xe.Bytes)return i.push(this.readSVarint());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Xe.Bytes)return i.push(this.readBoolean());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Xe.Bytes)return i.push(this.readFloat());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Xe.Bytes)return i.push(this.readDouble());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Xe.Bytes)return i.push(this.readFixed32());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Xe.Bytes)return i.push(this.readSFixed32());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Xe.Bytes)return i.push(this.readFixed64());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Xe.Bytes)return i.push(this.readSFixed64());var t=Qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Xe.Varint)for(;this.buf[this.pos++]>127;);else if(t===Xe.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Xe.Fixed32)this.pos+=4;else{if(t!==Xe.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Sa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Sa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Sa(this.buf,-1&i,this.pos),Sa(this.buf,Math.floor(i*Ic),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Sa(this.buf,-1&i,this.pos),Sa(this.buf,Math.floor(i*Ic),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var o,u;if(t>=0?(o=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,m,v){v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,d>>>=7,v.buf[v.pos++]=127&d|128,v.buf[v.pos]=127&(d>>>=7)}(o,0,n),function(d,m){var v=(7&d)<<4;m.buf[m.pos++]|=v|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(u,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,u,d){for(var m,v,w=0;w<u.length;w++){if((m=u.charCodeAt(w))>55295&&m<57344){if(!v){m>56319||w+1===u.length?(o[d++]=239,o[d++]=191,o[d++]=189):v=m;continue}if(m<56320){o[d++]=239,o[d++]=191,o[d++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(o[d++]=239,o[d++]=191,o[d++]=189,v=null);m<128?o[d++]=m:(m<2048?o[d++]=m>>6|192:(m<65536?o[d++]=m>>12|224:(o[d++]=m>>18|240,o[d++]=m>>12&63|128),o[d++]=m>>6&63|128),o[d++]=63&m|128)}return d}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&Pc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),Sc(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Sc(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var o=this.pos-n;o>=128&&Pc(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,n){this.writeTag(i,Xe.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Qp,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,td,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,nd,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,ed,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,id,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,rd,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,sd,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,od,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,ad,t)},writeBytesField:function(i,t){this.writeTag(i,Xe.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Xe.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Xe.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Xe.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Xe.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Xe.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Xe.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Xe.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Xe.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Xe.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class ch{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:d,content:m}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=d,this.content=m,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Mc{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,o,d),this.addImages(n,u,d);const{w:m,h:v}=Cc(d),w=new pr({width:m||1,height:v||1});for(const E in t){const M=t[E],D=o[E].paddedRect;pr.copy(M.data,w,{x:0,y:0},{x:D.x+1,y:D.y+1},M.data)}for(const E in n){const M=n[E],D=u[E].paddedRect,F=D.x+1,V=D.y+1,G=M.data.width,J=M.data.height;pr.copy(M.data,w,{x:0,y:0},{x:F,y:V},M.data),pr.copy(M.data,w,{x:0,y:J-1},{x:F,y:V-1},{width:G,height:1}),pr.copy(M.data,w,{x:0,y:0},{x:F,y:V+J},{width:G,height:1}),pr.copy(M.data,w,{x:G-1,y:0},{x:F-1,y:V},{width:1,height:J}),pr.copy(M.data,w,{x:0,y:0},{x:F+G,y:V},{width:1,height:J})}this.image=w,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const d=t[u],m={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(m),n[u]=new ch(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,d]=t.tl;o.update(n.data,void 0,{x:u,y:d})}}qt("ImagePosition",ch),qt("ImageAtlas",Mc),c.WritingMode=void 0,(Po=c.WritingMode||(c.WritingMode={}))[Po.none=0]="none",Po[Po.horizontal=1]="horizontal",Po[Po.vertical=2]="vertical",Po[Po.horizontalOnly=3]="horizontalOnly";const xl=-17;class Ka{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new Ka;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new Ka;return n.imageName=t,n}}class Ia{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Ia;for(let u=0;u<t.sections.length;u++){const d=t.sections[u];d.image?o.addImageSection(d):o.addTextSection(d,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,d=t.charCodeAt(o-1)||null;n+=u&&Ho(u)&&!Xa[t[o+1]]||d&&Ho(d)&&!Xa[t[o-1]]||!Xa[t[o]]?t[o]:Xa[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&wl[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&wl[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Ia;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ka.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void ni("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ka.forImage(n)),this.sectionIndex.push(this.sections.length-1)):ni("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bl(i,t,n,o,u,d,m,v,w,E,M,D,F,V,G,J){const K=Ia.fromFeature(i,u);let ut;D===c.WritingMode.vertical&&K.verticalizePunctuation();const{processBidirectionalText:gt,processStyledBidirectionalText:ct}=un;if(gt&&K.sections.length===1){ut=[];const It=gt(K.toString(),uh(K,E,d,t,o,V,G));for(const jt of It){const Kt=new Ia;Kt.text=jt,Kt.sections=K.sections;for(let Nt=0;Nt<jt.length;Nt++)Kt.sectionIndex.push(0);ut.push(Kt)}}else if(ct){ut=[];const It=ct(K.text,K.sectionIndex,uh(K,E,d,t,o,V,G));for(const jt of It){const Kt=new Ia;Kt.text=jt[0],Kt.sectionIndex=jt[1],Kt.sections=K.sections,ut.push(Kt)}}else ut=function(It,jt){const Kt=[],Nt=It.text;let Ot=0;for(const kt of jt)Kt.push(It.substring(Ot,kt)),Ot=kt;return Ot<Nt.length&&Kt.push(It.substring(Ot,Nt.length)),Kt}(K,uh(K,E,d,t,o,V,G));const mt=[],Et={positionedLines:mt,text:K.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(It,jt,Kt,Nt,Ot,kt,Zt,Ut,zt,ee,Qt,ve){let ei=0,ai=xl,Ai=0,fr=0;const Qi=Ut==="right"?1:Ut==="left"?0:.5;let Si=0;for(const Ii of Ot){Ii.trim();const en=Ii.getMaxScale(),dn=(en-1)*ji,In={positionedGlyphs:[],lineOffset:0};It.positionedLines[Si]=In;const kn=In.positionedGlyphs;let Dn=0;if(!Ii.length()){ai+=kt,++Si;continue}for(let Fi=0;Fi<Ii.length();Fi++){const Te=Ii.getSection(Fi),Jn=Ii.getSectionIndex(Fi),nn=Ii.getCharCode(Fi);let fn=0,Br=null,as=null,ls=null,eo=ji;const Rr=!(zt===c.WritingMode.horizontal||!Qt&&!zn(nn)||Qt&&(wl[nn]||(Oi=nn,Dt.Arabic(Oi)||Dt["Arabic Supplement"](Oi)||Dt["Arabic Extended-A"](Oi)||Dt["Arabic Presentation Forms-A"](Oi)||Dt["Arabic Presentation Forms-B"](Oi))));if(Te.imageName){const mr=Nt[Te.imageName];if(!mr)continue;ls=Te.imageName,It.iconsInText=It.iconsInText||!0,as=mr.paddedRect;const Bn=mr.displaySize;Te.scale=Te.scale*ji/ve,Br={width:Bn[0],height:Bn[1],left:1,top:-3,advance:Rr?Bn[1]:Bn[0]},fn=dn+(ji-Bn[1]*Te.scale),eo=Br.advance;const io=Rr?Bn[0]*Te.scale-ji*en:Bn[1]*Te.scale-ji*en;io>0&&io>Dn&&(Dn=io)}else{const mr=Kt[Te.fontStack],Bn=mr&&mr[nn];if(Bn&&Bn.rect)as=Bn.rect,Br=Bn.metrics;else{const io=jt[Te.fontStack],Qa=io&&io[nn];if(!Qa)continue;Br=Qa.metrics}fn=(en-Te.scale)*ji}Rr?(It.verticalizable=!0,kn.push({glyph:nn,imageName:ls,x:ei,y:ai+fn,vertical:Rr,scale:Te.scale,fontStack:Te.fontStack,sectionIndex:Jn,metrics:Br,rect:as}),ei+=eo*Te.scale+ee):(kn.push({glyph:nn,imageName:ls,x:ei,y:ai+fn,vertical:Rr,scale:Te.scale,fontStack:Te.fontStack,sectionIndex:Jn,metrics:Br,rect:as}),ei+=Br.advance*Te.scale+ee)}kn.length!==0&&(Ai=Math.max(ei-ee,Ai),dd(kn,0,kn.length-1,Qi,Dn)),ei=0;const li=kt*en+Dn;In.lineOffset=Math.max(Dn,dn),ai+=li,fr=Math.max(li,fr),++Si}var Oi;const tn=ai-xl,{horizontalAlign:pn,verticalAlign:Ln}=ph(Zt);(function(Ii,en,dn,In,kn,Dn,li,Fi,Te){const Jn=(en-dn)*kn;let nn=0;nn=Dn!==li?-Fi*In-xl:(-In*Te+.5)*li;for(const fn of Ii)for(const Br of fn.positionedGlyphs)Br.x+=Jn,Br.y+=nn})(It.positionedLines,Qi,pn,Ln,Ai,fr,kt,tn,Ot.length),It.top+=-Ln*tn,It.bottom=It.top+tn,It.left+=-pn*Ai,It.right=It.left+Ai}(Et,t,n,o,ut,m,v,w,D,E,F,J),!function(It){for(const jt of It)if(jt.positionedGlyphs.length!==0)return!1;return!0}(mt)&&Et}const wl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ud={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zc(i,t,n,o,u,d){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*ji/d+u:0}{const m=n[t.fontStack],v=m&&m[i];return v?v.metrics.advance*t.scale+u:0}}function Lc(i,t,n,o){const u=Math.pow(i-t,2);return o?i<t?u/2:2*u:u+Math.abs(n)*n}function pd(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function kc(i,t,n,o,u,d){let m=null,v=Lc(t,n,u,d);for(const w of o){const E=Lc(t-w.x,n,u,d)+w.badness;E<=v&&(m=w,v=E)}return{index:i,x:t,priorBreak:m,badness:v}}function Dc(i){return i?Dc(i.priorBreak).concat(i.index):[]}function uh(i,t,n,o,u,d,m){if(d!=="point")return[];if(!i)return[];const v=[],w=function(F,V,G,J,K,ut){let gt=0;for(let ct=0;ct<F.length();ct++){const mt=F.getSection(ct);gt+=zc(F.getCharCode(ct),mt,J,K,V,ut)}return gt/Math.max(1,Math.ceil(gt/G))}(i,t,n,o,u,m),E=i.text.indexOf("\u200B")>=0;let M=0;for(let F=0;F<i.length();F++){const V=i.getSection(F),G=i.getCharCode(F);if(wl[G]||(M+=zc(G,V,o,u,t,m)),F<i.length()-1){const J=!((D=G)<11904||!(Dt["Bopomofo Extended"](D)||Dt.Bopomofo(D)||Dt["CJK Compatibility Forms"](D)||Dt["CJK Compatibility Ideographs"](D)||Dt["CJK Compatibility"](D)||Dt["CJK Radicals Supplement"](D)||Dt["CJK Strokes"](D)||Dt["CJK Symbols and Punctuation"](D)||Dt["CJK Unified Ideographs Extension A"](D)||Dt["CJK Unified Ideographs"](D)||Dt["Enclosed CJK Letters and Months"](D)||Dt["Halfwidth and Fullwidth Forms"](D)||Dt.Hiragana(D)||Dt["Ideographic Description Characters"](D)||Dt["Kangxi Radicals"](D)||Dt["Katakana Phonetic Extensions"](D)||Dt.Katakana(D)||Dt["Vertical Forms"](D)||Dt["Yi Radicals"](D)||Dt["Yi Syllables"](D)));(ud[G]||J||V.imageName)&&v.push(kc(F+1,M,w,v,pd(G,i.getCharCode(F+1),J&&E),!1))}}var D;return Dc(kc(i.length(),M,w,v,0,!0))}function ph(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function dd(i,t,n,o,u){if(!o&&!u)return;const d=i[n],m=(i[n].x+d.metrics.advance*d.scale)*o;for(let v=t;v<=n;v++)i[v].x-=m,i[v].y+=u}function fd(i,t,n){const{horizontalAlign:o,verticalAlign:u}=ph(n),d=t[0]-i.displaySize[0]*o,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Bc(i,t,n,o,u,d){const m=i.image;let v;if(m.content){const K=m.content,ut=m.pixelRatio||1;v=[K[0]/ut,K[1]/ut,m.displaySize[0]-K[2]/ut,m.displaySize[1]-K[3]/ut]}const w=t.left*d,E=t.right*d;let M,D,F,V;n==="width"||n==="both"?(V=u[0]+w-o[3],D=u[0]+E+o[1]):(V=u[0]+(w+E-m.displaySize[0])/2,D=V+m.displaySize[0]);const G=t.top*d,J=t.bottom*d;return n==="height"||n==="both"?(M=u[1]+G-o[0],F=u[1]+J+o[2]):(M=u[1]+(G+J-m.displaySize[1])/2,F=M+m.displaySize[1]),{image:m,top:M,right:D,bottom:F,left:V,collisionPadding:v}}const to=128;function Rc(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Qe(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let d=0;for(;d<o.length&&o[d]<=i;)d++;d=Math.max(0,d-1);let m=d;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const v=o[d],w=o[m];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:w,minSize:n.evaluate(new Qe(v)),maxSize:n.evaluate(new Qe(w)),interpolationType:u}}}class Ao extends Yt{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Ao(this.x,this.y,this.angle,this.segment)}}function Oc(i,t,n,o,u){if(t.segment===void 0)return!0;let d=t,m=t.segment+1,v=0;for(;v>-n/2;){if(m--,m<0)return!1;v-=i[m].dist(d),d=i[m]}v+=i[m].dist(i[m+1]),m++;const w=[];let E=0;for(;v<n/2;){const M=i[m],D=i[m+1];if(!D)return!1;let F=i[m-1].angleTo(M)-M.angleTo(D);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:F}),E+=F;v-w[0].distance>o;)E-=w.shift().angleDelta;if(E>u)return!1;m++,v+=M.dist(D)}return!0}function Fc(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function Uc(i,t,n){return i?.6*t*n:0}function Nc(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function md(i,t,n,o,u,d){const m=Uc(n,u,d),v=Nc(n,o)*d;let w=0;const E=Fc(i)/2;for(let M=0;M<i.length-1;M++){const D=i[M],F=i[M+1],V=D.dist(F);if(w+V>E){const G=(E-w)/V,J=We(D.x,F.x,G),K=We(D.y,F.y,G),ut=new Ao(J,K,F.angleTo(D),M);return ut._round(),!m||Oc(i,ut,v,m,t)?ut:void 0}w+=V}}function _d(i,t,n,o,u,d,m,v,w){const E=Uc(o,d,m),M=Nc(o,u),D=M*m,F=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return t-D<t/4&&(t=D+t/4),Zc(i,F?t/2*v%t:(M/2+2*d)*m*v%t,t,E,n,D,F,!1,w)}function Zc(i,t,n,o,u,d,m,v,w){const E=d/2,M=Fc(i);let D=0,F=t-n,V=[];for(let G=0;G<i.length-1;G++){const J=i[G],K=i[G+1],ut=J.dist(K),gt=K.angleTo(J);for(;F+n<D+ut;){F+=n;const ct=(F-D)/ut,mt=We(J.x,K.x,ct),Et=We(J.y,K.y,ct);if(mt>=0&&mt<w&&Et>=0&&Et<w&&F-E>=0&&F+E<=M){const It=new Ao(mt,Et,gt,G);It._round(),o&&!Oc(i,It,d,o,u)||V.push(It)}}D+=ut}return v||V.length||m||(V=Zc(i,D/2,n,o,u,d,m,!0,w)),V}function Vc(i,t,n,o,u){const d=[];for(let m=0;m<i.length;m++){const v=i[m];let w;for(let E=0;E<v.length-1;E++){let M=v[E],D=v[E+1];M.x<t&&D.x<t||(M.x<t?M=new Yt(t,M.y+(t-M.x)/(D.x-M.x)*(D.y-M.y))._round():D.x<t&&(D=new Yt(t,M.y+(t-M.x)/(D.x-M.x)*(D.y-M.y))._round()),M.y<n&&D.y<n||(M.y<n?M=new Yt(M.x+(n-M.y)/(D.y-M.y)*(D.x-M.x),n)._round():D.y<n&&(D=new Yt(M.x+(n-M.y)/(D.y-M.y)*(D.x-M.x),n)._round()),M.x>=o&&D.x>=o||(M.x>=o?M=new Yt(o,M.y+(o-M.x)/(D.x-M.x)*(D.y-M.y))._round():D.x>=o&&(D=new Yt(o,M.y+(o-M.x)/(D.x-M.x)*(D.y-M.y))._round()),M.y>=u&&D.y>=u||(M.y>=u?M=new Yt(M.x+(u-M.y)/(D.y-M.y)*(D.x-M.x),u)._round():D.y>=u&&(D=new Yt(M.x+(u-M.y)/(D.y-M.y)*(D.x-M.x),u)._round()),w&&M.equals(w[w.length-1])||(w=[M],d.push(w)),w.push(D)))))}}return d}function Gc(i,t,n,o){const u=[],d=i.image,m=d.pixelRatio,v=d.paddedRect.w-2,w=d.paddedRect.h-2,E=i.right-i.left,M=i.bottom-i.top,D=d.stretchX||[[0,v]],F=d.stretchY||[[0,w]],V=(kt,Zt)=>kt+Zt[1]-Zt[0],G=D.reduce(V,0),J=F.reduce(V,0),K=v-G,ut=w-J;let gt=0,ct=G,mt=0,Et=J,It=0,jt=K,Kt=0,Nt=ut;if(d.content&&o){const kt=d.content;gt=Tl(D,0,kt[0]),mt=Tl(F,0,kt[1]),ct=Tl(D,kt[0],kt[2]),Et=Tl(F,kt[1],kt[3]),It=kt[0]-gt,Kt=kt[1]-mt,jt=kt[2]-kt[0]-ct,Nt=kt[3]-kt[1]-Et}const Ot=(kt,Zt,Ut,zt)=>{const ee=Sl(kt.stretch-gt,ct,E,i.left),Qt=Il(kt.fixed-It,jt,kt.stretch,G),ve=Sl(Zt.stretch-mt,Et,M,i.top),ei=Il(Zt.fixed-Kt,Nt,Zt.stretch,J),ai=Sl(Ut.stretch-gt,ct,E,i.left),Ai=Il(Ut.fixed-It,jt,Ut.stretch,G),fr=Sl(zt.stretch-mt,Et,M,i.top),Qi=Il(zt.fixed-Kt,Nt,zt.stretch,J),Si=new Yt(ee,ve),Oi=new Yt(ai,ve),tn=new Yt(ai,fr),pn=new Yt(ee,fr),Ln=new Yt(Qt/m,ei/m),Ii=new Yt(Ai/m,Qi/m),en=t*Math.PI/180;if(en){const kn=Math.sin(en),Dn=Math.cos(en),li=[Dn,-kn,kn,Dn];Si._matMult(li),Oi._matMult(li),pn._matMult(li),tn._matMult(li)}const dn=kt.stretch+kt.fixed,In=Zt.stretch+Zt.fixed;return{tl:Si,tr:Oi,bl:pn,br:tn,tex:{x:d.paddedRect.x+1+dn,y:d.paddedRect.y+1+In,w:Ut.stretch+Ut.fixed-dn,h:zt.stretch+zt.fixed-In},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ln,pixelOffsetBR:Ii,minFontScaleX:jt/m/E,minFontScaleY:Nt/m/M,isSDF:n}};if(o&&(d.stretchX||d.stretchY)){const kt=qc(D,K,G),Zt=qc(F,ut,J);for(let Ut=0;Ut<kt.length-1;Ut++){const zt=kt[Ut],ee=kt[Ut+1];for(let Qt=0;Qt<Zt.length-1;Qt++)u.push(Ot(zt,Zt[Qt],ee,Zt[Qt+1]))}}else u.push(Ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return u}function Tl(i,t,n){let o=0;for(const u of i)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function qc(i,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,d]of i){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(d-u)})}return o.push({fixed:t+1,stretch:n}),o}function Sl(i,t,n,o){return i/t*n+o}function Il(i,t,n,o){return i-t*n/o}qt("Anchor",Ao);class El{constructor(t,n,o,u,d,m,v,w,E,M){if(this.boxStartIndex=t.length,E){let D=m.top,F=m.bottom;const V=m.collisionPadding;V&&(D-=V[1],F+=V[3]);let G=F-D;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let D=m.top*v-w[0],F=m.bottom*v+w[2],V=m.left*v-w[3],G=m.right*v+w[1];const J=m.collisionPadding;if(J&&(V-=J[0]*v,D-=J[1]*v,G+=J[2]*v,F+=J[3]*v),M){const K=new Yt(V,D),ut=new Yt(G,D),gt=new Yt(V,F),ct=new Yt(G,F),mt=M*Math.PI/180;K._rotate(mt),ut._rotate(mt),gt._rotate(mt),ct._rotate(mt),V=Math.min(K.x,ut.x,gt.x,ct.x),G=Math.max(K.x,ut.x,gt.x,ct.x),D=Math.min(K.y,ut.y,gt.y,ct.y),F=Math.max(K.y,ut.y,gt.y,ct.y)}t.emplaceBack(n.x,n.y,V,D,G,F,o,u,d)}this.boxEndIndex=t.length}}class gd{constructor(t=[],n=yd){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const d=t-1>>1,m=n[d];if(o(u,m)>=0)break;n[t]=m,t=d}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,d=n[t];for(;t<u;){let m=1+(t<<1),v=n[m];const w=m+1;if(w<this.length&&o(n[w],v)<0&&(m=w,v=n[w]),o(v,d)>=0)break;n[t]=v,t=m}n[t]=d}}function yd(i,t){return i<t?-1:i>t?1:0}function vd(i,t=1,n=!1){let o=1/0,u=1/0,d=-1/0,m=-1/0;const v=i[0];for(let V=0;V<v.length;V++){const G=v[V];(!V||G.x<o)&&(o=G.x),(!V||G.y<u)&&(u=G.y),(!V||G.x>d)&&(d=G.x),(!V||G.y>m)&&(m=G.y)}const w=Math.min(d-o,m-u);let E=w/2;const M=new gd([],xd);if(w===0)return new Yt(o,u);for(let V=o;V<d;V+=w)for(let G=u;G<m;G+=w)M.push(new Ea(V+E,G+E,E,i));let D=function(V){let G=0,J=0,K=0;const ut=V[0];for(let gt=0,ct=ut.length,mt=ct-1;gt<ct;mt=gt++){const Et=ut[gt],It=ut[mt],jt=Et.x*It.y-It.x*Et.y;J+=(Et.x+It.x)*jt,K+=(Et.y+It.y)*jt,G+=3*jt}return new Ea(J/G,K/G,0,V)}(i),F=M.length;for(;M.length;){const V=M.pop();(V.d>D.d||!D.d)&&(D=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-D.d<=t||(E=V.h/2,M.push(new Ea(V.p.x-E,V.p.y-E,E,i)),M.push(new Ea(V.p.x+E,V.p.y-E,E,i)),M.push(new Ea(V.p.x-E,V.p.y+E,E,i)),M.push(new Ea(V.p.x+E,V.p.y+E,E,i)),F+=4)}return n&&(console.log(`num probes: ${F}`),console.log(`best distance: ${D.d}`)),D.p}function xd(i,t){return t.max-i.max}function Ea(i,t,n,o){this.p=new Yt(i,t),this.h=n,this.d=function(u,d){let m=!1,v=1/0;for(let w=0;w<d.length;w++){const E=d[w];for(let M=0,D=E.length,F=D-1;M<D;F=M++){const V=E[M],G=E[F];V.y>u.y!=G.y>u.y&&u.x<(G.x-V.x)*(u.y-V.y)/(G.y-V.y)+V.x&&(m=!m),v=Math.min(v,Yh(u,V,G))}}return(m?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const dh=Number.POSITIVE_INFINITY;function $c(i,t){return t[1]!==dh?function(n,o,u){let d=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":m=u-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-u}switch(n){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,m]}(i,t[0],t[1]):function(n,o){let u=0,d=0;o<0&&(o=0);const m=o/Math.sqrt(2);switch(n){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(n){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,d]}(i,t[0])}function fh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bd(i,t,n,o,u,d,m,v,w,E,M){let D=d.textMaxSize.evaluate(t,{});D===void 0&&(D=m);const F=i.layers[0].layout,V=F.get("icon-offset").evaluate(t,{},M),G=Wc(n.horizontal),J=m/24,K=i.tilePixelRatio*J,ut=i.tilePixelRatio*D/24,gt=i.tilePixelRatio*v,ct=i.tilePixelRatio*F.get("symbol-spacing"),mt=F.get("text-padding")*i.tilePixelRatio,Et=function(zt,ee,Qt,ve=1){const ei=zt.get("icon-padding").evaluate(ee,{},Qt),ai=ei&&ei.values;return[ai[0]*ve,ai[1]*ve,ai[2]*ve,ai[3]*ve]}(F,t,M,i.tilePixelRatio),It=F.get("text-max-angle")/180*Math.PI,jt=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",Kt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",Nt=F.get("symbol-placement"),Ot=ct/2,kt=F.get("icon-text-fit");let Zt;o&&kt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Zt=Bc(o,n.vertical,kt,F.get("icon-text-fit-padding"),V,J)),G&&(o=Bc(o,G,kt,F.get("icon-text-fit-padding"),V,J)));const Ut=(zt,ee)=>{ee.x<0||ee.x>=Pi||ee.y<0||ee.y>=Pi||function(Qt,ve,ei,ai,Ai,fr,Qi,Si,Oi,tn,pn,Ln,Ii,en,dn,In,kn,Dn,li,Fi,Te,Jn,nn,fn,Br){const as=Qt.addToLineVertexArray(ve,ei);let ls,eo,Rr,mr,Bn=0,io=0,Qa=0,hu=0,Sh=-1,Ih=-1;const no={};let cu=Ri.exports(""),Eh=0,Ph=0;if(Si._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Eh,Ph]=Si.layout.get("text-offset").evaluate(Te,{},fn).map(Rn=>Rn*ji):(Eh=Si.layout.get("text-radial-offset").evaluate(Te,{},fn)*ji,Ph=dh),Qt.allowVerticalPlacement&&ai.vertical){const Rn=Si.layout.get("text-rotate").evaluate(Te,{},fn)+90;Rr=new El(Oi,ve,tn,pn,Ln,ai.vertical,Ii,en,dn,Rn),Qi&&(mr=new El(Oi,ve,tn,pn,Ln,Qi,kn,Dn,dn,Rn))}if(Ai){const Rn=Si.layout.get("icon-rotate").evaluate(Te,{}),Is=Si.layout.get("icon-text-fit")!=="none",tl=Gc(Ai,Rn,nn,Is),el=Qi?Gc(Qi,Rn,nn,Is):void 0;eo=new El(Oi,ve,tn,pn,Ln,Ai,kn,Dn,!1,Rn),Bn=4*tl.length;const du=Qt.iconSizeData;let na=null;du.kind==="source"?(na=[to*Si.layout.get("icon-size").evaluate(Te,{})],na[0]>Co&&ni(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):du.kind==="composite"&&(na=[to*Jn.compositeIconSizes[0].evaluate(Te,{},fn),to*Jn.compositeIconSizes[1].evaluate(Te,{},fn)],(na[0]>Co||na[1]>Co)&&ni(`${Qt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Qt.addSymbols(Qt.icon,tl,na,Fi,li,Te,c.WritingMode.none,ve,as.lineStartIndex,as.lineLength,-1,fn),Sh=Qt.icon.placedSymbolArray.length-1,el&&(io=4*el.length,Qt.addSymbols(Qt.icon,el,na,Fi,li,Te,c.WritingMode.vertical,ve,as.lineStartIndex,as.lineLength,-1,fn),Ih=Qt.icon.placedSymbolArray.length-1)}const uu=Object.keys(ai.horizontal);for(const Rn of uu){const Is=ai.horizontal[Rn];if(!ls){cu=Ri.exports(Is.text);const el=Si.layout.get("text-rotate").evaluate(Te,{},fn);ls=new El(Oi,ve,tn,pn,Ln,Is,Ii,en,dn,el)}const tl=Is.positionedLines.length===1;if(Qa+=jc(Qt,ve,Is,fr,Si,dn,Te,In,as,ai.vertical?c.WritingMode.horizontal:c.WritingMode.horizontalOnly,tl?uu:[Rn],no,Sh,Jn,fn),tl)break}ai.vertical&&(hu+=jc(Qt,ve,ai.vertical,fr,Si,dn,Te,In,as,c.WritingMode.vertical,["vertical"],no,Ih,Jn,fn));const Dd=ls?ls.boxStartIndex:Qt.collisionBoxArray.length,Bd=ls?ls.boxEndIndex:Qt.collisionBoxArray.length,Rd=Rr?Rr.boxStartIndex:Qt.collisionBoxArray.length,Od=Rr?Rr.boxEndIndex:Qt.collisionBoxArray.length,Fd=eo?eo.boxStartIndex:Qt.collisionBoxArray.length,Ud=eo?eo.boxEndIndex:Qt.collisionBoxArray.length,Nd=mr?mr.boxStartIndex:Qt.collisionBoxArray.length,Zd=mr?mr.boxEndIndex:Qt.collisionBoxArray.length;let hs=-1;const zl=(Rn,Is)=>Rn&&Rn.circleDiameter?Math.max(Rn.circleDiameter,Is):Is;hs=zl(ls,hs),hs=zl(Rr,hs),hs=zl(eo,hs),hs=zl(mr,hs);const pu=hs>-1?1:0;pu&&(hs*=Br/ji),Qt.glyphOffsetArray.length>=Pa.MAX_GLYPHS&&ni("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Te.sortKey!==void 0&&Qt.addToSortKeyRanges(Qt.symbolInstances.length,Te.sortKey),Qt.symbolInstances.emplaceBack(ve.x,ve.y,no.right>=0?no.right:-1,no.center>=0?no.center:-1,no.left>=0?no.left:-1,no.vertical||-1,Sh,Ih,cu,Dd,Bd,Rd,Od,Fd,Ud,Nd,Zd,tn,Qa,hu,Bn,io,pu,0,Ii,Eh,Ph,hs)}(i,ee,zt,n,o,u,Zt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,K,[mt,mt,mt,mt],jt,w,gt,Et,Kt,V,t,d,E,M,m)};if(Nt==="line")for(const zt of Vc(t.geometry,0,0,Pi,Pi)){const ee=_d(zt,ct,It,n.vertical||G,o,24,ut,i.overscaling,Pi);for(const Qt of ee){const ve=G;ve&&wd(i,ve.text,Ot,Qt)||Ut(zt,Qt)}}else if(Nt==="line-center"){for(const zt of t.geometry)if(zt.length>1){const ee=md(zt,It,n.vertical||G,o,24,ut);ee&&Ut(zt,ee)}}else if(t.type==="Polygon")for(const zt of eh(t.geometry,0)){const ee=vd(zt,16);Ut(zt[0],new Ao(ee.x,ee.y,0))}else if(t.type==="LineString")for(const zt of t.geometry)Ut(zt,new Ao(zt[0].x,zt[0].y,0));else if(t.type==="Point")for(const zt of t.geometry)for(const ee of zt)Ut([ee],new Ao(ee.x,ee.y,0))}const Co=32640;function jc(i,t,n,o,u,d,m,v,w,E,M,D,F,V,G){const J=function(gt,ct,mt,Et,It,jt,Kt,Nt){const Ot=Et.layout.get("text-rotate").evaluate(jt,{})*Math.PI/180,kt=[];for(const Zt of ct.positionedLines)for(const Ut of Zt.positionedGlyphs){if(!Ut.rect)continue;const zt=Ut.rect||{};let ee=4,Qt=!0,ve=1,ei=0;const ai=(It||Nt)&&Ut.vertical,Ai=Ut.metrics.advance*Ut.scale/2;if(Nt&&ct.verticalizable){const li=(Ut.scale-1)*ji,Fi=(ji-Ut.metrics.width*Ut.scale)/2;ei=Zt.lineOffset/2-(Ut.imageName?-Fi:li)}if(Ut.imageName){const li=Kt[Ut.imageName];Qt=li.sdf,ve=li.pixelRatio,ee=1/ve}const fr=It?[Ut.x+Ai,Ut.y]:[0,0];let Qi=It?[0,0]:[Ut.x+Ai+mt[0],Ut.y+mt[1]-ei],Si=[0,0];ai&&(Si=Qi,Qi=[0,0]);const Oi=(Ut.metrics.left-ee)*Ut.scale-Ai+Qi[0],tn=(-Ut.metrics.top-ee)*Ut.scale+Qi[1],pn=Oi+zt.w*Ut.scale/ve,Ln=tn+zt.h*Ut.scale/ve,Ii=new Yt(Oi,tn),en=new Yt(pn,tn),dn=new Yt(Oi,Ln),In=new Yt(pn,Ln);if(ai){const li=new Yt(-Ai,Ai-xl),Fi=-Math.PI/2,Te=12-Ai,Jn=new Yt(22-Te,-(Ut.imageName?Te:0)),nn=new Yt(...Si);Ii._rotateAround(Fi,li)._add(Jn)._add(nn),en._rotateAround(Fi,li)._add(Jn)._add(nn),dn._rotateAround(Fi,li)._add(Jn)._add(nn),In._rotateAround(Fi,li)._add(Jn)._add(nn)}if(Ot){const li=Math.sin(Ot),Fi=Math.cos(Ot),Te=[Fi,-li,li,Fi];Ii._matMult(Te),en._matMult(Te),dn._matMult(Te),In._matMult(Te)}const kn=new Yt(0,0),Dn=new Yt(0,0);kt.push({tl:Ii,tr:en,bl:dn,br:In,tex:zt,writingMode:ct.writingMode,glyphOffset:fr,sectionIndex:Ut.sectionIndex,isSDF:Qt,pixelOffsetTL:kn,pixelOffsetBR:Dn,minFontScaleX:0,minFontScaleY:0})}return kt}(0,n,v,u,d,m,o,i.allowVerticalPlacement),K=i.textSizeData;let ut=null;K.kind==="source"?(ut=[to*u.layout.get("text-size").evaluate(m,{})],ut[0]>Co&&ni(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(ut=[to*V.compositeTextSizes[0].evaluate(m,{},G),to*V.compositeTextSizes[1].evaluate(m,{},G)],(ut[0]>Co||ut[1]>Co)&&ni(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,J,ut,v,d,m,E,t,w.lineStartIndex,w.lineLength,F,G);for(const gt of M)D[gt]=i.text.placedSymbolArray.length-1;return 4*J.length}function Wc(i){for(const t in i)return i[t];return null}function wd(i,t,n,o){const u=i.compareText;if(t in u){const d=u[t];for(let m=d.length-1;m>=0;m--)if(o.dist(d[m])<n)return!0}else u[t]=[];return u[t].push(o),!1}const Td=Eo.VectorTileFeature.types,Sd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pl(i,t,n,o,u,d,m,v,w,E,M,D,F){const V=v?Math.min(Co,Math.round(v[0])):0,G=v?Math.min(Co,Math.round(v[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),d,m,(V<<1)+(w?1:0),G,16*E,16*M,256*D,256*F)}function mh(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function Id(i){for(const t of i.sections)if(ma(t.text))return!0;return!1}class _h{constructor(t){this.layoutVertexArray=new kr,this.indexArray=new wn,this.programConfigurations=t,this.segments=new be,this.dynamicLayoutVertexArray=new ur,this.opacityVertexArray=new Dr,this.placedSymbolArray=new Mt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Xp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Sd,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qt("SymbolBuffers",_h);class gh{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new be,this.collisionVertexArray=new Xn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Kp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qt("CollisionBuffers",gh);class Pa{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xl([]),this.placementViewportMatrix=Xl([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rc(this.zoom,n["text-size"]),this.iconSizeData=Rc(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=vh(o,"text-overlap","text-allow-overlap")!=="never"||vh(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>c.WritingMode[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new _h(new Yo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new _h(new Yo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Rt,this.lineVertexArray=new $t,this.symbolInstances=new Vt}calculateGlyphDependencies(t,n,o,u,d){for(let m=0;m<t.length;m++)if(n[t.charCodeAt(m)]=!0,(o||u)&&d){const v=Xa[t.charAt(m)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],d=u.layout,m=d.get("text-font"),v=d.get("text-field"),w=d.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof it&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),M=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,D=d.get("symbol-sort-key");if(this.features=[],!E&&!M)return;const F=n.iconDependencies,V=n.glyphDependencies,G=n.availableImages,J=new Qe(this.zoom);for(const{feature:K,id:ut,index:gt,sourceLayerIndex:ct}of t){const mt=u._featureFilter.needGeometry,Et=ta(K,mt);if(!u._featureFilter.filter(J,Et,o))continue;let It,jt;if(mt||(Et.geometry=Qo(K)),E){const Nt=u.getValueAndResolveTokens("text-field",Et,o,G),Ot=it.factory(Nt);Id(Ot)&&(this.hasRTLText=!0),(!this.hasRTLText||ws()==="unavailable"||this.hasRTLText&&un.isParsed())&&(It=Yp(Ot,u,Et))}if(M){const Nt=u.getValueAndResolveTokens("icon-image",Et,o,G);jt=Nt instanceof at?Nt:at.fromString(Nt)}if(!It&&!jt)continue;const Kt=this.sortFeaturesByKey?D.evaluate(Et,{},o):void 0;if(this.features.push({id:ut,text:It,icon:jt,index:gt,sourceLayerIndex:ct,geometry:Et.geometry,properties:K.properties,type:Td[K.type],sortKey:Kt}),jt&&(F[jt.name]=!0),It){const Nt=m.evaluate(Et,{},o).join(","),Ot=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.WritingMode.vertical)>=0;for(const kt of It.sections)if(kt.image)F[kt.image.name]=!0;else{const Zt=$s(It.toString()),Ut=kt.fontStack||Nt,zt=V[Ut]=V[Ut]||{};this.calculateGlyphDependencies(kt.text,zt,Ot,this.allowVerticalPlacement,Zt)}}}d.get("symbol-placement")==="line"&&(this.features=function(K){const ut={},gt={},ct=[];let mt=0;function Et(Nt){ct.push(K[Nt]),mt++}function It(Nt,Ot,kt){const Zt=gt[Nt];return delete gt[Nt],gt[Ot]=Zt,ct[Zt].geometry[0].pop(),ct[Zt].geometry[0]=ct[Zt].geometry[0].concat(kt[0]),Zt}function jt(Nt,Ot,kt){const Zt=ut[Ot];return delete ut[Ot],ut[Nt]=Zt,ct[Zt].geometry[0].shift(),ct[Zt].geometry[0]=kt[0].concat(ct[Zt].geometry[0]),Zt}function Kt(Nt,Ot,kt){const Zt=kt?Ot[0][Ot[0].length-1]:Ot[0][0];return`${Nt}:${Zt.x}:${Zt.y}`}for(let Nt=0;Nt<K.length;Nt++){const Ot=K[Nt],kt=Ot.geometry,Zt=Ot.text?Ot.text.toString():null;if(!Zt){Et(Nt);continue}const Ut=Kt(Zt,kt),zt=Kt(Zt,kt,!0);if(Ut in gt&&zt in ut&&gt[Ut]!==ut[zt]){const ee=jt(Ut,zt,kt),Qt=It(Ut,zt,ct[ee].geometry);delete ut[Ut],delete gt[zt],gt[Kt(Zt,ct[Qt].geometry,!0)]=Qt,ct[ee].geometry=null}else Ut in gt?It(Ut,zt,kt):zt in ut?jt(Ut,zt,kt):(Et(Nt),ut[Ut]=mt-1,gt[zt]=mt-1)}return ct.filter(Nt=>Nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ut)=>K.sortKey-ut.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),d=t.dist(n[t.segment]);const m={};for(let v=t.segment+1;v<n.length;v++)m[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:u},v<n.length-1&&(u+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)m[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:d},v>0&&(d+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const w=m[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,d,m,v,w,E,M,D,F){const V=t.indexArray,G=t.layoutVertexArray,J=t.segments.prepareSegment(4*n.length,G,V,this.canOverlap?m.sortKey:void 0),K=this.glyphOffsetArray.length,ut=J.vertexLength,gt=this.allowVerticalPlacement&&v===c.WritingMode.vertical?Math.PI/2:0,ct=m.text&&m.text.sections;for(let mt=0;mt<n.length;mt++){const{tl:Et,tr:It,bl:jt,br:Kt,tex:Nt,pixelOffsetTL:Ot,pixelOffsetBR:kt,minFontScaleX:Zt,minFontScaleY:Ut,glyphOffset:zt,isSDF:ee,sectionIndex:Qt}=n[mt],ve=J.vertexLength,ei=zt[1];Pl(G,w.x,w.y,Et.x,ei+Et.y,Nt.x,Nt.y,o,ee,Ot.x,Ot.y,Zt,Ut),Pl(G,w.x,w.y,It.x,ei+It.y,Nt.x+Nt.w,Nt.y,o,ee,kt.x,Ot.y,Zt,Ut),Pl(G,w.x,w.y,jt.x,ei+jt.y,Nt.x,Nt.y+Nt.h,o,ee,Ot.x,kt.y,Zt,Ut),Pl(G,w.x,w.y,Kt.x,ei+Kt.y,Nt.x+Nt.w,Nt.y+Nt.h,o,ee,kt.x,kt.y,Zt,Ut),mh(t.dynamicLayoutVertexArray,w,gt),V.emplaceBack(ve,ve+1,ve+2),V.emplaceBack(ve+1,ve+2,ve+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zt[0]),mt!==n.length-1&&Qt===n[mt+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,m,m.index,{},F,ct&&ct[Qt])}t.placedSymbolArray.emplaceBack(w.x,w.y,K,this.glyphOffsetArray.length-K,ut,E,M,w.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],v,0,!1,0,D)}_addCollisionDebugVertex(t,n,o,u,d,m){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,d,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,n,o,u,d,m,v){const w=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),E=w.vertexLength,M=d.layoutVertexArray,D=d.collisionVertexArray,F=v.anchorX,V=v.anchorY;this._addCollisionDebugVertex(M,D,m,F,V,new Yt(t,n)),this._addCollisionDebugVertex(M,D,m,F,V,new Yt(o,n)),this._addCollisionDebugVertex(M,D,m,F,V,new Yt(o,u)),this._addCollisionDebugVertex(M,D,m,F,V,new Yt(t,u)),w.vertexLength+=4;const G=d.indexArray;G.emplaceBack(E,E+1),G.emplaceBack(E+1,E+2),G.emplaceBack(E+2,E+3),G.emplaceBack(E+3,E),w.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let d=t;d<n;d++){const m=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gh(Ts,wc.members,ss),this.iconCollisionBox=new gh(Ts,wc.members,ss);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,d,m,v,w,E){const M={};for(let D=n;D<o;D++){const F=t.get(D);M.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.textFeatureIndex=F.featureIndex;break}for(let D=u;D<d;D++){const F=t.get(D);M.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalTextFeatureIndex=F.featureIndex;break}for(let D=m;D<v;D++){const F=t.get(D);M.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.iconFeatureIndex=F.featureIndex;break}for(let D=w;D<E;D++){const F=t.get(D);M.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},M.verticalIconFeatureIndex=F.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<u;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],d=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const w=this.symbolInstances.get(v);u.push(0|Math.round(n*w.anchorX+o*w.anchorY)),d.push(w.featureIndex)}return m.sort((v,w)=>u[v]-u[w]||d[w]-d[v]),m}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,d,m)=>{u>=0&&m.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}qt("SymbolBucket",Pa,{omit:["layers","collisionBoxArray","features","compareText"]}),Pa.MAX_GLYPHS=65535,Pa.addDynamicAttributes=mh;const Ed=new ie({"symbol-placement":new nt(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new nt(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nt(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nt(wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nt(wt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new nt(wt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new nt(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new nt(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nt(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(wt.layout_symbol["icon-size"]),"icon-text-fit":new nt(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nt(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(wt.layout_symbol["icon-image"]),"icon-rotate":new lt(wt.layout_symbol["icon-rotate"]),"icon-padding":new lt(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new nt(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(wt.layout_symbol["icon-offset"]),"icon-anchor":new lt(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nt(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nt(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nt(wt.layout_symbol["text-rotation-alignment"]),"text-field":new lt(wt.layout_symbol["text-field"]),"text-font":new lt(wt.layout_symbol["text-font"]),"text-size":new lt(wt.layout_symbol["text-size"]),"text-max-width":new lt(wt.layout_symbol["text-max-width"]),"text-line-height":new nt(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(wt.layout_symbol["text-letter-spacing"]),"text-justify":new lt(wt.layout_symbol["text-justify"]),"text-radial-offset":new lt(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nt(wt.layout_symbol["text-variable-anchor"]),"text-anchor":new lt(wt.layout_symbol["text-anchor"]),"text-max-angle":new nt(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new nt(wt.layout_symbol["text-writing-mode"]),"text-rotate":new lt(wt.layout_symbol["text-rotate"]),"text-padding":new nt(wt.layout_symbol["text-padding"]),"text-keep-upright":new nt(wt.layout_symbol["text-keep-upright"]),"text-transform":new lt(wt.layout_symbol["text-transform"]),"text-offset":new lt(wt.layout_symbol["text-offset"]),"text-allow-overlap":new nt(wt.layout_symbol["text-allow-overlap"]),"text-overlap":new nt(wt.layout_symbol["text-overlap"]),"text-ignore-placement":new nt(wt.layout_symbol["text-ignore-placement"]),"text-optional":new nt(wt.layout_symbol["text-optional"])});var yh={paint:new ie({"icon-opacity":new lt(wt.paint_symbol["icon-opacity"]),"icon-color":new lt(wt.paint_symbol["icon-color"]),"icon-halo-color":new lt(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new nt(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new nt(wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new lt(wt.paint_symbol["text-opacity"]),"text-color":new lt(wt.paint_symbol["text-color"],{runtimeType:wi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new lt(wt.paint_symbol["text-halo-color"]),"text-halo-width":new lt(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(wt.paint_symbol["text-halo-blur"]),"text-translate":new nt(wt.paint_symbol["text-translate"]),"text-translate-anchor":new nt(wt.paint_symbol["text-translate-anchor"])}),layout:Ed};class Hc{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:wr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt("FormatSectionOverride",Hc,{omit:["defaultValue"]});class Al extends ki{constructor(t){super(t,yh)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const d of o)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const d=this.layout.get(t).evaluate(n,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Xr(m.value)||!d?d:function(v,w){return w.replace(/{([^{}]+)}/g,(E,M)=>M in v?String(v[M]):"")}(n.properties,d)}createBucket(t){return new Pa(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of yh.paint.overridableProperties){if(!Al.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Hc(n),u=new vs(o,n.property.specification);let d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new Fs("source",u):new fo("composite",u,n.value.zoomStops),this.paint._values[t]=new N(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Al.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=yh.paint.properties[n];let d=!1;const m=v=>{for(const w of v)if(u.overrides&&u.overrides.hasOverride(w))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof it)m(o.value.value.sections);else if(o.value.kind==="source"){const v=E=>{d||(E instanceof Xt&&vt(E.value)===Ti?m(E.value.sections):E instanceof co?m(E.sections):E.eachChild(v))},w=o.value;w._styleExpression&&v(w._styleExpression.expression)}return d}}function vh(i,t,n){let o="never";const u=i.get(t);return u?o=u:i.get(n)&&(o="always"),o}var Pd={paint:new ie({"background-color":new nt(wt.paint_background["background-color"]),"background-pattern":new Wt(wt.paint_background["background-pattern"]),"background-opacity":new nt(wt.paint_background["background-opacity"])})},Ad={paint:new ie({"raster-opacity":new nt(wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new nt(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nt(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nt(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new nt(wt.paint_raster["raster-saturation"]),"raster-contrast":new nt(wt.paint_raster["raster-contrast"]),"raster-resampling":new nt(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new nt(wt.paint_raster["raster-fade-duration"])})};class Cd extends ki{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Md={circle:class extends ki{constructor(i){super(i,ap)}createBucket(i){return new jl(i)}queryRadius(i){const t=i;return Na("circle-radius",this,t)+Na("circle-stroke-width",this,t)+ul(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,n,o,u,d,m,v){const w=pl(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,m),E=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),M=this.paint.get("circle-pitch-alignment")==="map",D=M?w:function(V,G){return V.map(J=>sc(J,G))}(w,v),F=M?E*m:E;for(const V of o)for(const G of V){const J=M?G:sc(G,v);let K=F;const ut=dl([],[G.x,G.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?K*=ut[3]/d.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(K*=d.cameraToCenterDistance/ut[3]),ip(D,J,K))return!0}return!1}},heatmap:class extends ki{constructor(i){super(i,hp),this._updateColorRamp()}createBucket(i){return new oc(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ki{constructor(i){super(i,cp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ki{constructor(i){super(i,Ep)}recalculate(i,t){super.recalculate(i,t);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new rh(i)}queryRadius(){return ul(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,n,o,u,d,m){return Jh(pl(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,m),o)}isTileClipped(){return!0}},"fill-extrusion":class extends ki{constructor(i){super(i,Np)}createBucket(i){return new oh(i)}queryRadius(){return ul(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,n,o,u,d,m,v){const w=pl(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,m),E=this.paint.get("fill-extrusion-height").evaluate(t,n),M=this.paint.get("fill-extrusion-base").evaluate(t,n),D=function(V,G,J,K){const ut=[];for(const gt of V){const ct=[gt.x,gt.y,0,1];dl(ct,ct,G),ut.push(new Yt(ct[0]/ct[3],ct[1]/ct[3]))}return ut}(w,v),F=function(V,G,J,K){const ut=[],gt=[],ct=K[8]*G,mt=K[9]*G,Et=K[10]*G,It=K[11]*G,jt=K[8]*J,Kt=K[9]*J,Nt=K[10]*J,Ot=K[11]*J;for(const kt of V){const Zt=[],Ut=[];for(const zt of kt){const ee=zt.x,Qt=zt.y,ve=K[0]*ee+K[4]*Qt+K[12],ei=K[1]*ee+K[5]*Qt+K[13],ai=K[2]*ee+K[6]*Qt+K[14],Ai=K[3]*ee+K[7]*Qt+K[15],fr=ai+Et,Qi=Ai+It,Si=ve+jt,Oi=ei+Kt,tn=ai+Nt,pn=Ai+Ot,Ln=new Yt((ve+ct)/Qi,(ei+mt)/Qi);Ln.z=fr/Qi,Zt.push(Ln);const Ii=new Yt(Si/pn,Oi/pn);Ii.z=tn/pn,Ut.push(Ii)}ut.push(Zt),gt.push(Ut)}return[ut,gt]}(o,M,E,v);return function(V,G,J){let K=1/0;Jh(J,G)&&(K=gc(J,G[0]));for(let ut=0;ut<G.length;ut++){const gt=G[ut],ct=V[ut];for(let mt=0;mt<gt.length-1;mt++){const Et=gt[mt],It=[Et,gt[mt+1],ct[mt+1],ct[mt],Et];Kh(J,It)&&(K=Math.min(K,gc(J,It)))}}return K!==1/0&&K}(F[0],F[1],D)}},line:class extends ki{constructor(i){super(i,vc),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ar,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=xc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ah(i)}queryRadius(i){const t=i,n=bc(Na("line-width",this,t),Na("line-gap-width",this,t)),o=Na("line-offset",this,t);return n/2+Math.abs(o)+ul(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,n,o,u,d,m){const v=pl(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,m),w=m/2*bc(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),E=this.paint.get("line-offset").evaluate(t,n);return E&&(o=function(M,D){const F=[];for(let V=0;V<M.length;V++){const G=M[V],J=[];for(let K=0;K<G.length;K++){const ut=G[K-1],gt=G[K],ct=G[K+1],mt=K===0?new Yt(0,0):gt.sub(ut)._unit()._perp(),Et=K===G.length-1?new Yt(0,0):ct.sub(gt)._unit()._perp(),It=mt._add(Et)._unit(),jt=It.x*Et.x+It.y*Et.y;jt!==0&&It._mult(1/jt),J.push(It._mult(D)._add(gt))}F.push(J)}return F}(o,E*m)),function(M,D,F){for(let V=0;V<D.length;V++){const G=D[V];if(M.length>=3){for(let J=0;J<G.length;J++)if(xa(M,G[J]))return!0}if(np(M,G,F))return!0}return!1}(v,o,w)}isTileClipped(){return!0}},symbol:Al,background:class extends ki{constructor(i){super(i,Pd)}},raster:class extends ki{constructor(i){super(i,Ad)}}};class zd{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Xc=63710088e-1;class _i{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _i(ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,d=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return Xc*Math.acos(Math.min(d,1))}toBounds(t=0){const n=360*t/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new ia(new _i(this.lng-o,this.lat-n),new _i(this.lng+o,this.lat+n))}static convert(t){if(t instanceof _i)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _i(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _i(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ia{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof _i?new _i(t.lng,t.lat):_i.convert(t),this}setSouthWest(t){return this._sw=t instanceof _i?new _i(t.lng,t.lat):_i.convert(t),this}extend(t){const n=this._sw,o=this._ne;let u,d;if(t instanceof _i)u=t,d=t;else{if(!(t instanceof ia))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ia.convert(t)):this.extend(_i.convert(t)):this;if(u=t._sw,d=t._ne,!u||!d)return this}return n||o?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new _i(u.lng,u.lat),this._ne=new _i(d.lng,d.lat)),this}getCenter(){return new _i((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _i(this.getWest(),this.getNorth())}getSouthEast(){return new _i(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:o}=_i.convert(t);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&u}static convert(t){return t instanceof ia?t:t&&new ia(t)}}const Kc=2*Math.PI*Xc;function Jc(i){return Kc*Math.cos(i*Math.PI/180)}function Yc(i){return(180+i)/360}function Qc(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function tu(i,t){return i/Jc(t)}function xh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Cl{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=_i.convert(t);return new Cl(Yc(o.lng),Qc(o.lat),tu(n,o.lat))}toLngLat(){return new _i(360*this.x-180,xh(this.y))}toAltitude(){return this.z*Jc(xh(this.y))}meterInMercatorCoordinateUnits(){return 1/Kc*(t=xh(this.y),1/Math.cos(t*Math.PI/180));var t}}function eu(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class bh{constructor(t,n,o){if(t<0||t>25||o<0||o>=Math.pow(2,t)||n<0||n>=Math.pow(2,t))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=Ja(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(m=this.y,v=this.z,w=eu(256*(d=this.x),256*(m=Math.pow(2,v)-m-1),v),E=eu(256*(d+1),256*(m+1),v),w[0]+","+w[1]+","+E[0]+","+E[1]);var d,m,v,w,E;const M=function(D,F,V){let G,J="";for(let K=D;K>0;K--)G=1<<K-1,J+=(F&G?1:0)+(V&G?2:0);return J}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Yt((t.x*n-this.x)*Pi,(t.y*n-this.y)*Pi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class iu{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Ja(t,n.z,n.z,n.x,n.y)}}class dr{constructor(t,n,o,u,d){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new bh(o,+u,+d),this.key=Ja(n,t,o,u,d)}clone(){return new dr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new dr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Ja(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Ja(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new dr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new dr(n,this.wrap,n,o,u),new dr(n,this.wrap,n,o+1,u),new dr(n,this.wrap,n,o,u+1),new dr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new dr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new dr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new iu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Cl(t.x-this.wrap,t.y))}}function Ja(i,t,n,o,u){(i*=2)<0&&(i=-1*i-1);const d=1<<n;return(d*d*i+d*u+o).toString(36)+n.toString(36)+t.toString(36)}qt("CanonicalTileID",bh),qt("OverscaledTileID",dr,{omit:["posMatrix"]});class nu{constructor(t,n,o){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void ni(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const u=this.dim=n.height-2;this.data=new Uint32Array(n.data.buffer),this.encoding=o||"mapbox";for(let d=0;d<u;d++)this.data[this._idx(-1,d)]=this.data[this._idx(0,d)],this.data[this._idx(u,d)]=this.data[this._idx(u-1,d)],this.data[this._idx(d,-1)]=this.data[this._idx(d,0)],this.data[this._idx(d,u)]=this.data[this._idx(d,u-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(u,-1)]=this.data[this._idx(u-1,0)],this.data[this._idx(-1,u)]=this.data[this._idx(0,u-1)],this.data[this._idx(u,u)]=this.data[this._idx(u-1,u-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let d=0;d<u;d++)for(let m=0;m<u;m++){const v=this.get(d,m);v>this.max&&(this.max=v),v<this.min&&(this.min=v)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(o[u],o[u+1],o[u+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}_unpackMapbox(t,n,o){return(256*t*256+256*n+o)/10-1e4}_unpackTerrarium(t,n,o){return 256*t+n+o/256-32768}getPixels(){return new pr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,d=n*this.dim+this.dim,m=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:u=d-1;break;case 1:d=u+1}switch(o){case-1:m=v-1;break;case 1:v=m+1}const w=-n*this.dim,E=-o*this.dim;for(let M=m;M<v;M++)for(let D=u;D<d;D++)this.data[this._idx(D,M)]=t.data[this._idx(D+w,M+E)]}}qt("DEMData",nu);class ru{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class su{constructor(t,n,o,u,d){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class ou{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new qs(Pi,16,0),this.grid3D=new qs(Pi,16,0),this.featureIndexArray=new ye,this.promoteId=n}insert(t,n,o,u,d,m){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,d);const w=m?this.grid3D:this.grid;for(let E=0;E<n.length;E++){const M=n[E],D=[1/0,1/0,-1/0,-1/0];for(let F=0;F<M.length;F++){const V=M[F];D[0]=Math.min(D[0],V.x),D[1]=Math.min(D[1],V.y),D[2]=Math.max(D[2],V.x),D[3]=Math.max(D[3],V.y)}D[0]<Pi&&D[1]<Pi&&D[2]>=0&&D[3]>=0&&w.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Eo.VectorTile(new lh(this.rawTileData)).layers,this.sourceLayerCoder=new ru(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const d=t.params||{},m=Pi/t.tileSize/t.scale,v=_o(d.filter),w=t.queryGeometry,E=t.queryPadding*m,M=lu(w),D=this.grid.query(M.minX-E,M.minY-E,M.maxX+E,M.maxY+E),F=lu(t.cameraQueryGeometry),V=this.grid3D.query(F.minX-E,F.minY-E,F.maxX+E,F.maxY+E,(K,ut,gt,ct)=>function(mt,Et,It,jt,Kt){for(const Ot of mt)if(Et<=Ot.x&&It<=Ot.y&&jt>=Ot.x&&Kt>=Ot.y)return!0;const Nt=[new Yt(Et,It),new Yt(Et,Kt),new Yt(jt,Kt),new Yt(jt,It)];if(mt.length>2){for(const Ot of Nt)if(xa(mt,Ot))return!0}for(let Ot=0;Ot<mt.length-1;Ot++)if(sp(mt[Ot],mt[Ot+1],Nt))return!0;return!1}(t.cameraQueryGeometry,K-E,ut-E,gt+E,ct+E));for(const K of V)D.push(K);D.sort(Ld);const G={};let J;for(let K=0;K<D.length;K++){const ut=D[K];if(ut===J)continue;J=ut;const gt=this.featureIndexArray.get(ut);let ct=null;this.loadMatchingFeature(G,gt.bucketIndex,gt.sourceLayerIndex,gt.featureIndex,v,d.layers,d.availableImages,n,o,u,(mt,Et,It)=>(ct||(ct=Qo(mt)),Et.queryIntersectsFeature(w,mt,It,ct,this.z,t.transform,m,t.pixelPosMatrix)))}return G}loadMatchingFeature(t,n,o,u,d,m,v,w,E,M,D){const F=this.bucketLayerIDs[n];if(m&&!function(K,ut){for(let gt=0;gt<K.length;gt++)if(ut.indexOf(K[gt])>=0)return!0;return!1}(m,F))return;const V=this.sourceLayerCoder.decode(o),G=this.vtLayers[V].feature(u);if(d.needGeometry){const K=ta(G,!0);if(!d.filter(new Qe(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!d.filter(new Qe(this.tileID.overscaledZ),G))return;const J=this.getId(G,V);for(let K=0;K<F.length;K++){const ut=F[K];if(m&&m.indexOf(ut)<0)continue;const gt=w[ut];if(!gt)continue;let ct={};J&&M&&(ct=M.getState(gt.sourceLayer||"_geojsonTileLayer",J));const mt=$e({},E[ut]);mt.paint=au(mt.paint,gt.paint,G,ct,v),mt.layout=au(mt.layout,gt.layout,G,ct,v);const Et=!D||D(G,gt,ct);if(!Et)continue;const It=new su(G,this.z,this.x,this.y,J);It.layer=mt;let jt=t[ut];jt===void 0&&(jt=t[ut]=[]),jt.push({featureIndex:u,feature:It,intersectionZ:Et})}}lookupSymbolFeatures(t,n,o,u,d,m,v,w){const E={};this.loadVTLayers();const M=_o(d);for(const D of t)this.loadMatchingFeature(E,o,u,D,M,m,v,w,n);return E}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function au(i,t,n,o,u){return Fr(i,(d,m)=>{const v=t instanceof et?t.get(m):null;return v&&v.evaluate?v.evaluate(n,o,u):v})}function lu(i){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const d of i)t=Math.min(t,d.x),n=Math.min(n,d.y),o=Math.max(o,d.x),u=Math.max(u,d.y);return{minX:t,minY:n,maxX:o,maxY:u}}function Ld(i,t){return t-i}var wh;qt("FeatureIndex",ou,{omit:["rawTileData","sourceLayerCoder"]}),c.PerformanceMarkers=void 0,(wh=c.PerformanceMarkers||(c.PerformanceMarkers={})).create="create",wh.load="load",wh.fullLoad="fullLoad";let Ml=null,Ya=[];const Th=1e3/30,kd={mark(i){performance.mark(i)},frame(i){const t=i;Ml!=null&&Ya.push(t-Ml),Ml=t},clearMetrics(){Ml=null,Ya=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in c.PerformanceMarkers)performance.clearMarks(c.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",c.PerformanceMarkers.create,c.PerformanceMarkers.load),performance.measure("fullLoadTime",c.PerformanceMarkers.create,c.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,n=Ya.length,o=1/(Ya.reduce((d,m)=>d+m,0)/n/1e3),u=Ya.filter(d=>d>Th).reduce((d,m)=>d+(m-Th)/Th,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100}}};c.AJAXError=Vi,c.ARRAY_TYPE=Sn,c.Actor=class{constructor(i,t,n){this.target=i,this.parent=t,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Or(["receive","process"],this),this.invoker=new zd(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=rn()?i:window}send(i,t,n,o,u=!1){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[d]=n);const m=us(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:i,hasCallback:!!n,targetMapId:o,mustQueue:u,sourceMapId:this.mapId,data:es(t,m)},m),{cancel:()=>{n&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const t=i.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[n];const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o()}else rn()||t.mustQueue?(this.tasks[n]=t,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if(t.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(t.error?n(bn(t.error)):n(null,bn(t.data)))}else{let n=!1;const o=us(this.globalScope)?void 0:[],u=t.hasCallback?(v,w)=>{n=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:v?es(v):null,data:es(w,o)},o)}:v=>{n=!0};let d=null;const m=bn(t.data);if(this.parent[t.type])d=this.parent[t.type](t.sourceMapId,m,u);else if(this.parent.getWorkerSource){const v=t.type.split(".");d=this.parent.getWorkerSource(t.sourceMapId,v[0],m.source)[v[1]](m,u)}else u(new Error(`Could not find function ${t.type}`));!n&&d&&d.cancel&&(this.cancelCallbacks[i]=d.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.AlphaImage=Va,c.CanonicalTileID=bh,c.CollisionBoxArray=Tt,c.CollisionCircleLayoutArray=class extends z{},c.Color=$,c.DEMData=nu,c.DataConstantProperty=nt,c.DictionaryCoder=ru,c.EXTENT=Pi,c.ErrorEvent=xr,c.EvaluationParameters=Qe,c.Event=ir,c.Evented=Un,c.FeatureIndex=ou,c.FillBucket=rh,c.FillExtrusionBucket=oh,c.GeoJSONFeature=su,c.ImageAtlas=Mc,c.ImagePosition=ch,c.LineBucket=ah,c.LineStripIndexArray=class extends X{},c.LngLat=_i,c.LngLatBounds=ia,c.MercatorCoordinate=Cl,c.ONE_EM=ji,c.OverscaledTileID=dr,c.PerformanceUtils=kd,c.PosArray=te,c.Properties=ie,c.QuadTriangleArray=class extends Z{},c.RGBAImage=pr,c.RasterBoundsArray=class extends h{},c.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},c.ResourceType=on,c.SegmentVector=be,c.SymbolBucket=Pa,c.Transitionable=l,c.TriangleIndexArray=wn,c.Uniform1f=Js,c.Uniform1i=class extends Ks{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},c.Uniform2f=class extends Ks{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},c.Uniform3f=class extends Ks{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},c.Uniform4f=ya,c.UniformColor=jh,c.UniformMatrix4f=class extends Ks{constructor(i,t){super(i,t),this.current=tp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},c.UnwrappedTileID=iu,c.ValidationError=Bt,c.ZoomHistory=jo,c.add=function(i,t,n){return i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2],i},c.addDynamicAttributes=mh,c.asyncAll=function(i,t,n){if(!i.length)return n(null,[]);let o=i.length;const u=new Array(i.length);let d=null;i.forEach((m,v)=>{t(m,(w,E)=>{w&&(d=w),u[v]=E,--o==0&&n(d,u)})})},c.bezier=Se,c.bindAll=Or,c.cacheEntryPossiblyAdded=function(i){Pe++,Pe>yi&&(i.getActor().send("enforceCacheSizeLimit",gi),Pe=0)},c.clamp=dt,c.clearTileCache=function(i){const t=caches.delete(gn);i&&t.catch(i).then(()=>i())},c.clipLine=Vc,c.clone=function(i){var t=new Sn(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},c.clone$1=ii,c.clone$2=function(i){var t=new Sn(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},c.collisionCircleLayout=Jp,c.config=ae,c.copy=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},c.create=function(){var i=new Sn(16);return Sn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},c.create$1=tc,c.createExpression=Os,c.createFilter=_o,c.createLayout=mi,c.createStyleLayer=function(i){return i.type==="custom"?new Cd(i):new Md[i.type](i)},c.cross=function(i,t,n){var o=t[0],u=t[1],d=t[2],m=n[0],v=n[1],w=n[2];return i[0]=u*w-d*v,i[1]=d*m-o*w,i[2]=o*v-u*m,i},c.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},c.dot$1=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},c.ease=Gt,c.emitValidationErrors=ts,c.enforceCacheSizeLimit=function(i){ri(),re&&re.then(t=>{t.keys().then(n=>{for(let o=0;o<n.length-i;o++)t.delete(n[o])})})},c.equals=function(i,t){var n=i[0],o=i[1],u=i[2],d=i[3],m=i[4],v=i[5],w=i[6],E=i[7],M=i[8],D=i[9],F=i[10],V=i[11],G=i[12],J=i[13],K=i[14],ut=i[15],gt=t[0],ct=t[1],mt=t[2],Et=t[3],It=t[4],jt=t[5],Kt=t[6],Nt=t[7],Ot=t[8],kt=t[9],Zt=t[10],Ut=t[11],zt=t[12],ee=t[13],Qt=t[14],ve=t[15];return Math.abs(n-gt)<=Tn*Math.max(1,Math.abs(n),Math.abs(gt))&&Math.abs(o-ct)<=Tn*Math.max(1,Math.abs(o),Math.abs(ct))&&Math.abs(u-mt)<=Tn*Math.max(1,Math.abs(u),Math.abs(mt))&&Math.abs(d-Et)<=Tn*Math.max(1,Math.abs(d),Math.abs(Et))&&Math.abs(m-It)<=Tn*Math.max(1,Math.abs(m),Math.abs(It))&&Math.abs(v-jt)<=Tn*Math.max(1,Math.abs(v),Math.abs(jt))&&Math.abs(w-Kt)<=Tn*Math.max(1,Math.abs(w),Math.abs(Kt))&&Math.abs(E-Nt)<=Tn*Math.max(1,Math.abs(E),Math.abs(Nt))&&Math.abs(M-Ot)<=Tn*Math.max(1,Math.abs(M),Math.abs(Ot))&&Math.abs(D-kt)<=Tn*Math.max(1,Math.abs(D),Math.abs(kt))&&Math.abs(F-Zt)<=Tn*Math.max(1,Math.abs(F),Math.abs(Zt))&&Math.abs(V-Ut)<=Tn*Math.max(1,Math.abs(V),Math.abs(Ut))&&Math.abs(G-zt)<=Tn*Math.max(1,Math.abs(G),Math.abs(zt))&&Math.abs(J-ee)<=Tn*Math.max(1,Math.abs(J),Math.abs(ee))&&Math.abs(K-Qt)<=Tn*Math.max(1,Math.abs(K),Math.abs(Qt))&&Math.abs(ut-ve)<=Tn*Math.max(1,Math.abs(ut),Math.abs(ve))},c.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/to:i.kind==="composite"?We(o/to,u/to,n):t},c.evaluateSizeForZoom=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:m}=i,v=u?dt(Xi.interpolationFactor(u,t,d,m),0,1):0;i.kind==="camera"?o=We(i.minSize,i.maxSize,v):n=v}return{uSizeT:n,uSize:o}},c.evaluateVariableOffset=$c,c.evented=To,c.exported=_r,c.exported$1=De,c.extend=$e,c.filterObject=mn,c.fromRotation=function(i,t){var n=Math.sin(t),o=Math.cos(t);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},c.fromScaling=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},c.getAnchorAlignment=ph,c.getAnchorJustification=fh,c.getArrayBuffer=yr,c.getImage=tr,c.getJSON=function(i,t){return Zr($e(i,{type:"json"}),t)},c.getOverlapMode=vh,c.getRTLTextPluginStatus=ws,c.getReferrer=Es,c.getVideo=function(i,t){const n=window.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(let o=0;o<i.length;o++){const u=window.document.createElement("source");vr(i[o])||(n.crossOrigin="Anonymous"),u.src=i[o],n.appendChild(u)}return{cancel:()=>{}}},c.identity=Xl,c.invert=function(i,t){var n=t[0],o=t[1],u=t[2],d=t[3],m=t[4],v=t[5],w=t[6],E=t[7],M=t[8],D=t[9],F=t[10],V=t[11],G=t[12],J=t[13],K=t[14],ut=t[15],gt=n*v-o*m,ct=n*w-u*m,mt=n*E-d*m,Et=o*w-u*v,It=o*E-d*v,jt=u*E-d*w,Kt=M*J-D*G,Nt=M*K-F*G,Ot=M*ut-V*G,kt=D*K-F*J,Zt=D*ut-V*J,Ut=F*ut-V*K,zt=gt*Ut-ct*Zt+mt*kt+Et*Ot-It*Nt+jt*Kt;return zt?(i[0]=(v*Ut-w*Zt+E*kt)*(zt=1/zt),i[1]=(u*Zt-o*Ut-d*kt)*zt,i[2]=(J*jt-K*It+ut*Et)*zt,i[3]=(F*It-D*jt-V*Et)*zt,i[4]=(w*Ot-m*Ut-E*Nt)*zt,i[5]=(n*Ut-u*Ot+d*Nt)*zt,i[6]=(K*mt-G*jt-ut*ct)*zt,i[7]=(M*jt-F*mt+V*ct)*zt,i[8]=(m*Zt-v*Ot+E*Kt)*zt,i[9]=(o*Ot-n*Zt-d*Kt)*zt,i[10]=(G*It-J*mt+ut*gt)*zt,i[11]=(D*mt-M*It-V*gt)*zt,i[12]=(v*Nt-m*kt-w*Kt)*zt,i[13]=(n*kt-o*Nt+u*Kt)*zt,i[14]=(J*ct-G*Et-K*gt)*zt,i[15]=(M*Et-D*ct+F*gt)*zt,i):null},c.isImageBitmap=Ci,c.isSafari=us,c.isWorker=rn,c.keysDifference=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},c.lazyLoadRTLTextPlugin=function(){un.isLoading()||un.isLoaded()||ws()!=="deferred"||_a()},c.makeRequest=Zr,c.mapObject=Fr,c.mercatorXfromLng=Yc,c.mercatorYfromLat=Qc,c.mercatorZfromAltitude=tu,c.mul=lp,c.mul$1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},c.multiply=ec,c.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},c.normalize=function(i,t){var n=t[0],o=t[1],u=t[2],d=n*n+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),i[0]=t[0]*d,i[1]=t[1]*d,i[2]=t[2]*d,i},c.number=We,c.ortho=function(i,t,n,o,u,d,m){var v=1/(t-n),w=1/(o-u),E=1/(d-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(t+n)*v,i[13]=(u+o)*w,i[14]=(m+d)*E,i[15]=1,i},c.parseCacheControl=cs,c.parseGlyphPbf=function(i){return new lh(i).readFields(ld,[])},c.pbf=lh,c.performSymbolLayout=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Pi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0].layout,n=i.bucket.layers[0]._unevaluatedLayout._values,o={layoutIconSize:n["icon-size"].possiblyEvaluate(new Qe(i.bucket.zoom+1),i.canonical),layoutTextSize:n["text-size"].possiblyEvaluate(new Qe(i.bucket.zoom+1),i.canonical),textMaxSize:n["text-size"].possiblyEvaluate(new Qe(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:E}=i.bucket.textSizeData;o.compositeTextSizes=[n["text-size"].possiblyEvaluate(new Qe(w),i.canonical),n["text-size"].possiblyEvaluate(new Qe(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:E}=i.bucket.iconSizeData;o.compositeIconSizes=[n["icon-size"].possiblyEvaluate(new Qe(w),i.canonical),n["icon-size"].possiblyEvaluate(new Qe(E),i.canonical)]}const u=t.get("text-line-height")*ji,d=t.get("text-rotation-alignment")!=="viewport"&&t.get("symbol-placement")!=="point",m=t.get("text-keep-upright"),v=t.get("text-size");for(const w of i.bucket.features){const E=t.get("text-font").evaluate(w,{},i.canonical).join(","),M=v.evaluate(w,{},i.canonical),D=o.layoutTextSize.evaluate(w,{},i.canonical),F=o.layoutIconSize.evaluate(w,{},i.canonical),V={horizontal:{},vertical:void 0},G=w.text;let J,K=[0,0];if(G){const ct=G.toString(),mt=t.get("text-letter-spacing").evaluate(w,{},i.canonical)*ji,Et=fa(ct)?mt:0,It=t.get("text-anchor").evaluate(w,{},i.canonical),jt=t.get("text-variable-anchor");if(!jt){const Zt=t.get("text-radial-offset").evaluate(w,{},i.canonical);K=Zt?$c(It,[Zt*ji,dh]):t.get("text-offset").evaluate(w,{},i.canonical).map(Ut=>Ut*ji)}let Kt=d?"center":t.get("text-justify").evaluate(w,{},i.canonical);const Nt=t.get("symbol-placement"),Ot=Nt==="point"?t.get("text-max-width").evaluate(w,{},i.canonical)*ji:0,kt=()=>{i.bucket.allowVerticalPlacement&&$s(ct)&&(V.vertical=bl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,It,"left",Et,K,c.WritingMode.vertical,!0,Nt,D,M))};if(!d&&jt){const Zt=Kt==="auto"?jt.map(zt=>fh(zt)):[Kt];let Ut=!1;for(let zt=0;zt<Zt.length;zt++){const ee=Zt[zt];if(!V.horizontal[ee])if(Ut)V.horizontal[ee]=V.horizontal[0];else{const Qt=bl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,"center",ee,Et,K,c.WritingMode.horizontal,!1,Nt,D,M);Qt&&(V.horizontal[ee]=Qt,Ut=Qt.positionedLines.length===1)}}kt()}else{Kt==="auto"&&(Kt=fh(It));const Zt=bl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,It,Kt,Et,K,c.WritingMode.horizontal,!1,Nt,D,M);Zt&&(V.horizontal[Kt]=Zt),kt(),$s(ct)&&d&&m&&(V.vertical=bl(G,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ot,u,It,Kt,Et,K,c.WritingMode.vertical,!1,Nt,D,M))}}let ut=!1;if(w.icon&&w.icon.name){const ct=i.imageMap[w.icon.name];ct&&(J=fd(i.imagePositions[w.icon.name],t.get("icon-offset").evaluate(w,{},i.canonical),t.get("icon-anchor").evaluate(w,{},i.canonical)),ut=!!ct.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ut:i.bucket.sdfIcons!==ut&&ni("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ct.pixelRatio!==i.bucket.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const gt=Wc(V.horizontal)||V.vertical;i.bucket.iconsInText=!!gt&&gt.iconsInText,(gt||J)&&bd(i.bucket,w,V,J,i.imageMap,o,D,F,K,ut,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},c.perspective=function(i,t,n,o,u){var d,m=1/Math.tan(t/2);return i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(d=1/(o-u)),i[14]=2*u*o*d):(i[10]=-1,i[14]=-2*o),i},c.pick=function(i,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in i&&(n[u]=i[u])}return n},c.plugin=un,c.pointGeometry=Yt,c.polygonIntersectsPolygon=Kh,c.potpack=Cc,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.register=qt,c.registerForPluginStateChange=function(i){return i({pluginStatus:Yi,pluginURL:cr}),To.on("pluginStateChange",i),i},c.renderColorRamp=lc,c.rotateX=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),d=t[4],m=t[5],v=t[6],w=t[7],E=t[8],M=t[9],D=t[10],F=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=d*u+E*o,i[5]=m*u+M*o,i[6]=v*u+D*o,i[7]=w*u+F*o,i[8]=E*u-d*o,i[9]=M*u-m*o,i[10]=D*u-v*o,i[11]=F*u-w*o,i},c.rotateZ=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),d=t[0],m=t[1],v=t[2],w=t[3],E=t[4],M=t[5],D=t[6],F=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=d*u+E*o,i[1]=m*u+M*o,i[2]=v*u+D*o,i[3]=w*u+F*o,i[4]=E*u-d*o,i[5]=M*u-m*o,i[6]=D*u-v*o,i[7]=F*u-w*o,i},c.scale=function(i,t,n){var o=n[0],u=n[1],d=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*d,i[9]=t[9]*d,i[10]=t[10]*d,i[11]=t[11]*d,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},c.scale$1=function(i,t,n){return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i},c.setCacheLimits=function(i,t){gi=i,yi=t},c.setRTLTextPlugin=function(i,t,n=!1){if(Yi===bs||Yi===is||Yi===bo)throw new Error("setRTLTextPlugin cannot be called multiple times.");cr=_r.resolveURL(i),Yi=bs,wo=t,ns(),n||_a()},c.spec=wt,c.sphericalToCartesian=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},c.sqrLen=function(i){var t=i[0],n=i[1];return t*t+n*n},c.sub=function(i,t,n){return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i},c.toEvaluationFeature=ta,c.transformMat3=function(i,t,n){var o=t[0],u=t[1],d=t[2];return i[0]=o*n[0]+u*n[3]+d*n[6],i[1]=o*n[1]+u*n[4]+d*n[7],i[2]=o*n[2]+u*n[5]+d*n[8],i},c.transformMat4=dl,c.transformMat4$1=function(i,t,n){var o=t[0],u=t[1];return i[0]=n[0]*o+n[4]*u+n[12],i[1]=n[1]*o+n[5]*u+n[13],i},c.translate=function(i,t,n){var o,u,d,m,v,w,E,M,D,F,V,G,J=n[0],K=n[1],ut=n[2];return t===i?(i[12]=t[0]*J+t[4]*K+t[8]*ut+t[12],i[13]=t[1]*J+t[5]*K+t[9]*ut+t[13],i[14]=t[2]*J+t[6]*K+t[10]*ut+t[14],i[15]=t[3]*J+t[7]*K+t[11]*ut+t[15]):(u=t[1],d=t[2],m=t[3],v=t[4],w=t[5],E=t[6],M=t[7],D=t[8],F=t[9],V=t[10],G=t[11],i[0]=o=t[0],i[1]=u,i[2]=d,i[3]=m,i[4]=v,i[5]=w,i[6]=E,i[7]=M,i[8]=D,i[9]=F,i[10]=V,i[11]=G,i[12]=o*J+v*K+D*ut+t[12],i[13]=u*J+w*K+F*ut+t[13],i[14]=d*J+E*K+V*ut+t[14],i[15]=m*J+M*K+G*ut+t[15]),i},c.triggerPluginCompletionEvent=Ko,c.unicodeBlockLookup=Dt,c.uniqueId=function(){return ce++},c.validateCustomStyleLayer=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},c.validateLight=xo,c.validateStyle=Gs,c.vectorTile=Eo,c.warnOnce=ni,c.wrap=ci}),Y(["./shared"],function(c){function Pt(U){const C=typeof U;if(C==="number"||C==="boolean"||C==="string"||U==null)return JSON.stringify(U);if(Array.isArray(U)){let $="[";for(const Q of U)$+=`${Pt(Q)},`;return`${$}]`}const B=Object.keys(U).sort();let q="{";for(let $=0;$<B.length;$++)q+=`${JSON.stringify(B[$])}:${Pt(U[B[$]])},`;return`${q}}`}function Jt(U){let C="";for(const B of c.refProperties)C+=`/${Pt(U[B])}`;return C}class Se{constructor(C){this.keyCache={},C&&this.replace(C)}replace(C){this._layerConfigs={},this._layers={},this.update(C,[])}update(C,B){for(const $ of C){this._layerConfigs[$.id]=$;const Q=this._layers[$.id]=c.createStyleLayer($);Q._featureFilter=c.createFilter(Q.filter),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(const $ of B)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};const q=function($,Q){const st={};for(let tt=0;tt<$.length;tt++){const at=Q&&Q[$[tt].id]||Jt($[tt]);Q&&(Q[$[tt].id]=at);let xt=st[at];xt||(xt=st[at]=[]),xt.push($[tt])}const it=[];for(const tt in st)it.push(st[tt]);return it}(Object.values(this._layerConfigs),this.keyCache);for(const $ of q){const Q=$.map(At=>this._layers[At.id]),st=Q[0];if(st.visibility==="none")continue;const it=st.source||"";let tt=this.familiesBySource[it];tt||(tt=this.familiesBySource[it]={});const at=st.sourceLayer||"_geojsonTileLayer";let xt=tt[at];xt||(xt=tt[at]=[]),xt.push(Q)}}}class Gt{constructor(C){const B={},q=[];for(const it in C){const tt=C[it],at=B[it]={};for(const xt in tt){const At=tt[+xt];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const vt={x:0,y:0,w:At.bitmap.width+2,h:At.bitmap.height+2};q.push(vt),at[xt]={rect:vt,metrics:At.metrics}}}const{w:$,h:Q}=c.potpack(q),st=new c.AlphaImage({width:$||1,height:Q||1});for(const it in C){const tt=C[it];for(const at in tt){const xt=tt[+at];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const At=B[it][at].rect;c.AlphaImage.copy(xt.bitmap,st,{x:0,y:0},{x:At.x+1,y:At.y+1},xt.bitmap)}}this.image=st,this.positions=B}}c.register("GlyphAtlas",Gt);class dt{constructor(C){this.tileID=new c.OverscaledTileID(C.tileID.overscaledZ,C.tileID.wrap,C.tileID.canonical.z,C.tileID.canonical.x,C.tileID.canonical.y),this.uid=C.uid,this.zoom=C.zoom,this.pixelRatio=C.pixelRatio,this.tileSize=C.tileSize,this.source=C.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=C.showCollisionBoxes,this.collectResourceTiming=!!C.collectResourceTiming,this.returnDependencies=!!C.returnDependencies,this.promoteId=C.promoteId}parse(C,B,q,$,Q){this.status="parsing",this.data=C,this.collisionBoxArray=new c.CollisionBoxArray;const st=new c.DictionaryCoder(Object.keys(C.layers).sort()),it=new c.FeatureIndex(this.tileID,this.promoteId);it.bucketLayerIDs=[];const tt={},at={featureIndex:it,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},xt=B.familiesBySource[this.source];for(const he in xt){const _e=C.layers[he];if(!_e)continue;_e.version===1&&c.warnOnce(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const we=st.encode(he),Be=[];for(let vi=0;vi<_e.length;vi++){const Ke=_e.feature(vi),fi=it.getId(Ke,he);Be.push({feature:Ke,id:fi,index:vi,sourceLayerIndex:we})}for(const vi of xt[he]){const Ke=vi[0];Ke.source!==this.source&&c.warnOnce(`layer.source = ${Ke.source} does not equal this.source = ${this.source}`),Ke.minzoom&&this.zoom<Math.floor(Ke.minzoom)||Ke.maxzoom&&this.zoom>=Ke.maxzoom||Ke.visibility!=="none"&&(ci(vi,this.zoom,q),(tt[Ke.id]=Ke.createBucket({index:it.bucketLayerIDs.length,layers:vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:we,sourceID:this.source})).populate(Be,at,this.tileID.canonical),it.bucketLayerIDs.push(vi.map(fi=>fi.id)))}}let At,vt,Ht,Xt;const Ft=c.mapObject(at.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(Ft).length?$.send("getGlyphs",{uid:this.uid,stacks:Ft},(he,_e)=>{At||(At=he,vt=_e,Me.call(this))}):vt={};const ne=Object.keys(at.iconDependencies);ne.length?$.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(he,_e)=>{At||(At=he,Ht=_e,Me.call(this))}):Ht={};const se=Object.keys(at.patternDependencies);function Me(){if(At)return Q(At);if(vt&&Ht&&Xt){const he=new Gt(vt),_e=new c.ImageAtlas(Ht,Xt);for(const we in tt){const Be=tt[we];Be instanceof c.SymbolBucket?(ci(Be.layers,this.zoom,q),c.performSymbolLayout({bucket:Be,glyphMap:vt,glyphPositions:he.positions,imageMap:Ht,imagePositions:_e.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Be.hasPattern&&(Be instanceof c.LineBucket||Be instanceof c.FillBucket||Be instanceof c.FillExtrusionBucket)&&(ci(Be.layers,this.zoom,q),Be.addFeatures(at,this.tileID.canonical,_e.patternPositions))}this.status="done",Q(null,{buckets:Object.values(tt).filter(we=>!we.isEmpty()),featureIndex:it,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,imageAtlas:_e,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?Ht:null,glyphPositions:this.returnDependencies?he.positions:null})}}se.length?$.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"patterns"},(he,_e)=>{At||(At=he,Xt=_e,Me.call(this))}):Xt={},Me.call(this)}}function ci(U,C,B){const q=new c.EvaluationParameters(C);for(const $ of U)$.recalculate(q,B)}function $e(U,C){const B=c.getArrayBuffer(U.request,(q,$,Q,st)=>{q?C(q):$&&C(null,{vectorTile:new c.vectorTile.VectorTile(new c.pbf($)),rawData:$,cacheControl:Q,expires:st})});return()=>{B.cancel(),C()}}class ce{constructor(C,B,q,$){this.actor=C,this.layerIndex=B,this.availableImages=q,this.loadVectorData=$||$e,this.loading={},this.loaded={}}loadTile(C,B){const q=C.uid;this.loading||(this.loading={});const $=!!(C&&C.request&&C.request.collectResourceTiming)&&new c.RequestPerformance(C.request),Q=this.loading[q]=new dt(C);Q.abort=this.loadVectorData(C,(st,it)=>{if(delete this.loading[q],st||!it)return Q.status="done",this.loaded[q]=Q,B(st);const tt=it.rawData,at={};it.expires&&(at.expires=it.expires),it.cacheControl&&(at.cacheControl=it.cacheControl);const xt={};if($){const At=$.finish();At&&(xt.resourceTiming=JSON.parse(JSON.stringify(At)))}Q.vectorTile=it.vectorTile,Q.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor,(At,vt)=>{if(At||!vt)return B(At);B(null,c.extend({rawTileData:tt.slice(0)},vt,at,xt))}),this.loaded=this.loaded||{},this.loaded[q]=Q})}reloadTile(C,B){const q=this.loaded,$=C.uid,Q=this;if(q&&q[$]){const st=q[$];st.showCollisionBoxes=C.showCollisionBoxes;const it=(tt,at)=>{const xt=st.reloadCallback;xt&&(delete st.reloadCallback,st.parse(st.vectorTile,Q.layerIndex,this.availableImages,Q.actor,xt)),B(tt,at)};st.status==="parsing"?st.reloadCallback=it:st.status==="done"&&(st.vectorTile?st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor,it):it())}}abortTile(C,B){const q=this.loading,$=C.uid;q&&q[$]&&q[$].abort&&(q[$].abort(),delete q[$]),B()}removeTile(C,B){const q=this.loaded,$=C.uid;q&&q[$]&&delete q[$],B()}}class Or{constructor(){this.loaded={}}loadTile(C,B){const{uid:q,encoding:$,rawImageData:Q}=C,st=c.isImageBitmap(Q)?this.getImageData(Q):Q,it=new c.DEMData(q,st,$);this.loaded=this.loaded||{},this.loaded[q]=it,B(null,it)}getImageData(C){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(C.width,C.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=C.width,this.offscreenCanvas.height=C.height,this.offscreenCanvasContext.drawImage(C,0,0,C.width,C.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,C.width+2,C.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new c.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(C){const B=this.loaded,q=C.uid;B&&B[q]&&delete B[q]}}var Fr=function U(C,B){var q,$=C&&C.type;if($==="FeatureCollection")for(q=0;q<C.features.length;q++)U(C.features[q],B);else if($==="GeometryCollection")for(q=0;q<C.geometries.length;q++)U(C.geometries[q],B);else if($==="Feature")U(C.geometry,B);else if($==="Polygon")mn(C.coordinates,B);else if($==="MultiPolygon")for(q=0;q<C.coordinates.length;q++)mn(C.coordinates[q],B);return C};function mn(U,C){if(U.length!==0){ii(U[0],C);for(var B=1;B<U.length;B++)ii(U[B],!C)}}function ii(U,C){for(var B=0,q=0,$=0,Q=U.length,st=Q-1;$<Q;st=$++){var it=(U[$][0]-U[st][0])*(U[st][1]+U[$][1]),tt=B+it;q+=Math.abs(B)>=Math.abs(it)?B-tt+it:it-tt+B,B=tt}B+q>=0!=!!C&&U.reverse()}const Ur=c.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ni{constructor(C){this._feature=C,this.extent=c.EXTENT,this.type=C.type,this.properties=C.tags,"id"in C&&!isNaN(C.id)&&(this.id=parseInt(C.id,10))}loadGeometry(){if(this._feature.type===1){const C=[];for(const B of this._feature.geometry)C.push([new c.pointGeometry(B[0],B[1])]);return C}{const C=[];for(const B of this._feature.geometry){const q=[];for(const $ of B)q.push(new c.pointGeometry($[0],$[1]));C.push(q)}return C}}toGeoJSON(C,B,q){return Ur.call(this,C,B,q)}}class _n{constructor(C){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=C.length,this._features=C}feature(C){return new ni(this._features[C])}}var Yn={exports:{}},rn=c.pointGeometry,cs=c.vectorTile.VectorTileFeature,On=ui;function ui(U,C){this.options=C||{},this.features=U,this.length=U.length}function pi(U,C){this.id=typeof U.id=="number"?U.id:void 0,this.type=U.type,this.rawGeometry=U.type===1?[U.geometry]:U.geometry,this.properties=U.tags,this.extent=C||4096}ui.prototype.feature=function(U){return new pi(this.features[U],this.options.extent)},pi.prototype.loadGeometry=function(){var U=this.rawGeometry;this.geometry=[];for(var C=0;C<U.length;C++){for(var B=U[C],q=[],$=0;$<B.length;$++)q.push(new rn(B[$][0],B[$][1]));this.geometry.push(q)}return this.geometry},pi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var U=this.geometry,C=1/0,B=-1/0,q=1/0,$=-1/0,Q=0;Q<U.length;Q++)for(var st=U[Q],it=0;it<st.length;it++){var tt=st[it];C=Math.min(C,tt.x),B=Math.max(B,tt.x),q=Math.min(q,tt.y),$=Math.max($,tt.y)}return[C,q,B,$]},pi.prototype.toGeoJSON=cs.prototype.toGeoJSON;var us=c.pbf,Ci=On;function _r(U){var C=new us;return function(B,q){for(var $ in B.layers)q.writeMessage(3,Yt,B.layers[$])}(U,C),C.finish()}function Yt(U,C){var B;C.writeVarintField(15,U.version||1),C.writeStringField(1,U.name||""),C.writeVarintField(5,U.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<U.length;B++)q.feature=U.feature(B),C.writeMessage(2,sn,q);var $=q.keys;for(B=0;B<$.length;B++)C.writeStringField(3,$[B]);var Q=q.values;for(B=0;B<Q.length;B++)C.writeMessage(4,gi,Q[B])}function sn(U,C){var B=U.feature;B.id!==void 0&&C.writeVarintField(1,B.id),C.writeMessage(2,ae,U),C.writeVarintField(3,B.type),C.writeMessage(4,Ze,B)}function ae(U,C){var B=U.feature,q=U.keys,$=U.values,Q=U.keycache,st=U.valuecache;for(var it in B.properties){var tt=B.properties[it],at=Q[it];if(tt!==null){at===void 0&&(q.push(it),Q[it]=at=q.length-1),C.writeVarint(at);var xt=typeof tt;xt!=="string"&&xt!=="boolean"&&xt!=="number"&&(tt=JSON.stringify(tt));var At=xt+":"+tt,vt=st[At];vt===void 0&&($.push(tt),st[At]=vt=$.length-1),C.writeVarint(vt)}}}function gn(U,C){return(C<<3)+(7&U)}function re(U){return U<<1^U>>31}function Ze(U,C){for(var B=U.loadGeometry(),q=U.type,$=0,Q=0,st=B.length,it=0;it<st;it++){var tt=B[it],at=1;q===1&&(at=tt.length),C.writeVarint(gn(1,at));for(var xt=q===3?tt.length-1:tt.length,At=0;At<xt;At++){At===1&&q!==1&&C.writeVarint(gn(2,xt-1));var vt=tt[At].x-$,Ht=tt[At].y-Q;C.writeVarint(re(vt)),C.writeVarint(re(Ht)),$+=vt,Q+=Ht}q===3&&C.writeVarint(gn(7,1))}}function gi(U,C){var B=typeof U;B==="string"?C.writeStringField(1,U):B==="boolean"?C.writeBooleanField(7,U):B==="number"&&(U%1!=0?C.writeDoubleField(3,U):U<0?C.writeSVarintField(6,U):C.writeVarintField(5,U))}function yi(U,C,B,q,$,Q){if($-q<=B)return;const st=q+$>>1;ri(U,C,st,q,$,Q%2),yi(U,C,B,q,st-1,Q+1),yi(U,C,B,st+1,$,Q+1)}function ri(U,C,B,q,$,Q){for(;$>q;){if($-q>600){const at=$-q+1,xt=B-q+1,At=Math.log(at),vt=.5*Math.exp(2*At/3),Ht=.5*Math.sqrt(At*vt*(at-vt)/at)*(xt-at/2<0?-1:1);ri(U,C,B,Math.max(q,Math.floor(B-xt*vt/at+Ht)),Math.min($,Math.floor(B+(at-xt)*vt/at+Ht)),Q)}const st=C[2*B+Q];let it=q,tt=$;for(Pe(U,C,q,B),C[2*$+Q]>st&&Pe(U,C,q,$);it<tt;){for(Pe(U,C,it,tt),it++,tt--;C[2*it+Q]<st;)it++;for(;C[2*tt+Q]>st;)tt--}C[2*q+Q]===st?Pe(U,C,q,tt):(tt++,Pe(U,C,tt,$)),tt<=B&&(q=tt+1),B<=tt&&($=tt-1)}}function Pe(U,C,B,q){De(U,B,q),De(C,2*B,2*q),De(C,2*B+1,2*q+1)}function De(U,C,B){const q=U[C];U[C]=U[B],U[B]=q}function Mi(U,C,B,q){const $=U-B,Q=C-q;return $*$+Q*Q}Yn.exports=_r,Yn.exports.fromVectorTileJs=_r,Yn.exports.fromGeojsonVt=function(U,C){C=C||{};var B={};for(var q in U)B[q]=new Ci(U[q].features,C),B[q].name=q,B[q].version=C.version,B[q].extent=C.extent;return _r({layers:B})},Yn.exports.GeoJSONWrapper=Ci;const Ni=U=>U[0],Zi=U=>U[1];class gr{constructor(C,B=Ni,q=Zi,$=64,Q=Float64Array){this.nodeSize=$,this.points=C;const st=C.length<65536?Uint16Array:Uint32Array,it=this.ids=new st(C.length),tt=this.coords=new Q(2*C.length);for(let at=0;at<C.length;at++)it[at]=at,tt[2*at]=B(C[at]),tt[2*at+1]=q(C[at]);yi(it,tt,$,0,it.length-1,0)}range(C,B,q,$){return function(Q,st,it,tt,at,xt,At){const vt=[0,Q.length-1,0],Ht=[];let Xt,Ft;for(;vt.length;){const ne=vt.pop(),se=vt.pop(),Me=vt.pop();if(se-Me<=At){for(let we=Me;we<=se;we++)Xt=st[2*we],Ft=st[2*we+1],Xt>=it&&Xt<=at&&Ft>=tt&&Ft<=xt&&Ht.push(Q[we]);continue}const he=Math.floor((Me+se)/2);Xt=st[2*he],Ft=st[2*he+1],Xt>=it&&Xt<=at&&Ft>=tt&&Ft<=xt&&Ht.push(Q[he]);const _e=(ne+1)%2;(ne===0?it<=Xt:tt<=Ft)&&(vt.push(Me),vt.push(he-1),vt.push(_e)),(ne===0?at>=Xt:xt>=Ft)&&(vt.push(he+1),vt.push(se),vt.push(_e))}return Ht}(this.ids,this.coords,C,B,q,$,this.nodeSize)}within(C,B,q){return function($,Q,st,it,tt,at){const xt=[0,$.length-1,0],At=[],vt=tt*tt;for(;xt.length;){const Ht=xt.pop(),Xt=xt.pop(),Ft=xt.pop();if(Xt-Ft<=at){for(let _e=Ft;_e<=Xt;_e++)Mi(Q[2*_e],Q[2*_e+1],st,it)<=vt&&At.push($[_e]);continue}const ne=Math.floor((Ft+Xt)/2),se=Q[2*ne],Me=Q[2*ne+1];Mi(se,Me,st,it)<=vt&&At.push($[ne]);const he=(Ht+1)%2;(Ht===0?st-tt<=se:it-tt<=Me)&&(xt.push(Ft),xt.push(ne-1),xt.push(he)),(Ht===0?st+tt>=se:it+tt>=Me)&&(xt.push(ne+1),xt.push(Xt),xt.push(he))}return At}(this.ids,this.coords,C,B,q,this.nodeSize)}}const Nr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:U=>U},on=Math.fround||(Vi=new Float32Array(1),U=>(Vi[0]=+U,Vi[0]));var Vi;class Es{constructor(C){this.options=tr(Object.create(Nr),C),this.trees=new Array(this.options.maxZoom+1)}load(C){const{log:B,minZoom:q,maxZoom:$,nodeSize:Q}=this.options;B&&console.time("total time");const st=`prepare ${C.length} points`;B&&console.time(st),this.points=C;let it=[];for(let tt=0;tt<C.length;tt++)C[tt].geometry&&it.push(Zr(C[tt],tt));this.trees[$+1]=new gr(it,ps,er,Q,Float32Array),B&&console.timeEnd(st);for(let tt=$;tt>=q;tt--){const at=+Date.now();it=this._cluster(it,tt),this.trees[tt]=new gr(it,ps,er,Q,Float32Array),B&&console.log("z%d: %d clusters in %dms",tt,it.length,+Date.now()-at)}return B&&console.timeEnd("total time"),this}getClusters(C,B){let q=((C[0]+180)%360+360)%360-180;const $=Math.max(-90,Math.min(90,C[1]));let Q=C[2]===180?180:((C[2]+180)%360+360)%360-180;const st=Math.max(-90,Math.min(90,C[3]));if(C[2]-C[0]>=360)q=-180,Q=180;else if(q>Q){const xt=this.getClusters([q,$,180,st],B),At=this.getClusters([-180,$,Q,st],B);return xt.concat(At)}const it=this.trees[this._limitZoom(B)],tt=it.range(Ae(q),En(st),Ae(Q),En($)),at=[];for(const xt of tt){const At=it.points[xt];at.push(At.numPoints?yr(At):this.points[At.index])}return at}getChildren(C){const B=this._getOriginId(C),q=this._getOriginZoom(C),$="No cluster with the specified id.",Q=this.trees[q];if(!Q)throw new Error($);const st=Q.points[B];if(!st)throw new Error($);const it=this.options.radius/(this.options.extent*Math.pow(2,q-1)),tt=Q.within(st.x,st.y,it),at=[];for(const xt of tt){const At=Q.points[xt];At.parentId===C&&at.push(At.numPoints?yr(At):this.points[At.index])}if(at.length===0)throw new Error($);return at}getLeaves(C,B,q){const $=[];return this._appendLeaves($,C,B=B||10,q=q||0,0),$}getTile(C,B,q){const $=this.trees[this._limitZoom(C)],Q=Math.pow(2,C),{extent:st,radius:it}=this.options,tt=it/st,at=(q-tt)/Q,xt=(q+1+tt)/Q,At={features:[]};return this._addTileFeatures($.range((B-tt)/Q,at,(B+1+tt)/Q,xt),$.points,B,q,Q,At),B===0&&this._addTileFeatures($.range(1-tt/Q,at,1,xt),$.points,Q,q,Q,At),B===Q-1&&this._addTileFeatures($.range(0,at,tt/Q,xt),$.points,-1,q,Q,At),At.features.length?At:null}getClusterExpansionZoom(C){let B=this._getOriginZoom(C)-1;for(;B<=this.options.maxZoom;){const q=this.getChildren(C);if(B++,q.length!==1)break;C=q[0].properties.cluster_id}return B}_appendLeaves(C,B,q,$,Q){const st=this.getChildren(B);for(const it of st){const tt=it.properties;if(tt&&tt.cluster?Q+tt.point_count<=$?Q+=tt.point_count:Q=this._appendLeaves(C,tt.cluster_id,q,$,Q):Q<$?Q++:C.push(it),C.length===q)break}return Q}_addTileFeatures(C,B,q,$,Q,st){for(const it of C){const tt=B[it],at=tt.numPoints;let xt,At,vt;if(at)xt=vr(tt),At=tt.x,vt=tt.y;else{const Ft=this.points[tt.index];xt=Ft.properties,At=Ae(Ft.geometry.coordinates[0]),vt=En(Ft.geometry.coordinates[1])}const Ht={type:1,geometry:[[Math.round(this.options.extent*(At*Q-q)),Math.round(this.options.extent*(vt*Q-$))]],tags:xt};let Xt;at?Xt=tt.id:this.options.generateId?Xt=tt.index:this.points[tt.index].id&&(Xt=this.points[tt.index].id),Xt!==void 0&&(Ht.id=Xt),st.features.push(Ht)}}_limitZoom(C){return Math.max(this.options.minZoom,Math.min(Math.floor(+C),this.options.maxZoom+1))}_cluster(C,B){const q=[],{radius:$,extent:Q,reduce:st,minPoints:it}=this.options,tt=$/(Q*Math.pow(2,B));for(let at=0;at<C.length;at++){const xt=C[at];if(xt.zoom<=B)continue;xt.zoom=B;const At=this.trees[B+1],vt=At.within(xt.x,xt.y,tt),Ht=xt.numPoints||1;let Xt=Ht;for(const Ft of vt){const ne=At.points[Ft];ne.zoom>B&&(Xt+=ne.numPoints||1)}if(Xt>Ht&&Xt>=it){let Ft=xt.x*Ht,ne=xt.y*Ht,se=st&&Ht>1?this._map(xt,!0):null;const Me=(at<<5)+(B+1)+this.points.length;for(const he of vt){const _e=At.points[he];if(_e.zoom<=B)continue;_e.zoom=B;const we=_e.numPoints||1;Ft+=_e.x*we,ne+=_e.y*we,_e.parentId=Me,st&&(se||(se=this._map(xt,!0)),st(se,this._map(_e)))}xt.parentId=Me,q.push(Qn(Ft/Xt,ne/Xt,Me,Xt,se))}else if(q.push(xt),Xt>1)for(const Ft of vt){const ne=At.points[Ft];ne.zoom<=B||(ne.zoom=B,q.push(ne))}}return q}_getOriginId(C){return C-this.points.length>>5}_getOriginZoom(C){return(C-this.points.length)%32}_map(C,B){if(C.numPoints)return B?tr({},C.properties):C.properties;const q=this.points[C.index].properties,$=this.options.map(q);return B&&$===q?tr({},$):$}}function Qn(U,C,B,q,$){return{x:on(U),y:on(C),zoom:1/0,id:B,parentId:-1,numPoints:q,properties:$}}function Zr(U,C){const[B,q]=U.geometry.coordinates;return{x:on(Ae(B)),y:on(En(q)),zoom:1/0,index:C,parentId:-1}}function yr(U){return{type:"Feature",id:U.id,properties:vr(U),geometry:{type:"Point",coordinates:[(C=U.x,360*(C-.5)),Fn(U.y)]}};var C}function vr(U){const C=U.numPoints,B=C>=1e4?`${Math.round(C/1e3)}k`:C>=1e3?Math.round(C/100)/10+"k":C;return tr(tr({},U.properties),{cluster:!0,cluster_id:U.id,point_count:C,point_count_abbreviated:B})}function Ae(U){return U/360+.5}function En(U){const C=Math.sin(U*Math.PI/180),B=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return B<0?0:B>1?1:B}function Fn(U){const C=(180-360*U)*Math.PI/180;return 360*Math.atan(Math.exp(C))/Math.PI-90}function tr(U,C){for(const B in C)U[B]=C[B];return U}function ps(U){return U.x}function er(U){return U.y}function ir(U,C,B,q){for(var $,Q=q,st=B-C>>1,it=B-C,tt=U[C],at=U[C+1],xt=U[B],At=U[B+1],vt=C+3;vt<B;vt+=3){var Ht=xr(U[vt],U[vt+1],tt,at,xt,At);if(Ht>Q)$=vt,Q=Ht;else if(Ht===Q){var Xt=Math.abs(vt-st);Xt<it&&($=vt,it=Xt)}}Q>q&&($-C>3&&ir(U,C,$,q),U[$+2]=Q,B-$>3&&ir(U,$,B,q))}function xr(U,C,B,q,$,Q){var st=$-B,it=Q-q;if(st!==0||it!==0){var tt=((U-B)*st+(C-q)*it)/(st*st+it*it);tt>1?(B=$,q=Q):tt>0&&(B+=st*tt,q+=it*tt)}return(st=U-B)*st+(it=C-q)*it}function Un(U,C,B,q){var $={id:U===void 0?null:U,type:C,geometry:B,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var st=Q.geometry,it=Q.type;if(it==="Point"||it==="MultiPoint"||it==="LineString")wt(Q,st);else if(it==="Polygon"||it==="MultiLineString")for(var tt=0;tt<st.length;tt++)wt(Q,st[tt]);else if(it==="MultiPolygon")for(tt=0;tt<st.length;tt++)for(var at=0;at<st[tt].length;at++)wt(Q,st[tt][at])}($),$}function wt(U,C){for(var B=0;B<C.length;B+=3)U.minX=Math.min(U.minX,C[B]),U.minY=Math.min(U.minY,C[B+1]),U.maxX=Math.max(U.maxX,C[B]),U.maxY=Math.max(U.maxY,C[B+1])}function Bt(U,C,B,q){if(C.geometry){var $=C.geometry.coordinates,Q=C.geometry.type,st=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),it=[],tt=C.id;if(B.promoteId?tt=C.properties[B.promoteId]:B.generateId&&(tt=q||0),Q==="Point")br($,it);else if(Q==="MultiPoint")for(var at=0;at<$.length;at++)br($[at],it);else if(Q==="LineString")yn($,it,st,!1);else if(Q==="MultiLineString"){if(B.lineMetrics){for(at=0;at<$.length;at++)yn($[at],it=[],st,!1),U.push(Un(tt,"LineString",it,C.properties));return}Ce($,it,st,!1)}else if(Q==="Polygon")Ce($,it,st,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(at=0;at<C.geometry.geometries.length;at++)Bt(U,{id:tt,geometry:C.geometry.geometries[at],properties:C.properties},B,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(at=0;at<$.length;at++){var xt=[];Ce($[at],xt,st,!0),it.push(xt)}}U.push(Un(tt,Q,it,C.properties))}}function br(U,C){C.push(an(U[0])),C.push(Gi(U[1])),C.push(0)}function yn(U,C,B,q){for(var $,Q,st=0,it=0;it<U.length;it++){var tt=an(U[it][0]),at=Gi(U[it][1]);C.push(tt),C.push(at),C.push(0),it>0&&(st+=q?($*at-tt*Q)/2:Math.sqrt(Math.pow(tt-$,2)+Math.pow(at-Q,2))),$=tt,Q=at}var xt=C.length-3;C[2]=1,ir(C,0,xt,B),C[xt+2]=1,C.size=Math.abs(st),C.start=0,C.end=C.size}function Ce(U,C,B,q){for(var $=0;$<U.length;$++){var Q=[];yn(U[$],Q,B,q),C.push(Q)}}function an(U){return U/360+.5}function Gi(U){var C=Math.sin(U*Math.PI/180),B=.5-.25*Math.log((1+C)/(1-C))/Math.PI;return B<0?0:B>1?1:B}function Wi(U,C,B,q,$,Q,st,it){if(q/=C,Q>=(B/=C)&&st<q)return U;if(st<B||Q>=q)return null;for(var tt=[],at=0;at<U.length;at++){var xt=U[at],At=xt.geometry,vt=xt.type,Ht=$===0?xt.minX:xt.minY,Xt=$===0?xt.maxX:xt.maxY;if(Ht>=B&&Xt<q)tt.push(xt);else if(!(Xt<B||Ht>=q)){var Ft=[];if(vt==="Point"||vt==="MultiPoint")wr(At,Ft,B,q,$);else if(vt==="LineString")Lt(At,Ft,B,q,$,!1,it.lineMetrics);else if(vt==="MultiLineString")ue(At,Ft,B,q,$,!1);else if(vt==="Polygon")ue(At,Ft,B,q,$,!0);else if(vt==="MultiPolygon")for(var ne=0;ne<At.length;ne++){var se=[];ue(At[ne],se,B,q,$,!0),se.length&&Ft.push(se)}if(Ft.length){if(it.lineMetrics&&vt==="LineString"){for(ne=0;ne<Ft.length;ne++)tt.push(Un(xt.id,vt,Ft[ne],xt.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(Ft.length===1?(vt="LineString",Ft=Ft[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=Ft.length===3?"Point":"MultiPoint"),tt.push(Un(xt.id,vt,Ft,xt.tags))}}}return tt.length?tt:null}function wr(U,C,B,q,$){for(var Q=0;Q<U.length;Q+=3){var st=U[Q+$];st>=B&&st<=q&&(C.push(U[Q]),C.push(U[Q+1]),C.push(U[Q+2]))}}function Lt(U,C,B,q,$,Q,st){for(var it,tt,at=me(U),xt=$===0?nr:le,At=U.start,vt=0;vt<U.length-3;vt+=3){var Ht=U[vt],Xt=U[vt+1],Ft=U[vt+2],ne=U[vt+3],se=U[vt+4],Me=$===0?Ht:Xt,he=$===0?ne:se,_e=!1;st&&(it=Math.sqrt(Math.pow(Ht-ne,2)+Math.pow(Xt-se,2))),Me<B?he>B&&(tt=xt(at,Ht,Xt,ne,se,B),st&&(at.start=At+it*tt)):Me>q?he<q&&(tt=xt(at,Ht,Xt,ne,se,q),st&&(at.start=At+it*tt)):wi(at,Ht,Xt,Ft),he<B&&Me>=B&&(tt=xt(at,Ht,Xt,ne,se,B),_e=!0),he>q&&Me<=q&&(tt=xt(at,Ht,Xt,ne,se,q),_e=!0),!Q&&_e&&(st&&(at.end=At+it*tt),C.push(at),at=me(U)),st&&(At+=it)}var we=U.length-3;Ht=U[we],Xt=U[we+1],Ft=U[we+2],(Me=$===0?Ht:Xt)>=B&&Me<=q&&wi(at,Ht,Xt,Ft),we=at.length-3,Q&&we>=3&&(at[we]!==at[0]||at[we+1]!==at[1])&&wi(at,at[0],at[1],at[2]),at.length&&C.push(at)}function me(U){var C=[];return C.size=U.size,C.start=U.start,C.end=U.end,C}function ue(U,C,B,q,$,Q){for(var st=0;st<U.length;st++)Lt(U[st],C,B,q,$,Q,!1)}function wi(U,C,B,q){U.push(C),U.push(B),U.push(q)}function nr(U,C,B,q,$,Q){var st=(Q-C)/(q-C);return U.push(Q),U.push(B+($-B)*st),U.push(1),st}function le(U,C,B,q,$,Q){var st=(Q-B)/($-B);return U.push(C+(q-C)*st),U.push(Q),U.push(1),st}function rr(U,C){for(var B=[],q=0;q<U.length;q++){var $,Q=U[q],st=Q.type;if(st==="Point"||st==="MultiPoint"||st==="LineString")$=Ti(Q.geometry,C);else if(st==="MultiLineString"||st==="Polygon"){$=[];for(var it=0;it<Q.geometry.length;it++)$.push(Ti(Q.geometry[it],C))}else if(st==="MultiPolygon")for($=[],it=0;it<Q.geometry.length;it++){for(var tt=[],at=0;at<Q.geometry[it].length;at++)tt.push(Ti(Q.geometry[it][at],C));$.push(tt)}B.push(Un(Q.id,st,$,Q.tags))}return B}function Ti(U,C){var B=[];B.size=U.size,U.start!==void 0&&(B.start=U.start,B.end=U.end);for(var q=0;q<U.length;q+=3)B.push(U[q]+C,U[q+1],U[q+2]);return B}function ds(U,C){if(U.transformed)return U;var B,q,$,Q=1<<U.z,st=U.x,it=U.y;for(B=0;B<U.features.length;B++){var tt=U.features[B],at=tt.geometry,xt=tt.type;if(tt.geometry=[],xt===1)for(q=0;q<at.length;q+=2)tt.geometry.push(di(at[q],at[q+1],C,Q,st,it));else for(q=0;q<at.length;q++){var At=[];for($=0;$<at[q].length;$+=2)At.push(di(at[q][$],at[q][$+1],C,Q,st,it));tt.geometry.push(At)}}return U.transformed=!0,U}function di(U,C,B,q,$,Q){return[Math.round(B*(U*q-$)),Math.round(B*(C*q-Q))]}function qi(U,C,B,q,$){for(var Q=C===$.maxZoom?0:$.tolerance/((1<<C)*$.extent),st={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:q,z:C,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},it=0;it<U.length;it++){st.numFeatures++,Ue(st,U[it],Q,$);var tt=U[it].minX,at=U[it].minY,xt=U[it].maxX,At=U[it].maxY;tt<st.minX&&(st.minX=tt),at<st.minY&&(st.minY=at),xt>st.maxX&&(st.maxX=xt),At>st.maxY&&(st.maxY=At)}return st}function Ue(U,C,B,q){var $=C.geometry,Q=C.type,st=[];if(Q==="Point"||Q==="MultiPoint")for(var it=0;it<$.length;it+=3)st.push($[it]),st.push($[it+1]),U.numPoints++,U.numSimplified++;else if(Q==="LineString")Tr(st,$,U,B,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(it=0;it<$.length;it++)Tr(st,$[it],U,B,Q==="Polygon",it===0);else if(Q==="MultiPolygon")for(var tt=0;tt<$.length;tt++){var at=$[tt];for(it=0;it<at.length;it++)Tr(st,at[it],U,B,!0,it===0)}if(st.length){var xt=C.tags||null;if(Q==="LineString"&&q.lineMetrics){for(var At in xt={},C.tags)xt[At]=C.tags[At];xt.mapbox_clip_start=$.start/$.size,xt.mapbox_clip_end=$.end/$.size}var vt={geometry:st,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:xt};C.id!==null&&(vt.id=C.id),U.features.push(vt)}}function Tr(U,C,B,q,$,Q){var st=q*q;if(q>0&&C.size<($?st:q))B.numPoints+=C.length/3;else{for(var it=[],tt=0;tt<C.length;tt+=3)(q===0||C[tt+2]>st)&&(B.numSimplified++,it.push(C[tt]),it.push(C[tt+1])),B.numPoints++;$&&function(at,xt){for(var At=0,vt=0,Ht=at.length,Xt=Ht-2;vt<Ht;Xt=vt,vt+=2)At+=(at[vt]-at[Xt])*(at[vt+1]+at[Xt+1]);if(At>0===xt)for(vt=0,Ht=at.length;vt<Ht/2;vt+=2){var Ft=at[vt],ne=at[vt+1];at[vt]=at[Ht-2-vt],at[vt+1]=at[Ht-1-vt],at[Ht-2-vt]=Ft,at[Ht-1-vt]=ne}}(it,Q),U.push(it)}}function Nn(U,C){var B=(C=this.options=function($,Q){for(var st in Q)$[st]=Q[st];return $}(Object.create(this.options),C)).debug;if(B&&console.time("preprocess data"),C.maxZoom<0||C.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(C.promoteId&&C.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function($,Q){var st=[];if($.type==="FeatureCollection")for(var it=0;it<$.features.length;it++)Bt(st,$.features[it],Q,it);else Bt(st,$.type==="Feature"?$:{geometry:$},Q);return st}(U,C);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",C.indexMaxZoom,C.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function($,Q){var st=Q.buffer/Q.extent,it=$,tt=Wi($,1,-1-st,st,0,-1,2,Q),at=Wi($,1,1-st,2+st,0,-1,2,Q);return(tt||at)&&(it=Wi($,1,-st,1+st,0,-1,2,Q)||[],tt&&(it=rr(tt,1).concat(it)),at&&(it=it.concat(rr(at,-1)))),it}(q,C),q.length&&this.splitTile(q,0,0,0),B&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Vr(U,C,B){return 32*((1<<U)*B+C)+U}function Gr(U,C){const B=U.tileID.canonical;if(!this._geoJSONIndex)return C(null,null);const q=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!q)return C(null,null);const $=new _n(q.features);let Q=Yn.exports($);Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),C(null,{vectorTile:$,rawData:Q.buffer})}Nn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Nn.prototype.splitTile=function(U,C,B,q,$,Q,st){for(var it=[U,C,B,q],tt=this.options,at=tt.debug;it.length;){q=it.pop(),B=it.pop(),C=it.pop(),U=it.pop();var xt=1<<C,At=Vr(C,B,q),vt=this.tiles[At];if(!vt&&(at>1&&console.time("creation"),vt=this.tiles[At]=qi(U,C,B,q,tt),this.tileCoords.push({z:C,x:B,y:q}),at)){at>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",C,B,q,vt.numFeatures,vt.numPoints,vt.numSimplified),console.timeEnd("creation"));var Ht="z"+C;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(vt.source=U,$){if(C===tt.maxZoom||C===$)continue;var Xt=1<<$-C;if(B!==Math.floor(Q/Xt)||q!==Math.floor(st/Xt))continue}else if(C===tt.indexMaxZoom||vt.numPoints<=tt.indexMaxPoints)continue;if(vt.source=null,U.length!==0){at>1&&console.time("clipping");var Ft,ne,se,Me,he,_e,we=.5*tt.buffer/tt.extent,Be=.5-we,vi=.5+we,Ke=1+we;Ft=ne=se=Me=null,he=Wi(U,xt,B-we,B+vi,0,vt.minX,vt.maxX,tt),_e=Wi(U,xt,B+Be,B+Ke,0,vt.minX,vt.maxX,tt),U=null,he&&(Ft=Wi(he,xt,q-we,q+vi,1,vt.minY,vt.maxY,tt),ne=Wi(he,xt,q+Be,q+Ke,1,vt.minY,vt.maxY,tt),he=null),_e&&(se=Wi(_e,xt,q-we,q+vi,1,vt.minY,vt.maxY,tt),Me=Wi(_e,xt,q+Be,q+Ke,1,vt.minY,vt.maxY,tt),_e=null),at>1&&console.timeEnd("clipping"),it.push(Ft||[],C+1,2*B,2*q),it.push(ne||[],C+1,2*B,2*q+1),it.push(se||[],C+1,2*B+1,2*q),it.push(Me||[],C+1,2*B+1,2*q+1)}}},Nn.prototype.getTile=function(U,C,B){var q=this.options,$=q.extent,Q=q.debug;if(U<0||U>24)return null;var st=1<<U,it=Vr(U,C=(C%st+st)%st,B);if(this.tiles[it])return ds(this.tiles[it],$);Q>1&&console.log("drilling down to z%d-%d-%d",U,C,B);for(var tt,at=U,xt=C,At=B;!tt&&at>0;)at--,xt=Math.floor(xt/2),At=Math.floor(At/2),tt=this.tiles[Vr(at,xt,At)];return tt&&tt.source?(Q>1&&console.log("found parent tile z%d-%d-%d",at,xt,At),Q>1&&console.time("drilling down"),this.splitTile(tt.source,at,xt,At,U,C,B),Q>1&&console.timeEnd("drilling down"),this.tiles[it]?ds(this.tiles[it],$):null):null};class fs extends ce{constructor(C,B,q,$){super(C,B,q,Gr),$&&(this.loadGeoJSON=$)}loadData(C,B){var q;(q=this._pendingRequest)===null||q===void 0||q.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const $=!!(C&&C.request&&C.request.collectResourceTiming)&&new c.RequestPerformance(C.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(C,(Q,st)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!st)return B(Q);if(typeof st!="object")return B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));{Fr(st,!0);try{if(C.filter){const tt=c.createExpression(C.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(tt.result==="error")throw new Error(tt.value.map(xt=>`${xt.key}: ${xt.message}`).join(", "));const at=st.features.filter(xt=>tt.value.evaluate({zoom:0},xt));st={type:"FeatureCollection",features:at}}this._geoJSONIndex=C.cluster?new Es(function({superclusterOptions:tt,clusterProperties:at}){if(!at||!tt)return tt;const xt={},At={},vt={accumulated:null,zoom:0},Ht={properties:null},Xt=Object.keys(at);for(const Ft of Xt){const[ne,se]=at[Ft],Me=c.createExpression(se),he=c.createExpression(typeof ne=="string"?[ne,["accumulated"],["get",Ft]]:ne);xt[Ft]=Me.value,At[Ft]=he.value}return tt.map=Ft=>{Ht.properties=Ft;const ne={};for(const se of Xt)ne[se]=xt[se].evaluate(vt,Ht);return ne},tt.reduce=(Ft,ne)=>{Ht.properties=ne;for(const se of Xt)vt.accumulated=Ft[se],Ft[se]=At[se].evaluate(vt,Ht)},tt}(C)).load(st.features):function(tt,at){return new Nn(tt,at)}(st,C.geojsonVtOptions)}catch(tt){return B(tt)}this.loaded={};const it={};if($){const tt=$.finish();tt&&(it.resourceTiming={},it.resourceTiming[C.source]=JSON.parse(JSON.stringify(tt)))}B(null,it)}})}reloadTile(C,B){const q=this.loaded;return q&&q[C.uid]?super.reloadTile(C,B):this.loadTile(C,B)}loadGeoJSON(C,B){if(C.request)return c.getJSON(C.request,B);if(typeof C.data=="string")try{B(null,JSON.parse(C.data))}catch{B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`))}else B(new Error(`Input data given to '${C.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(C,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(C,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(C.clusterId))}catch(q){B(q)}}getClusterChildren(C,B){try{B(null,this._geoJSONIndex.getChildren(C.clusterId))}catch(q){B(q)}}getClusterLeaves(C,B){try{B(null,this._geoJSONIndex.getLeaves(C.clusterId,C.limit,C.offset))}catch(q){B(q)}}}class zi{constructor(C){this.self=C,this.actor=new c.Actor(C,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ce,geojson:fs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,q)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=q},this.self.registerRTLTextPlugin=B=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=B.applyArabicShaping,c.plugin.processBidirectionalText=B.processBidirectionalText,c.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(C,B){this.referrer=B}setImages(C,B,q){this.availableImages[C]=B;for(const $ in this.workerSources[C]){const Q=this.workerSources[C][$];for(const st in Q)Q[st].availableImages=B}q()}setLayers(C,B,q){this.getLayerIndex(C).replace(B),q()}updateLayers(C,B,q){this.getLayerIndex(C).update(B.layers,B.removedIds),q()}loadTile(C,B,q){this.getWorkerSource(C,B.type,B.source).loadTile(B,q)}loadDEMTile(C,B,q){this.getDEMWorkerSource(C,B.source).loadTile(B,q)}reloadTile(C,B,q){this.getWorkerSource(C,B.type,B.source).reloadTile(B,q)}abortTile(C,B,q){this.getWorkerSource(C,B.type,B.source).abortTile(B,q)}removeTile(C,B,q){this.getWorkerSource(C,B.type,B.source).removeTile(B,q)}removeDEMTile(C,B){this.getDEMWorkerSource(C,B.source).removeTile(B)}removeSource(C,B,q){if(!this.workerSources[C]||!this.workerSources[C][B.type]||!this.workerSources[C][B.type][B.source])return;const $=this.workerSources[C][B.type][B.source];delete this.workerSources[C][B.type][B.source],$.removeSource!==void 0?$.removeSource(B,q):q()}loadWorkerSource(C,B,q){try{this.self.importScripts(B.url),q()}catch($){q($.toString())}}syncRTLPluginState(C,B,q){try{c.plugin.setState(B);const $=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&$!=null){this.self.importScripts($);const Q=c.plugin.isParsed();q(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${$}`),Q)}}catch($){q($.toString())}}getAvailableImages(C){let B=this.availableImages[C];return B||(B=[]),B}getLayerIndex(C){let B=this.layerIndexes[C];return B||(B=this.layerIndexes[C]=new Se),B}getWorkerSource(C,B,q){if(this.workerSources[C]||(this.workerSources[C]={}),this.workerSources[C][B]||(this.workerSources[C][B]={}),!this.workerSources[C][B][q]){const $={send:(Q,st,it)=>{this.actor.send(Q,st,it,C)}};this.workerSources[C][B][q]=new this.workerSourceTypes[B]($,this.getLayerIndex(C),this.getAvailableImages(C))}return this.workerSources[C][B][q]}getDEMWorkerSource(C,B){return this.demWorkerSources[C]||(this.demWorkerSources[C]={}),this.demWorkerSources[C][B]||(this.demWorkerSources[C][B]=new Or),this.demWorkerSources[C][B]}enforceCacheSizeLimit(C,B){c.enforceCacheSizeLimit(B)}}return c.isWorker()&&(self.worker=new zi(self)),zi}),Y(["./shared"],function(c){var Pt=Jt;function Jt(h){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,p,f=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(f);try{p=new Worker(y),a=!0}catch{a=!1}return p&&p.terminate(),URL.revokeObjectURL(y),a}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var a=document.createElement("canvas");a.width=a.height=1;var p=a.getContext("2d");if(!p)return!1;var f=p.getImageData(0,0,1,1);return f&&f.width===a.width}()?(Se[s=e&&e.failIfMajorPerformanceCaveat]===void 0&&(Se[s]=function(a){var p,f=function(y){var T=document.createElement("canvas"),I=Object.create(Jt.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=y,T.getContext("webgl",I)||T.getContext("experimental-webgl",I)}(a);if(!f)return!1;try{p=f.createShader(f.VERTEX_SHADER)}catch{return!1}return!(!p||f.isContextLost())&&(f.shaderSource(p,"void main() {}"),f.compileShader(p),f.getShaderParameter(p,f.COMPILE_STATUS)===!0)}(s)),Se[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(h)}var Se={};function Gt(h,e){if(Array.isArray(h)){if(!Array.isArray(e)||h.length!==e.length)return!1;for(let s=0;s<h.length;s++)if(!Gt(h[s],e[s]))return!1;return!0}if(typeof h=="object"&&h!==null&&e!==null){if(typeof e!="object"||Object.keys(h).length!==Object.keys(e).length)return!1;for(const s in h)if(!Gt(h[s],e[s]))return!1;return!0}return h===e}Jt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class dt{static testProp(e){if(!dt.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in dt.docStyle)return e[s];return e[0]}static create(e,s,a){const p=window.document.createElement(e);return s!==void 0&&(p.className=s),a&&a.appendChild(p),p}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){dt.docStyle&&dt.selectProp&&(dt.userSelect=dt.docStyle[dt.selectProp],dt.docStyle[dt.selectProp]="none")}static enableDrag(){dt.docStyle&&dt.selectProp&&(dt.docStyle[dt.selectProp]=dt.userSelect)}static setTransform(e,s){e.style[dt.transformProp]=s}static addEventListener(e,s,a,p={}){e.addEventListener(s,a,"passive"in p?p:p.capture)}static removeEventListener(e,s,a,p={}){e.removeEventListener(s,a,"passive"in p?p:p.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",dt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",dt.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",dt.suppressClickInternal,!0)},0)}static mousePos(e,s){const a=e.getBoundingClientRect();return new c.pointGeometry(s.clientX-a.left-e.clientLeft,s.clientY-a.top-e.clientTop)}static touchPos(e,s){const a=e.getBoundingClientRect(),p=[];for(let f=0;f<s.length;f++)p.push(new c.pointGeometry(s[f].clientX-a.left-e.clientLeft,s[f].clientY-a.top-e.clientTop));return p}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}dt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,dt.selectProp=dt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),dt.transformProp=dt.testProp(["transform","WebkitTransform"]);class ci{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}normalizeSpriteURL(e,s,a){const p=function(f){const y=f.match($e);if(!y)throw new Error(`Unable to parse URL "${f}"`);return{protocol:y[1],authority:y[2],path:y[3]||"/",params:y[4]?y[4].split("&"):[]}}(e);return p.path+=`${s}${a}`,function(f){const y=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${y}`}(p)}setTransformRequest(e){this._transformRequestFn=e}}const $e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class ce{constructor(e,s,a,p){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(s,p)}update(e,s,a){const{width:p,height:f}=e,y=!(this.size&&this.size[0]===p&&this.size[1]===f||a),{context:T}=this,{gl:I}=T;if(this.useMipmap=Boolean(s&&s.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!s||s.premultiply!==!1)),y)this.size=[p,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.isImageBitmap(e)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,e):I.texImage2D(I.TEXTURE_2D,0,this.format,p,f,0,this.format,I.UNSIGNED_BYTE,e.data);else{const{x:P,y:z}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.isImageBitmap(e)?I.texSubImage2D(I.TEXTURE_2D,0,P,z,I.RGBA,I.UNSIGNED_BYTE,e):I.texSubImage2D(I.TEXTURE_2D,0,P,z,p,f,I.RGBA,I.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(e,s,a){const{context:p}=this,{gl:f}=p;f.bindTexture(f.TEXTURE_2D,this.texture),a!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,a||e),this.filter=e),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Or(h){const{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class Fr extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,callback:a}of this.requestors)this._notify(s,a);this.requestors=[]}}getImage(e){return this.images[e]}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let a=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(s.content,s)||(this.fire(new c.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,s){if(!e)return!0;let a=0;for(const p of e){if(p[0]<a||p[1]<p[0]||s<p[1])return!1;a=p[1]}return!0}_validateContent(e,s){return!(e&&(e.length!==4||e[0]<0||s.data.width<e[0]||e[1]<0||s.data.height<e[1]||e[2]<0||s.data.width<e[2]||e[3]<0||s.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,s){const a=this.images[e];if(a.data.width!==s.data.width||a.data.height!==s.data.height)throw new Error(`size mismatch between old image (${a.data.width}x${a.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=a.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e,s){let a=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(a=!1);this.isLoaded()||a?this._notify(e,s):this.requestors.push({ids:e,callback:s})}_notify(e,s){const a={};for(const p of e){this.images[p]||this.fire(new c.Event("styleimagemissing",{id:p}));const f=this.images[p];f?a[p]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:Boolean(f.userImage&&f.userImage.render)}:c.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,a)}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],a=this.getImage(e);if(!a)return null;if(s&&s.position.version===a.version)return s.position;if(s)s.position.version=a.version;else{const p={w:a.data.width+2,h:a.data.height+2,x:0,y:0},f=new c.ImagePosition(p,a);this.patterns[e]={bin:p,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ce(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:s,h:a}=c.potpack(e),p=this.atlasImage;p.resize({width:s||1,height:a||1});for(const f in this.patterns){const{bin:y}=this.patterns[f],T=y.x+1,I=y.y+1,P=this.images[f].data,z=P.width,O=P.height;c.RGBAImage.copy(P,p,{x:0,y:0},{x:T,y:I},{width:z,height:O}),c.RGBAImage.copy(P,p,{x:0,y:O-1},{x:T,y:I-1},{width:z,height:1}),c.RGBAImage.copy(P,p,{x:0,y:0},{x:T,y:I+O},{width:z,height:1}),c.RGBAImage.copy(P,p,{x:z-1,y:0},{x:T-1,y:I},{width:1,height:O}),c.RGBAImage.copy(P,p,{x:0,y:0},{x:T+z,y:I},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const a=this.images[s];a||c.warnOnce(`Image with ID: "${s}" was not found`),Or(a)&&this.updateImage(s,a)}}}const mn=1e20;function ii(h,e,s,a,p,f,y,T,I){for(let P=e;P<e+a;P++)Ur(h,s*f+P,f,p,y,T,I);for(let P=s;P<s+p;P++)Ur(h,P*f+e,1,a,y,T,I)}function Ur(h,e,s,a,p,f,y){f[0]=0,y[0]=-mn,y[1]=mn,p[0]=h[e];for(let T=1,I=0,P=0;T<a;T++){p[T]=h[e+T*s];const z=T*T;do{const O=f[I];P=(p[T]-p[O]+z-O*O)/(T-O)/2}while(P<=y[I]&&--I>-1);I++,f[I]=T,y[I]=P,y[I+1]=mn}for(let T=0,I=0;T<a;T++){for(;y[I+1]<T;)I++;const P=f[I],z=T-P;h[e+T*s]=p[P]+z*z}}class ni{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e,s){const a=[];for(const p in e)for(const f of e[p])a.push({stack:p,id:f});c.asyncAll(a,({stack:p,id:f},y)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{}});let I=T.glyphs[f];if(I!==void 0)return void y(null,{stack:p,id:f,glyph:I});if(I=this._tinySDF(T,p,f),I)return T.glyphs[f]=I,void y(null,{stack:p,id:f,glyph:I});const P=Math.floor(f/256);if(256*P>65535)return void y(new Error("glyphs > 65535 not supported"));if(T.ranges[P])return void y(null,{stack:p,id:f,glyph:I});let z=T.requests[P];z||(z=T.requests[P]=[],ni.loadGlyphRange(p,P,this.url,this.requestManager,(O,Z)=>{if(Z){for(const H in Z)this._doesCharSupportLocalGlyph(+H)||(T.glyphs[+H]=Z[+H]);T.ranges[P]=!0}for(const H of z)H(O,Z);delete T.requests[P]})),z.push((O,Z)=>{O?y(O):Z&&y(null,{stack:p,id:f,glyph:Z[f]||null})})},(p,f)=>{if(p)s(p);else if(f){const y={};for(const{stack:T,id:I,glyph:P}of f)(y[T]||(y[T]={}))[I]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};s(null,y)}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(c.unicodeBlockLookup["CJK Unified Ideographs"](e)||c.unicodeBlockLookup["Hangul Syllables"](e)||c.unicodeBlockLookup.Hiragana(e)||c.unicodeBlockLookup.Katakana(e))}_tinySDF(e,s,a){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let T="400";/bold/i.test(s)?T="900":/medium/i.test(s)?T="500":/light/i.test(s)&&(T="200"),f=e.tinySDF=new ni.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:p,fontWeight:T})}const y=f.draw(String.fromCharCode(a));return{id:a,bitmap:new c.AlphaImage({width:y.width||30,height:y.height||30},y.data),metrics:{width:y.glyphWidth||24,height:y.glyphHeight||24,left:y.glyphLeft||0,top:y.glyphTop-27||-8,advance:y.glyphAdvance||24}}}}ni.loadGlyphRange=function(h,e,s,a,p){const f=256*e,y=f+255,T=a.transformRequest(s.replace("{fontstack}",h).replace("{range}",`${f}-${y}`),c.ResourceType.Glyphs);c.getArrayBuffer(T,(I,P)=>{if(I)p(I);else if(P){const z={};for(const O of c.parseGlyphPbf(P))z[O.id]=O;p(null,z)}})},ni.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:s=8,cutoff:a=.25,fontFamily:p="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=s;const T=this.size=h+4*e,I=this._createCanvas(T),P=this.ctx=I.getContext("2d",{willReadFrequently:!0});P.font=`${y} ${f} ${h}px ${p}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(h){const e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:a,actualBoundingBoxLeft:p,actualBoundingBoxRight:f}=this.ctx.measureText(h),y=Math.ceil(s),T=Math.min(this.size-this.buffer,Math.ceil(f-p)),I=Math.min(this.size-this.buffer,y+Math.ceil(a)),P=T+2*this.buffer,z=I+2*this.buffer,O=Math.max(P*z,0),Z=new Uint8ClampedArray(O),H={data:Z,width:P,height:z,glyphWidth:T,glyphHeight:I,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(T===0||I===0)return H;const{ctx:j,buffer:W,gridInner:rt,gridOuter:ht}=this;j.clearRect(W,W,T,I),j.fillText(h,W,W+y);const pt=j.getImageData(W,W,T,I);ht.fill(mn,0,O),rt.fill(0,0,O);for(let X=0;X<I;X++)for(let _t=0;_t<T;_t++){const ft=pt.data[4*(X*T+_t)+3]/255;if(ft===0)continue;const Tt=(X+W)*P+_t+W;if(ft===1)ht[Tt]=0,rt[Tt]=mn;else{const St=.5-ft;ht[Tt]=St>0?St*St:0,rt[Tt]=St<0?St*St:0}}ii(ht,0,0,P,z,P,this.f,this.v,this.z),ii(rt,W,W,T,I,P,this.f,this.v,this.z);for(let X=0;X<O;X++){const _t=Math.sqrt(ht[X])-Math.sqrt(rt[X]);Z[X]=Math.round(255-255*(_t/this.radius+this.cutoff))}return H}};const _n=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(h,e){return c.sphericalToCartesian(h.expression.evaluate(e))}interpolate(h,e,s){return{x:c.number(h.x,e.x,s),y:c.number(h.y,e.y,s),z:c.number(h.z,e.z,s)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Yn="-transition";class rn extends c.Evented{constructor(e){super(),this._transitionable=new c.Transitionable(_n),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(c.validateLight,e,s))for(const a in e){const p=e[a];a.endsWith(Yn)?this._transitionable.setTransition(a.slice(0,-Yn.length),p):this._transitionable.setValue(a,p)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,a){return(!a||a.validate!==!1)&&c.emitValidationErrors(this,e.call(c.validateStyle,c.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class cs{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const a=e.join(",")+String(s);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,s)),this.dashEntry[a]}getDashRanges(e,s,a){const p=[];let f=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,T=!0;p.push({left:f,right:y,isDash:T,zeroLength:e[0]===0});let I=e[0];for(let P=1;P<e.length;P++){T=!T;const z=e[P];f=I*a,I+=z,y=I*a,p.push({left:f,right:y,isDash:T,zeroLength:z===0})}return p}addRoundDash(e,s,a){const p=s/2;for(let f=-a;f<=a;f++){const y=this.width*(this.nextRow+a+f);let T=0,I=e[T];for(let P=0;P<this.width;P++){P/I.right>1&&(I=e[++T]);const z=Math.abs(P-I.left),O=Math.abs(P-I.right),Z=Math.min(z,O);let H;const j=f/a*(p+1);if(I.isDash){const W=p-Math.abs(j);H=Math.sqrt(Z*Z+W*W)}else H=p-Math.sqrt(Z*Z+j*j);this.data[y+P]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const I=e[T],P=e[T+1];I.zeroLength?e.splice(T,1):P&&P.isDash===I.isDash&&(P.left=I.left,e.splice(T,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const p=this.width*this.nextRow;let f=0,y=e[f];for(let T=0;T<this.width;T++){T/y.right>1&&(y=e[++f]);const I=Math.abs(T-y.left),P=Math.abs(T-y.right),z=Math.min(I,P);this.data[p+T]=Math.max(0,Math.min(255,(y.isDash?z:-z)+128))}}addDash(e,s){const a=s?7:0,p=2*a+1;if(this.nextRow+p>this.height)return c.warnOnce("LineAtlas out of space"),null;let f=0;for(let T=0;T<e.length;T++)f+=e[T];if(f!==0){const T=this.width/f,I=this.getDashRanges(e,this.width,T);s?this.addRoundDash(I,T,a):this.addRegularDash(I)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:f};return this.nextRow+=p,this.dirty=!0,y}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class On{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const a=this.workerPool.acquire(this.id);for(let p=0;p<a.length;p++){const f=new On.Actor(a[p],s,this.id);f.name=`Worker ${p}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s,a){c.asyncAll(this.actors,(p,f)=>{p.send(e,s,f)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ui(h,e,s){const a=function(p,f){if(p)return s(p);if(f){const y=c.pick(c.extend(f,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(y.vectorLayers=f.vector_layers,y.vectorLayerIds=y.vectorLayers.map(T=>T.id)),s(null,y)}};return h.url?c.getJSON(e.transformRequest(h.url,c.ResourceType.Source),a):c.exported.frame(()=>a(null,h))}On.Actor=c.Actor;class pi{constructor(e,s,a){this.bounds=c.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),a=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*s),f=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*s),y=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*s);return e.x>=a&&e.x<f&&e.y>=p&&e.y<y}}class us extends c.Evented{constructor(e,s,a,p){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(s,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ui(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e?this.fire(new c.ErrorEvent(e)):s&&(c.extend(this,s),s.bounds&&(this.tileBounds=new pi(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(a,c.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(y,T){return delete e.request,e.aborted?s(null):y&&y.status!==404?s(y):(T&&T.resourceTiming&&(e.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&e.setExpiryData(T),e.loadVectorData(T,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired"?e.state==="loading"?e.reloadCallback=s:e.request=e.actor.send("reloadTile",p,f.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",p,f.bind(this)))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}unloadTile(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ci extends c.Evented{constructor(e,s,a,p){super(),this.id=e,this.dispatcher=a,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},s),c.extend(this,c.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ui(this._options,this.map._requestManager,(e,s)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new c.ErrorEvent(e)):s&&(c.extend(this,s),s.bounds&&(this.tileBounds=new pi(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.request=c.getImage(this.map._requestManager.transformRequest(a,c.ResourceType.Tile),(p,f,y)=>{if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(p)e.state="errored",s(p);else if(f){this.map._refreshExpiredTiles&&e.setExpiryData(y);const T=this.map.painter.context,I=T.gl;e.texture=this.map.painter.getTileTexture(f.width),e.texture?e.texture.update(f,{useMipmap:!0}):(e.texture=new ce(T,f,I.RGBA,{useMipmap:!0}),e.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),T.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax)),e.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(e,s){e.request&&(e.request.cancel(),delete e.request),s()}unloadTile(e,s){e.texture&&this.map.painter.saveTileTexture(e.texture),s()}hasTransition(){return!1}}let _r;class Yt extends Ci{constructor(e,s,a,p){super(e,s,a,p),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(e,s){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function p(f,y){f&&(e.state="errored",s(f)),y&&(e.dem=y,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded",s(null))}e.request=c.getImage(this.map._requestManager.transformRequest(a,c.ResourceType.Tile),function(f,y){if(delete e.request,e.aborted)e.state="unloaded",s(null);else if(f)e.state="errored",s(f);else if(y){this.map._refreshExpiredTiles&&e.setExpiryData(y),delete y.cacheControl,delete y.expires;const T=c.isImageBitmap(y)&&(_r==null&&(_r=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),_r)?y:c.exported.getImageData(y,1),I={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:T,encoding:this.encoding};e.actor&&e.state!=="expired"||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",I,p.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)}_getNeighboringTiles(e){const s=e.canonical,a=Math.pow(2,s.z),p=(s.x-1+a)%a,f=s.x===0?e.wrap-1:e.wrap,y=(s.x+1+a)%a,T=s.x+1===a?e.wrap+1:e.wrap,I={};return I[new c.OverscaledTileID(e.overscaledZ,f,s.z,p,s.y).key]={backfilled:!1},I[new c.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y).key]={backfilled:!1},s.y>0&&(I[new c.OverscaledTileID(e.overscaledZ,f,s.z,p,s.y-1).key]={backfilled:!1},I[new c.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new c.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y-1).key]={backfilled:!1}),s.y+1<a&&(I[new c.OverscaledTileID(e.overscaledZ,f,s.z,p,s.y+1).key]={backfilled:!1},I[new c.OverscaledTileID(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new c.OverscaledTileID(e.overscaledZ,T,s.z,y,s.y+1).key]={backfilled:!1}),I}unloadTile(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&e.actor.send("removeDEMTile",{uid:e.uid,source:this.id})}}class sn extends c.Evented{constructor(e,s,a,p){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(p),this._data=s.data,this._options=c.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:c.EXTENT,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData("content"),this}getClusterExpansionZoom(e,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},s),this}getClusterChildren(e,s){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},s),this}getClusterLeaves(e,s,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:s,offset:a},p),this}_updateWorkerData(e){const s=c.extend({},this.workerOptions),a=this._data;typeof a=="string"?(s.request=this.map._requestManager.transformRequest(c.exported.resolveURL(a),c.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(a),this._pendingLoads++,this.fire(new c.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(p,f)=>{if(this._pendingLoads--,this._removed||f&&f.abandoned)return void this.fire(new c.Event("dataabort",{dataType:"source",sourceDataType:e}));let y=null;if(f&&f.resourceTiming&&f.resourceTiming[this.id]&&(y=f.resourceTiming[this.id].slice(0)),p)return void this.fire(new c.ErrorEvent(p));const T={dataType:"source",sourceDataType:e};this._collectResourceTiming&&y&&y.length>0&&c.extend(T,{resourceTiming:y}),this.fire(new c.Event("data",T))})}loaded(){return this._pendingLoads===0}loadTile(e,s){const a=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const p={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.request=this.actor.send(a,p,(f,y)=>(delete e.request,e.unloadVectorData(),e.aborted?s(null):f?s(f):(e.loadVectorData(y,this.map.painter,a==="reloadTile"),s(null))))}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ae=c.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gn extends c.Evented{constructor(e,s,a,p){super(),this.id=e,this.dispatcher=a,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(e,s){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(a,p)=>{this._loaded=!0,a?this.fire(new c.ErrorEvent(a)):p&&(this.image=p,e&&(this.coordinates=e),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}setCoordinates(e){this.coordinates=e;const s=e.map(c.MercatorCoordinate.fromLngLat);this.tileID=function(p){let f=1/0,y=1/0,T=-1/0,I=-1/0;for(const Z of p)f=Math.min(f,Z.x),y=Math.min(y,Z.y),T=Math.max(T,Z.x),I=Math.max(I,Z.y);const P=Math.max(T-f,I-y),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),O=Math.pow(2,z);return new c.CanonicalTileID(z,Math.floor((f+T)/2*O),Math.floor((y+I)/2*O))}(s),this.minzoom=this.maxzoom=this.tileID.z;const a=s.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new c.RasterBoundsArray,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.EXTENT,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.EXTENT),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.EXTENT,c.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ce(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const a in this.tiles){const p=this.tiles[a];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}loadTile(e,s){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},s(null)):(e.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class re extends gn{constructor(e,s,a,p){super(e,s,a,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,c.ResourceType.Source).url);c.getVideo(this.urls,(s,a)=>{this._loaded=!0,s?this.fire(new c.ErrorEvent(s)):a&&(this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new ce(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const a in this.tiles){const p=this.tiles[a];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ze extends gn{constructor(e,s,a,p){super(e,s,a,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(y=>typeof y!="number"))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,a=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ae.members)),this.boundsSegments||(this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ce(s,this.canvas,a.RGBA,{premultiply:!0});for(const p in this.tiles){const f=this.tiles[p];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const gi={vector:us,raster:Ci,"raster-dem":Yt,geojson:sn,video:re,image:gn,canvas:Ze};function yi(h,e){const s=c.create();return c.translate(s,s,[1,1,0]),c.scale(s,s,[.5*h.width,.5*h.height,1]),c.multiply(s,s,h.calculatePosMatrix(e.toUnwrapped()))}function ri(h,e,s,a,p,f){const y=function(O,Z,H){if(O)for(const j of O){const W=Z[j];if(W&&W.source===H&&W.type==="fill-extrusion")return!0}else for(const j in Z){const W=Z[j];if(W.source===H&&W.type==="fill-extrusion")return!0}return!1}(p&&p.layers,e,h.id),T=f.maxPitchScaleFactor(),I=h.tilesIn(a,T,y);I.sort(Pe);const P=[];for(const O of I)P.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(e,s,h._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,p,f,T,yi(h.transform,O.tileID))});const z=function(O){const Z={},H={};for(const j of O){const W=j.queryResults,rt=j.wrappedTileID,ht=H[rt]=H[rt]||{};for(const pt in W){const X=W[pt],_t=ht[pt]=ht[pt]||{},ft=Z[pt]=Z[pt]||[];for(const Tt of X)_t[Tt.featureIndex]||(_t[Tt.featureIndex]=!0,ft.push(Tt))}}return Z}(P);for(const O in z)z[O].forEach(Z=>{const H=Z.feature,j=h.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=j});return z}function Pe(h,e){const s=h.tileID,a=e.tileID;return s.overscaledZ-a.overscaledZ||s.canonical.y-a.canonical.y||s.wrap-a.wrap||s.canonical.x-a.canonical.x}class De{constructor(e,s){this.tileID=e,this.uid=c.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<c.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.textures.forEach(s=>e.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(e,s,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,f){const y={};if(!f)return y;for(const T of p){const I=T.layerIds.map(P=>f.getLayer(P)).filter(Boolean);if(I.length!==0){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(P=>I.filter(z=>z.id===P)[0]));for(const P of I)y[P.id]=T}}return y}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const f=this.buckets[p];if(f instanceof c.SymbolBucket){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const f=this.buckets[p];if(f instanceof c.SymbolBucket&&f.hasRTLText){this.hasRTLText=!0,c.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const p in this.buckets){const f=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.CollisionBoxArray}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const p=this.buckets[a];p.uploadPending()&&p.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ce(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ce(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,a,p,f,y,T,I,P,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:f,scale:y,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:T,queryPadding:this.queryPadding*P},e,s,a):{}}querySourceFeatures(e,s){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const p=a.loadVTLayers(),f=s?s.sourceLayer:"",y=p._geojsonTileLayer||p[f];if(!y)return;const T=c.createFilter(s&&s.filter),{z:I,x:P,y:z}=this.tileID.canonical,O={z:I,x:P,y:z};for(let Z=0;Z<y.length;Z++){const H=y.feature(Z);if(T.needGeometry){const rt=c.toEvaluationFeature(H,!0);if(!T.filter(new c.EvaluationParameters(this.tileID.overscaledZ),rt,this.tileID.canonical))continue}else if(!T.filter(new c.EvaluationParameters(this.tileID.overscaledZ),H))continue;const j=a.getId(H,f),W=new c.GeoJSONFeature(H,I,P,z,j);W.tile=O,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const a=c.parseCacheControl(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let p=!1;if(this.expirationTime>a)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const f=this.expirationTime-s;f?this.expirationTime=a+Math.max(f,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const f=this.buckets[p],y=f.layers[0].sourceLayer||"_geojsonTileLayer",T=a[y],I=e[y];if(!T||!I||Object.keys(I).length===0)continue;f.update(I,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=s&&s.style&&s.style.getLayer(p);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=c.exported.now()+e}setDependencies(e,s){const a={};for(const p of s)a[p]=!0;this.dependencies[e]=a}hasDependency(e,s){for(const a of e){const p=this.dependencies[a];if(p){for(const f of s)if(p[f])return!0}}return!1}}class Mi{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,a){const p=e.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const f={value:s,timeout:void 0};if(a!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[p].push(f),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const a=e.wrapped().key,p=s===void 0?0:this.data[a].indexOf(s),f=this.data[a][p];return this.data[a].splice(p,1),f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const a in this.data)for(const p of this.data[a])e(p.value)||s.push(p);for(const a of s)this.remove(a.value.tileID,a)}}class Ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,a){const p=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},c.extend(this.stateChanges[e][p],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==p&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][p]===null){this.deletedStates[e][p]={};for(const f in this.state[e][p])a[f]||(this.deletedStates[e][p][f]=null)}else for(const f in a)this.deletedStates[e]&&this.deletedStates[e][p]&&this.deletedStates[e][p][f]===null&&delete this.deletedStates[e][p][f]}removeFeatureState(e,s,a){if(this.deletedStates[e]===null)return;const p=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&s!==void 0)this.deletedStates[e][p]!==null&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][a]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][p])for(a in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][a]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,s){const a=String(s),p=c.extend({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][s];if(f===null)return{};for(const y in f)delete p[y]}return p}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const a={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const f={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),c.extend(this.state[p][y],this.stateChanges[p][y]),f[y]=this.state[p][y];a[p]=f}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const f={};if(this.deletedStates[p]===null)for(const y in this.state[p])f[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(this.deletedStates[p][y]===null)this.state[p][y]={};else for(const T of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][T];f[y]=this.state[p][y]}a[p]=a[p]||{},c.extend(a[p],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const p in e)e[p].setFeatureState(a,s)}}class Zi extends c.Evented{constructor(e,s,a){super(),this.id=e,this.dispatcher=a,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(p,f,y,T){const I=new gi[f.type](p,f,y,T);if(I.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${I.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],I),I}(e,s,a,this),this._tiles={},this._cache=new Mi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ni}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s){return this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){this._source.abortTile&&this._source.abortTile(e,()=>{}),this._source.fire(new c.Event("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const a=this._tiles[s];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(gr).map(e=>e.key)}getRenderableIds(e){const s=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&s.push(this._tiles[a]);return e?s.sort((a,p)=>{const f=a.tileID,y=p.tileID,T=new c.pointGeometry(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),I=new c.pointGeometry(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-y.overscaledZ||I.y-T.y||I.x-T.x}).map(a=>a.tileID.key):s.map(a=>a.tileID).sort(gr).map(a=>a.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=s),this._loadTile(a,this._tileLoaded.bind(this,a,e,s)))}_tileLoaded(e,s,a,p){if(p)return e.state="errored",void(p.status!==404?this._source.fire(new c.ErrorEvent(p,{tile:e})):this.update(this.transform,this.terrain));e.timeAdded=c.exported.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.Event("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const f=s[p];if(e.neighboringTiles&&e.neighboringTiles[f]){const y=this.getTileByID(f);a(e,y),a(y,e)}}function a(p,f){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let y=f.tileID.canonical.x-p.tileID.canonical.x;const T=f.tileID.canonical.y-p.tileID.canonical.y,I=Math.pow(2,p.tileID.canonical.z),P=f.tileID.key;y===0&&T===0||Math.abs(T)>1||(Math.abs(y)>1&&(Math.abs(y+I)===1?y+=I:Math.abs(y-I)===1&&(y-=I)),f.dem&&p.dem&&(p.dem.backfillBorder(f.dem,y,T),p.neighboringTiles&&p.neighboringTiles[P]&&(p.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,a,p){for(const f in this._tiles){let y=this._tiles[f];if(p[f]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>a)continue;let T=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const P=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[P.key],y&&y.hasData()&&(T=P)}let I=T;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){p[T.key]=T;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=s?a:null}for(let a=e.overscaledZ-1;a>=s;a--){const p=e.scaledTo(a),f=this._getLoadedTile(p);if(f)return f}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,p=Math.floor(s*a*5),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(f)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const a={};for(const p in this._tiles){const f=this._tiles[p];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),a[f.tileID.key]=f}this._tiles=a;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(e,s){if(this.transform=e,this.terrain=s,!this._sourceLoaded||this._paused)return;let a;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new c.OverscaledTileID(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(a=a.filter(P=>this._source.hasTile(P)))):a=[];const p=e.coveringZoomLevel(this._source),f=Math.max(p-Zi.maxOverzooming,this._source.minzoom),y=Math.max(p+Zi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const z of a)if(z.canonical.z>this._source.minzoom){const O=z.scaledTo(z.canonical.z-1);P[O.key]=O;const Z=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));P[Z.key]=Z}a=a.concat(Object.values(P))}const T=this._updateRetainedTiles(a,p);if(Nr(this._source.type)){const P={},z={},O=Object.keys(T);for(const Z of O){const H=T[Z],j=this._tiles[Z];if(!j||j.fadeEndTime&&j.fadeEndTime<=c.exported.now())continue;const W=this.findLoadedParent(H,f);W&&(this._addTile(W.tileID),P[W.tileID.key]=W.tileID),z[Z]=H}this._retainLoadedChildren(z,p,y,T);for(const Z in P)T[Z]||(this._coveredTiles[Z]=!0,T[Z]=P[Z]);if(s){const Z={},H={};for(const j of a)this._tiles[j.key].hasData()?Z[j.key]=j:H[j.key]=j;for(const j in H){const W=H[j].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(Z[W[0].key]=T[W[0].key]=W[0],Z[W[1].key]=T[W[1].key]=W[1],Z[W[2].key]=T[W[2].key]=W[2],Z[W[3].key]=T[W[3].key]=W[3],delete H[j])}for(const j in H){const W=this.findLoadedParent(H[j],this._source.minzoom);if(W){Z[W.tileID.key]=T[W.tileID.key]=W.tileID;for(const rt in Z)Z[rt].isChildOf(W.tileID)&&delete Z[rt]}}for(const j in this._tiles)Z[j]||(this._coveredTiles[j]=!0)}}for(const P in T)this._tiles[P].clearFadeHold();const I=c.keysDifference(this._tiles,T);for(const P of I){const z=this._tiles[P];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){const a={},p={},f=Math.max(s-Zi.maxOverzooming,this._source.minzoom),y=Math.max(s+Zi.maxUnderzooming,this._source.minzoom),T={};for(const I of e){const P=this._addTile(I);a[I.key]=I,P.hasData()||s<this._source.maxzoom&&(T[I.key]=I)}this._retainLoadedChildren(T,s,y,a);for(const I of e){let P=this._tiles[I.key];if(P.hasData())continue;if(s+1>this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],Z=this.getTile(O);if(Z&&Z.hasData()){a[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(a[O[0].key]&&a[O[1].key]&&a[O[2].key]&&a[O[3].key])continue}let z=P.wasRequested();for(let O=I.overscaledZ-1;O>=f;--O){const Z=I.scaledTo(O);if(p[Z.key]||(p[Z.key]=!0,P=this.getTile(Z),!P&&z&&(P=this._addTile(Z)),P&&(a[Z.key]=Z,z=P.wasRequested(),P.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let a,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){a=this._loadedParentTiles[p.key];break}s.push(p.key);const f=p.scaledTo(p.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;p=f}for(const f of s)this._loadedParentTiles[f]=a}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const a=s;return s||(s=new De(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))),s.uses++,this._tiles[e.key]=s,a||this._source.fire(new c.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=s.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,a){const p=[],f=this.transform;if(!f)return p;const y=a?f.getCameraQueryGeometry(e):e,T=e.map(j=>f.pointCoordinate(j,this.terrain)),I=y.map(j=>f.pointCoordinate(j,this.terrain)),P=this.getIds();let z=1/0,O=1/0,Z=-1/0,H=-1/0;for(const j of I)z=Math.min(z,j.x),O=Math.min(O,j.y),Z=Math.max(Z,j.x),H=Math.max(H,j.y);for(let j=0;j<P.length;j++){const W=this._tiles[P[j]];if(W.holdingForFade())continue;const rt=W.tileID,ht=Math.pow(2,f.zoom-W.tileID.overscaledZ),pt=s*W.queryPadding*c.EXTENT/W.tileSize/ht,X=[rt.getTilePoint(new c.MercatorCoordinate(z,O)),rt.getTilePoint(new c.MercatorCoordinate(Z,H))];if(X[0].x-pt<c.EXTENT&&X[0].y-pt<c.EXTENT&&X[1].x+pt>=0&&X[1].y+pt>=0){const _t=T.map(Tt=>rt.getTilePoint(Tt)),ft=I.map(Tt=>rt.getTilePoint(Tt));p.push({tile:W,tileID:rt,queryGeometry:_t,cameraQueryGeometry:ft,scale:ht})}}return p}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of s)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Nr(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=c.exported.now())return!0}return!1}setFeatureState(e,s,a){this._state.updateState(e=e||"_geojsonTileLayer",s,a)}removeFeatureState(e,s,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,a)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,a){const p=this._tiles[e];p&&p.setDependencies(s,a)}reloadTilesForDependencies(e,s){for(const a in this._tiles)this._tiles[a].hasDependency(e,s)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,s))}}function gr(h,e){const s=Math.abs(2*h.wrap)-+(h.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||a-s||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function Nr(h){return h==="raster"||h==="image"||h==="video"}Zi.maxOverzooming=10,Zi.maxUnderzooming=3;const on="mapboxgl_preloaded_worker_pool";class Vi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Vi.workerCount;)this.workers.push(new Worker(rs.workerUrl));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[on]}numActive(){return Object.keys(this.active).length}}const Es=Math.floor(c.exported.hardwareConcurrency/2);let Qn;function Zr(){return Qn||(Qn=new Vi),Qn}function yr(h,e){const s={};for(const a in h)a!=="ref"&&(s[a]=h[a]);return c.refProperties.forEach(a=>{a in e&&(s[a]=e[a])}),s}function vr(h){h=h.slice();const e=Object.create(null);for(let s=0;s<h.length;s++)e[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=yr(h[s],e[h[s].ref]));return h}Vi.workerCount=Math.max(Math.min(Es,6),1);const Ae={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function En(h,e,s){s.push({command:Ae.addSource,args:[h,e[h]]})}function Fn(h,e,s){e.push({command:Ae.removeSource,args:[h]}),s[h]=!0}function tr(h,e,s,a){Fn(h,s,a),En(h,e,s)}function ps(h,e,s){let a;for(a in h[s])if(Object.prototype.hasOwnProperty.call(h[s],a)&&a!=="data"&&!Gt(h[s][a],e[s][a]))return!1;for(a in e[s])if(Object.prototype.hasOwnProperty.call(e[s],a)&&a!=="data"&&!Gt(h[s][a],e[s][a]))return!1;return!0}function er(h,e,s,a,p,f){let y;for(y in e=e||{},h=h||{})Object.prototype.hasOwnProperty.call(h,y)&&(Gt(h[y],e[y])||s.push({command:f,args:[a,y,e[y],p]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(h,y)&&(Gt(h[y],e[y])||s.push({command:f,args:[a,y,e[y],p]}))}function ir(h){return h.id}function xr(h,e){return h[e.id]=e,h}class Un{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.clamp(e,0,1);let s=1,a=this._distances[s];const p=e*this.paddedLength+this.padding;for(;a<p&&s<this._distances.length;)a=this._distances[++s];const f=s-1,y=this._distances[f],T=a-y,I=T>0?(p-y)/T:0;return this.points[f].mult(1-I).add(this.points[s].mult(I))}}function wt(h,e){let s=!0;return h==="always"||h!=="never"&&e!=="never"||(s=!1),s}class Bt{constructor(e,s,a){const p=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(s/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)p.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,a,p,f){this._forEachCell(s,a,p,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(f)}insertCircle(e,s,a,p){this._forEachCell(s-p,a-p,s+p,a+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(a),this.circles.push(p)}_insertBoxCell(e,s,a,p,f,y){this.boxCells[f].push(y)}_insertCircleCell(e,s,a,p,f,y){this.circleCells[f].push(y)}_query(e,s,a,p,f,y,T){if(a<0||e>this.width||p<0||s>this.height)return[];const I=[];if(e<=0&&s<=0&&this.width<=a&&this.height<=p){if(f)return[{key:null,x1:e,y1:s,x2:a,y2:p}];for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],O=this.circles[3*P+1],Z=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:z-Z,y1:O-Z,x2:z+Z,y2:O+Z})}}else this._forEachCell(e,s,a,p,this._queryCell,I,{hitTest:f,overlapMode:y,seenUids:{box:{},circle:{}}},T);return I}query(e,s,a,p){return this._query(e,s,a,p,!1,null)}hitTest(e,s,a,p,f,y){return this._query(e,s,a,p,!0,f,y).length>0}hitTestCircle(e,s,a,p,f){const y=e-a,T=e+a,I=s-a,P=s+a;if(T<0||y>this.width||P<0||I>this.height)return!1;const z=[];return this._forEachCell(y,I,T,P,this._queryCellCircle,z,{hitTest:!0,overlapMode:p,circle:{x:e,y:s,radius:a},seenUids:{box:{},circle:{}}},f),z.length>0}_queryCell(e,s,a,p,f,y,T,I){const{seenUids:P,hitTest:z,overlapMode:O}=T,Z=this.boxCells[f];if(Z!==null){const j=this.bboxes;for(const W of Z)if(!P.box[W]){P.box[W]=!0;const rt=4*W,ht=this.boxKeys[W];if(e<=j[rt+2]&&s<=j[rt+3]&&a>=j[rt+0]&&p>=j[rt+1]&&(!I||I(ht))&&(!z||!wt(O,ht.overlapMode))&&(y.push({key:ht,x1:j[rt],y1:j[rt+1],x2:j[rt+2],y2:j[rt+3]}),z))return!0}}const H=this.circleCells[f];if(H!==null){const j=this.circles;for(const W of H)if(!P.circle[W]){P.circle[W]=!0;const rt=3*W,ht=this.circleKeys[W];if(this._circleAndRectCollide(j[rt],j[rt+1],j[rt+2],e,s,a,p)&&(!I||I(ht))&&(!z||!wt(O,ht.overlapMode))){const pt=j[rt],X=j[rt+1],_t=j[rt+2];if(y.push({key:ht,x1:pt-_t,y1:X-_t,x2:pt+_t,y2:X+_t}),z)return!0}}}return!1}_queryCellCircle(e,s,a,p,f,y,T,I){const{circle:P,seenUids:z,overlapMode:O}=T,Z=this.boxCells[f];if(Z!==null){const j=this.bboxes;for(const W of Z)if(!z.box[W]){z.box[W]=!0;const rt=4*W,ht=this.boxKeys[W];if(this._circleAndRectCollide(P.x,P.y,P.radius,j[rt+0],j[rt+1],j[rt+2],j[rt+3])&&(!I||I(ht))&&!wt(O,ht.overlapMode))return y.push(!0),!0}}const H=this.circleCells[f];if(H!==null){const j=this.circles;for(const W of H)if(!z.circle[W]){z.circle[W]=!0;const rt=3*W,ht=this.circleKeys[W];if(this._circlesCollide(j[rt],j[rt+1],j[rt+2],P.x,P.y,P.radius)&&(!I||I(ht))&&!wt(O,ht.overlapMode))return y.push(!0),!0}}}_forEachCell(e,s,a,p,f,y,T,I){const P=this._convertToXCellCoord(e),z=this._convertToYCellCoord(s),O=this._convertToXCellCoord(a),Z=this._convertToYCellCoord(p);for(let H=P;H<=O;H++)for(let j=z;j<=Z;j++)if(f.call(this,e,s,a,p,this.xCellCount*j+H,y,T,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,a,p,f,y){const T=p-e,I=f-s,P=a+y;return P*P>T*T+I*I}_circleAndRectCollide(e,s,a,p,f,y,T){const I=(y-p)/2,P=Math.abs(e-(p+I));if(P>I+a)return!1;const z=(T-f)/2,O=Math.abs(s-(f+z));if(O>z+a)return!1;if(P<=I||O<=z)return!0;const Z=P-I,H=O-z;return Z*Z+H*H<=a*a}}function br(h,e,s,a,p){const f=c.create();return e?(c.scale(f,f,[1/p,1/p,1]),s||c.rotateZ(f,f,a.angle)):c.multiply(f,a.labelPlaneMatrix,h),f}function yn(h,e,s,a,p){if(e){const f=c.clone(h);return c.scale(f,f,[p,p,1]),s||c.rotateZ(f,f,-a.angle),f}return a.glCoordMatrix}function Ce(h,e,s){let a;s?(a=[h.x,h.y,s(h.x,h.y),1],c.transformMat4(a,a,e)):(a=[h.x,h.y,0,1],rr(a,a,e));const p=a[3];return{point:new c.pointGeometry(a[0]/p,a[1]/p),signedDistanceFromCamera:p}}function an(h,e){return .5+h/e*.5}function Gi(h,e){const s=h[0]/h[3],a=h[1]/h[3];return s>=-e[0]&&s<=e[0]&&a>=-e[1]&&a<=e[1]}function Wi(h,e,s,a,p,f,y,T,I,P){const z=a?h.textSizeData:h.iconSizeData,O=c.evaluateSizeForZoom(z,s.transform.zoom),Z=[256/s.width*2+1,256/s.height*2+1],H=a?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;H.clear();const j=h.lineVertexArray,W=a?h.text.placedSymbolArray:h.icon.placedSymbolArray,rt=s.transform.width/s.transform.height;let ht=!1;for(let pt=0;pt<W.length;pt++){const X=W.get(pt);if(X.hidden||X.writingMode===c.WritingMode.vertical&&!ht){le(X.numGlyphs,H);continue}let _t;if(ht=!1,P?(_t=[X.anchorX,X.anchorY,P(X.anchorX,X.anchorY),1],c.transformMat4(_t,_t,e)):(_t=[X.anchorX,X.anchorY,0,1],rr(_t,_t,e)),!Gi(_t,Z)){le(X.numGlyphs,H);continue}const ft=an(s.transform.cameraToCenterDistance,_t[3]),Tt=c.evaluateSizeForFeature(z,O,X),St=y?Tt/ft:Tt*ft,Mt=new c.pointGeometry(X.anchorX,X.anchorY),bt=Ce(Mt,p,P).point,Vt={},Rt=me(X,St,!1,T,e,p,f,h.glyphOffsetArray,j,H,bt,Mt,Vt,rt,I,P);ht=Rt.useVertical,(Rt.notEnoughRoom||ht||Rt.needsFlipping&&me(X,St,!0,T,e,p,f,h.glyphOffsetArray,j,H,bt,Mt,Vt,rt,I,P).notEnoughRoom)&&le(X.numGlyphs,H)}a?h.text.dynamicLayoutVertexBuffer.updateData(H):h.icon.dynamicLayoutVertexBuffer.updateData(H)}function wr(h,e,s,a,p,f,y,T,I,P,z,O,Z){const H=T.glyphStartIndex+T.numGlyphs,j=T.lineStartIndex,W=T.lineStartIndex+T.lineLength,rt=e.getoffsetX(T.glyphStartIndex),ht=e.getoffsetX(H-1),pt=wi(h*rt,s,a,p,f,y,T.segment,j,W,I,P,z,O,Z);if(!pt)return null;const X=wi(h*ht,s,a,p,f,y,T.segment,j,W,I,P,z,O,Z);return X?{first:pt,last:X}:null}function Lt(h,e,s,a){return h===c.WritingMode.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*a?{useVertical:!0}:(h===c.WritingMode.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function me(h,e,s,a,p,f,y,T,I,P,z,O,Z,H,j,W){const rt=e/24,ht=h.lineOffsetX*rt,pt=h.lineOffsetY*rt;let X;if(h.numGlyphs>1){const _t=h.glyphStartIndex+h.numGlyphs,ft=h.lineStartIndex,Tt=h.lineStartIndex+h.lineLength,St=wr(rt,T,ht,pt,s,z,O,h,I,f,Z,j,W);if(!St)return{notEnoughRoom:!0};const Mt=Ce(St.first.point,y,W).point,bt=Ce(St.last.point,y,W).point;if(a&&!s){const Vt=Lt(h.writingMode,Mt,bt,H);if(Vt)return Vt}X=[St.first];for(let Vt=h.glyphStartIndex+1;Vt<_t-1;Vt++)X.push(wi(rt*T.getoffsetX(Vt),ht,pt,s,z,O,h.segment,ft,Tt,I,f,Z,j,W));X.push(St.last)}else{if(a&&!s){const ft=Ce(O,p,W).point,Tt=h.lineStartIndex+h.segment+1,St=new c.pointGeometry(I.getx(Tt),I.gety(Tt)),Mt=Ce(St,p,W),bt=Mt.signedDistanceFromCamera>0?Mt.point:ue(O,St,ft,1,p,W),Vt=Lt(h.writingMode,ft,bt,H);if(Vt)return Vt}const _t=wi(rt*T.getoffsetX(h.glyphStartIndex),ht,pt,s,z,O,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,I,f,Z,j,W);if(!_t)return{notEnoughRoom:!0};X=[_t]}for(const _t of X)c.addDynamicAttributes(P,_t.point,_t.angle);return{}}function ue(h,e,s,a,p,f){const y=Ce(h.add(h.sub(e)._unit()),p,f).point,T=s.sub(y);return s.add(T._mult(a/T.mag()))}function wi(h,e,s,a,p,f,y,T,I,P,z,O,Z,H){const j=a?h-e:h+e;let W=j>0?1:-1,rt=0;a&&(W*=-1,rt=Math.PI),W<0&&(rt+=Math.PI);let ht=W>0?T+y:T+y+1,pt=p,X=p,_t=0,ft=0;const Tt=Math.abs(j),St=[];for(;_t+ft<=Tt;){if(ht+=W,ht<T||ht>=I)return null;if(X=pt,St.push(pt),pt=O[ht],pt===void 0){const $t=new c.pointGeometry(P.getx(ht),P.gety(ht)),de=Ce($t,z,H);if(de.signedDistanceFromCamera>0)pt=O[ht]=de.point;else{const ye=ht-W;pt=ue(_t===0?f:new c.pointGeometry(P.getx(ye),P.gety(ye)),$t,X,Tt-_t+1,z,H)}}_t+=ft,ft=X.dist(pt)}const Mt=(Tt-_t)/ft,bt=pt.sub(X),Vt=bt.mult(Mt)._add(X);Vt._add(bt._unit()._perp()._mult(s*W));const Rt=rt+Math.atan2(pt.y-X.y,pt.x-X.x);return St.push(Vt),{point:Vt,angle:Z?Rt:0,path:St}}const nr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(h,e){for(let s=0;s<h;s++){const a=e.length;e.resize(a+4),e.float32.set(nr,3*a)}}function rr(h,e,s){const a=e[0],p=e[1];return h[0]=s[0]*a+s[4]*p+s[12],h[1]=s[1]*a+s[5]*p+s[13],h[3]=s[3]*a+s[7]*p+s[15],h}const Ti=100;class ds{constructor(e,s=new Bt(e.width+200,e.height+200,25),a=new Bt(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=a,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ti,this.screenBottomBoundary=e.height+Ti,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,a,p,f,y){const T=this.projectAndGetPerspectiveRatio(p,e.anchorPointX,e.anchorPointY,y),I=a*T.perspectiveRatio,P=e.x1*I+T.point.x,z=e.y1*I+T.point.y,O=e.x2*I+T.point.x,Z=e.y2*I+T.point.y;return!this.isInsideGrid(P,z,O,Z)||s!=="always"&&this.grid.hitTest(P,z,O,Z,s,f)||T.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[P,z,O,Z],offscreen:this.isOffscreen(P,z,O,Z)}}placeCollisionCircles(e,s,a,p,f,y,T,I,P,z,O,Z,H,j){const W=[],rt=new c.pointGeometry(s.anchorX,s.anchorY),ht=Ce(rt,y,j),pt=an(this.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),X=(z?f/pt:f*pt)/c.ONE_EM,_t=Ce(rt,T,j).point,ft=wr(X,p,s.lineOffsetX*X,s.lineOffsetY*X,!1,_t,rt,s,a,T,{},!1,j);let Tt=!1,St=!1,Mt=!0;if(ft){const bt=.5*Z*pt+H,Vt=new c.pointGeometry(-100,-100),Rt=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$t=new Un,de=ft.first,ye=ft.last;let te=[];for(let Le=de.path.length-1;Le>=1;Le--)te.push(de.path[Le]);for(let Le=1;Le<ye.path.length;Le++)te.push(ye.path[Le]);const Ve=2.5*bt;if(I){const Le=te.map(ke=>Ce(ke,I,j));te=Le.some(ke=>ke.signedDistanceFromCamera<=0)?[]:Le.map(ke=>ke.point)}let Ge=[];if(te.length>0){const Le=te[0].clone(),ke=te[0].clone();for(let qe=1;qe<te.length;qe++)Le.x=Math.min(Le.x,te[qe].x),Le.y=Math.min(Le.y,te[qe].y),ke.x=Math.max(ke.x,te[qe].x),ke.y=Math.max(ke.y,te[qe].y);Ge=Le.x>=Vt.x&&ke.x<=Rt.x&&Le.y>=Vt.y&&ke.y<=Rt.y?[te]:ke.x<Vt.x||Le.x>Rt.x||ke.y<Vt.y||Le.y>Rt.y?[]:c.clipLine([te],Vt.x,Vt.y,Rt.x,Rt.y)}for(const Le of Ge){$t.reset(Le,.25*bt);let ke=0;ke=$t.length<=.5*bt?1:Math.ceil($t.paddedLength/Ve)+1;for(let qe=0;qe<ke;qe++){const Di=qe/Math.max(ke-1,1),kr=$t.lerp(Di),ur=kr.x+Ti,Dr=kr.y+Ti;W.push(ur,Dr,bt,0);const Ts=ur-bt,Xn=Dr-bt,wn=ur+bt,ss=Dr+bt;if(Mt=Mt&&this.isOffscreen(Ts,Xn,wn,ss),St=St||this.isInsideGrid(Ts,Xn,wn,ss),e!=="always"&&this.grid.hitTestCircle(ur,Dr,bt,e,O)&&(Tt=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Tt}}}}return{circles:!P&&Tt||!St||pt<this.perspectiveRatioCutoff?[]:W,offscreen:Mt,collisionDetected:Tt}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let a=1/0,p=1/0,f=-1/0,y=-1/0;for(const z of e){const O=new c.pointGeometry(z.x+Ti,z.y+Ti);a=Math.min(a,O.x),p=Math.min(p,O.y),f=Math.max(f,O.x),y=Math.max(y,O.y),s.push(O)}const T=this.grid.query(a,p,f,y).concat(this.ignoredGrid.query(a,p,f,y)),I={},P={};for(const z of T){const O=z.key;if(I[O.bucketInstanceId]===void 0&&(I[O.bucketInstanceId]={}),I[O.bucketInstanceId][O.featureIndex])continue;const Z=[new c.pointGeometry(z.x1,z.y1),new c.pointGeometry(z.x2,z.y1),new c.pointGeometry(z.x2,z.y2),new c.pointGeometry(z.x1,z.y2)];c.polygonIntersectsPolygon(s,Z)&&(I[O.bucketInstanceId][O.featureIndex]=!0,P[O.bucketInstanceId]===void 0&&(P[O.bucketInstanceId]=[]),P[O.bucketInstanceId].push(O.featureIndex))}return P}insertCollisionBox(e,s,a,p,f,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:f,collisionGroupID:y,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,a,p,f,y){const T=a?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:f,collisionGroupID:y,overlapMode:s};for(let P=0;P<e.length;P+=4)T.insertCircle(I,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,s,a,p){let f;return p?(f=[s,a,p(s,a),1],c.transformMat4(f,f,e)):(f=[s,a,0,1],rr(f,f,e)),{point:new c.pointGeometry((f[0]/f[3]+1)/2*this.transform.width+Ti,(-f[1]/f[3]+1)/2*this.transform.height+Ti),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(e,s,a,p){return a<Ti||e>=this.screenRightBoundary||p<Ti||s>this.screenBottomBoundary}isInsideGrid(e,s,a,p){return a>=0&&e<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=c.identity([]);return c.translate(e,e,[-100,-100,0]),e}}function di(h,e,s){return e*(c.EXTENT/(h.tileSize*Math.pow(2,s-h.tileID.overscaledZ)))}class qi{constructor(e,s,a,p){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):p&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ue{constructor(e,s,a,p,f){this.text=new qi(e?e.text:null,s,a,f),this.icon=new qi(e?e.icon:null,s,p,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tr{constructor(e,s,a){this.text=e,this.icon=s,this.skipFade=a}}class Nn{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class Vr{constructor(e,s,a,p,f){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=a,this.bucketIndex=p,this.tileID=f}}class Gr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:a=>a.collisionGroupID===s}}return this.collisionGroups[e]}}function fs(h,e,s,a,p){const{horizontalAlign:f,verticalAlign:y}=c.getAnchorAlignment(h),T=-(f-.5)*e,I=-(y-.5)*s,P=c.evaluateVariableOffset(h,a);return new c.pointGeometry(T+P[0]*p,I+P[1]*p)}function zi(h,e,s,a,p,f){const{x1:y,x2:T,y1:I,y2:P,anchorPointX:z,anchorPointY:O}=h,Z=new c.pointGeometry(e,s);return a&&Z._rotate(p?f:-f),{x1:y+Z.x,y1:I+Z.y,x2:T+Z.x,y2:P+Z.y,anchorPointX:z,anchorPointY:O}}class U{constructor(e,s,a,p,f){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new ds(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Gr(p),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,s,a,p){const f=a.getBucket(s),y=a.latestFeatureIndex;if(!f||!y||s.id!==f.layerIds[0])return;const T=a.collisionBoxArray,I=f.layers[0].layout,P=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.EXTENT,O=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),Z=I.get("text-pitch-alignment")==="map",H=I.get("text-rotation-alignment")==="map",j=di(a,1,this.transform.zoom),W=br(O,Z,H,this.transform,j);let rt=null;if(Z){const pt=yn(O,Z,H,this.transform,j);rt=c.multiply([],this.transform.labelPlaneMatrix,pt)}this.retainedQueryData[f.bucketInstanceId]=new Vr(f.bucketInstanceId,y,f.sourceLayerIndex,f.index,a.tileID);const ht={bucket:f,layout:I,posMatrix:O,textLabelPlaneMatrix:W,labelToScreenMatrix:rt,scale:P,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(p)for(const pt of f.sortKeyRanges){const{sortKey:X,symbolInstanceStart:_t,symbolInstanceEnd:ft}=pt;e.push({sortKey:X,symbolInstanceStart:_t,symbolInstanceEnd:ft,parameters:ht})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:ht})}attemptAnchorPlacement(e,s,a,p,f,y,T,I,P,z,O,Z,H,j,W,rt){const ht=[Z.textOffset0,Z.textOffset1],pt=fs(e,a,p,ht,f),X=this.collisionIndex.placeCollisionBox(zi(s,pt.x,pt.y,y,T,this.transform.angle),O,I,P,z.predicate,rt);if((!W||this.collisionIndex.placeCollisionBox(zi(W,pt.x,pt.y,y,T,this.transform.angle),O,I,P,z.predicate,rt).box.length!==0)&&X.box.length>0){let _t;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(_t=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:ht,width:a,height:p,anchor:e,textBoxScale:f,prevAnchor:_t},this.markUsedJustification(H,e,Z,j),H.allowVerticalPlacement&&(this.markUsedOrientation(H,j,Z),this.placedOrientations[Z.crossTileID]=j),{shift:pt,placedGlyphBoxes:X}}}placeLayerBucketPart(e,s,a){const{bucket:p,layout:f,posMatrix:y,textLabelPlaneMatrix:T,labelToScreenMatrix:I,textPixelRatio:P,holdingForFade:z,collisionBoxArray:O,partiallyEvaluatedTextSize:Z,collisionGroup:H}=e.parameters,j=f.get("text-optional"),W=f.get("icon-optional"),rt=c.getOverlapMode(f,"text-overlap","text-allow-overlap"),ht=rt==="always",pt=c.getOverlapMode(f,"icon-overlap","icon-allow-overlap"),X=pt==="always",_t=f.get("text-rotation-alignment")==="map",ft=f.get("text-pitch-alignment")==="map",Tt=f.get("icon-text-fit")!=="none",St=f.get("symbol-z-order")==="viewport-y",Mt=ht&&(X||!p.hasIconData()||W),bt=X&&(ht||!p.hasTextData()||j);!p.collisionArrays&&O&&p.deserializeCollisionBoxes(O);const Vt=(Rt,$t)=>{if(s[Rt.crossTileID])return;if(z)return void(this.placements[Rt.crossTileID]=new Tr(!1,!1,!1));let de=!1,ye=!1,te=!0,Ve=null,Ge={box:null,offscreen:null},Le={box:null,offscreen:null},ke=null,qe=null,Di=null,kr=0,ur=0,Dr=0;$t.textFeatureIndex?kr=$t.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(kr=Rt.featureIndex),$t.verticalTextFeatureIndex&&(ur=$t.verticalTextFeatureIndex);const Ts=this.retainedQueryData[p.bucketInstanceId].tileID,Xn=this.terrain?(Ei,be)=>this.terrain.getElevation(Ts,Ei,be):null;for(const Ei of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const be=$t[Ei];be&&(be.elevation=Xn?Xn(be.anchorPointX,be.anchorPointY):0)}const wn=$t.textBox;if(wn){const Ei=Ne=>{let Bi=c.WritingMode.horizontal;if(p.allowVerticalPlacement&&!Ne&&this.prevPlacement){const Ri=this.prevPlacement.placedOrientations[Rt.crossTileID];Ri&&(this.placedOrientations[Rt.crossTileID]=Ri,Bi=Ri,this.markUsedOrientation(p,Bi,Rt))}return Bi},be=(Ne,Bi)=>{if(p.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&$t.verticalTextBox){for(const Ri of p.writingModes)if(Ri===c.WritingMode.vertical?(Ge=Bi(),Le=Ge):Ge=Ne(),Ge&&Ge.box&&Ge.box.length)break}else Ge=Ne()};if(f.get("text-variable-anchor")){let Ne=f.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt.crossTileID]){const oi=this.prevPlacement.variableOffsets[Rt.crossTileID];Ne.indexOf(oi.anchor)>0&&(Ne=Ne.filter(Kn=>Kn!==oi.anchor),Ne.unshift(oi.anchor))}const Bi=(oi,Kn,Xs)=>{const Oa=oi.x2-oi.x1,So=oi.y2-oi.y1,hl=Rt.textBoxScale,Fa=Tt&&pt==="never"?Kn:null;let Ss={box:[],offscreen:!1};const Ks=rt!=="never"?2*Ne.length:Ne.length;for(let Js=0;Js<Ks;++Js){const ya=this.attemptAnchorPlacement(Ne[Js%Ne.length],oi,Oa,So,hl,_t,ft,P,y,H,Js>=Ne.length?rt:"never",Rt,p,Xs,Fa,Xn);if(ya&&(Ss=ya.placedGlyphBoxes,Ss&&Ss.box&&Ss.box.length)){de=!0,Ve=ya.shift;break}}return Ss};be(()=>Bi(wn,$t.iconBox,c.WritingMode.horizontal),()=>{const oi=$t.verticalTextBox;return p.allowVerticalPlacement&&!(Ge&&Ge.box&&Ge.box.length)&&Rt.numVerticalGlyphVertices>0&&oi?Bi(oi,$t.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null}}),Ge&&(de=Ge.box,te=Ge.offscreen);const Ri=Ei(Ge&&Ge.box);if(!de&&this.prevPlacement){const oi=this.prevPlacement.variableOffsets[Rt.crossTileID];oi&&(this.variableOffsets[Rt.crossTileID]=oi,this.markUsedJustification(p,oi.anchor,Rt,Ri))}}else{const Ne=(Bi,Ri)=>{const oi=this.collisionIndex.placeCollisionBox(Bi,rt,P,y,H.predicate,Xn);return oi&&oi.box&&oi.box.length&&(this.markUsedOrientation(p,Ri,Rt),this.placedOrientations[Rt.crossTileID]=Ri),oi};be(()=>Ne(wn,c.WritingMode.horizontal),()=>{const Bi=$t.verticalTextBox;return p.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&Bi?Ne(Bi,c.WritingMode.vertical):{box:null,offscreen:null}}),Ei(Ge&&Ge.box&&Ge.box.length)}}if(ke=Ge,de=ke&&ke.box&&ke.box.length>0,te=ke&&ke.offscreen,Rt.useRuntimeCollisionCircles){const Ei=p.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex),be=c.evaluateSizeForFeature(p.textSizeData,Z,Ei),Ne=f.get("text-padding");qe=this.collisionIndex.placeCollisionCircles(rt,Ei,p.lineVertexArray,p.glyphOffsetArray,be,y,T,I,a,ft,H.predicate,Rt.collisionCircleDiameter,Ne,Xn),qe.circles.length&&qe.collisionDetected&&!a&&c.warnOnce("Collisions detected, but collision boxes are not shown"),de=ht||qe.circles.length>0&&!qe.collisionDetected,te=te&&qe.offscreen}if($t.iconFeatureIndex&&(Dr=$t.iconFeatureIndex),$t.iconBox){const Ei=be=>{const Ne=Tt&&Ve?zi(be,Ve.x,Ve.y,_t,ft,this.transform.angle):be;return this.collisionIndex.placeCollisionBox(Ne,pt,P,y,H.predicate,Xn)};Le&&Le.box&&Le.box.length&&$t.verticalIconBox?(Di=Ei($t.verticalIconBox),ye=Di.box.length>0):(Di=Ei($t.iconBox),ye=Di.box.length>0),te=te&&Di.offscreen}const ss=j||Rt.numHorizontalGlyphVertices===0&&Rt.numVerticalGlyphVertices===0,ga=W||Rt.numIconVertices===0;if(ss||ga?ga?ss||(ye=ye&&de):de=ye&&de:ye=de=ye&&de,de&&ke&&ke.box&&this.collisionIndex.insertCollisionBox(ke.box,rt,f.get("text-ignore-placement"),p.bucketInstanceId,Le&&Le.box&&ur?ur:kr,H.ID),ye&&Di&&this.collisionIndex.insertCollisionBox(Di.box,pt,f.get("icon-ignore-placement"),p.bucketInstanceId,Dr,H.ID),qe&&(de&&this.collisionIndex.insertCollisionCircles(qe.circles,rt,f.get("text-ignore-placement"),p.bucketInstanceId,kr,H.ID),a)){const Ei=p.bucketInstanceId;let be=this.collisionCircleArrays[Ei];be===void 0&&(be=this.collisionCircleArrays[Ei]=new Nn);for(let Ne=0;Ne<qe.circles.length;Ne+=4)be.circles.push(qe.circles[Ne+0]),be.circles.push(qe.circles[Ne+1]),be.circles.push(qe.circles[Ne+2]),be.circles.push(qe.collisionDetected?1:0)}if(Rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Rt.crossTileID]=new Tr(de||Mt,ye||bt,te||p.justReloaded),s[Rt.crossTileID]=!0};if(St){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Rt=p.getSortedSymbolIndexes(this.transform.angle);for(let $t=Rt.length-1;$t>=0;--$t){const de=Rt[$t];Vt(p.symbolInstances.get(de),p.collisionArrays[de])}}else for(let Rt=e.symbolInstanceStart;Rt<e.symbolInstanceEnd;Rt++)Vt(p.symbolInstances.get(Rt),p.collisionArrays[Rt]);if(a&&p.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[p.bucketInstanceId];c.invert(Rt.invProjMatrix,y),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(e,s,a,p){let f;f=p===c.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.getAnchorJustification(s)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const T of y)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=f>=0&&T!==f?0:a.crossTileID)}markUsedOrientation(e,s,a){const p=s===c.WritingMode.horizontal||s===c.WritingMode.horizontalOnly?s:0,f=s===c.WritingMode.vertical?s:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const T of y)e.text.placedSymbolArray.get(T).placedOrientation=p;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let a=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(e):1,f=s?s.opacities:{},y=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const I in this.placements){const P=this.placements[I],z=f[I];z?(this.opacities[I]=new Ue(z,p,P.text,P.icon),a=a||P.text!==z.text.placed||P.icon!==z.icon.placed):(this.opacities[I]=new Ue(null,p,P.text,P.icon,P.skipFade),a=a||P.text||P.icon)}for(const I in f){const P=f[I];if(!this.opacities[I]){const z=new Ue(P,p,!1,!1);z.isHidden()||(this.opacities[I]=z,a=a||P.text.placed||P.icon.placed)}}for(const I in y)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=y[I]);for(const I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const a={};for(const p of s){const f=p.getBucket(e);f&&p.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,a,p.collisionBoxArray)}}updateBucketOpacities(e,s,a){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0].layout,f=new Ue(null,0,!1,!1,!0),y=p.get("text-allow-overlap"),T=p.get("icon-allow-overlap"),I=p.get("text-variable-anchor"),P=p.get("text-rotation-alignment")==="map",z=p.get("text-pitch-alignment")==="map",O=p.get("icon-text-fit")!=="none",Z=new Ue(null,0,y&&(T||!e.hasIconData()||p.get("icon-optional")),T&&(y||!e.hasTextData()||p.get("text-optional")),!0);!e.collisionArrays&&a&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(a);const H=(j,W,rt)=>{for(let ht=0;ht<W/4;ht++)j.opacityVertexArray.emplaceBack(rt)};for(let j=0;j<e.symbolInstances.length;j++){const W=e.symbolInstances.get(j),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:ht,crossTileID:pt}=W;let X=this.opacities[pt];s[pt]?X=f:X||(X=Z,this.opacities[pt]=X),s[pt]=!0;const _t=W.numIconVertices>0,ft=this.placedOrientations[W.crossTileID],Tt=ft===c.WritingMode.vertical,St=ft===c.WritingMode.horizontal||ft===c.WritingMode.horizontalOnly;if(rt>0||ht>0){const Mt=at(X.text);H(e.text,rt,Tt?xt:Mt),H(e.text,ht,St?xt:Mt);const bt=X.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(e.text.placedSymbolArray.get($t).hidden=bt||Tt?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=bt||St?1:0);const Vt=this.variableOffsets[W.crossTileID];Vt&&this.markUsedJustification(e,Vt.anchor,W,ft);const Rt=this.placedOrientations[W.crossTileID];Rt&&(this.markUsedJustification(e,"left",W,Rt),this.markUsedOrientation(e,Rt,W))}if(_t){const Mt=at(X.icon),bt=!(O&&W.verticalPlacedIconSymbolIndex&&Tt);W.placedIconSymbolIndex>=0&&(H(e.icon,W.numIconVertices,bt?Mt:xt),e.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=X.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(H(e.icon,W.numVerticalIconVertices,bt?xt:Mt),e.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=X.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Mt=e.collisionArrays[j];if(Mt){let bt=new c.pointGeometry(0,0);if(Mt.textBox||Mt.verticalTextBox){let Rt=!0;if(I){const $t=this.variableOffsets[pt];$t?(bt=fs($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),P&&bt._rotate(z?this.transform.angle:-this.transform.angle)):Rt=!1}Mt.textBox&&C(e.textCollisionBox.collisionVertexArray,X.text.placed,!Rt||Tt,bt.x,bt.y),Mt.verticalTextBox&&C(e.textCollisionBox.collisionVertexArray,X.text.placed,!Rt||St,bt.x,bt.y)}const Vt=Boolean(!St&&Mt.verticalIconBox);Mt.iconBox&&C(e.iconCollisionBox.collisionVertexArray,X.icon.placed,Vt,O?bt.x:0,O?bt.y:0),Mt.verticalIconBox&&C(e.iconCollisionBox.collisionVertexArray,X.icon.placed,!Vt,O?bt.x:0,O?bt.y:0)}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=j.invProjMatrix,e.placementViewportMatrix=j.viewportMatrix,e.collisionCircleArray=j.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const a=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function C(h,e,s,a,p){h.emplaceBack(e?1:0,s?1:0,a||0,p||0),h.emplaceBack(e?1:0,s?1:0,a||0,p||0),h.emplaceBack(e?1:0,s?1:0,a||0,p||0),h.emplaceBack(e?1:0,s?1:0,a||0,p||0)}const B=Math.pow(2,25),q=Math.pow(2,24),$=Math.pow(2,17),Q=Math.pow(2,16),st=Math.pow(2,9),it=Math.pow(2,8),tt=Math.pow(2,1);function at(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const e=h.placed?1:0,s=Math.floor(127*h.opacity);return s*B+e*q+s*$+e*Q+s*st+e*it+s*tt+e}const xt=0;class At{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,a,p,f){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(y,p,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<y.length;)if(s.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,f())return!0;return!1}}class vt{constructor(e,s,a,p,f,y,T,I){this.placement=new U(e,s,y,T,I),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,s,a){const p=c.exported.now(),f=()=>{const y=c.exported.now()-p;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=s[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=T)&&(!y.maxzoom||y.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new At(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ht=512/c.EXTENT/2;class Xt{constructor(e,s,a){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let p=0;p<s.length;p++){const f=s.get(p),y=f.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:f.crossTileID,coord:this.getScaledCoordinates(f,e)})}}getScaledCoordinates(e,s){const a=Ht/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*c.EXTENT+e.anchorX)*a),y:Math.floor((s.canonical.y*c.EXTENT+e.anchorY)*a)}}findMatches(e,s,a){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<e.length;f++){const y=e.get(f);if(y.crossTileID)continue;const T=this.indexedSymbolInstances[y.key];if(!T)continue;const I=this.getScaledCoordinates(y,s);for(const P of T)if(Math.abs(P.coord.x-I.x)<=p&&Math.abs(P.coord.y-I.y)<=p&&!a[P.crossTileID]){a[P.crossTileID]=!0,y.crossTileID=P.crossTileID;break}}}}class Ft{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ne{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const a in this.indexes){const p=this.indexes[a],f={};for(const y in p){const T=p[y];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),f[T.tileID.key]=T}this.indexes[a]=f}this.lng=e}addBucket(e,s,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const p=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const y=this.indexes[f];if(Number(f)>e.overscaledZ)for(const T in y){const I=y[T];I.tileID.isChildOf(e)&&I.findMatches(s.symbolInstances,e,p)}else{const T=y[e.scaledTo(Number(f)).key];T&&T.findMatches(s.symbolInstances,e,p)}}for(let f=0;f<s.symbolInstances.length;f++){const y=s.symbolInstances.get(f);y.crossTileID||(y.crossTileID=a.generate(),p[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Xt(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const a in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[a])delete this.usedCrossTileIDs[e][p.crossTileID]}removeStaleBuckets(e){let s=!1;for(const a in this.indexes){const p=this.indexes[a];for(const f in p)e[p[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,p[f]),delete p[f],s=!0)}return s}}class se{constructor(){this.layerIndexes={},this.crossTileIDs=new Ft,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,a){let p=this.layerIndexes[e.id];p===void 0&&(p=this.layerIndexes[e.id]=new ne);let f=!1;const y={};p.handleWrapJump(a);for(const T of s){const I=T.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(T.tileID,I,this.crossTileIDs)&&(f=!0),y[I.bucketInstanceId]=!0)}return p.removeStaleBuckets(y)&&(f=!0),f}pruneUnusedLayers(e){const s={};e.forEach(a=>{s[a]=!0});for(const a in this.layerIndexes)s[a]||delete this.layerIndexes[a]}}var Me=c.createLayout([{name:"a_pos",type:"Int16",components:2}]);class he extends c.Evented{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=e._cache.max,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const e in this._tiles){const s=this._tiles[e];s.textures.forEach(a=>a.destroy()),s.textures=[]}}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];for(const a of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(a.key),this._tiles[a.key]||(a.posMatrix=new Float64Array(16),c.ortho(a.posMatrix,0,c.EXTENT,0,c.EXTENT,0,1),this._tiles[a.key]=new De(a,this.tileSize))}removeOutdated(e){const s={};this.renderHistory=this.renderHistory.filter((a,p)=>this.renderHistory.indexOf(a)===p).slice(0,this.renderHistorySize);for(const a of this._renderableTilesKeys)s[a]=!0;for(const a of this.renderHistory)s[a]=!0;for(const a in this._tiles)s[a]||(this._tiles[a].clearTextures(e),delete this._tiles[a])}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const a of this._renderableTilesKeys){const p=this._tiles[a].tileID;if(p.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),c.ortho(f.posMatrix,0,c.EXTENT,0,c.EXTENT,0,1),s[a]=f}else if(p.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const y=p.canonical.z-e.canonical.z,T=p.canonical.x-(p.canonical.x>>y<<y),I=p.canonical.y-(p.canonical.y>>y<<y),P=c.EXTENT>>y;c.ortho(f.posMatrix,0,P,0,P,0,1),c.translate(f.posMatrix,f.posMatrix,[-T*P,-I*P,0]),s[a]=f}else if(e.canonical.isChildOf(p.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const y=e.canonical.z-p.canonical.z,T=e.canonical.x-(e.canonical.x>>y<<y),I=e.canonical.y-(e.canonical.y>>y<<y),P=c.EXTENT>>y;c.ortho(f.posMatrix,0,c.EXTENT,0,c.EXTENT,0,1),c.translate(f.posMatrix,f.posMatrix,[T*P,I*P,0]),c.scale(f.posMatrix,f.posMatrix,[1/2**y,1/2**y,0]),s[a]=f}}return s}getSourceTile(e,s){const a=this.sourceCache._source;let p=e.overscaledZ-this.deltaZoom;if(p>a.maxzoom&&(p=a.maxzoom),p<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(p).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&s)for(;p>=a.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(p--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=e)}}class _e{constructor(e,s,a){this.style=e,this.sourceCache=new he(s),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.elevationOffset=typeof a.elevationOffset=="number"?a.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(e,s,a,p=c.EXTENT){if(!(s>=0&&s<p&&a>=0&&a<p))return this.elevationOffset;let f=0;const y=this.getTerrainData(e);if(y.tile&&y.tile.dem){const T=c.transformMat4$1([],[s/p*c.EXTENT,a/p*c.EXTENT],y.u_terrain_matrix),I=[T[0]*y.tile.dem.dim,T[1]*y.tile.dem.dim],P=[Math.floor(I[0]),Math.floor(I[1])],z=y.tile.dem.get(P[0],P[1]),O=y.tile.dem.get(P[0],P[1]+1),Z=y.tile.dem.get(P[0]+1,P[1]),H=y.tile.dem.get(P[0]+1,P[1]+1);f=c.number(c.number(z,O,I[0]-P[0]),c.number(Z,H,I[0]-P[0]),I[1]-P[1])}return f}rememberForRerender(e,s){for(const a in this.sourceCache._tiles){const p=this.sourceCache._tiles[a];(p.tileID.equals(s)||p.tileID.isChildOf(s))&&(e===this.sourceCache.sourceCache.id&&(p.timeLoaded=Date.now()),this._rerender[e]=this._rerender[e]||{},this._rerender[e][p.tileID.key]=!0)}}needsRerender(e,s){return this._rerender[e]&&this._rerender[e][s.key]}clearRerenderCache(){this._rerender={}}getElevation(e,s,a,p=c.EXTENT){return(this.getDEMElevation(e,s,a,p)+this.elevationOffset)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const p=this.style.map.painter.context,f=new c.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ce(p,f,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ce(p,new c.RGBAImage({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.identity([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new ce(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const a=s&&s+s.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const p=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=p?f=e.canonical.z-p:c.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>f<<f),T=e.canonical.y-(e.canonical.y>>f<<f),I=c.fromScaling(new Float64Array(16),[1/(c.EXTENT<<f),1/(c.EXTENT<<f),0]);c.translate(I,I,[y*c.EXTENT,T*c.EXTENT,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const e=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=e.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(e.context.createRenderbuffer(e.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(e){const s=this.style.map.painter,a=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ce(s.context,{width:a,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ce(s.context,{width:a,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(a,p,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,a,p))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,y=0;f<this._coordsTextureSize;f++)for(let T=0;T<this._coordsTextureSize;T++,y+=4)s[y+0]=255&T,s[y+1]=255&f,s[y+2]=T>>8<<4|f>>8,s[y+3]=0;const a=new c.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new ce(e,a,e.gl.RGBA,{premultiply:!1});return p.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(e){const s=new Uint8Array(4),a=this.style.map.painter,p=a.context,f=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(e.x,a.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,s),p.bindFramebuffer.set(null);const y=s[0]+(s[2]>>4<<8),T=s[1]+((15&s[2])<<8),I=this.coordsIndex[255-s[3]],P=I&&this.sourceCache.getTileByID(I);if(!P)return null;const z=this._coordsTextureSize,O=(1<<P.tileID.canonical.z)*z;return new c.MercatorCoordinate((P.tileID.canonical.x*z+y)/O,(P.tileID.canonical.y*z+T)/O,this.getElevation(P.tileID,y,T,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.style.map.painter.context,s=new c.PosArray,a=new c.TriangleIndexArray,p=this.meshSize,f=c.EXTENT/p,y=p*p;for(let T=0;T<=p;T++)for(let I=0;I<=p;I++)s.emplaceBack(I*f,T*f);for(let T=0;T<y;T+=p+1)for(let I=0;I<p;I++)a.emplaceBack(I+T,p+I+T+1,p+I+T+2),a.emplaceBack(I+T,p+I+T+2,I+T+1);return this._mesh={indexBuffer:e.createIndexBuffer(a),vertexBuffer:e.createVertexBuffer(s,Me.members),segments:c.SegmentVector.simpleSegment(0,0,s.length,a.length)},this._mesh}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return s&&s.dem&&(a.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,a.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),a}}const we=(h,e)=>c.emitValidationErrors(h,e&&e.filter(s=>s.identifier!=="source.canvas")),Be=c.pick(Ae,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),vi=c.pick(Ae,["setCenter","setZoom","setBearing","setPitch"]),Ke=function(){const h={},e=c.spec.$version;for(const s in c.spec.$root){const a=c.spec.$root[s];if(a.required){let p=null;p=s==="version"?e:a.type==="array"?[]:{},p!=null&&(h[s]=p)}}return h}();class fi extends c.Evented{constructor(e,s={}){super(),this.map=e,this.dispatcher=new On(Zr(),this),this.imageManager=new Fr,this.imageManager.setEventedParent(this),this.glyphManager=new ni(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new cs(256,512),this.crossTileSymbolIndex=new se,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const a=this;this._rtlTextPluginCallback=fi.registerForPluginStateChange(p=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(f,y)=>{if(c.triggerPluginCompletionEvent(f),y&&y.every(T=>T))for(const T in a.sourceCaches)a.sourceCaches[T].reload()})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const f=this.sourceCaches[p.sourceId];if(!f)return;const y=f.getSource();if(y&&y.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===y.id&&this._validateLayer(I)}})}loadURL(e,s={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const a=typeof s.validate!="boolean"||s.validate,p=this.map._requestManager.transformRequest(e,c.ResourceType.Style);this._request=c.getJSON(p,(f,y)=>{this._request=null,f?this.fire(new c.ErrorEvent(f)):y&&this._load(y,a)})}loadJSON(e,s={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(e,s.validate!==!1)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Ke,!1)}_load(e,s){if(s&&we(this,c.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e;for(const p in e.sources)this.addSource(p,e.sources[p],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);const a=vr(this.stylesheet.layers);this._order=a.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of a)p=c.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new rn(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}_loadSprite(e){this._spriteRequest=function(s,a,p,f){let y,T,I;const P=p>1?"@2x":"";let z=c.getJSON(a.transformRequest(a.normalizeSpriteURL(s,P,".json"),c.ResourceType.SpriteJSON),(H,j)=>{z=null,I||(I=H,y=j,Z())}),O=c.getImage(a.transformRequest(a.normalizeSpriteURL(s,P,".png"),c.ResourceType.SpriteImage),(H,j)=>{O=null,I||(I=H,T=j,Z())});function Z(){if(I)f(I);else if(y&&T){const H=c.exported.getImageData(T),j={};for(const W in y){const{width:rt,height:ht,x:pt,y:X,sdf:_t,pixelRatio:ft,stretchX:Tt,stretchY:St,content:Mt}=y[W],bt=new c.RGBAImage({width:rt,height:ht});c.RGBAImage.copy(H,bt,{x:pt,y:X},{x:0,y:0},{width:rt,height:ht}),j[W]={data:bt,pixelRatio:ft,sdf:_t,stretchX:Tt,stretchY:St,content:Mt}}f(null,j)}}return{cancel(){z&&(z.cancel(),z=null),O&&(O.cancel(),O=null)}}}(e,this.map._requestManager,this.map.getPixelRatio(),(s,a)=>{if(this._spriteRequest=null,s)this.fire(new c.ErrorEvent(s));else if(a)for(const p in a)this.imageManager.addImage(p,a[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const a=e.sourceLayer;if(!a)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${p.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(e){const s=[];for(const a of e){const p=this._layers[a];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(p.length||f.length)&&this._updateWorkerLayers(p,f);for(const y in this._updatedSources){const T=this._updatedSources[y];if(T==="reload")this._reloadSource(y);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(y)}}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const a={};for(const p in this.sourceCaches){const f=this.sourceCaches[p];a[p]=f.used,f.used=!1}for(const p of this._order){const f=this._layers[p];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const p in a){const f=this.sourceCaches[p];a[p]!==f.used&&f.fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.z=e.zoom,s&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(e){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),e){const s=this.sourceCaches[e.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);this.terrain=new _e(this,s,e),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=a=>{a.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=a=>{a.tile&&(a.sourceId===e.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(a.sourceId,a.tile.tileID)):a.source.type==="geojson"&&this.terrain.rememberForRerender(a.sourceId,a.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new c.Event("terrain",{terrain:e}))}setState(e){if(this._checkLoaded(),we(this,c.validateStyle(e)))return!1;(e=c.clone$1(e)).layers=vr(e.layers);const s=function(p,f){if(!p)return[{command:Ae.setStyle,args:[f]}];let y=[];try{if(!Gt(p.version,f.version))return[{command:Ae.setStyle,args:[f]}];Gt(p.center,f.center)||y.push({command:Ae.setCenter,args:[f.center]}),Gt(p.zoom,f.zoom)||y.push({command:Ae.setZoom,args:[f.zoom]}),Gt(p.bearing,f.bearing)||y.push({command:Ae.setBearing,args:[f.bearing]}),Gt(p.pitch,f.pitch)||y.push({command:Ae.setPitch,args:[f.pitch]}),Gt(p.sprite,f.sprite)||y.push({command:Ae.setSprite,args:[f.sprite]}),Gt(p.glyphs,f.glyphs)||y.push({command:Ae.setGlyphs,args:[f.glyphs]}),Gt(p.transition,f.transition)||y.push({command:Ae.setTransition,args:[f.transition]}),Gt(p.light,f.light)||y.push({command:Ae.setLight,args:[f.light]});const T={},I=[];(function(z,O,Z,H){let j;for(j in O=O||{},z=z||{})Object.prototype.hasOwnProperty.call(z,j)&&(Object.prototype.hasOwnProperty.call(O,j)||Fn(j,Z,H));for(j in O)Object.prototype.hasOwnProperty.call(O,j)&&(Object.prototype.hasOwnProperty.call(z,j)?Gt(z[j],O[j])||(z[j].type==="geojson"&&O[j].type==="geojson"&&ps(z,O,j)?Z.push({command:Ae.setGeoJSONSourceData,args:[j,O[j].data]}):tr(j,O,Z,H)):En(j,O,Z))})(p.sources,f.sources,I,T);const P=[];p.layers&&p.layers.forEach(z=>{T[z.source]?y.push({command:Ae.removeLayer,args:[z.id]}):P.push(z)}),y=y.concat(I),function(z,O,Z){O=O||[];const H=(z=z||[]).map(ir),j=O.map(ir),W=z.reduce(xr,{}),rt=O.reduce(xr,{}),ht=H.slice(),pt=Object.create(null);let X,_t,ft,Tt,St,Mt,bt;for(X=0,_t=0;X<H.length;X++)ft=H[X],Object.prototype.hasOwnProperty.call(rt,ft)?_t++:(Z.push({command:Ae.removeLayer,args:[ft]}),ht.splice(ht.indexOf(ft,_t),1));for(X=0,_t=0;X<j.length;X++)ft=j[j.length-1-X],ht[ht.length-1-X]!==ft&&(Object.prototype.hasOwnProperty.call(W,ft)?(Z.push({command:Ae.removeLayer,args:[ft]}),ht.splice(ht.lastIndexOf(ft,ht.length-_t),1)):_t++,Mt=ht[ht.length-X],Z.push({command:Ae.addLayer,args:[rt[ft],Mt]}),ht.splice(ht.length-X,0,ft),pt[ft]=!0);for(X=0;X<j.length;X++)if(ft=j[X],Tt=W[ft],St=rt[ft],!pt[ft]&&!Gt(Tt,St))if(Gt(Tt.source,St.source)&&Gt(Tt["source-layer"],St["source-layer"])&&Gt(Tt.type,St.type)){for(bt in er(Tt.layout,St.layout,Z,ft,null,Ae.setLayoutProperty),er(Tt.paint,St.paint,Z,ft,null,Ae.setPaintProperty),Gt(Tt.filter,St.filter)||Z.push({command:Ae.setFilter,args:[ft,St.filter]}),Gt(Tt.minzoom,St.minzoom)&&Gt(Tt.maxzoom,St.maxzoom)||Z.push({command:Ae.setLayerZoomRange,args:[ft,St.minzoom,St.maxzoom]}),Tt)Object.prototype.hasOwnProperty.call(Tt,bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&(bt.indexOf("paint.")===0?er(Tt[bt],St[bt],Z,ft,bt.slice(6),Ae.setPaintProperty):Gt(Tt[bt],St[bt])||Z.push({command:Ae.setLayerProperty,args:[ft,bt,St[bt]]}));for(bt in St)Object.prototype.hasOwnProperty.call(St,bt)&&!Object.prototype.hasOwnProperty.call(Tt,bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&(bt.indexOf("paint.")===0?er(Tt[bt],St[bt],Z,ft,bt.slice(6),Ae.setPaintProperty):Gt(Tt[bt],St[bt])||Z.push({command:Ae.setLayerProperty,args:[ft,bt,St[bt]]}))}else Z.push({command:Ae.removeLayer,args:[ft]}),Mt=ht[ht.lastIndexOf(ft)+1],Z.push({command:Ae.addLayer,args:[St,Mt]})}(P,f.layers,y)}catch(T){console.warn("Unable to compute style diff:",T),y=[{command:Ae.setStyle,args:[f]}]}return y}(this.serialize(),e).filter(p=>!(p.command in vi));if(s.length===0)return!1;const a=s.filter(p=>!(p.command in Be));if(a.length>0)throw new Error(`Unimplemented: ${a.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=e,!0}addImage(e,s){if(this.getImage(e))return this.fire(new c.ErrorEvent(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.ErrorEvent(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(c.validateStyle.source,`sources.${e}`,s,null,a))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[e]=new Zi(e,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:p.serialize(),sourceId:e})),p.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,a={}){this._checkLoaded();const p=e.id;if(this.getLayer(p))return void this.fire(new c.ErrorEvent(new Error(`Layer "${p}" already exists on this map.`)));let f;if(e.type==="custom"){if(we(this,c.validateCustomStyleLayer(e)))return;f=c.createStyleLayer(e)}else{if(typeof e.source=="object"&&(this.addSource(p,e.source),e=c.clone$1(e),e=c.extend(e,{source:p})),this._validate(c.validateStyle.layer,`layers.${p}`,e,{arrayIndex:-1},a))return;f=c.createStyleLayer(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[f.id]=f.serialize()}const y=s?this._order.indexOf(s):this._order.length;if(s&&y===-1)this.fire(new c.ErrorEvent(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(y,0,p),this._layerOrderChanged=!0,this._layers[p]=f,this._removedLayers[p]&&f.source&&f.type!=="custom"){const T=this._removedLayers[p];delete this._removedLayers[p],T.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const a=this._order.indexOf(e);this._order.splice(a,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new c.ErrorEvent(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(p,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new c.ErrorEvent(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,a){this._checkLoaded();const p=this.getLayer(e);p?p.minzoom===s&&p.maxzoom===a||(s!=null&&(p.minzoom=s),a!=null&&(p.maxzoom=a),this._updateLayer(p)):this.fire(new c.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,a={}){this._checkLoaded();const p=this.getLayer(e);if(p){if(!Gt(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(c.validateStyle.filter,`layers.${p.id}.filter`,s,null,a)||(p.filter=c.clone$1(s),this._updateLayer(p)))}else this.fire(new c.ErrorEvent(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.clone$1(this.getLayer(e).filter)}setLayoutProperty(e,s,a,p={}){this._checkLoaded();const f=this.getLayer(e);f?Gt(f.getLayoutProperty(s),a)||(f.setLayoutProperty(s,a,p),this._updateLayer(f)):this.fire(new c.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const a=this.getLayer(e);if(a)return a.getLayoutProperty(s);this.fire(new c.ErrorEvent(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,a,p={}){this._checkLoaded();const f=this.getLayer(e);f?Gt(f.getPaintProperty(s),a)||(f.setPaintProperty(s,a,p)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new c.ErrorEvent(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const a=e.source,p=e.sourceLayer,f=this.sourceCaches[a];if(f===void 0)return void this.fire(new c.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const y=f.getSource().type;y==="geojson"&&p?this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||p?(e.id===void 0&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),f.setFeatureState(p,e.id,s)):this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const a=e.source,p=this.sourceCaches[a];if(p===void 0)return void this.fire(new c.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const f=p.getSource().type,y=f==="vector"?e.sourceLayer:void 0;f!=="vector"||y?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(y,e.id,s):this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,a=e.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),p.getFeatureState(a,e.id)):void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:c.mapObject(this.sourceCaches,e=>e.serialize()),layers:this._serializeLayers(this._order)},e=>e!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=y=>this._layers[y].type==="fill-extrusion",a={},p=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T)){a[T]=y;for(const I of e){const P=I[T];if(P)for(const z of P)p.push(z)}}}p.sort((y,T)=>T.intersectionZ-y.intersectionZ);const f=[];for(let y=this._order.length-1;y>=0;y--){const T=this._order[y];if(s(T))for(let I=p.length-1;I>=0;I--){const P=p[I].feature;if(a[P.layer.id]<y)break;f.push(P),p.pop()}else for(const I of e){const P=I[T];if(P)for(const z of P)f.push(z.feature)}}return f}queryRenderedFeatures(e,s,a){s&&s.filter&&this._validate(c.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const y of s.layers){const T=this._layers[y];if(!T)return this.fire(new c.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];p[T.source]=!0}}const f=[];s.availableImages=this._availableImages;for(const y in this.sourceCaches)s.layers&&!p[y]||f.push(ri(this.sourceCaches[y],this._layers,this._serializedLayers,e,s,a));return this.placement&&f.push(function(y,T,I,P,z,O,Z){const H={},j=O.queryRenderedSymbols(P),W=[];for(const rt of Object.keys(j).map(Number))W.push(Z[rt]);W.sort(Pe);for(const rt of W){const ht=rt.featureIndex.lookupSymbolFeatures(j[rt.bucketInstanceId],T,rt.bucketIndex,rt.sourceLayerIndex,z.filter,z.layers,z.availableImages,y);for(const pt in ht){const X=H[pt]=H[pt]||[],_t=ht[pt];_t.sort((ft,Tt)=>{const St=rt.featureSortOrder;if(St){const Mt=St.indexOf(ft.featureIndex);return St.indexOf(Tt.featureIndex)-Mt}return Tt.featureIndex-ft.featureIndex});for(const ft of _t)X.push(ft)}}for(const rt in H)H[rt].forEach(ht=>{const pt=ht.feature,X=I[y[rt].source].getFeatureState(pt.layer["source-layer"],pt.id);pt.source=pt.layer.source,pt.layer["source-layer"]&&(pt.sourceLayer=pt.layer["source-layer"]),pt.state=X});return H}(this._layers,this._serializedLayers,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,s){s&&s.filter&&this._validate(c.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const a=this.sourceCaches[e];return a?function(p,f){const y=p.getRenderableIds().map(P=>p.getTileByID(P)),T=[],I={};for(let P=0;P<y.length;P++){const z=y[P],O=z.tileID.canonical.key;I[O]||(I[O]=!0,z.querySourceFeatures(T,f))}return T}(a,s):[]}addSourceType(e,s,a){return fi.getSourceType(e)?a(new Error(`A source type called "${e}" already exists.`)):(fi.setSourceType(e,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:s.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const a=this.light.getLight();let p=!1;for(const y in e)if(!Gt(e[y],a[y])){p=!0;break}if(!p)return;const f={now:c.exported.now(),transition:c.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(f)}_validate(e,s,a,p,f={}){return(!f||f.validate!==!1)&&we(this,e.call(c.validateStyle,c.extend({key:s,style:this.serialize(),value:a,styleSpec:c.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const s=this.sourceCaches[e];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,a,p,f=!1){let y=!1,T=!1;const I={};for(const P of this._order){const z=this._layers[P];if(z.type!=="symbol")continue;if(!I[z.source]){const Z=this.sourceCaches[z.source];I[z.source]=Z.getRenderableIds(!0).map(H=>Z.getTileByID(H)).sort((H,j)=>j.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(j.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(z,I[z.source],e.center.lng);y=y||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),e.zoom))&&(this.pauseablePlacement=new vt(e,this.terrain,this._order,f,s,a,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),T=!0),y&&this.pauseablePlacement.placement.setStale()),T||y)for(const P of this._order){const z=this._layers[P];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s,a){this.imageManager.getImages(s.icons,a),this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(e,s,a){this.glyphManager.getGlyphs(s.stacks,a)}getResource(e,s,a){return c.makeRequest(s,a)}}fi.getSourceType=function(h){return gi[h]},fi.setSourceType=function(h,e){gi[h]=e},fi.registerForPluginStateChange=c.registerForPluginStateChange;var Ie="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const je={prelude:Oe(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Oe(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Oe(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Oe(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Oe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Oe(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Oe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Oe("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Oe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Oe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Oe(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Oe(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Oe(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Oe(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Oe(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Oe(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Oe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Oe(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Oe(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Oe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Oe(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Oe(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Oe(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Oe(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Oe(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Oe(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Oe("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ie),terrainDepth:Oe("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ie),terrainCoords:Oe("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ie)};function Oe(h,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),p=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=f?f.concat(p):p,T={};return{fragmentSource:h=h.replace(s,(I,P,z,O,Z)=>(T[Z]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${z} ${O} ${Z};
#else
uniform ${z} ${O} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${z} ${O} ${Z} = u_${Z};
#endif
`)),vertexSource:e=e.replace(s,(I,P,z,O,Z)=>{const H=O==="float"?"vec2":"vec4",j=Z.match(/color/)?"color":H;return T[Z]?P==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${z} ${H} a_${Z};
varying ${z} ${O} ${Z};
#else
uniform ${z} ${O} u_${Z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${j}(a_${Z}, u_${Z}_t);
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${z} ${H} a_${Z};
#else
uniform ${z} ${O} u_${Z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${z} ${O} ${Z} = a_${Z};
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${z} ${O} ${Z} = unpack_mix_${j}(a_${Z}, u_${Z}_t);
#else
    ${z} ${O} ${Z} = u_${Z};
#endif
`}),staticAttributes:a,staticUniforms:y}}class Sr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,a,p,f,y,T,I,P){this.context=e;let z=this.boundPaintVertexBuffers.length!==p.length;for(let O=0;!z&&O<p.length;O++)this.boundPaintVertexBuffers[O]!==p[O]&&(z=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===a&&!z&&this.boundIndexBuffer===f&&this.boundVertexOffset===y&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===P?(e.bindVertexArrayOES.set(this.vao),T&&T.bind(),f&&f.dynamicDraw&&f.bind(),I&&I.bind(),P&&P.bind()):this.freshBind(s,a,p,f,y,T,I,P)}freshBind(e,s,a,p,f,y,T,I){let P;const z=e.numAttributes,O=this.context,Z=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=p,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=I;else{P=O.currentNumAttributes||0;for(let H=z;H<P;H++)Z.disableVertexAttribArray(H)}s.enableAttributes(Z,e);for(const H of a)H.enableAttributes(Z,e);y&&y.enableAttributes(Z,e),T&&T.enableAttributes(Z,e),I&&I.enableAttributes(Z,e),s.bind(),s.setVertexAttribPointers(Z,e,f);for(const H of a)H.bind(),H.setVertexAttribPointers(Z,e,f);y&&(y.bind(),y.setVertexAttribPointers(Z,e,f)),p&&p.bind(),T&&(T.bind(),T.setVertexAttribPointers(Z,e,f)),I&&(I.bind(),I.setVertexAttribPointers(Z,e,f)),O.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ir(h){const e=[];for(let s=0;s<h.length;s++){if(h[s]===null)continue;const a=h[s].split(" ");e.push(a.pop())}return e}class so{constructor(e,s,a,p,f,y,T){const I=e.gl;this.program=I.createProgram();const P=Ir(a.staticAttributes),z=p?p.getBinderAttributes():[],O=P.concat(z),Z=je.prelude.staticUniforms?Ir(je.prelude.staticUniforms):[],H=a.staticUniforms?Ir(a.staticUniforms):[],j=p?p.getBinderUniforms():[],W=Z.concat(H).concat(j),rt=[];for(const St of W)rt.indexOf(St)<0&&rt.push(St);const ht=p?p.defines():[];y&&ht.push("#define OVERDRAW_INSPECTOR;"),T&&ht.push("#define TERRAIN3D;");const pt=ht.concat(je.prelude.fragmentSource,a.fragmentSource).join(`
`),X=ht.concat(je.prelude.vertexSource,a.vertexSource).join(`
`),_t=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(_t,pt),I.compileShader(_t),I.attachShader(this.program,_t);const ft=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ft,X),I.compileShader(ft),I.attachShader(this.program,ft),this.attributes={};const Tt={};this.numAttributes=O.length;for(let St=0;St<this.numAttributes;St++)O[St]&&(I.bindAttribLocation(this.program,St,O[St]),this.attributes[O[St]]=St);I.linkProgram(this.program),I.deleteShader(ft),I.deleteShader(_t);for(let St=0;St<rt.length;St++){const Mt=rt[St];if(Mt&&!Tt[Mt]){const bt=I.getUniformLocation(this.program,Mt);bt&&(Tt[Mt]=bt)}}this.fixedUniforms=f(e,Tt),this.terrainUniforms=((St,Mt)=>({u_depth:new c.Uniform1i(St,Mt.u_depth),u_terrain:new c.Uniform1i(St,Mt.u_terrain),u_terrain_dim:new c.Uniform1f(St,Mt.u_terrain_dim),u_terrain_matrix:new c.UniformMatrix4f(St,Mt.u_terrain_matrix),u_terrain_unpack:new c.Uniform4f(St,Mt.u_terrain_unpack),u_terrain_offset:new c.Uniform1f(St,Mt.u_terrain_offset),u_terrain_exaggeration:new c.Uniform1f(St,Mt.u_terrain_exaggeration)}))(e,Tt),this.binderUniforms=p?p.getUniforms(e,Tt):[]}draw(e,s,a,p,f,y,T,I,P,z,O,Z,H,j,W,rt,ht,pt){const X=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(p),e.setColorMode(f),e.setCullFace(y),I){e.activeTexture.set(X.TEXTURE2),X.bindTexture(X.TEXTURE_2D,I.depthTexture),e.activeTexture.set(X.TEXTURE3),X.bindTexture(X.TEXTURE_2D,I.texture);for(const ft in this.terrainUniforms)this.terrainUniforms[ft].set(I[ft])}for(const ft in this.fixedUniforms)this.fixedUniforms[ft].set(T[ft]);W&&W.setUniforms(e,this.binderUniforms,H,{zoom:j});let _t=0;switch(s){case X.LINES:_t=2;break;case X.TRIANGLES:_t=3;break;case X.LINE_STRIP:_t=1}for(const ft of Z.get()){const Tt=ft.vaos||(ft.vaos={});(Tt[P]||(Tt[P]=new Sr)).bind(e,this,z,W?W.getPaintVertexBuffers():[],O,ft.vertexOffset,rt,ht,pt),X.drawElements(s,ft.primitiveLength*_t,X.UNSIGNED_SHORT,ft.primitiveOffset*_t*2)}}}function ge(h,e,s){const a=1/di(s,1,e.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,e.transform.tileZoom)/p,y=f*(s.tileID.canonical.x+s.tileID.wrap*p),T=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[a,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[y>>16,T>>16],u_pixel_coord_lower:[65535&y,65535&T]}}const si=(h,e,s,a)=>{const p=e.style.light,f=p.properties.get("position"),y=[f.x,f.y,f.z],T=c.create$1();p.properties.get("anchor")==="viewport"&&c.fromRotation(T,-e.transform.angle),c.transformMat3(y,y,T);const I=p.properties.get("color");return{u_matrix:h,u_lightpos:y,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+s,u_opacity:a}},ko=(h,e,s,a,p,f,y)=>c.extend(si(h,e,s,a),ge(f,e,y),{u_height_factor:-Math.pow(2,p.overscaledZ)/y.tileSize/8}),qr=h=>({u_matrix:h}),Hi=(h,e,s,a)=>c.extend(qr(h),ge(s,e,a)),sa=(h,e)=>({u_matrix:h,u_world:e}),Ps=(h,e,s,a,p)=>c.extend(Hi(h,e,s,a),{u_world:p}),Er=(h,e,s,a)=>{const p=h.transform;let f,y;if(a.paint.get("circle-pitch-alignment")==="map"){const T=di(s,1,p.zoom);f=!0,y=[T,T]}else f=!1,y=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(e.posMatrix,s,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:y}},Je=(h,e,s)=>{const a=di(s,1,e.zoom),p=Math.pow(2,e.zoom-s.tileID.overscaledZ),f=s.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:a,u_extrude_scale:[e.pixelsToGLUnits[0]/(a*p),e.pixelsToGLUnits[1]/(a*p)],u_overscale_factor:f}},Pn=(h,e,s=1)=>({u_matrix:h,u_color:e,u_overlay:0,u_overlay_scale:s}),Zn=h=>({u_matrix:h}),Pr=(h,e,s,a)=>({u_matrix:h,u_extrude_scale:di(e,1,s),u_intensity:a});function ms(h,e){const s=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.MercatorCoordinate(0,a/s).toLngLat().lat,new c.MercatorCoordinate(0,(a+1)/s).toLngLat().lat]}const Vn=(h,e,s,a)=>{const p=h.transform;return{u_matrix:$r(h,e,s,a),u_ratio:1/di(e,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},As=(h,e,s,a,p)=>c.extend(Vn(h,e,s,p),{u_image:0,u_image_height:a}),_s=(h,e,s,a,p)=>{const f=h.transform,y=We(e,f);return{u_matrix:$r(h,e,s,p),u_texsize:e.imageAtlasTexture.size,u_ratio:1/di(e,1,f.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Ar=(h,e,s,a,p,f)=>{const y=h.lineAtlas,T=We(e,h.transform),I=s.layout.get("line-cap")==="round",P=y.getDash(a.from,I),z=y.getDash(a.to,I),O=P.width*p.fromScale,Z=z.width*p.toScale;return c.extend(Vn(h,e,s,f),{u_patternscale_a:[T/O,-P.height/2],u_patternscale_b:[T/Z,-z.height/2],u_sdfgamma:y.width/(256*Math.min(O,Z)*h.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:z.y,u_mix:p.t})};function We(h,e){return 1/di(h,1,e.tileZoom)}function $r(h,e,s,a){return h.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Cs=(h,e,s,a,p)=>{return{u_matrix:h,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(y=p.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(f=p.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:Do(p.paint.get("raster-hue-rotate"))};var f,y};function Do(h){h*=Math.PI/180;const e=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Ms=(h,e,s,a,p,f,y,T,I,P)=>{const z=p.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:z.width/z.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:y,u_coord_matrix:T,u_is_text:+I,u_pitch_with_map:+a,u_texsize:P,u_texture:0}},oo=(h,e,s,a,p,f,y,T,I,P,z)=>{const O=p.transform;return c.extend(Ms(h,e,s,a,p,f,y,T,I,P),{u_gamma_scale:a?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+z})},fe=(h,e,s,a,p,f,y,T,I,P)=>c.extend(oo(h,e,s,a,p,f,y,T,!0,I,!0),{u_texsize_icon:P,u_texture_icon:1}),Gn=(h,e,s)=>({u_matrix:h,u_opacity:e,u_color:s}),Ye=(h,e,s,a,p,f)=>c.extend(function(y,T,I,P){const z=I.imageManager.getPattern(y.from.toString()),O=I.imageManager.getPattern(y.to.toString()),{width:Z,height:H}=I.imageManager.getPixelSize(),j=Math.pow(2,P.tileID.overscaledZ),W=P.tileSize*Math.pow(2,I.transform.tileZoom)/j,rt=W*(P.tileID.canonical.x+P.tileID.wrap*j),ht=W*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[Z,H],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/di(P,1,I.transform.tileZoom),u_pixel_coord_upper:[rt>>16,ht>>16],u_pixel_coord_lower:[65535&rt,65535&ht]}}(a,f,s,p),{u_matrix:h,u_opacity:e}),ao={fillExtrusion:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_lightpos:new c.Uniform3f(h,e.u_lightpos),u_lightintensity:new c.Uniform1f(h,e.u_lightintensity),u_lightcolor:new c.Uniform3f(h,e.u_lightcolor),u_vertical_gradient:new c.Uniform1f(h,e.u_vertical_gradient),u_opacity:new c.Uniform1f(h,e.u_opacity)}),fillExtrusionPattern:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_lightpos:new c.Uniform3f(h,e.u_lightpos),u_lightintensity:new c.Uniform1f(h,e.u_lightintensity),u_lightcolor:new c.Uniform3f(h,e.u_lightcolor),u_vertical_gradient:new c.Uniform1f(h,e.u_vertical_gradient),u_height_factor:new c.Uniform1f(h,e.u_height_factor),u_image:new c.Uniform1i(h,e.u_image),u_texsize:new c.Uniform2f(h,e.u_texsize),u_pixel_coord_upper:new c.Uniform2f(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(h,e.u_pixel_coord_lower),u_scale:new c.Uniform3f(h,e.u_scale),u_fade:new c.Uniform1f(h,e.u_fade),u_opacity:new c.Uniform1f(h,e.u_opacity)}),fill:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix)}),fillPattern:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_image:new c.Uniform1i(h,e.u_image),u_texsize:new c.Uniform2f(h,e.u_texsize),u_pixel_coord_upper:new c.Uniform2f(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(h,e.u_pixel_coord_lower),u_scale:new c.Uniform3f(h,e.u_scale),u_fade:new c.Uniform1f(h,e.u_fade)}),fillOutline:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_world:new c.Uniform2f(h,e.u_world)}),fillOutlinePattern:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_world:new c.Uniform2f(h,e.u_world),u_image:new c.Uniform1i(h,e.u_image),u_texsize:new c.Uniform2f(h,e.u_texsize),u_pixel_coord_upper:new c.Uniform2f(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(h,e.u_pixel_coord_lower),u_scale:new c.Uniform3f(h,e.u_scale),u_fade:new c.Uniform1f(h,e.u_fade)}),circle:(h,e)=>({u_camera_to_center_distance:new c.Uniform1f(h,e.u_camera_to_center_distance),u_scale_with_map:new c.Uniform1i(h,e.u_scale_with_map),u_pitch_with_map:new c.Uniform1i(h,e.u_pitch_with_map),u_extrude_scale:new c.Uniform2f(h,e.u_extrude_scale),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_matrix:new c.UniformMatrix4f(h,e.u_matrix)}),collisionBox:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_camera_to_center_distance:new c.Uniform1f(h,e.u_camera_to_center_distance),u_pixels_to_tile_units:new c.Uniform1f(h,e.u_pixels_to_tile_units),u_extrude_scale:new c.Uniform2f(h,e.u_extrude_scale),u_overscale_factor:new c.Uniform1f(h,e.u_overscale_factor)}),collisionCircle:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_inv_matrix:new c.UniformMatrix4f(h,e.u_inv_matrix),u_camera_to_center_distance:new c.Uniform1f(h,e.u_camera_to_center_distance),u_viewport_size:new c.Uniform2f(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new c.UniformColor(h,e.u_color),u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_overlay:new c.Uniform1i(h,e.u_overlay),u_overlay_scale:new c.Uniform1f(h,e.u_overlay_scale)}),clippingMask:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix)}),heatmap:(h,e)=>({u_extrude_scale:new c.Uniform1f(h,e.u_extrude_scale),u_intensity:new c.Uniform1f(h,e.u_intensity),u_matrix:new c.UniformMatrix4f(h,e.u_matrix)}),heatmapTexture:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_world:new c.Uniform2f(h,e.u_world),u_image:new c.Uniform1i(h,e.u_image),u_color_ramp:new c.Uniform1i(h,e.u_color_ramp),u_opacity:new c.Uniform1f(h,e.u_opacity)}),hillshade:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_image:new c.Uniform1i(h,e.u_image),u_latrange:new c.Uniform2f(h,e.u_latrange),u_light:new c.Uniform2f(h,e.u_light),u_shadow:new c.UniformColor(h,e.u_shadow),u_highlight:new c.UniformColor(h,e.u_highlight),u_accent:new c.UniformColor(h,e.u_accent)}),hillshadePrepare:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_image:new c.Uniform1i(h,e.u_image),u_dimension:new c.Uniform2f(h,e.u_dimension),u_zoom:new c.Uniform1f(h,e.u_zoom),u_unpack:new c.Uniform4f(h,e.u_unpack)}),line:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_ratio:new c.Uniform1f(h,e.u_ratio),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_ratio:new c.Uniform1f(h,e.u_ratio),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(h,e.u_units_to_pixels),u_image:new c.Uniform1i(h,e.u_image),u_image_height:new c.Uniform1f(h,e.u_image_height)}),linePattern:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_texsize:new c.Uniform2f(h,e.u_texsize),u_ratio:new c.Uniform1f(h,e.u_ratio),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_image:new c.Uniform1i(h,e.u_image),u_units_to_pixels:new c.Uniform2f(h,e.u_units_to_pixels),u_scale:new c.Uniform3f(h,e.u_scale),u_fade:new c.Uniform1f(h,e.u_fade)}),lineSDF:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_ratio:new c.Uniform1f(h,e.u_ratio),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_units_to_pixels:new c.Uniform2f(h,e.u_units_to_pixels),u_patternscale_a:new c.Uniform2f(h,e.u_patternscale_a),u_patternscale_b:new c.Uniform2f(h,e.u_patternscale_b),u_sdfgamma:new c.Uniform1f(h,e.u_sdfgamma),u_image:new c.Uniform1i(h,e.u_image),u_tex_y_a:new c.Uniform1f(h,e.u_tex_y_a),u_tex_y_b:new c.Uniform1f(h,e.u_tex_y_b),u_mix:new c.Uniform1f(h,e.u_mix)}),raster:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_tl_parent:new c.Uniform2f(h,e.u_tl_parent),u_scale_parent:new c.Uniform1f(h,e.u_scale_parent),u_buffer_scale:new c.Uniform1f(h,e.u_buffer_scale),u_fade_t:new c.Uniform1f(h,e.u_fade_t),u_opacity:new c.Uniform1f(h,e.u_opacity),u_image0:new c.Uniform1i(h,e.u_image0),u_image1:new c.Uniform1i(h,e.u_image1),u_brightness_low:new c.Uniform1f(h,e.u_brightness_low),u_brightness_high:new c.Uniform1f(h,e.u_brightness_high),u_saturation_factor:new c.Uniform1f(h,e.u_saturation_factor),u_contrast_factor:new c.Uniform1f(h,e.u_contrast_factor),u_spin_weights:new c.Uniform3f(h,e.u_spin_weights)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new c.Uniform1i(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(h,e.u_is_size_feature_constant),u_size_t:new c.Uniform1f(h,e.u_size_t),u_size:new c.Uniform1f(h,e.u_size),u_camera_to_center_distance:new c.Uniform1f(h,e.u_camera_to_center_distance),u_pitch:new c.Uniform1f(h,e.u_pitch),u_rotate_symbol:new c.Uniform1i(h,e.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(h,e.u_aspect_ratio),u_fade_change:new c.Uniform1f(h,e.u_fade_change),u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(h,e.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(h,e.u_coord_matrix),u_is_text:new c.Uniform1i(h,e.u_is_text),u_pitch_with_map:new c.Uniform1i(h,e.u_pitch_with_map),u_texsize:new c.Uniform2f(h,e.u_texsize),u_texture:new c.Uniform1i(h,e.u_texture)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new c.Uniform1i(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(h,e.u_is_size_feature_constant),u_size_t:new c.Uniform1f(h,e.u_size_t),u_size:new c.Uniform1f(h,e.u_size),u_camera_to_center_distance:new c.Uniform1f(h,e.u_camera_to_center_distance),u_pitch:new c.Uniform1f(h,e.u_pitch),u_rotate_symbol:new c.Uniform1i(h,e.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(h,e.u_aspect_ratio),u_fade_change:new c.Uniform1f(h,e.u_fade_change),u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(h,e.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(h,e.u_coord_matrix),u_is_text:new c.Uniform1i(h,e.u_is_text),u_pitch_with_map:new c.Uniform1i(h,e.u_pitch_with_map),u_texsize:new c.Uniform2f(h,e.u_texsize),u_texture:new c.Uniform1i(h,e.u_texture),u_gamma_scale:new c.Uniform1f(h,e.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_is_halo:new c.Uniform1i(h,e.u_is_halo)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new c.Uniform1i(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.Uniform1i(h,e.u_is_size_feature_constant),u_size_t:new c.Uniform1f(h,e.u_size_t),u_size:new c.Uniform1f(h,e.u_size),u_camera_to_center_distance:new c.Uniform1f(h,e.u_camera_to_center_distance),u_pitch:new c.Uniform1f(h,e.u_pitch),u_rotate_symbol:new c.Uniform1i(h,e.u_rotate_symbol),u_aspect_ratio:new c.Uniform1f(h,e.u_aspect_ratio),u_fade_change:new c.Uniform1f(h,e.u_fade_change),u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_label_plane_matrix:new c.UniformMatrix4f(h,e.u_label_plane_matrix),u_coord_matrix:new c.UniformMatrix4f(h,e.u_coord_matrix),u_is_text:new c.Uniform1i(h,e.u_is_text),u_pitch_with_map:new c.Uniform1i(h,e.u_pitch_with_map),u_texsize:new c.Uniform2f(h,e.u_texsize),u_texsize_icon:new c.Uniform2f(h,e.u_texsize_icon),u_texture:new c.Uniform1i(h,e.u_texture),u_texture_icon:new c.Uniform1i(h,e.u_texture_icon),u_gamma_scale:new c.Uniform1f(h,e.u_gamma_scale),u_device_pixel_ratio:new c.Uniform1f(h,e.u_device_pixel_ratio),u_is_halo:new c.Uniform1i(h,e.u_is_halo)}),background:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_opacity:new c.Uniform1f(h,e.u_opacity),u_color:new c.UniformColor(h,e.u_color)}),backgroundPattern:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_opacity:new c.Uniform1f(h,e.u_opacity),u_image:new c.Uniform1i(h,e.u_image),u_pattern_tl_a:new c.Uniform2f(h,e.u_pattern_tl_a),u_pattern_br_a:new c.Uniform2f(h,e.u_pattern_br_a),u_pattern_tl_b:new c.Uniform2f(h,e.u_pattern_tl_b),u_pattern_br_b:new c.Uniform2f(h,e.u_pattern_br_b),u_texsize:new c.Uniform2f(h,e.u_texsize),u_mix:new c.Uniform1f(h,e.u_mix),u_pattern_size_a:new c.Uniform2f(h,e.u_pattern_size_a),u_pattern_size_b:new c.Uniform2f(h,e.u_pattern_size_b),u_scale_a:new c.Uniform1f(h,e.u_scale_a),u_scale_b:new c.Uniform1f(h,e.u_scale_b),u_pixel_coord_upper:new c.Uniform2f(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.Uniform2f(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.Uniform1f(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_texture:new c.Uniform1i(h,e.u_texture)}),terrainDepth:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix)}),terrainCoords:(h,e)=>({u_matrix:new c.UniformMatrix4f(h,e.u_matrix),u_texture:new c.Uniform1i(h,e.u_texture),u_terrain_coords_id:new c.Uniform1f(h,e.u_terrain_coords_id)})};class zs{constructor(e,s,a){this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ks{constructor(e,s,a,p){this.length=s.length,this.attributes=a,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let a=0;a<this.attributes.length;a++){const p=s.attributes[this.attributes[a].name];p!==void 0&&e.enableVertexAttribArray(p)}}setVertexAttribPointers(e,s,a){for(let p=0;p<this.attributes.length;p++){const f=this.attributes[p],y=s.attributes[f.name];y!==void 0&&e.vertexAttribPointer(y,f.components,e[Ls[f.type]],!1,this.itemSize,f.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xe{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lo extends xe{getDefault(){return c.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ds extends xe{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class hi extends xe{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class An extends xe{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Bo extends xe{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Xi extends xe{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ro extends xe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Bs extends xe{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class gs extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Oo extends xe{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ho extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ee extends xe{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Fo extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ln extends xe{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Cr extends xe{getDefault(){return c.Color.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Uo extends xe{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class oa extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Mr extends xe{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ca extends xe{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class aa extends xe{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ma extends xe{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class za extends xe{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class No extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class La extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class vn extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class co extends xe{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class uo extends xe{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class qn extends xe{constructor(e){super(e),this.vao=e.extVertexArrayObject}getDefault(){return null}set(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}class jr extends xe{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Zo extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class la extends xe{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class po extends xe{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class sr extends po{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ha extends po{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Wr{constructor(e,s,a,p){this.context=e,this.width=s,this.height=a;const f=e.gl,y=this.framebuffer=f.createFramebuffer();if(this.colorAttachment=new sr(e,y),p&&(this.depthAttachment=new ha(e,y)),f.checkFramebufferStatus(f.FRAMEBUFFER)!==f.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class He{constructor(e,s,a){this.blendFunction=e,this.blendColor=s,this.mask=a}}He.Replace=[1,0],He.disabled=new He(He.Replace,c.Color.transparent,[!1,!1,!1,!1]),He.unblended=new He(He.Replace,c.Color.transparent,[!0,!0,!0,!0]),He.alphaBlended=new He([1,771],c.Color.transparent,[!0,!0,!0,!0]);class Rs{constructor(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new lo(this),this.clearDepth=new Ds(this),this.clearStencil=new hi(this),this.colorMask=new An(this),this.depthMask=new Bo(this),this.stencilMask=new Xi(this),this.stencilFunc=new Ro(this),this.stencilOp=new Bs(this),this.stencilTest=new gs(this),this.depthRange=new Oo(this),this.depthTest=new ho(this),this.depthFunc=new Ee(this),this.blend=new Fo(this),this.blendFunc=new ln(this),this.blendColor=new Cr(this),this.blendEquation=new Uo(this),this.cullFace=new oa(this),this.cullFaceSide=new Mr(this),this.frontFace=new Ca(this),this.program=new aa(this),this.activeTexture=new Ma(this),this.viewport=new za(this),this.bindFramebuffer=new No(this),this.bindRenderbuffer=new La(this),this.bindTexture=new vn(this),this.bindVertexBuffer=new co(this),this.bindElementBuffer=new uo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new qn(this),this.pixelStoreUnpack=new jr(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new la(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(e.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new zs(this,e,s)}createVertexBuffer(e,s,a){return new ks(this,e,s,a)}createRenderbuffer(e,s,a){const p=this.gl,f=p.createRenderbuffer();return this.bindRenderbuffer.set(f),p.renderbufferStorage(p.RENDERBUFFER,e,s,a),this.bindRenderbuffer.set(null),f}createFramebuffer(e,s,a){return new Wr(this,e,s,a)}clear({color:e,depth:s}){const a=this.gl;let p=0;e&&(p|=a.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),a.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){Gt(e.blendFunction,He.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class pe{constructor(e,s,a){this.func=e,this.mask=s,this.range=a}}pe.ReadOnly=!1,pe.ReadWrite=!0,pe.disabled=new pe(519,pe.ReadOnly,[0,1]);const Re=7680;class Fe{constructor(e,s,a,p,f,y){this.test=e,this.ref=s,this.mask=a,this.fail=p,this.depthFail=f,this.pass=y}}Fe.disabled=new Fe({func:519,mask:0},0,0,Re,Re,Re);class ze{constructor(e,s,a){this.enable=e,this.mode=s,this.frontFace=a}}let ys;function Hr(h,e,s,a,p,f,y){const T=h.context,I=T.gl,P=h.useProgram("collisionBox"),z=[];let O=0,Z=0;for(let X=0;X<a.length;X++){const _t=a[X],ft=e.getTile(_t),Tt=ft.getBucket(s);if(!Tt)continue;let St=_t.posMatrix;p[0]===0&&p[1]===0||(St=h.translatePosMatrix(_t.posMatrix,ft,p,f));const Mt=y?Tt.textCollisionBox:Tt.iconCollisionBox,bt=Tt.collisionCircleArray;if(bt.length>0){const Vt=c.create(),Rt=St;c.mul(Vt,Tt.placementInvProjMatrix,h.transform.glCoordMatrix),c.mul(Vt,Vt,Tt.placementViewportMatrix),z.push({circleArray:bt,circleOffset:Z,transform:Rt,invTransform:Vt,coord:_t}),O+=bt.length/4,Z=O}Mt&&P.draw(T,I.LINES,pe.disabled,Fe.disabled,h.colorModeForRenderPass(),ze.disabled,Je(St,h.transform,ft),h.style.terrain&&h.style.terrain.getTerrainData(_t),s.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,h.transform.zoom,null,null,Mt.collisionVertexBuffer)}if(!y||!z.length)return;const H=h.useProgram("collisionCircle"),j=new c.CollisionCircleLayoutArray;j.resize(4*O),j._trim();let W=0;for(const X of z)for(let _t=0;_t<X.circleArray.length/4;_t++){const ft=4*_t,Tt=X.circleArray[ft+0],St=X.circleArray[ft+1],Mt=X.circleArray[ft+2],bt=X.circleArray[ft+3];j.emplace(W++,Tt,St,Mt,bt,0),j.emplace(W++,Tt,St,Mt,bt,1),j.emplace(W++,Tt,St,Mt,bt,2),j.emplace(W++,Tt,St,Mt,bt,3)}(!ys||ys.length<2*O)&&(ys=function(X){const _t=2*X,ft=new c.QuadTriangleArray;ft.resize(_t),ft._trim();for(let Tt=0;Tt<_t;Tt++){const St=6*Tt;ft.uint16[St+0]=4*Tt+0,ft.uint16[St+1]=4*Tt+1,ft.uint16[St+2]=4*Tt+2,ft.uint16[St+3]=4*Tt+2,ft.uint16[St+4]=4*Tt+3,ft.uint16[St+5]=4*Tt+0}return ft}(O));const rt=T.createIndexBuffer(ys,!0),ht=T.createVertexBuffer(j,c.collisionCircleLayout.members,!0);for(const X of z){const _t={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(pt=h.transform).cameraToCenterDistance,u_viewport_size:[pt.width,pt.height]};H.draw(T,I.TRIANGLES,pe.disabled,Fe.disabled,h.colorModeForRenderPass(),ze.disabled,_t,h.style.terrain&&h.style.terrain.getTerrainData(X.coord),s.id,ht,rt,c.SegmentVector.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,h.transform.zoom,null,null,null)}var pt;ht.destroy(),rt.destroy()}ze.disabled=new ze(!1,1029,2305),ze.backCCW=new ze(!0,1029,2305);const ka=c.identity(new Float32Array(16));function ca(h,e,s,a,p,f){const{horizontalAlign:y,verticalAlign:T}=c.getAnchorAlignment(h),I=-(y-.5)*e,P=-(T-.5)*s,z=c.evaluateVariableOffset(h,a);return new c.pointGeometry((I/p+z[0])*f,(P/p+z[1])*f)}function Vo(h,e,s,a,p,f,y,T,I,P,z){const O=h.text.placedSymbolArray,Z=h.text.dynamicLayoutVertexArray,H=h.icon.dynamicLayoutVertexArray,j={};Z.clear();for(let W=0;W<O.length;W++){const rt=O.get(W),ht=h.allowVerticalPlacement&&!rt.placedOrientation,pt=rt.hidden||!rt.crossTileID||ht?null:a[rt.crossTileID];if(pt){const X=new c.pointGeometry(rt.anchorX,rt.anchorY),_t=Ce(X,s?y:f,z),ft=an(p.cameraToCenterDistance,_t.signedDistanceFromCamera);let Tt=c.evaluateSizeForFeature(h.textSizeData,I,rt)*ft/c.ONE_EM;s&&(Tt*=h.tilePixelRatio/T);const{width:St,height:Mt,anchor:bt,textOffset:Vt,textBoxScale:Rt}=pt,$t=ca(bt,St,Mt,Vt,Rt,Tt),de=s?Ce(X.add($t),f,z).point:_t.point.add(e?$t.rotate(-p.angle):$t),ye=h.allowVerticalPlacement&&rt.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let te=0;te<rt.numGlyphs;te++)c.addDynamicAttributes(Z,de,ye);P&&rt.associatedIconIndex>=0&&(j[rt.associatedIconIndex]={shiftedAnchor:de,angle:ye})}else le(rt.numGlyphs,Z)}if(P){H.clear();const W=h.icon.placedSymbolArray;for(let rt=0;rt<W.length;rt++){const ht=W.get(rt);if(ht.hidden)le(ht.numGlyphs,H);else{const pt=j[rt];if(pt)for(let X=0;X<ht.numGlyphs;X++)c.addDynamicAttributes(H,pt.shiftedAnchor,pt.angle);else le(ht.numGlyphs,H)}}h.icon.dynamicLayoutVertexBuffer.updateData(H)}h.text.dynamicLayoutVertexBuffer.updateData(Z)}function Da(h,e,s){return s.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function vs(h,e,s,a,p,f,y,T,I,P,z,O){const Z=h.context,H=Z.gl,j=h.transform,W=T==="map",rt=I==="map",ht=T!=="viewport"&&s.layout.get("symbol-placement")!=="point",pt=W&&!rt&&!ht,X=!s.layout.get("symbol-sort-key").isConstant();let _t=!1;const ft=h.depthModeForSublayer(0,pe.ReadOnly),Tt=s.layout.get("text-variable-anchor"),St=[];for(const Mt of a){const bt=e.getTile(Mt),Vt=bt.getBucket(s);if(!Vt)continue;const Rt=p?Vt.text:Vt.icon;if(!Rt||!Rt.segments.get().length)continue;const $t=Rt.programConfigurations.get(s.id),de=p||Vt.sdfIcons,ye=p?Vt.textSizeData:Vt.iconSizeData,te=rt||j.pitch!==0,Ve=h.useProgram(Da(de,p,Vt),$t),Ge=c.evaluateSizeForZoom(ye,j.zoom),Le=h.style.terrain&&h.style.terrain.getTerrainData(Mt);let ke,qe,Di,kr,ur=[0,0],Dr=null;if(p){if(qe=bt.glyphAtlasTexture,Di=H.LINEAR,ke=bt.glyphAtlasTexture.size,Vt.iconsInText){ur=bt.imageAtlasTexture.size,Dr=bt.imageAtlasTexture;const Kn=ye.kind==="composite"||ye.kind==="camera";kr=te||h.options.rotating||h.options.zooming||Kn?H.LINEAR:H.NEAREST}}else{const Kn=s.layout.get("icon-size").constantOr(0)!==1||Vt.iconsNeedLinear;qe=bt.imageAtlasTexture,Di=de||h.options.rotating||h.options.zooming||Kn||te?H.LINEAR:H.NEAREST,ke=bt.imageAtlasTexture.size}const Ts=di(bt,1,h.transform.zoom),Xn=br(Mt.posMatrix,rt,W,h.transform,Ts),wn=yn(Mt.posMatrix,rt,W,h.transform,Ts),ss=Tt&&Vt.hasTextData(),ga=s.layout.get("icon-text-fit")!=="none"&&ss&&Vt.hasIconData();if(ht){const Kn=h.style.terrain?(Oa,So)=>h.style.terrain.getElevation(Mt,Oa,So):null,Xs=s.layout.get("text-rotation-alignment")==="map";Wi(Vt,Mt.posMatrix,h,p,Xn,wn,rt,P,Xs,Kn)}const Ei=h.translatePosMatrix(Mt.posMatrix,bt,f,y),be=ht||p&&Tt||ga?ka:Xn,Ne=h.translatePosMatrix(wn,bt,f,y,!0),Bi=de&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ri;Ri=de?Vt.iconsInText?fe(ye.kind,Ge,pt,rt,h,Ei,be,Ne,ke,ur):oo(ye.kind,Ge,pt,rt,h,Ei,be,Ne,p,ke,!0):Ms(ye.kind,Ge,pt,rt,h,Ei,be,Ne,p,ke);const oi={program:Ve,buffers:Rt,uniformValues:Ri,atlasTexture:qe,atlasTextureIcon:Dr,atlasInterpolation:Di,atlasInterpolationIcon:kr,isSDF:de,hasHalo:Bi};if(X&&Vt.canOverlap){_t=!0;const Kn=Rt.segments.get();for(const Xs of Kn)St.push({segments:new c.SegmentVector([Xs]),sortKey:Xs.sortKey,state:oi,terrainData:Le})}else St.push({segments:Rt.segments,sortKey:0,state:oi,terrainData:Le})}_t&&St.sort((Mt,bt)=>Mt.sortKey-bt.sortKey);for(const Mt of St){const bt=Mt.state;if(Z.activeTexture.set(H.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,H.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(Z.activeTexture.set(H.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),bt.isSDF){const Vt=bt.uniformValues;bt.hasHalo&&(Vt.u_is_halo=1,Xr(bt.buffers,Mt.segments,s,h,bt.program,ft,z,O,Vt,Mt.terrainData)),Vt.u_is_halo=0}Xr(bt.buffers,Mt.segments,s,h,bt.program,ft,z,O,bt.uniformValues,Mt.terrainData)}}function Xr(h,e,s,a,p,f,y,T,I,P){const z=a.context;p.draw(z,z.gl.TRIANGLES,f,y,T,ze.disabled,I,P,s.id,h.layoutVertexBuffer,h.indexBuffer,e,s.paint,a.transform.zoom,h.programConfigurations.get(s.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Os(h,e,s,a,p,f,y){const T=h.context.gl,I=s.paint.get("fill-pattern"),P=I&&I.constantOr(1),z=s.getCrossfadeParameters();let O,Z,H,j,W;y?(Z=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=T.LINES):(Z=P?"fillPattern":"fill",O=T.TRIANGLES);for(const rt of a){const ht=e.getTile(rt);if(P&&!ht.patternsLoaded())continue;const pt=ht.getBucket(s);if(!pt)continue;const X=pt.programConfigurations.get(s.id),_t=h.useProgram(Z,X),ft=h.style.terrain&&h.style.terrain.getTerrainData(rt);P&&(h.context.activeTexture.set(T.TEXTURE0),ht.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),X.updatePaintBuffers(z));const Tt=I.constantOr(null);if(Tt&&ht.imageAtlas){const bt=ht.imageAtlas,Vt=bt.patternPositions[Tt.to.toString()],Rt=bt.patternPositions[Tt.from.toString()];Vt&&Rt&&X.setConstantPatternPositions(Vt,Rt)}const St=ft?rt:null,Mt=h.translatePosMatrix(St?St.posMatrix:rt.posMatrix,ht,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(y){j=pt.indexBuffer2,W=pt.segments2;const bt=[T.drawingBufferWidth,T.drawingBufferHeight];H=Z==="fillOutlinePattern"&&P?Ps(Mt,h,z,ht,bt):sa(Mt,bt)}else j=pt.indexBuffer,W=pt.segments,H=P?Hi(Mt,h,z,ht):qr(Mt);_t.draw(h.context,O,p,h.stencilModeForClipping(rt),f,ze.disabled,H,ft,s.id,pt.layoutVertexBuffer,j,W,s.paint,h.transform.zoom,X)}}function Fs(h,e,s,a,p,f,y){const T=h.context,I=T.gl,P=s.paint.get("fill-extrusion-pattern"),z=P.constantOr(1),O=s.getCrossfadeParameters(),Z=s.paint.get("fill-extrusion-opacity");for(const H of a){const j=e.getTile(H),W=j.getBucket(s);if(!W)continue;const rt=h.style.terrain&&h.style.terrain.getTerrainData(H),ht=W.programConfigurations.get(s.id),pt=h.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ht);z&&(h.context.activeTexture.set(I.TEXTURE0),j.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ht.updatePaintBuffers(O));const X=P.constantOr(null);if(X&&j.imageAtlas){const St=j.imageAtlas,Mt=St.patternPositions[X.to.toString()],bt=St.patternPositions[X.from.toString()];Mt&&bt&&ht.setConstantPatternPositions(Mt,bt)}const _t=h.translatePosMatrix(H.posMatrix,j,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ft=s.paint.get("fill-extrusion-vertical-gradient"),Tt=z?ko(_t,h,ft,Z,H,O,j):si(_t,h,ft,Z);pt.draw(T,T.gl.TRIANGLES,p,f,y,ze.backCCW,Tt,rt,s.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,s.paint,h.transform.zoom,ht,h.style.terrain&&W.centroidVertexBuffer)}}function fo(h,e,s,a,p,f,y){const T=h.context,I=T.gl,P=s.fbo;if(!P)return;const z=h.useProgram("hillshade"),O=h.style.terrain&&h.style.terrain.getTerrainData(e);T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),z.draw(T,I.TRIANGLES,p,f,y,ze.disabled,((Z,H,j,W)=>{const rt=j.paint.get("hillshade-shadow-color"),ht=j.paint.get("hillshade-highlight-color"),pt=j.paint.get("hillshade-accent-color");let X=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(X-=Z.transform.angle);const _t=!Z.options.moving;return{u_matrix:W?W.posMatrix:Z.transform.calculatePosMatrix(H.tileID.toUnwrapped(),_t),u_image:0,u_latrange:ms(0,H.tileID),u_light:[j.paint.get("hillshade-exaggeration"),X],u_shadow:rt,u_highlight:ht,u_accent:pt}})(h,s,a,O?e:null),O,a.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function ua(h,e,s,a,p,f){const y=h.context,T=y.gl,I=e.dem;if(I&&I.data){const P=I.dim,z=I.stride,O=I.getPixels();if(y.activeTexture.set(T.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||h.getTileTexture(z),e.demTexture){const H=e.demTexture;H.update(O,{premultiply:!1}),H.bind(T.NEAREST,T.CLAMP_TO_EDGE)}else e.demTexture=new ce(y,O,T.RGBA,{premultiply:!1}),e.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);y.activeTexture.set(T.TEXTURE0);let Z=e.fbo;if(!Z){const H=new ce(y,{width:P,height:P,data:null},T.RGBA);H.bind(T.LINEAR,T.CLAMP_TO_EDGE),Z=e.fbo=y.createFramebuffer(P,P,!0),Z.colorAttachment.set(H.texture)}y.bindFramebuffer.set(Z.framebuffer),y.viewport.set([0,0,P,P]),h.useProgram("hillshadePrepare").draw(y,T.TRIANGLES,a,p,f,ze.disabled,((H,j)=>{const W=j.stride,rt=c.create();return c.ortho(rt,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(rt,rt,[0,-c.EXTENT,0]),{u_matrix:rt,u_image:1,u_dimension:[W,W],u_zoom:H.overscaledZ,u_unpack:j.getUnpackVector()}})(e.tileID,I),null,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ki(h,e,s,a,p,f){const y=a.paint.get("raster-fade-duration");if(!f&&y>0){const T=c.exported.now(),I=(T-h.timeAdded)/y,P=e?(T-e.timeAdded)/y:-1,z=s.getSource(),O=p.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),Z=!e||Math.abs(e.tileID.overscaledZ-O)>Math.abs(h.tileID.overscaledZ-O),H=Z&&h.refreshedUponExpiration?1:c.clamp(Z?I:1-P,0,1);return h.refreshedUponExpiration&&I>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}const or=new c.Color(1,0,0,1),Cn=new c.Color(0,1,0,1),zr=new c.Color(0,0,1,1),Go=new c.Color(1,0,1,1),Kr=new c.Color(0,1,1,1);function Jr(h,e,s,a){Yr(h,0,e+s/2,h.transform.width,s,a)}function ar(h,e,s,a){Yr(h,e-s/2,0,s,h.transform.height,a)}function Yr(h,e,s,a,p,f){const y=h.context,T=y.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*h.pixelRatio,s*h.pixelRatio,a*h.pixelRatio,p*h.pixelRatio),y.clear({color:f}),T.disable(T.SCISSOR_TEST)}function mo(h,e,s){const a=h.context,p=a.gl,f=s.posMatrix,y=h.useProgram("debug"),T=pe.disabled,I=Fe.disabled,P=h.colorModeForRenderPass(),z="$debug",O=h.style.terrain&&h.style.terrain.getTerrainData(s);a.activeTexture.set(p.TEXTURE0),h.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE);const Z=e.getTileByID(s.key).latestRawTileData,H=Math.floor((Z&&Z.byteLength||0)/1024),j=e.getTile(s).tileSize,W=512/Math.min(j,512)*(s.overscaledZ/h.transform.zoom)*.5;let rt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(rt+=` => ${s.overscaledZ}`),function(ht,pt){ht.initDebugOverlayCanvas();const X=ht.debugOverlayCanvas,_t=ht.context.gl,ft=ht.debugOverlayCanvas.getContext("2d");ft.clearRect(0,0,X.width,X.height),ft.shadowColor="white",ft.shadowBlur=2,ft.lineWidth=1.5,ft.strokeStyle="white",ft.textBaseline="top",ft.font="bold 36px Open Sans, sans-serif",ft.fillText(pt,5,5),ft.strokeText(pt,5,5),ht.debugOverlayTexture.update(X),ht.debugOverlayTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE)}(h,`${rt} ${H}kB`),y.draw(a,p.TRIANGLES,T,I,He.alphaBlended,ze.disabled,Pn(f,c.Color.transparent,W),null,z,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),y.draw(a,p.LINE_STRIP,T,I,P,ze.disabled,Pn(f,c.Color.red),O,z,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function _o(h,e,s){const a=h.context,p=a.gl,f=h.colorModeForRenderPass(),y=new pe(p.LEQUAL,pe.ReadWrite,h.depthRangeFor3D),T=h.useProgram("terrain"),I=e.getTerrainMesh(),P=e.getTerrainData(s.tileID);a.bindFramebuffer.set(null),a.viewport.set([0,0,h.width,h.height]),a.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,e.getRTTFramebuffer().colorAttachment.get());const z=h.transform.calculatePosMatrix(s.tileID.toUnwrapped());T.draw(a,p.TRIANGLES,y,Fe.disabled,f,ze.backCCW,{u_matrix:z,u_texture:0},P,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function lr(h,e,s,a){const p=h.context,f=s.tileSize*e.qualityFactor;s.textures[a]||(s.textures[a]=h.getTileTexture(f)||new ce(p,{width:f,height:f,data:null},p.gl.RGBA),s.textures[a].bind(p.gl.LINEAR,p.gl.CLAMP_TO_EDGE),a===0&&e.sourceCache.renderHistory.unshift(s.tileID.key));const y=e.getRTTFramebuffer();y.colorAttachment.set(s.textures[a].texture),p.bindFramebuffer.set(y.framebuffer),p.viewport.set([0,0,f,f])}class Us{constructor(e){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=e,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=e.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const e=this.painter.style,s=e.terrain;for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const p=e.sourceCaches[a].getVisibleCoordinates();for(const f of p){const y=s.sourceCache.getTerrainCoords(f);for(const T in y)this._coordsDescendingInv[a][T]||(this._coordsDescendingInv[a][T]=[]),this._coordsDescendingInv[a][T].push(y[T])}}for(const a of e._order){const p=e._layers[a],f=p.source;if(this._renderToTexture[p.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const y in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][y]=this._coordsDescendingInv[f][y].map(T=>T.key).sort().join()}}return this._renderableTiles.forEach(a=>{for(const p in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[p][a.tileID.key];f&&f!==a.textureCoords[p]&&a.clearTextures(this.painter),s.needsRerender(p,a.tileID)&&a.clearTextures(this.painter)}this._rerender[a.tileID.key]=!a.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(e){const s=e.type,a=this.painter,p=a.style._order,f=a.currentLayer,y=f+1===p.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(p[f]),!y))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&y){this._prevType=s;const T=this._stacks.length-1,I=this._stacks[T]||[];for(const P of this._renderableTiles){if(lr(a,a.style.terrain,P,T),this._rerender[P.tileID.key]){a.context.clear({color:c.Color.transparent});for(let z=0;z<I.length;z++){const O=a.style._layers[I[z]],Z=O.source?this._coordsDescendingInv[O.source][P.tileID.key]:[P.tileID];a._renderTileClippingMasks(O,Z),a.renderLayer(a,a.style.sourceCaches[O.source],O,Z),O.source&&(P.textureCoords[O.source]=this._coordsDescendingInvStr[O.source][P.tileID.key])}}_o(a,a.style.terrain,P)}if(s==="hillshade"){this._stacks.push([p[f]]);for(const P of this._renderableTiles){const z=this._coordsDescendingInv[e.source][P.tileID.key];lr(a,a.style.terrain,P,this._stacks.length-1),a.context.clear({color:c.Color.transparent}),a._renderTileClippingMasks(e,z),a.renderLayer(a,a.style.sourceCaches[e.source],e,z),_o(a,a.style.terrain,P)}return!0}return this._renderToTexture[s]}return!1}}const Ns={symbol:function(h,e,s,a,p){if(h.renderPass!=="translucent")return;const f=Fe.disabled,y=h.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(T,I,P,z,O,Z,H){const j=I.transform,W=O==="map",rt=Z==="map";for(const ht of T){const pt=z.getTile(ht),X=pt.getBucket(P);if(!X||!X.text||!X.text.segments.get().length)continue;const _t=c.evaluateSizeForZoom(X.textSizeData,j.zoom),ft=di(pt,1,I.transform.zoom),Tt=br(ht.posMatrix,rt,W,I.transform,ft),St=P.layout.get("icon-text-fit")!=="none"&&X.hasIconData();if(_t){const Mt=Math.pow(2,j.zoom-pt.tileID.overscaledZ);Vo(X,W,rt,H,j,Tt,ht.posMatrix,Mt,_t,St,I.style.terrain?(bt,Vt)=>I.style.terrain.getElevation(ht,bt,Vt):null)}}}(a,h,s,e,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&vs(h,e,s,a,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),f,y),s.paint.get("text-opacity").constantOr(1)!==0&&vs(h,e,s,a,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),f,y),e.map.showCollisionBoxes&&(Hr(h,e,s,a,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Hr(h,e,s,a,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,e,s,a){if(h.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),f=s.paint.get("circle-stroke-width"),y=s.paint.get("circle-stroke-opacity"),T=!s.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(f.constantOr(1)===0||y.constantOr(1)===0))return;const I=h.context,P=I.gl,z=h.depthModeForSublayer(0,pe.ReadOnly),O=Fe.disabled,Z=h.colorModeForRenderPass(),H=[];for(let j=0;j<a.length;j++){const W=a[j],rt=e.getTile(W),ht=rt.getBucket(s);if(!ht)continue;const pt=ht.programConfigurations.get(s.id),X=h.useProgram("circle",pt),_t=ht.layoutVertexBuffer,ft=ht.indexBuffer,Tt=h.style.terrain&&h.style.terrain.getTerrainData(W),St={programConfiguration:pt,program:X,layoutVertexBuffer:_t,indexBuffer:ft,uniformValues:Er(h,W,rt,s),terrainData:Tt};if(T){const Mt=ht.segments.get();for(const bt of Mt)H.push({segments:new c.SegmentVector([bt]),sortKey:bt.sortKey,state:St})}else H.push({segments:ht.segments,sortKey:0,state:St})}T&&H.sort((j,W)=>j.sortKey-W.sortKey);for(const j of H){const{programConfiguration:W,program:rt,layoutVertexBuffer:ht,indexBuffer:pt,uniformValues:X,terrainData:_t}=j.state;rt.draw(I,P.TRIANGLES,z,O,Z,ze.disabled,X,_t,s.id,ht,pt,j.segments,s.paint,h.transform.zoom,W)}},heatmap:function(h,e,s,a){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,f=p.gl,y=Fe.disabled,T=new He([f.ONE,f.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(I,P,z){const O=I.gl;I.activeTexture.set(O.TEXTURE1),I.viewport.set([0,0,P.width/4,P.height/4]);let Z=z.heatmapFbo;if(Z)O.bindTexture(O.TEXTURE_2D,Z.colorAttachment.get()),I.bindFramebuffer.set(Z.framebuffer);else{const H=O.createTexture();O.bindTexture(O.TEXTURE_2D,H),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),Z=z.heatmapFbo=I.createFramebuffer(P.width/4,P.height/4,!1),function(j,W,rt,ht){const pt=j.gl;pt.texImage2D(pt.TEXTURE_2D,0,pt.RGBA,W.width/4,W.height/4,0,pt.RGBA,j.extRenderToTextureHalfFloat?j.extTextureHalfFloat.HALF_FLOAT_OES:pt.UNSIGNED_BYTE,null),ht.colorAttachment.set(rt)}(I,P,H,Z)}})(p,h,s),p.clear({color:c.Color.transparent});for(let I=0;I<a.length;I++){const P=a[I];if(e.hasRenderableParent(P))continue;const z=e.getTile(P),O=z.getBucket(s);if(!O)continue;const Z=O.programConfigurations.get(s.id),H=h.useProgram("heatmap",Z),{zoom:j}=h.transform;H.draw(p,f.TRIANGLES,pe.disabled,y,T,ze.disabled,Pr(P.posMatrix,z,j,s.paint.get("heatmap-intensity")),null,s.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,s.paint,h.transform.zoom,Z)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,f){const y=p.context,T=y.gl,I=f.heatmapFbo;if(!I)return;y.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.colorAttachment.get()),y.activeTexture.set(T.TEXTURE1);let P=f.colorRampTexture;P||(P=f.colorRampTexture=new ce(y,f.colorRamp,T.RGBA)),P.bind(T.LINEAR,T.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(y,T.TRIANGLES,pe.disabled,Fe.disabled,p.colorModeForRenderPass(),ze.disabled,((z,O,Z,H)=>{const j=c.create();c.ortho(j,0,z.width,z.height,0,0,1);const W=z.context.gl;return{u_matrix:j,u_world:[W.drawingBufferWidth,W.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}})(p,f),null,f.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,f.paint,p.transform.zoom)}(h,s))},line:function(h,e,s,a){if(h.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),f=s.paint.get("line-width");if(p.constantOr(1)===0||f.constantOr(1)===0)return;const y=h.depthModeForSublayer(0,pe.ReadOnly),T=h.colorModeForRenderPass(),I=s.paint.get("line-dasharray"),P=s.paint.get("line-pattern"),z=P.constantOr(1),O=s.paint.get("line-gradient"),Z=s.getCrossfadeParameters(),H=z?"linePattern":I?"lineSDF":O?"lineGradient":"line",j=h.context,W=j.gl;let rt=!0;for(const ht of a){const pt=e.getTile(ht);if(z&&!pt.patternsLoaded())continue;const X=pt.getBucket(s);if(!X)continue;const _t=X.programConfigurations.get(s.id),ft=h.context.program.get(),Tt=h.useProgram(H,_t),St=rt||Tt.program!==ft,Mt=h.style.terrain&&h.style.terrain.getTerrainData(ht),bt=P.constantOr(null);if(bt&&pt.imageAtlas){const $t=pt.imageAtlas,de=$t.patternPositions[bt.to.toString()],ye=$t.patternPositions[bt.from.toString()];de&&ye&&_t.setConstantPatternPositions(de,ye)}const Vt=Mt?ht:null,Rt=z?_s(h,pt,s,Z,Vt):I?Ar(h,pt,s,I,Z,Vt):O?As(h,pt,s,X.lineClipsArray.length,Vt):Vn(h,pt,s,Vt);if(z)j.activeTexture.set(W.TEXTURE0),pt.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),_t.updatePaintBuffers(Z);else if(I&&(St||h.lineAtlas.dirty))j.activeTexture.set(W.TEXTURE0),h.lineAtlas.bind(j);else if(O){const $t=X.gradients[s.id];let de=$t.texture;if(s.gradientVersion!==$t.version){let ye=256;if(s.stepInterpolant){const te=e.getSource().maxzoom,Ve=ht.canonical.z===te?Math.ceil(1<<h.transform.maxZoom-ht.canonical.z):1;ye=c.clamp(c.nextPowerOfTwo(X.maxLineLength/c.EXTENT*1024*Ve),256,j.maxTextureSize)}$t.gradient=c.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ye,image:$t.gradient||void 0,clips:X.lineClipsArray}),$t.texture?$t.texture.update($t.gradient):$t.texture=new ce(j,$t.gradient,W.RGBA),$t.version=s.gradientVersion,de=$t.texture}j.activeTexture.set(W.TEXTURE0),de.bind(s.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Tt.draw(j,W.TRIANGLES,y,h.stencilModeForClipping(ht),T,ze.disabled,Rt,Mt,s.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,s.paint,h.transform.zoom,_t,X.layoutVertexBuffer2),rt=!1}},fill:function(h,e,s,a){const p=s.paint.get("fill-color"),f=s.paint.get("fill-opacity");if(f.constantOr(1)===0)return;const y=h.colorModeForRenderPass(),T=s.paint.get("fill-pattern"),I=h.opaquePassEnabledForLayer()&&!T.constantOr(1)&&p.constantOr(c.Color.transparent).a===1&&f.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===I){const P=h.depthModeForSublayer(1,h.renderPass==="opaque"?pe.ReadWrite:pe.ReadOnly);Os(h,e,s,a,P,y,!1)}if(h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const P=h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,pe.ReadOnly);Os(h,e,s,a,P,y,!0)}},"fill-extrusion":function(h,e,s,a){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&h.renderPass==="translucent"){const f=new pe(h.context.gl.LEQUAL,pe.ReadWrite,h.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Fs(h,e,s,a,f,Fe.disabled,He.disabled),Fs(h,e,s,a,f,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const y=h.colorModeForRenderPass();Fs(h,e,s,a,f,Fe.disabled,y)}}},hillshade:function(h,e,s,a){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const p=h.context,f=h.depthModeForSublayer(0,pe.ReadOnly),y=h.colorModeForRenderPass(),[T,I]=h.renderPass==="translucent"?h.stencilConfigForOverlap(a):[{},a];for(const P of I){const z=e.getTile(P);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&h.renderPass==="offscreen"?ua(h,z,s,f,Fe.disabled,y):h.renderPass==="translucent"&&fo(h,P,z,s,f,T[P.overscaledZ],y)}p.viewport.set([0,0,h.width,h.height])},raster:function(h,e,s,a){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!a.length)return;const p=h.context,f=p.gl,y=e.getSource(),T=h.useProgram("raster"),I=h.colorModeForRenderPass(),[P,z]=y instanceof gn?[{},a]:h.stencilConfigForOverlap(a),O=z[z.length-1].overscaledZ,Z=!h.options.moving;for(const H of z){const j=h.depthModeForSublayer(H.overscaledZ-O,s.paint.get("raster-opacity")===1?pe.ReadWrite:pe.ReadOnly,f.LESS),W=e.getTile(H);W.registerFadeDuration(s.paint.get("raster-fade-duration"));const rt=e.findLoadedParent(H,0),ht=Ki(W,rt,e,s,h.transform,h.style.terrain);let pt,X;const _t=s.paint.get("raster-resampling")==="nearest"?f.NEAREST:f.LINEAR;p.activeTexture.set(f.TEXTURE0),W.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(f.TEXTURE1),rt?(rt.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST),pt=Math.pow(2,rt.tileID.overscaledZ-W.tileID.overscaledZ),X=[W.tileID.canonical.x*pt%1,W.tileID.canonical.y*pt%1]):W.texture.bind(_t,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST);const ft=h.style.terrain&&h.style.terrain.getTerrainData(H),Tt=ft?H:null,St=Tt?Tt.posMatrix:h.transform.calculatePosMatrix(H.toUnwrapped(),Z),Mt=Cs(St,X||[0,0],pt||1,ht,s);y instanceof gn?T.draw(p,f.TRIANGLES,j,Fe.disabled,I,ze.disabled,Mt,ft,s.id,y.boundsBuffer,h.quadTriangleIndexBuffer,y.boundsSegments):T.draw(p,f.TRIANGLES,j,P[H.overscaledZ],I,ze.disabled,Mt,ft,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,e,s,a){const p=s.paint.get("background-color"),f=s.paint.get("background-opacity");if(f===0)return;const y=h.context,T=y.gl,I=h.transform,P=I.tileSize,z=s.paint.get("background-pattern");if(h.isPatternMissing(z))return;const O=!z&&p.a===1&&f===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==O)return;const Z=Fe.disabled,H=h.depthModeForSublayer(0,O==="opaque"?pe.ReadWrite:pe.ReadOnly),j=h.colorModeForRenderPass(),W=h.useProgram(z?"backgroundPattern":"background"),rt=a||I.coveringTiles({tileSize:P,terrain:h.style.terrain});z&&(y.activeTexture.set(T.TEXTURE0),h.imageManager.bind(h.context));const ht=s.getCrossfadeParameters();for(const pt of rt){const X=a?pt.posMatrix:h.transform.calculatePosMatrix(pt.toUnwrapped()),_t=z?Ye(X,f,h,z,{tileID:pt,tileSize:P},ht):Gn(X,f,p),ft=h.style.terrain&&h.style.terrain.getTerrainData(pt);W.draw(y,T.TRIANGLES,H,Z,j,ze.disabled,_t,ft,s.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}},debug:function(h,e,s){for(let a=0;a<s.length;a++)mo(h,e,s[a])},custom:function(h,e,s){const a=h.context,p=s.implementation;if(h.renderPass==="offscreen"){const f=p.prerender;f&&(h.setCustomLayerDefaults(),a.setColorMode(h.colorModeForRenderPass()),f.call(p,a.gl,h.transform.customLayerMatrix()),a.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),a.setColorMode(h.colorModeForRenderPass()),a.setStencilMode(Fe.disabled);const f=p.renderingMode==="3d"?new pe(h.context.gl.LEQUAL,pe.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,pe.ReadOnly);a.setDepthMode(f),p.render(a.gl,h.transform.customLayerMatrix()),a.setDirty(),h.setBaseState(),a.bindFramebuffer.set(null)}}};class Zs{constructor(e,s){this.context=new Rs(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.create(),renderTime:0},this.setup(),this.numSublayers=Zi.maxUnderzooming+Zi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new se,this.gpuTimers={}}resize(e,s,a){if(this.width=e*a,this.height=s*a,this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const e=this.context,s=new c.PosArray;s.emplaceBack(0,0),s.emplaceBack(c.EXTENT,0),s.emplaceBack(0,c.EXTENT),s.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(s,Me.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const a=new c.PosArray;a.emplaceBack(0,0),a.emplaceBack(c.EXTENT,0),a.emplaceBack(0,c.EXTENT),a.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=e.createVertexBuffer(a,Me.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const p=new c.RasterBoundsArray;p.emplaceBack(0,0,0,0),p.emplaceBack(c.EXTENT,0,c.EXTENT,0),p.emplaceBack(0,c.EXTENT,0,c.EXTENT),p.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(p,ae.members),this.rasterBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const f=new c.PosArray;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,Me.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const y=new c.LineStripIndexArray;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const T=new c.TriangleIndexArray;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T),this.emptyTexture=new ce(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new Fe({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.create();c.ortho(a,0,this.width,this.height,0,0,1),c.scale(a,a,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,pe.disabled,this.stencilClearMode,He.disabled,ze.disabled,Zn(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const a=this.context,p=a.gl;this.nextStencilID+s.length>256&&this.clearStencil(),a.setColorMode(He.disabled),a.setDepthMode(pe.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of s){const T=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(y);f.draw(a,p.TRIANGLES,pe.disabled,new Fe({func:p.ALWAYS,mask:0},T,255,p.KEEP,p.KEEP,p.REPLACE),He.disabled,ze.disabled,Zn(y.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Fe({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Fe({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,a=e.sort((y,T)=>T.overscaledZ-y.overscaledZ),p=a[a.length-1].overscaledZ,f=a[0].overscaledZ-p+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const y={};for(let T=0;T<f;T++)y[T+p]=new Fe({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[y,a]}return[{[p]:Fe.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new He([e.CONSTANT_COLOR,e.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?He.unblended:He.alphaBlended}depthModeForSublayer(e,s,a){if(!this.opaquePassEnabledForLayer())return pe.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new pe(a||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const a=this.style._order,p=this.style.sourceCaches,f=this.style.terrain&&new Us(this);for(const P in p){const z=p[P];z.used&&z.prepare(this.context)}const y={},T={},I={};for(const P in p){const z=p[P];y[P]=z.getVisibleCoordinates(),T[P]=y[P].slice().reverse(),I[P]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<a.length;P++)if(this.style._layers[a[P]].is3D()){this.opaquePassCutoff=P;break}if(f){this.opaquePassCutoff=0;const P=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!c.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(c.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,O){const Z=z.context,H=Z.gl,j=He.unblended,W=new pe(H.LEQUAL,pe.ReadWrite,[0,1]),rt=O.getTerrainMesh(),ht=O.sourceCache.getRenderableTiles(),pt=z.useProgram("terrainDepth");Z.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),Z.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),Z.clear({color:c.Color.transparent,depth:1});for(const X of ht){const _t=O.getTerrainData(X.tileID),ft=z.transform.calculatePosMatrix(X.tileID.toUnwrapped());pt.draw(Z,H.TRIANGLES,W,Fe.disabled,j,ze.backCCW,{u_matrix:ft},_t,"terrain",rt.vertexBuffer,rt.indexBuffer,rt.segments)}Z.bindFramebuffer.set(null),Z.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,O){const Z=z.context,H=Z.gl,j=He.unblended,W=new pe(H.LEQUAL,pe.ReadWrite,[0,1]),rt=O.getTerrainMesh(),ht=O.getCoordsTexture(),pt=O.sourceCache.getRenderableTiles(),X=z.useProgram("terrainCoords");Z.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),Z.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),Z.clear({color:c.Color.transparent,depth:1}),O.coordsIndex=[];for(const _t of pt){const ft=O.getTerrainData(_t.tileID);Z.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,ht.texture);const Tt=z.transform.calculatePosMatrix(_t.tileID.toUnwrapped());X.draw(Z,H.TRIANGLES,W,Fe.disabled,j,ze.backCCW,{u_matrix:Tt,u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0},ft,"terrain",rt.vertexBuffer,rt.indexBuffer,rt.segments),O.coordsIndex.push(_t.tileID.key)}Z.bindFramebuffer.set(null),Z.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const P of a){const z=this.style._layers[P];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const O=T[z.source];(z.type==="custom"||O.length)&&this.renderLayer(this,p[z.source],z,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!f)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[a[this.currentLayer]],z=p[P.source],O=y[P.source];this._renderTileClippingMasks(P,O),this.renderLayer(this,z,P,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const P=this.style._layers[a[this.currentLayer]],z=p[P.source];if(f&&f.renderLayer(P))continue;const O=(P.type==="symbol"?I:T)[P.source];this._renderTileClippingMasks(P,y[P.source]),this.renderLayer(this,z,P,O)}if(this.options.showTileBoundaries){let P,z;Object.values(this.style._layers).forEach(O=>{O.source&&!O.isHidden(this.transform.zoom)&&(O.source!==(z&&z.id)&&(z=this.style.sourceCaches[O.source]),(!P||P.getSource().maxzoom<z.getSource().maxzoom)&&(P=z))}),P&&Ns.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const z=P.transform.padding;Jr(P,P.transform.height-(z.top||0),3,or),Jr(P,z.bottom||0,3,Cn),ar(P,z.left||0,3,zr),ar(P,P.transform.width-(z.right||0),3,Go);const O=P.transform.centerPoint;(function(Z,H,j,W){Yr(Z,H-1,j-10,2,20,W),Yr(Z,H-10,j-1,20,2,W)})(P,O.x,P.transform.height-O.y,Kr)}(this),this.context.setDefault()}renderLayer(e,s,a,p){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(p||[]).length)&&(this.id=a.id,this.gpuTimingStart(a),Ns[a.type](e,s,a,p,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let a=this.gpuTimers[e.id];a||(a=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),a.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,a.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}queryGpuTimers(e){const s={};for(const a in e){const p=e[a],f=this.context.extTimerQuery,y=f.getQueryObjectEXT(p.query,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(p.query),s[a]=y}return s}translatePosMatrix(e,s,a,p,f){if(!a[0]&&!a[1])return e;const y=f?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(y){const P=Math.sin(y),z=Math.cos(y);a=[a[0]*z-a[1]*P,a[0]*P+a[1]*z]}const T=[f?a[0]:di(s,a[0],this.transform.zoom),f?a[1]:di(s,a[1],this.transform.zoom),0],I=new Float32Array(16);return c.translate(I,e,T),I}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!s||!a}useProgram(e,s){this.cache=this.cache||{};const a=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new so(this.context,e,je[e],s,ao[e],this._showOverdrawInspector,this.style.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ce(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class go{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,a){const p=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=1/(T=c.transformMat4([],T,e))[3]/s*p;return c.mul$1(T,T,[I,I,1/T[3],I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=c.sub([],f[T[0]],f[T[1]]),P=c.sub([],f[T[2]],f[T[1]]),z=c.normalize([],c.cross([],I,P)),O=-c.dot(z,f[T[1]]);return z.concat(O)});return new go(f,y)}}class hn{constructor(e,s){this.min=e,this.max=s,this.center=c.scale$1([],c.add([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],a=c.clone$2(this.min),p=c.clone$2(this.max);for(let f=0;f<s.length;f++)a[f]=s[f]?this.min[f]:this.center[f],p[f]=s[f]?this.center[f]:this.max[f];return p[2]=this.max[2],new hn(a,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let p=0;p<e.planes.length;p++){const f=e.planes[p];let y=0;for(let T=0;T<s.length;T++)c.dot$1(f,s[T])>=0&&y++;if(y===0)return 0;y!==s.length&&(a=!1)}if(a)return 2;for(let p=0;p<3;p++){let f=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const I=e.points[T][p]-this.min[p];f=Math.min(f,I),y=Math.max(y,I)}if(y<0||f>this.max[p]-this.min[p])return 0}return 1}}class xs{constructor(e=0,s=0,a=0,p=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(a)||a<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=a,this.right=p}interpolate(e,s,a){return s.top!=null&&e.top!=null&&(this.top=c.number(e.top,s.top,a)),s.bottom!=null&&e.bottom!=null&&(this.bottom=c.number(e.bottom,s.bottom,a)),s.left!=null&&e.left!=null&&(this.left=c.number(e.left,s.left,a)),s.right!=null&&e.right!=null&&(this.right=c.number(e.right,s.right,a)),this}getCenter(e,s){const a=c.clamp((this.left+e-this.right)/2,0,e),p=c.clamp((this.top+s-this.bottom)/2,0,s);return new c.pointGeometry(a,p)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new xs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class $n{constructor(e,s,a,p,f){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=a==null?0:a,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new xs,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const e=new $n(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e._elevation=this._elevation,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._calcMatrices(),e}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-c.wrap(e,-180,180)*Math.PI/180;var a;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(a=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),function(p,f,y){var T=f[0],I=f[1],P=f[2],z=f[3],O=Math.sin(y),Z=Math.cos(y);p[0]=T*Z+P*O,p[1]=I*Z+z*O,p[2]=T*-O+P*Z,p[3]=I*-O+z*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=c.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,a){this._unmodified=!1,this._edgeInsets.interpolate(e,s,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new c.UnwrappedTileID(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.pointGeometry(0,0)),p=this.pointCoordinate(new c.pointGeometry(this.width,0)),f=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new c.pointGeometry(0,this.height)),T=Math.floor(Math.min(a.x,p.x,f.x,y.x)),I=Math.floor(Math.max(a.x,p.x,f.x,y.x)),P=1;for(let z=T-P;z<=I+P;z++)z!==0&&s.push(new c.UnwrappedTileID(z,e))}return s}coveringTiles(e){var s,a;let p=this.coveringZoomLevel(e);const f=p;if(e.minzoom!==void 0&&p<e.minzoom)return[];e.maxzoom!==void 0&&p>e.maxzoom&&(p=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),T=c.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,p),P=[I*y.x,I*y.y,0],z=[I*T.x,I*T.y,0],O=go.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let Z=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Z=p);const H=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,j=X=>({aabb:new hn([X*I,0,0],[(X+1)*I,I,0]),zoom:0,x:0,y:0,wrap:X,fullyVisible:!1}),W=[],rt=[],ht=p,pt=e.reparseOverscaled?f:p;if(this._renderWorldCopies)for(let X=1;X<=3;X++)W.push(j(-X)),W.push(j(X));for(W.push(j(0));W.length>0;){const X=W.pop(),_t=X.x,ft=X.y;let Tt=X.fullyVisible;if(!Tt){const $t=X.aabb.intersects(O);if($t===0)continue;Tt=$t===2}const St=e.terrain?P:z,Mt=X.aabb.distanceX(St),bt=X.aabb.distanceY(St),Vt=Math.max(Math.abs(Mt),Math.abs(bt)),Rt=H+(1<<ht-X.zoom)-2;if(X.zoom===ht||Vt>Rt&&X.zoom>=Z){const $t=ht-X.zoom,de=P[0]-.5-(_t<<$t),ye=P[1]-.5-(ft<<$t);rt.push({tileID:new c.OverscaledTileID(X.zoom===ht?pt:X.zoom,X.wrap,X.zoom,_t,ft),distanceSq:c.sqrLen([z[0]-.5-_t,z[1]-.5-ft]),tileDistanceToCamera:Math.sqrt(de*de+ye*ye)})}else for(let $t=0;$t<4;$t++){const de=(_t<<1)+$t%2,ye=(ft<<1)+($t>>1),te=X.zoom+1;let Ve=X.aabb.quadrant($t);if(e.terrain){const Ge=new c.OverscaledTileID(te,X.wrap,te,de,ye),Le=e.terrain.getMinMaxElevation(Ge),ke=(s=Le.minElevation)!==null&&s!==void 0?s:this.elevation,qe=(a=Le.maxElevation)!==null&&a!==void 0?a:this.elevation;Ve=new hn([Ve.min[0],Ve.min[1],ke],[Ve.max[0],Ve.max[1],qe])}W.push({aabb:Ve,zoom:te,x:de,y:ye,wrap:X.wrap,fullyVisible:Tt})}}return rt.sort((X,_t)=>X.distanceSq-_t.distanceSq).map(X=>X.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=c.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new c.pointGeometry(c.mercatorXfromLng(e.lng)*this.worldSize,c.mercatorYfromLat(s)*this.worldSize)}unproject(e){return new c.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(e){this.freezeElevation||(this.elevation=e?this.getElevation(this._center,e):0)}getElevation(e,s){const a=c.MercatorCoordinate.fromLngLat(e),p=(1<<this.tileZoom)*c.EXTENT,f=a.x*p,y=a.y*p,T=Math.floor(f/c.EXTENT),I=Math.floor(y/c.EXTENT),P=new c.OverscaledTileID(this.tileZoom,0,this.tileZoom,T,I);return s.getElevation(P,f%c.EXTENT,y%c.EXTENT,c.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.pointLocation(this.centerPoint,e),a=this.getElevation(s,e);if(!(this.elevation-a))return;const p=this.getCameraPosition(),f=c.MercatorCoordinate.fromLngLat(p.lngLat,p.altitude),y=c.MercatorCoordinate.fromLngLat(s,a),T=f.x-y.x,I=f.y-y.y,P=f.z-y.z,z=Math.sqrt(T*T+I*I+P*P),O=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=a,this._center=s,this.zoom=O}setLocationAtPoint(e,s){const a=this.pointCoordinate(s),p=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),y=new c.MercatorCoordinate(f.x-(a.x-p.x),f.y-(a.y-p.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),this.getElevation(e,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return c.MercatorCoordinate.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const Z=s.pointCoordinate(e);if(Z!=null)return Z}const a=[e.x,e.y,0,1],p=[e.x,e.y,1,1];c.transformMat4(a,a,this.pixelMatrixInverse),c.transformMat4(p,p,this.pixelMatrixInverse);const f=a[3],y=p[3],T=a[1]/f,I=p[1]/y,P=a[2]/f,z=p[2]/y,O=P===z?0:(0-P)/(z-P);return new c.MercatorCoordinate(c.number(a[0]/f,p[0]/y,O)/this.worldSize,c.number(T,I,O)/this.worldSize)}coordinatePoint(e,s=0,a=this.pixelMatrix){const p=[e.x*this.worldSize,e.y*this.worldSize,s,1];return c.transformMat4(p,p,a),new c.pointGeometry(p[0]/p[3],p[1]/p[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new c.LngLatBounds().extend(this.pointLocation(new c.pointGeometry(0,e))).extend(this.pointLocation(new c.pointGeometry(this.width,e))).extend(this.pointLocation(new c.pointGeometry(this.width,this.height))).extend(this.pointLocation(new c.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new c.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(e,s=!1){const a=e.key,p=s?this._alignedPosMatrixCache:this._posMatrixCache;if(p[a])return p[a];const f=e.canonical,y=this.worldSize/this.zoomScale(f.z),T=f.x+Math.pow(2,f.z)*e.wrap,I=c.identity(new Float64Array(16));return c.translate(I,I,[T*y,f.y*y,0]),c.scale(I,I,[y/c.EXTENT,y/c.EXTENT,1]),c.multiply(I,s?this.alignedProjMatrix:this.projMatrix,I),p[a]=new Float32Array(I),p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e,s,a,p,f=-90,y=90,T=-180,I=180;const P=this.size,z=this._unmodified;if(this.latRange){const H=this.latRange;f=c.mercatorYfromLat(H[1])*this.worldSize,y=c.mercatorYfromLat(H[0])*this.worldSize,e=y-f<P.y?P.y/(y-f):0}if(this.lngRange){const H=this.lngRange;T=c.wrap(c.mercatorXfromLng(H[0])*this.worldSize,0,this.worldSize),I=c.wrap(c.mercatorXfromLng(H[1])*this.worldSize,0,this.worldSize),I<T&&(I+=this.worldSize),s=I-T<P.x?P.x/(I-T):0}const O=this.point,Z=Math.max(s||0,e||0);if(Z)return this.center=this.unproject(new c.pointGeometry(s?(I+T)/2:O.x,e?(y+f)/2:O.y)),this.zoom+=this.scaleZoom(Z),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const H=O.y,j=P.y/2;H-j<f&&(p=f+j),H+j>y&&(p=y-j)}if(this.lngRange){const H=(T+I)/2,j=c.wrap(O.x,H-this.worldSize/2,H+this.worldSize/2),W=P.x/2;j-W<T&&(a=T+W),j+W>I&&(a=I-W)}a===void 0&&p===void 0||(this.center=this.unproject(new c.pointGeometry(a!==void 0?a:O.x,p!==void 0?p:O.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let p=c.identity(new Float64Array(16));c.scale(p,p,[this.width/2,-this.height/2,1]),c.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=c.identity(new Float64Array(16)),c.scale(p,p,[1,-1,1]),c.translate(p,p,[-1,-1,0]),c.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const f=Math.PI/2+this._pitch,y=this._fov*(.5+e.y/this.height),T=Math.sin(y)*this.cameraToSeaLevelDistance/Math.sin(c.clamp(Math.PI-f-y,.01,Math.PI-.01)),I=this.getHorizon(),P=2*Math.atan(I/this.cameraToCenterDistance)*(.5+e.y/(2*I)),z=Math.sin(P)*this.cameraToSeaLevelDistance/Math.sin(c.clamp(Math.PI-f-P,.01,Math.PI-.01)),O=Math.cos(Math.PI/2-this._pitch)*T+this.cameraToSeaLevelDistance,Z=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,H=1.01*Math.min(O,Z),j=this.height/50;p=new Float64Array(16),c.perspective(p,this._fov,this.width/this.height,j,H),p[8]=2*-e.x/this.width,p[9]=2*e.y/this.height,c.scale(p,p,[1,-1,1]),c.translate(p,p,[0,0,-this.cameraToCenterDistance]),c.rotateX(p,p,this._pitch),c.rotateZ(p,p,this.angle),c.translate(p,p,[-s,-a,0]),this.mercatorMatrix=c.scale([],p,[this.worldSize,this.worldSize,this.worldSize]),c.scale(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,p),c.translate(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=c.invert([],p),this.pixelMatrix3D=c.multiply(new Float64Array(16),this.labelPlaneMatrix,p);const W=this.width%2/2,rt=this.height%2/2,ht=Math.cos(this.angle),pt=Math.sin(this.angle),X=s-Math.round(s)+ht*W+pt*rt,_t=a-Math.round(a)+ht*rt+pt*W,ft=new Float64Array(p);if(c.translate(ft,ft,[X>.5?X-1:X,_t>.5?_t-1:_t,0]),this.alignedProjMatrix=ft,p=c.invert(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.pointGeometry(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let a=s.x,p=s.y,f=s.x,y=s.y;for(const T of e)a=Math.min(a,T.x),p=Math.min(p,T.y),f=Math.max(f,T.x),y=Math.max(y,T.y);return[new c.pointGeometry(a,p),new c.pointGeometry(f,p),new c.pointGeometry(f,y),new c.pointGeometry(a,y),new c.pointGeometry(a,p)]}}}class pa{constructor(e){this._hashName=e&&encodeURIComponent(e),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,a){let p=!1,f=null;const y=()=>{f=null,p&&(s(),f=setTimeout(y,300),p=!1)};return()=>(p=!0,f||y(),f)}(this._updateHashUnthrottled.bind(this))}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const s=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,p=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,p),y=Math.round(s.lng*f)/f,T=Math.round(s.lat*f)/f,I=this._map.getBearing(),P=this._map.getPitch();let z="";if(z+=e?`/${y}/${T}/${a}`:`${a}/${T}/${y}`,(I||P)&&(z+="/"+Math.round(10*I)/10),P&&(z+=`/${Math.round(P)}`),this._hashName){const O=this._hashName;let Z=!1;const H=window.location.hash.slice(1).split("&").map(j=>{const W=j.split("=")[0];return W===O?(Z=!0,`${W}=${z}`):j}).filter(j=>j);return Z||H.push(`${O}=${z}`),`#${H.join("&")}`}return`#${z}`}_getCurrentHash(){const e=window.location.hash.replace("#","");if(this._hashName){let s;return e.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(s=a)}),(s&&s[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._getCurrentHash();if(e.length>=3&&!e.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:s,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch{}}}const cn={linearity:.3,easing:c.bezier(0,0,.3,1)},Vs=c.extend({deceleration:2500,maxSpeed:1400},cn),qo=c.extend({deceleration:20,maxSpeed:1400},cn),yo=c.extend({deceleration:1e3,maxSpeed:360},cn),hr=c.extend({deceleration:1e3,maxSpeed:90},cn);class vo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=c.exported.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const f=jn(s.pan.mag(),a,c.extend({},Vs,e||{}));p.offset=s.pan.mult(f.amount/s.pan.mag()),p.center=this._map.transform.center,Lr(p,f)}if(s.zoom){const f=jn(s.zoom,a,qo);p.zoom=this._map.transform.zoom+f.amount,Lr(p,f)}if(s.bearing){const f=jn(s.bearing,a,yo);p.bearing=this._map.transform.bearing+c.clamp(f.amount,-179,179),Lr(p,f)}if(s.pitch){const f=jn(s.pitch,a,hr);p.pitch=this._map.transform.pitch+f.amount,Lr(p,f)}if(p.zoom||p.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;p.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),c.extend(p,{noMoveStart:!0})}}function Lr(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function jn(h,e,s){const{maxSpeed:a,linearity:p,deceleration:f}=s,y=c.clamp(h*p/(e/1e3),-a,a),T=Math.abs(y)/(f*p);return{easing:s.easing,duration:1e3*T,amount:y*(T/2)}}class Li extends c.Event{constructor(e,s,a,p={}){const f=dt.mousePos(s.getCanvasContainer(),a),y=s.unproject(f);super(e,c.extend({point:f,lngLat:y,originalEvent:a},p)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Qr extends c.Event{constructor(e,s,a){const p=e==="touchend"?a.changedTouches:a.touches,f=dt.touchPos(s.getCanvasContainer(),p),y=f.map(I=>s.unproject(I)),T=f.reduce((I,P,z,O)=>I.add(P.div(O.length)),new c.pointGeometry(0,0));super(e,{points:f,point:T,lngLats:y,lngLat:s.unproject(T),originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ji extends c.Event{constructor(e,s,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ba{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ji(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Li(e.type,this._map,e))}mouseup(e){this._map.fire(new Li(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Li(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Li(e.type,this._map,e))}mouseover(e){this._map.fire(new Li(e.type,this._map,e))}mouseout(e){this._map.fire(new Li(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Qr(e.type,this._map,e))}touchmove(e){this._map.fire(new Qr(e.type,this._map,e))}touchend(e){this._map.fire(new Qr(e.type,this._map,e))}touchcancel(e){this._map.fire(new Qr(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Li(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Li(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class da{constructor(e,s){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(dt.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const a=s;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=a,this._box||(this._box=dt.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(p.x,a.x),y=Math.max(p.x,a.x),T=Math.min(p.y,a.y),I=Math.max(p.y,a.y);dt.setTransform(this._box,`translate(${f}px,${T}px)`),this._box.style.width=y-f+"px",this._box.style.height=I-T+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const a=this._startPos,p=s;if(this.reset(),dt.suppressClick(),a.x!==p.x||a.y!==p.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(a,p,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(dt.remove(this._box),this._box=null),dt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new c.Event(e,{originalEvent:s}))}}function Wn(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);const s={};for(let a=0;a<h.length;a++)s[h[a].identifier]=e[a];return s}class Gs{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(p){const f=new c.pointGeometry(0,0);for(const y of p)f._add(y);return f.div(p.length)}(s),this.touches=Wn(a,s)))}touchmove(e,s,a){if(this.aborted||!this.centroid)return;const p=Wn(a,s);for(const f in this.touches){const y=this.touches[f],T=p[f];(!T||T.dist(y)>30)&&(this.aborted=!0)}}touchend(e,s,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class xo{constructor(e){this.singleTap=new Gs(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,a){this.singleTap.touchstart(e,s,a)}touchmove(e,s,a){this.singleTap.touchmove(e,s,a)}touchend(e,s,a){const p=this.singleTap.touchend(e,s,a);if(p){const f=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(p)<30;if(f&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Ra{constructor(){this._zoomIn=new xo({numTouches:1,numTaps:2}),this._zoomOut=new xo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,a){this._zoomIn.touchstart(e,s,a),this._zoomOut.touchstart(e,s,a)}touchmove(e,s,a){this._zoomIn.touchmove(e,s,a),this._zoomOut.touchmove(e,s,a)}touchend(e,s,a){const p=this._zoomIn.touchend(e,s,a),f=this._zoomOut.touchend(e,s,a);return p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(p)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hn={0:1,2:2};class ts{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(e,s){return!1}_move(e,s){return{}}mousedown(e,s){if(this._lastPoint)return;const a=dt.mouseButton(e);this._correctButton(e,a)&&(this._lastPoint=s,this._eventButton=a)}mousemoveWindow(e,s){const a=this._lastPoint;if(a){if(e.preventDefault(),function(p,f){const y=Hn[f];return p.buttons===void 0||(p.buttons&y)!==y}(e,this._eventButton))this.reset();else if(this._moved||!(s.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(a,s)}}mouseupWindow(e){this._lastPoint&&dt.mouseButton(e)===this._eventButton&&(this._moved&&dt.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qs extends ts{mousedown(e,s){super.mousedown(e,s),this._lastPoint&&(this._active=!0)}_correctButton(e,s){return s===0&&!e.ctrlKey}_move(e,s){return{around:s,panDelta:s.sub(e)}}}class xn extends ts{_correctButton(e,s){return s===0&&e.ctrlKey||s===2}_move(e,s){const a=.8*(s.x-e.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(e){e.preventDefault()}}class qt extends ts{_correctButton(e,s){return s===0&&e.ctrlKey||s===2}_move(e,s){const a=-.5*(s.y-e.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(e){e.preventDefault()}}class $o{constructor(e,s){this._minTouches=e.cooperativeGestures?2:1,this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(e,s,a){return this._calculateTransform(e,s,a)}touchmove(e,s,a){if(this._map._cooperativeGestures&&(this._minTouches===2&&a.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(e,!1,a.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(a.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,s,a)}touchend(e,s,a){this._calculateTransform(e,s,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,a){a.length>0&&(this._active=!0);const p=Wn(a,s),f=new c.pointGeometry(0,0),y=new c.pointGeometry(0,0);let T=0;for(const P in p){const z=p[P],O=this._touches[P];O&&(f._add(z),y._add(z.sub(O)),T++,p[P]=z)}if(this._touches=p,T<this._minTouches||!y.mag())return;const I=y.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(T),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class es{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(e){}_move(e,s,a){return{}}touchstart(e,s,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,a){if(!this._firstTwoTouches)return;e.preventDefault();const[p,f]=this._firstTwoTouches,y=bn(a,s,p),T=bn(a,s,f);if(!y||!T)return;const I=this._aroundCenter?null:y.add(T).div(2);return this._move([y,T],I,e)}touchend(e,s,a){if(!this._firstTwoTouches)return;const[p,f]=this._firstTwoTouches,y=bn(a,s,p),T=bn(a,s,f);y&&T||(this._active&&dt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function bn(h,e,s){for(let a=0;a<h.length;a++)if(h[a].identifier===s)return e[a]}function jo(h,e){return Math.log(h/e)/Math.LN2}class Dt extends es{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(jo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jo(this._distance,a),pinchAround:s}}}function $s(h,e){return 180*h.angleWith(e)/Math.PI}class fa extends es{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s){const a=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$s(this._vector,a),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,a=$s(e,this._startVector);return Math.abs(a)<s}}function Wo(h){return Math.abs(h.y)>Math.abs(h.x)}class zn extends es{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,a){super.touchstart(e,s,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,Wo(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,a){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,f,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(p.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,a){if(this._valid!==void 0)return this._valid;const p=e.mag()>=2,f=s.mag()>=2;if(!p&&!f)return;if(!p||!f)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==s.y>0;return Wo(e)&&Wo(s)&&y}}const Ho={panStep:100,bearingStep:15,pitchStep:10};class Xo{constructor(){const e=Ho;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,a=0,p=0,f=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?p=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?p=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,p=0),{cameraAnimation:T=>{const I=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:js,zoom:s?Math.round(I)+s*(e.shiftKey?2:1):I,bearing:T.getBearing()+a*this._bearingStep,pitch:T.getPitch()+p*this._pitchStep,offset:[-f*this._panStep,-y*this._panStep],center:T.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function js(h){return h*(2-h)}const ma=4.000244140625;class bs{constructor(e,s){this._map=e,this._el=e.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;e.preventDefault()}let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=c.exported.now(),p=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,s!==0&&s%ma==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=dt.mousePos(this._el,e);this._around=c.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._map.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>ma?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&I!==0&&(I=1/I);const P=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(P*I))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,p=this._easing;let f,y=!1;if(this._type==="wheel"&&a&&p){const T=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),I=p(T);f=c.number(a,s,I),T<1?this._frameId||(this._frameId=!0):y=!0}else f=s,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=c.ease;if(this._prevEase){const a=this._prevEase,p=(c.exported.now()-a.start)/a.duration,f=a.easing(p+.01)-a.easing(p),y=.27/Math.sqrt(f*f+1e-4)*.01,T=Math.sqrt(.0729-y*y);s=c.bezier(y,T,.25,1)}return this._prevEase={start:c.exported.now(),duration:e,easing:s},s}reset(){this._active=!1}}class is{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bo{constructor(){this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(e.shiftKey?-1:1),around:a.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo{constructor(){this._tap=new xo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(e,s,a){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=s[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(e,s,a))}touchmove(e,s,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const p=s[0],f=p.y-this._swipePoint.y;return this._swipePoint=p,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,s,a)}touchend(e,s,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(e,s,a)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yi{constructor(e,s,a){this._el=e,this._mousePan=s,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cr{constructor(e,s,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ko{constructor(e,s,a,p){this._el=e,this._touchZoom=s,this._touchRotate=a,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ns=h=>h.zoom||h.drag||h.pitch||h.rotate;class To extends c.Event{}function ws(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class _a{constructor(e,s){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vo(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),c.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,f,y]of this._listeners)dt.addEventListener(p,f,p===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,s,a]of this._listeners)dt.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const s=this._map,a=s.getCanvasContainer();this._add("mapEvent",new Ba(s,e));const p=s.boxZoom=new da(s,e);this._add("boxZoom",p);const f=new Ra,y=new bo;s.doubleClickZoom=new is(y,f),this._add("tapZoom",f),this._add("clickZoom",y);const T=new wo;this._add("tapDragZoom",T);const I=s.touchPitch=new zn(s);this._add("touchPitch",I);const P=new xn(e),z=new qt(e);s.dragRotate=new cr(e,P,z),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const O=new qs(e),Z=new $o(e,s);s.dragPan=new Yi(a,O,Z),this._add("mousePan",O),this._add("touchPan",Z,["touchZoom","touchRotate"]);const H=new fa,j=new Dt;s.touchZoomRotate=new Ko(a,j,H,T),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]);const W=s.scrollZoom=new bs(s,this);this._add("scrollZoom",W,["mousePan"]);const rt=s.keyboard=new Xo;this._add("keyboard",rt),this._add("blockableMapEvent",new Mn(s));for(const ht of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[ht]&&s[ht].enable(e[ht])}_add(e,s,a){this._handlers.push({handlerName:e,handler:s,allowed:a}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(ns(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,s,a){for(const p in e)if(p!==a&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){const s=[];for(const a of e)this._el.contains(a.target)&&s.push(a);return s}handleEvent(e,s){if(e.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=e.type==="renderFrame"?void 0:e,p={needsRenderFrame:!1},f={},y={},T=e.touches,I=T?this._getMapTouches(T):void 0,P=I?dt.touchPos(this._el,I):dt.mousePos(this._el,e);for(const{handlerName:Z,handler:H,allowed:j}of this._handlers){if(!H.isEnabled())continue;let W;this._blockedByActive(y,j,Z)?H.reset():H[s||e.type]&&(W=H[s||e.type](e,P,I),this.mergeHandlerResult(p,f,W,Z,a),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||H.isActive())&&(y[Z]=H)}const z={};for(const Z in this._previousActiveHandlers)y[Z]||(z[Z]=a);this._previousActiveHandlers=y,(Object.keys(z).length||ws(p))&&(this._changes.push([p,f,z]),this._triggerRenderFrame()),(Object.keys(y).length||ws(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=p;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(e,s,a,p,f){if(!a)return;c.extend(e,a);const y={handlerName:p,originalEvent:a.originalEvent||f};a.zoomDelta!==void 0&&(s.zoom=y),a.panDelta!==void 0&&(s.drag=y),a.pitchDelta!==void 0&&(s.pitch=y),a.bearingDelta!==void 0&&(s.rotate=y)}_applyChanges(){const e={},s={},a={};for(const[p,f,y]of this._changes)p.panDelta&&(e.panDelta=(e.panDelta||new c.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(e.around=p.around),p.pinchAround!==void 0&&(e.pinchAround=p.pinchAround),p.noInertia&&(e.noInertia=p.noInertia),c.extend(s,f),c.extend(a,y);this._updateMapTransform(e,s,a),this._changes=[]}_updateMapTransform(e,s,a){const p=this._map,f=p.transform,y=p.style&&p.style.terrain;if(!(ws(e)||y&&this._drag))return this._fireEvents(s,a,!0);let{panDelta:T,zoomDelta:I,bearingDelta:P,pitchDelta:z,around:O,pinchAround:Z}=e;Z!==void 0&&(O=Z),p._stop(!0),O=O||p.transform.centerPoint;const H=f.pointLocation(T?O.sub(T):O);P&&(f.bearing+=P),z&&(f.pitch+=z),I&&(f.zoom+=I),y?s.drag&&!this._drag?(this._drag={center:f.centerPoint,lngLat:f.pointLocation(O),point:O,handlerName:s.drag.handlerName},p.fire(new c.Event("freezeElevation",{freeze:!0}))):this._drag&&a[this._drag.handlerName]?(p.fire(new c.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(f.center=f.pointLocation(f.centerPoint.sub(T))):f.setLocationAtPoint(H,O),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,a,!0)}_fireEvents(e,s,a){const p=ns(this._eventsInProgress),f=ns(e),y={};for(const z in e){const{originalEvent:O}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=O),this._eventsInProgress[z]=e[z]}!p&&f&&this._fireEvent("movestart",f.originalEvent);for(const z in y)this._fireEvent(z,y[z]);f&&this._fireEvent("move",f.originalEvent);for(const z in e){const{originalEvent:O}=e[z];this._fireEvent(z,O)}const T={};let I;for(const z in this._eventsInProgress){const{handlerName:O,originalEvent:Z}=this._eventsInProgress[z];this._handlersById[O].isActive()||(delete this._eventsInProgress[z],I=s[O]||Z,T[`${z}end`]=I)}for(const z in T)this._fireEvent(z,T[z]);const P=ns(this._eventsInProgress);if(a&&(p||f)&&!P){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;z?(O(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new c.Event("moveend",{originalEvent:I})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new c.Event(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new To("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const un={extend:(h,...e)=>c.extend(h,...e),run(h){h()},logToElement(h,e=!1,s="log"){const a=window.document.getElementById(s);a&&(e&&(a.innerHTML=""),a.innerHTML+=`<br>${h}`)}};class Qe extends c.Evented{constructor(e,s){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,a){return e=c.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,c.extend({offset:e},s),a)}panTo(e,s,a){return this.easeTo(c.extend({center:e},s),a)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,a){return this.easeTo(c.extend({zoom:e},s),a)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,a){return this.easeTo(c.extend({bearing:e},s),a)}resetNorth(e,s){return this.rotateTo(0,c.extend({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=c.LngLatBounds.convert(e);const a=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,s)}_cameraForBoxAndBearing(e,s,a,p){const f={top:0,bottom:0,right:0,left:0};if(typeof(p=c.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const ft=p.padding;p.padding={top:ft,bottom:ft,right:ft,left:ft}}p.padding=c.extend(f,p.padding);const y=this.transform,T=y.padding,I=y.project(c.LngLat.convert(e)),P=y.project(c.LngLat.convert(s)),z=I.rotate(-a*Math.PI/180),O=P.rotate(-a*Math.PI/180),Z=new c.pointGeometry(Math.max(z.x,O.x),Math.max(z.y,O.y)),H=new c.pointGeometry(Math.min(z.x,O.x),Math.min(z.y,O.y)),j=Z.sub(H),W=(y.width-(T.left+T.right+p.padding.left+p.padding.right))/j.x,rt=(y.height-(T.top+T.bottom+p.padding.top+p.padding.bottom))/j.y;if(rt<0||W<0)return void c.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ht=Math.min(y.scaleZoom(y.scale*Math.min(W,rt)),p.maxZoom),pt=c.pointGeometry.convert(p.offset),X=new c.pointGeometry((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(a*Math.PI/180),_t=pt.add(X).mult(y.scale/y.zoomScale(ht));return{center:y.unproject(I.add(P).div(2).sub(_t)),zoom:ht,bearing:a}}fitBounds(e,s,a){return this._fitInternal(this.cameraForBounds(e,s),s,a)}fitScreenCoordinates(e,s,a,p,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.pointGeometry.convert(e)),this.transform.pointLocation(c.pointGeometry.convert(s)),a,p),p,f)}_fitInternal(e,s,a){return e?(delete(s=c.extend(e,s)).padding,s.linear?this.easeTo(s,a):this.flyTo(s,a)):this}jumpTo(e,s){this.stop();const a=this.transform;let p=!1,f=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(p=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.LngLat.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(f=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this.fire(new c.Event("movestart",s)).fire(new c.Event("move",s)),p&&this.fire(new c.Event("zoomstart",s)).fire(new c.Event("zoom",s)).fire(new c.Event("zoomend",s)),f&&this.fire(new c.Event("rotatestart",s)).fire(new c.Event("rotate",s)).fire(new c.Event("rotateend",s)),y&&this.fire(new c.Event("pitchstart",s)).fire(new c.Event("pitch",s)).fire(new c.Event("pitchend",s)),this.fire(new c.Event("moveend",s))}calculateCameraOptionsFromTo(e,s,a,p=0){const f=c.MercatorCoordinate.fromLngLat(e,s),y=c.MercatorCoordinate.fromLngLat(a,p),T=y.x-f.x,I=y.y-f.y,P=y.z-f.z,z=Math.hypot(T,I,P);if(z===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(T,I),Z=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),H=180*Math.atan2(T,-I)/Math.PI;let j=180*Math.acos(O/z)/Math.PI;return j=P<0?90-j:90+j,{center:y.toLngLat(),zoom:Z,pitch:j,bearing:H}}easeTo(e,s){this._stop(!1,e.easeId),((e=c.extend({offset:[0,0],duration:500,easing:c.ease},e)).animate===!1||!e.essential&&c.exported.prefersReducedMotion)&&(e.duration=0);const a=this.transform,p=this.getZoom(),f=this.getBearing(),y=this.getPitch(),T=this.getPadding(),I="zoom"in e?+e.zoom:p,P="bearing"in e?this._normalizeBearing(e.bearing,f):f,z="pitch"in e?+e.pitch:y,O="padding"in e?e.padding:a.padding,Z=c.pointGeometry.convert(e.offset);let H=a.centerPoint.add(Z);const j=a.pointLocation(H),W=c.LngLat.convert(e.center||j);this._normalizeCenter(W);const rt=a.project(j),ht=a.project(W).sub(rt),pt=a.zoomScale(I-p);let X,_t;e.around&&(X=c.LngLat.convert(e.around),_t=a.locationPoint(X));const ft={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==p,this._rotating=this._rotating||f!==P,this._pitching=this._pitching||z!==y,this._padding=!a.isPaddingEqual(O),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,ft),this._ease(Tt=>{if(this._zooming&&(a.zoom=c.number(p,I,Tt)),this._rotating&&(a.bearing=c.number(f,P,Tt)),this._pitching&&(a.pitch=c.number(y,z,Tt)),this._padding&&(a.interpolatePadding(T,O,Tt),H=a.centerPoint.add(Z)),X)a.setLocationAtPoint(X,_t);else{const St=a.zoomScale(a.zoom-p),Mt=I>p?Math.min(2,pt):Math.max(.5,pt),bt=Math.pow(Mt,1-Tt),Vt=a.unproject(rt.add(ht.mult(Tt*bt)).mult(St));a.setLocationAtPoint(a.renderWorldCopies?Vt.wrap():Vt,H)}this._fireMoveEvents(s)},Tt=>{this._afterEase(s,Tt)},e),this}_prepareEase(e,s,a={}){this._moving=!0,this.fire(new c.Event("freezeElevation",{freeze:!0})),s||a.moving||this.fire(new c.Event("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.Event("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.Event("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new c.Event("move",e)),this._zooming&&this.fire(new c.Event("zoom",e)),this._rotating&&this.fire(new c.Event("rotate",e)),this._pitching&&this.fire(new c.Event("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new c.Event("freezeElevation",{freeze:!1}));const a=this._zooming,p=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.Event("zoomend",e)),p&&this.fire(new c.Event("rotateend",e)),f&&this.fire(new c.Event("pitchend",e)),this.fire(new c.Event("moveend",e))}flyTo(e,s){if(!e.essential&&c.exported.prefersReducedMotion){const te=c.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(te,s)}this.stop(),e=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},e);const a=this.transform,p=this.getZoom(),f=this.getBearing(),y=this.getPitch(),T=this.getPadding(),I="zoom"in e?c.clamp(+e.zoom,a.minZoom,a.maxZoom):p,P="bearing"in e?this._normalizeBearing(e.bearing,f):f,z="pitch"in e?+e.pitch:y,O="padding"in e?e.padding:a.padding,Z=a.zoomScale(I-p),H=c.pointGeometry.convert(e.offset);let j=a.centerPoint.add(H);const W=a.pointLocation(j),rt=c.LngLat.convert(e.center||W);this._normalizeCenter(rt);const ht=a.project(W),pt=a.project(rt).sub(ht);let X=e.curve;const _t=Math.max(a.width,a.height),ft=_t/Z,Tt=pt.mag();if("minZoom"in e){const te=c.clamp(Math.min(e.minZoom,p,I),a.minZoom,a.maxZoom),Ve=_t/a.zoomScale(te-p);X=Math.sqrt(Ve/Tt*2)}const St=X*X;function Mt(te){const Ve=(ft*ft-_t*_t+(te?-1:1)*St*St*Tt*Tt)/(2*(te?ft:_t)*St*Tt);return Math.log(Math.sqrt(Ve*Ve+1)-Ve)}function bt(te){return(Math.exp(te)-Math.exp(-te))/2}function Vt(te){return(Math.exp(te)+Math.exp(-te))/2}const Rt=Mt(0);let $t=function(te){return Vt(Rt)/Vt(Rt+X*te)},de=function(te){return _t*((Vt(Rt)*(bt(Ve=Rt+X*te)/Vt(Ve))-bt(Rt))/St)/Tt;var Ve},ye=(Mt(1)-Rt)/X;if(Math.abs(Tt)<1e-6||!isFinite(ye)){if(Math.abs(_t-ft)<1e-6)return this.easeTo(e,s);const te=ft<_t?-1:1;ye=Math.abs(Math.log(ft/_t))/X,de=function(){return 0},$t=function(Ve){return Math.exp(te*X*Ve)}}return e.duration="duration"in e?+e.duration:1e3*ye/("screenSpeed"in e?+e.screenSpeed/X:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==P,this._pitching=z!==y,this._padding=!a.isPaddingEqual(O),this._prepareEase(s,!1),this._ease(te=>{const Ve=te*ye,Ge=1/$t(Ve);a.zoom=te===1?I:p+a.scaleZoom(Ge),this._rotating&&(a.bearing=c.number(f,P,te)),this._pitching&&(a.pitch=c.number(y,z,te)),this._padding&&(a.interpolatePadding(T,O,te),j=a.centerPoint.add(H));const Le=te===1?rt:a.unproject(ht.add(pt.mult(de(Ve))).mult(Ge));a.setLocationAtPoint(a.renderWorldCopies?Le.wrap():Le,j),this._fireMoveEvents(s)},()=>this._afterEase(s),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const a=this._onEaseEnd;delete this._onEaseEnd,a.call(this,s)}if(!e){const a=this.handlers;a&&a.stop(!1)}return this}_ease(e,s,a){a.animate===!1||a.duration===0?(e(1),s()):(this._easeStart=c.exported.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,s){e=c.wrap(e,-180,180);const a=Math.abs(e-s);return Math.abs(e-360-s)<a&&(e-=360),Math.abs(e+360-s)<a&&(e+=360),e}_normalizeCenter(e){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const a=e.lng-s.center.lng;e.lng+=a>180?-360:a<-180?360:0}}class Ws{constructor(e={}){this.options=e,c.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options&&this.options.compact,this._container=dt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=dt.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=dt.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){dt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const a=this._map._getUIString(`AttributionControl.${s}`);e.title=a,e.setAttribute("aria-label",a)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"&&e.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const f=s[p];if(f.used||f.usedForTerrain){const y=f.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(p=>String(p).trim()),e.sort((p,f)=>p.length-f.length),e=e.filter((p,f)=>{for(let y=f+1;y<e.length;y++)if(e[y].indexOf(p)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class r{constructor(e={}){this.options=e,c.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=dt.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=dt.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){dt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const e=this._container.children;if(e.length){const s=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class l{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,a=s?this._queue.concat(s):this._queue;for(const p of a)if(p.id===e)return void(p.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const a of s)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const _={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},b={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},A={showCompass:!0,showZoom:!0,visualizePitch:!1};class N{constructor(e,s,a=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new xn({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,a&&(this.mousePitch=new qt({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),dt.addEventListener(s,"mousedown",this.mousedown),dt.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),dt.addEventListener(s,"touchmove",this.touchmove),dt.addEventListener(s,"touchend",this.touchend),dt.addEventListener(s,"touchcancel",this.reset)}down(e,s){this.mouseRotate.mousedown(e,s),this.mousePitch&&this.mousePitch.mousedown(e,s),dt.disableDrag()}move(e,s){const a=this.map,p=this.mouseRotate.mousemoveWindow(e,s);if(p&&p.bearingDelta&&a.setBearing(a.getBearing()+p.bearingDelta),this.mousePitch){const f=this.mousePitch.mousemoveWindow(e,s);f&&f.pitchDelta&&a.setPitch(a.getPitch()+f.pitchDelta)}}off(){const e=this.element;dt.removeEventListener(e,"mousedown",this.mousedown),dt.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),dt.removeEventListener(e,"touchmove",this.touchmove),dt.removeEventListener(e,"touchend",this.touchend),dt.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){dt.enableDrag(),dt.removeEventListener(window,"mousemove",this.mousemove),dt.removeEventListener(window,"mouseup",this.mouseup)}mousedown(e){this.down(c.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),dt.mousePos(this.element,e)),dt.addEventListener(window,"mousemove",this.mousemove),dt.addEventListener(window,"mouseup",this.mouseup)}mousemove(e){this.move(e,dt.mousePos(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=dt.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=dt.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function et(h,e,s){if(h=new c.LngLat(h.lng,h.lat),e){const a=new c.LngLat(h.lng-360,h.lat),p=new c.LngLat(h.lng+360,h.lat),f=s.locationPoint(h).distSqr(e);s.locationPoint(a).distSqr(e)<f?h=a:s.locationPoint(p).distSqr(e)<f&&(h=p)}for(;Math.abs(h.lng-s.center.lng)>180;){const a=s.locationPoint(h);if(a.x>=0&&a.y>=0&&a.x<=s.width&&a.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const nt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function lt(h,e,s){const a=h.classList;for(const p in nt)a.remove(`maplibregl-${s}-anchor-${p}`,`mapboxgl-${s}-anchor-${p}`);a.add(`maplibregl-${s}-anchor-${e}`,`mapboxgl-${s}-anchor-${e}`)}class Ct extends c.Evented{constructor(e,s){if(super(),(e instanceof HTMLElement||s)&&(e=c.extend({element:e},s)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,e&&e.element)this._element=e.element,this._offset=c.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=dt.create("div"),this._element.setAttribute("aria-label","Map marker");const a=dt.createNS("http://www.w3.org/2000/svg","svg"),p=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${p}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${p}`);const y=dt.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const T=dt.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const I=dt.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const pt of P){const X=dt.createNS("http://www.w3.org/2000/svg","ellipse");X.setAttributeNS(null,"opacity","0.04"),X.setAttributeNS(null,"cx","10.5"),X.setAttributeNS(null,"cy","5.80029008"),X.setAttributeNS(null,"rx",pt.rx),X.setAttributeNS(null,"ry",pt.ry),I.appendChild(X)}const z=dt.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const O=dt.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(O);const Z=dt.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const H=dt.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(H);const j=dt.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const W=dt.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const rt=dt.createNS("http://www.w3.org/2000/svg","circle");rt.setAttributeNS(null,"fill","#000000"),rt.setAttributeNS(null,"opacity","0.25"),rt.setAttributeNS(null,"cx","5.5"),rt.setAttributeNS(null,"cy","5.5"),rt.setAttributeNS(null,"r","5.4999962");const ht=dt.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#FFFFFF"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962"),W.appendChild(rt),W.appendChild(ht),T.appendChild(I),T.appendChild(z),T.appendChild(Z),T.appendChild(j),T.appendChild(W),a.appendChild(T),a.setAttributeNS(null,"height",p*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=c.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),lt(this._element,this._anchor,"marker"),this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),dt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(e){const s=e.code,a=e.charCode||e.keyCode;s!=="Space"&&s!=="Enter"&&a!==32&&a!==13||this.togglePopup()}_onMapClick(e){const s=e.originalEvent.target,a=this._element;this._popup&&(s===a||a.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}_update(e){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=et(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let a="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?a="rotateX(0deg)":this._pitchAlignment==="map"&&(a=`rotateX(${this._map.getPitch()}deg)`),e&&e.type!=="moveend"||(this._pos=this._pos.round()),dt.setTransform(this._element,`${nt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${a} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const p=this._map.unproject(this._pos),f=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=p.distanceTo(this._lngLat)>20*f?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(e){return this._offset=c.pointGeometry.convert(e),this._update(),this}_onMove(e){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Wt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let oe,ie=0,xi=!1;const ki={maxWidth:100,unit:"metric"};function Hs(h,e,s){const a=s&&s.maxWidth||100,p=h._container.clientHeight/2,f=h.unproject([0,p]),y=h.unproject([a,p]),T=f.distanceTo(y);if(s&&s.unit==="imperial"){const I=3.2808*T;I>5280?$i(e,a,I/5280,h._getUIString("ScaleControl.Miles")):$i(e,a,I,h._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?$i(e,a,T/1852,h._getUIString("ScaleControl.NauticalMiles")):T>=1e3?$i(e,a,T/1e3,h._getUIString("ScaleControl.Kilometers")):$i(e,a,T,h._getUIString("ScaleControl.Meters"))}function $i(h,e,s,a){const p=function(f){const y=Math.pow(10,`${Math.floor(f)}`.length-1);let T=f/y;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){const P=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*P)/P}(T),y*T}(s);h.style.width=e*(p/s)+"px",h.innerHTML=`${p}&nbsp;${a}`}const ti={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jo(h){if(h){if(typeof h=="number"){const e=Math.round(Math.sqrt(.5*Math.pow(h,2)));return{center:new c.pointGeometry(0,0),top:new c.pointGeometry(0,h),"top-left":new c.pointGeometry(e,e),"top-right":new c.pointGeometry(-e,e),bottom:new c.pointGeometry(0,-h),"bottom-left":new c.pointGeometry(e,-e),"bottom-right":new c.pointGeometry(-e,-e),left:new c.pointGeometry(h,0),right:new c.pointGeometry(-h,0)}}if(h instanceof c.pointGeometry||Array.isArray(h)){const e=c.pointGeometry.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.pointGeometry.convert(h.center||[0,0]),top:c.pointGeometry.convert(h.top||[0,0]),"top-left":c.pointGeometry.convert(h["top-left"]||[0,0]),"top-right":c.pointGeometry.convert(h["top-right"]||[0,0]),bottom:c.pointGeometry.convert(h.bottom||[0,0]),"bottom-left":c.pointGeometry.convert(h["bottom-left"]||[0,0]),"bottom-right":c.pointGeometry.convert(h["bottom-right"]||[0,0]),left:c.pointGeometry.convert(h.left||[0,0]),right:c.pointGeometry.convert(h.right||[0,0])}}return Jo(new c.pointGeometry(0,0))}const rs={supported:Pt,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends Qe{constructor(h){var e;if(c.PerformanceUtils.mark(c.PerformanceMarkers.create),(h=c.extend({},b,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new $n(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new l,this._controls=[],this._mapId=c.uniqueId(),this._locale=c.extend({},_,h.locale),this._clickTolerance=h.clickTolerance,this._pixelRatio=(e=h.pixelRatio)!==null&&e!==void 0?e:devicePixelRatio,this._requestManager=new ci(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new _a(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new pa(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Ws({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new r,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new c.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new c.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new c.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(s,a.firstChild):a.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,s,a){return a==null&&this.style.terrain&&(a=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(h,e,s,a)}resize(h){const e=this._containerDimensions(),s=e[0],a=e[1];this._resizeCanvas(s,a,this.getPixelRatio()),this.transform.resize(s,a),this.painter.resize(s,a,this.getPixelRatio());const p=!this._moving;return p&&(this.stop(),this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h))),this.fire(new c.Event("resize",h)),p&&this.fire(new c.Event("moveend",h)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(h){const[e,s]=this._containerDimensions();this._pixelRatio=h,this._resizeCanvas(e,s,h),this.painter.resize(e,s,h)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(c.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h==null?60:h)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(c.LngLat.convert(h),this.style&&this.style.terrain)}unproject(h){return this.transform.pointLocation(c.pointGeometry.convert(h),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(h,e,s){if(h==="mouseenter"||h==="mouseover"){let a=!1;return{layer:e,listener:s,delegates:{mousemove:f=>{const y=this.getLayer(e)?this.queryRenderedFeatures(f.point,{layers:[e]}):[];y.length?a||(a=!0,s.call(this,new Li(h,this,f.originalEvent,{features:y}))):a=!1},mouseout:()=>{a=!1}}}}if(h==="mouseleave"||h==="mouseout"){let a=!1;return{layer:e,listener:s,delegates:{mousemove:y=>{(this.getLayer(e)?this.queryRenderedFeatures(y.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,s.call(this,new Li(h,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,s.call(this,new Li(h,this,y.originalEvent)))}}}}{const a=p=>{const f=this.getLayer(e)?this.queryRenderedFeatures(p.point,{layers:[e]}):[];f.length&&(p.features=f,s.call(this,p),delete p.features)};return{layer:e,listener:s,delegates:{[h]:a}}}}on(h,e,s){if(s===void 0)return super.on(h,e);const a=this._createDelegatedListener(h,e,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(a);for(const p in a.delegates)this.on(p,a.delegates[p]);return this}once(h,e,s){if(s===void 0)return super.once(h,e);const a=this._createDelegatedListener(h,e,s);for(const p in a.delegates)this.once(p,a.delegates[p]);return this}off(h,e,s){return s===void 0?super.off(h,e):(this._delegatedListeners&&this._delegatedListeners[h]&&(a=>{const p=this._delegatedListeners[h];for(let f=0;f<p.length;f++){const y=p[f];if(y.layer===e&&y.listener===s){for(const T in y.delegates)this.off(T,y.delegates[T]);return p.splice(f,1),this}}})(),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let s;if(e!==void 0||h===void 0||h instanceof c.pointGeometry||Array.isArray(h)||(e=h,h=void 0),e=e||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof c.pointGeometry||typeof h[0]=="number")s=[c.pointGeometry.convert(h)];else{const a=c.pointGeometry.convert(h[0]),p=c.pointGeometry.convert(h[1]);s=[a,new c.pointGeometry(p.x,a.y),p,new c.pointGeometry(a.x,p.y),a]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new fi(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new fi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){const s=this._requestManager.transformRequest(h,c.ResourceType.Style);c.getJSON(s,(a,p)=>{a?this.fire(new c.ErrorEvent(a)):p&&this._updateDiff(p,e)})}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h)&&this._update(!0)}catch(s){c.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.warnOnce("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){const e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){return this.style.setTerrain(h),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const e in h){const s=h[e]._tiles;for(const a in s){const p=s[a];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(h,e,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,e,s)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,e,{pixelRatio:s=1,sdf:a=!1,stretchX:p,stretchY:f,content:y}={}){if(this._lazyInitEmptyStyle(),e instanceof HTMLImageElement||c.isImageBitmap(e)){const{width:T,height:I,data:P}=c.exported.getImageData(e);this.style.addImage(h,{data:new c.RGBAImage({width:T,height:I},P),pixelRatio:s,stretchX:p,stretchY:f,content:y,sdf:a,version:0})}else{if(e.width===void 0||e.height===void 0)return this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:I,data:P}=e,z=e;this.style.addImage(h,{data:new c.RGBAImage({width:T,height:I},new Uint8Array(P)),pixelRatio:s,stretchX:p,stretchY:f,content:y,sdf:a,version:0,userImage:z}),z.onAdd&&z.onAdd(this,h)}}}updateImage(h,e){const s=this.style.getImage(h);if(!s)return this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.isImageBitmap(e)?c.exported.getImageData(e):e,{width:p,height:f,data:y}=a;if(p===void 0||f===void 0)return this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||f!==s.data.height)return this.fire(new c.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||c.isImageBitmap(e));s.data.replace(y,T),this.style.updateImage(h,s)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,e){c.getImage(this._requestManager.transformRequest(h,c.ResourceType.Image),e)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,e,s){return this.style.setLayerZoomRange(h,e,s),this._update(!0)}setFilter(h,e,s={}){return this.style.setFilter(h,e,s),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,s,a={}){return this.style.setPaintProperty(h,e,s,a),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,s,a={}){return this.style.setLayoutProperty(h,e,s,a),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map","mapboxgl-map");const e=this._canvasContainer=dt.create("div","maplibregl-canvas-container mapboxgl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=dt.create("canvas","maplibregl-canvas mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const a=this._controlContainer=dt.create("div","maplibregl-control-container mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{p[f]=dt.create("div",`maplibregl-ctrl-${f} mapboxgl-ctrl-${f}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const h=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=dt.create("div","maplibregl-cooperative-gesture-screen",h);let e="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",e="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",a=>{a.key===e&&(this._metaPress=!0)}),document.addEventListener("keyup",a=>{a.key===e&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",a=>{this._onCooperativeGesture(a,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(h,e,s){this._canvas.width=s*h,this._canvas.height=s*e,this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const h=c.extend({},Pt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);e?(this.painter=new Zs(e,this.transform),c.exported$1.testSupport(e)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(h,e,s){return!e&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let e,s=0;const a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(e=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,e),s=c.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,T=c.exported.now();this.style.zoomHistory.update(y,T);const I=new c.EvaluationParameters(y,{now:T,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=I.crossFadingFactor();P===1&&P===this._crossFadingFactor||(p=!0,this._crossFadingFactor=P),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.PerformanceUtils.mark(c.PerformanceMarkers.load),this.fire(new c.Event("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const y=c.exported.now()-s;a.endQueryEXT(a.TIME_ELAPSED_EXT,e),setTimeout(()=>{const T=a.getQueryObjectEXT(e,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(e),this.fire(new c.Event("gpu-timing-frame",{cpuTime:y,gpuTime:T}))},50)}if(this.listens("gpu-timing-layer")){const y=this.painter.collectGpuTimers();setTimeout(()=>{const T=this.painter.queryGpuTimers(y);this.fire(new c.Event("gpu-timing-layer",{layerTimes:T}))},50)}const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,c.PerformanceUtils.mark(c.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),dt.remove(this._canvasContainer),dt.remove(this._controlContainer),this._cooperativeGestures&&dt.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),c.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=c.exported.frame(h=>{c.PerformanceUtils.frame(h),this._frame=null,this._render(h)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,e){c.setCacheLimits(h,e)}get version(){return"2.4.0"}},NavigationControl:class{constructor(h){this.options=c.extend({},A,h),this._container=dt.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),dt.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),dt.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=dt.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map.getZoom(),e=h===this._map.getMaxZoom(),s=h===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new N(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){dt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){const s=dt.create("button",h,this._container);return s.type="button",s.addEventListener("click",e),s}_setButtonTitle(h,e){const s=this._map._getUIString(`NavigationControl.${e}`);h.title=s,h.setAttribute("aria-label",s)}},GeolocateControl:class extends c.Evented{constructor(h){super(),this.options=c.extend({},Wt,h),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(h){var e;return this._map=h,this._container=dt.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),e=this._setupUI,oe!==void 0?e(oe):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{oe=s.state!=="denied",e(oe)}):(oe=!!window.navigator.geolocation,e(oe)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),dt.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ie=0,xi=!1}_isOutOfMapMaxBounds(h){const e=this._map.getMaxBounds(),s=h.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",h)),this._finish()}}_updateCamera(h){const e=new c.LngLat(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,a=this._map.getBearing(),p=c.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(s),p,{geolocateSource:!0})}_updateMarker(h){if(h){const e=new c.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.clientHeight/2,e=this._map.unproject([0,h]),s=this._map.unproject([1,h]),a=e.distanceTo(s),p=Math.ceil(2*this._accuracy/a);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&xi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=dt.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),dt.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=dt.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Ct(this._dotElement),this._circleElement=dt.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ct({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ie--,xi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ie++,ie>1?(h={maximumAge:6e5,timeout:0},xi=!0):(h=this.options.positionOptions,xi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ws,LogoControl:r,ScaleControl:class{constructor(h){this.options=c.extend({},ki,h),c.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Hs(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=dt.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){dt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,Hs(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=dt.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){dt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=dt.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);dt.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(h){this.options=h,c.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(h){return this._map=h,this._container=dt.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=dt.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),dt.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){dt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends c.Evented{constructor(h){super(),this.options=c.extend(Object.create(ti),h),c.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&dt.remove(this._content),this._container&&(dt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=c.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const e=document.createDocumentFragment(),s=document.createElement("body");let a;for(s.innerHTML=h;a=s.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=dt.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=dt.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_update(h){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=dt.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=dt.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(f=>this._container.classList.add(f)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=et(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h))return;const e=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat);let s=this.options.anchor;const a=Jo(this.options.offset);if(!s){const f=this._container.offsetWidth,y=this._container.offsetHeight;let T;T=e.y+a.bottom.y<y?["top"]:e.y>this._map.transform.height-y?["bottom"]:[],e.x<f/2?T.push("left"):e.x>this._map.transform.width-f/2&&T.push("right"),s=T.length===0?"bottom":T.join("-")}const p=e.add(a[s]).round();dt.setTransform(this._container,`${nt[s]} translate(${p.x}px,${p.y}px)`),lt(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(mi);h&&h.focus()}_onClose(){this.remove()}},Marker:Ct,Style:fi,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,Evented:c.Evented,AJAXError:c.AJAXError,config:c.config,CanvasSource:Ze,GeoJSONSource:sn,ImageSource:gn,RasterDEMTileSource:Yt,RasterTileSource:Ci,VectorTileSource:us,VideoSource:re,prewarm:function(){Zr().acquire(on)},clearPrewarmedResources:function(){const h=Qn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(on),Qn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Vi.workerCount},set workerCount(h){Vi.workerCount=h},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){c.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){c.clearTileCache(h)},workerUrl:"",addProtocol(h,e){c.config.REGISTERED_PROTOCOLS[h]=e},removeProtocol(h){delete c.config.REGISTERED_PROTOCOLS[h]}};return un.extend(rs,{isSafari:c.isSafari,getPerformanceMetrics:c.PerformanceUtils.getPerformanceMetrics}),rs});var ot=R;return ot})})(Ju);const xu=Ju.exports;var kf=yt.exports.Layer.extend({options:{updateInterval:32,padding:.1,interactive:!1,pane:"tilePane"},initialize:function(g){yt.exports.setOptions(this,g),this._throttledUpdate=yt.exports.Util.throttle(this._update,this.options.updateInterval,this)},onAdd:function(g){this._container||this._initContainer();var x=this.getPaneName();g.getPane(x).appendChild(this._container),this._initGL(),this._offset=this._map.containerPointToLayerPoint([0,0]),g.options.zoomAnimation&&yt.exports.DomEvent.on(g._proxy,yt.exports.DomUtil.TRANSITION_END,this._transitionEnd,this)},onRemove:function(g){this._map._proxy&&this._map.options.zoomAnimation&&yt.exports.DomEvent.off(this._map._proxy,yt.exports.DomUtil.TRANSITION_END,this._transitionEnd,this);var x=this.getPaneName();g.getPane(x).removeChild(this._container),this._glMap.remove(),this._glMap=null},getEvents:function(){return{move:this._throttledUpdate,zoomanim:this._animateZoom,zoom:this._pinchZoom,zoomstart:this._zoomStart,zoomend:this._zoomEnd,resize:this._resize}},getMaplibreMap:function(){return this._glMap},getCanvas:function(){return this._glMap.getCanvas()},getSize:function(){return this._map.getSize().multiplyBy(1+this.options.padding*2)},getOpacity:function(){return this.options.opacity},setOpacity:function(g){this.options.opacity=g,this._container.style.opacity=g},getBounds:function(){var g=this.getSize().multiplyBy(.5),x=this._map.latLngToContainerPoint(this._map.getCenter());return yt.exports.latLngBounds(this._map.containerPointToLatLng(x.subtract(g)),this._map.containerPointToLatLng(x.add(g)))},getContainer:function(){return this._container},getPaneName:function(){return this._map.getPane(this.options.pane)?this.options.pane:"tilePane"},_initContainer:function(){var g=this._container=yt.exports.DomUtil.create("div","leaflet-gl-layer"),x=this.getSize(),S=this._map.getSize().multiplyBy(this.options.padding);g.style.width=x.x+"px",g.style.height=x.y+"px";var k=this._map.containerPointToLayerPoint([0,0]).subtract(S);yt.exports.DomUtil.setPosition(g,k)},_initGL:function(){var g=this._map.getCenter(),x=yt.exports.extend({},this.options,{container:this._container,center:[g.lng,g.lat],zoom:this._map.getZoom()-1,attributionControl:!1});this._glMap=new xu.Map(x),this._glMap.once("styledata",function(k){this.fire("styleLoaded")}.bind(this)),this._glMap.transform.latRange=null,this._glMap.transform.maxValidLatitude=1/0,this._transformGL(this._glMap),this._glMap._canvas.canvas?this._glMap._actualCanvas=this._glMap._canvas.canvas:this._glMap._actualCanvas=this._glMap._canvas;var S=this._glMap._actualCanvas;yt.exports.DomUtil.addClass(S,"leaflet-image-layer"),yt.exports.DomUtil.addClass(S,"leaflet-zoom-animated"),this.options.interactive&&yt.exports.DomUtil.addClass(S,"leaflet-interactive"),this.options.className&&yt.exports.DomUtil.addClass(S,this.options.className)},_update:function(g){if(this._offset=this._map.containerPointToLayerPoint([0,0]),!this._zooming){var x=this.getSize(),S=this._container,k=this._glMap,R=this._map.getSize().multiplyBy(this.options.padding),Y=this._map.containerPointToLayerPoint([0,0]).subtract(R);yt.exports.DomUtil.setPosition(S,Y),this._transformGL(k),k.transform.width!==x.x||k.transform.height!==x.y?(S.style.width=x.x+"px",S.style.height=x.y+"px",k._resize!==null&&k._resize!==void 0?k._resize():k.resize()):k._update!==null&&k._update!==void 0?k._update():k.update()}},_transformGL:function(g){var x=this._map.getCenter(),S=g.transform;S.center=xu.LngLat.convert([x.lng,x.lat]),S.zoom=this._map.getZoom()-1},_pinchZoom:function(g){this._glMap.jumpTo({zoom:this._map.getZoom()-1,center:this._map.getCenter()})},_animateZoom:function(g){var x=this._map.getZoomScale(g.zoom),S=this._map.getSize().multiplyBy(this.options.padding*x),k=this.getSize()._divideBy(2),R=this._map.project(g.center,g.zoom)._subtract(k)._add(this._map._getMapPanePos().add(S))._round(),Y=this._map.project(this._map.getBounds().getNorthWest(),g.zoom)._subtract(R);yt.exports.DomUtil.setTransform(this._glMap._actualCanvas,Y.subtract(this._offset),x)},_zoomStart:function(g){this._zooming=!0},_zoomEnd:function(){var g=this._map.getZoomScale(this._map.getZoom());yt.exports.DomUtil.setTransform(this._glMap._actualCanvas,null,g),this._zooming=!1,this._update()},_transitionEnd:function(g){yt.exports.Util.requestAnimFrame(function(){var x=this._map.getZoom(),S=this._map.getCenter(),k=this._map.latLngToContainerPoint(this._map.getBounds().getNorthWest());yt.exports.DomUtil.setTransform(this._glMap._actualCanvas,k,1),this._glMap.once("moveend",yt.exports.Util.bind(function(){this._zoomEnd()},this)),this._glMap.jumpTo({center:S,zoom:x-1})},this)}});function Qu(g){return new kf(g)}var Df=yt.exports.Layer.extend({options:{key:"ArcGIS:Streets"},initialize:function(g,x){if(x&&yt.exports.setOptions(this,x),this.options.apiKey&&(this.options.apikey=this.options.apiKey),this.options.token&&(this.options.apikey=this.options.token),!(this.options.apikey||this.options.token))throw new Error("API Key or token is required for vectorBasemapLayer.");g&&(this.options.key=g),this._createLayer()},_createLayer:function(){var g=Ef(this.options.key,this.options.apikey);this._maplibreGL=Qu({style:g,pane:this.options.pane,opacity:this.options.opacity}),this._ready=!0,this.fire("ready",{},!0),this._maplibreGL.on("styleLoaded",function(x){this._setupAttribution()}.bind(this))},_setupAttribution:function(){var g=this._map;if(nl.setEsriAttribution(g),this.options.key.length===32){var x=this._maplibreGL.getMaplibreMap().style.stylesheet.sources,S=[];Object.keys(x).forEach(function(k){S.push(x[k].attribution),x[k].copyrightText&&x[k].copyrightText&&x[k].copyrightText!==""&&x[k].attribution!==x[k].copyrightText&&S.push(x[k].copyrightText)}),g.attributionControl.addAttribution('<span class="">'+S.join(", ")+"</span>")}else if(this.options.attributionUrls||(this.options.attributionUrls=this._getAttributionUrls(this.options.key)),this._map&&this.options.attributionUrls){if(this._map.attributionControl){for(let k=0;k<this.options.attributionUrls.length;k++){const R=this.options.attributionUrls[k];Mf(R,g)}g.attributionControl.addAttribution('<span class="esri-dynamic-attribution"></span>')}nl._updateMapAttribution({target:this._map})}},_getAttributionUrls:function(g){return g.indexOf("OSM:")===0?["https://static.arcgis.com/attribution/Vector/OpenStreetMap_v2"]:g.indexOf("ArcGIS:Imagery")===0?["https://static.arcgis.com/attribution/World_Imagery","https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]:["https://static.arcgis.com/attribution/Vector/World_Basemap_v2"]},onAdd:function(g){this._map=g,this._initPane(),this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},_initPane:function(){if(this.options.pane||(this.options.key.indexOf(":Labels")>-1?this.options.pane="esri-labels":this.options.pane="tilePane"),!this._map.getPane(this.options.pane)){var g=this._map.createPane(this.options.pane);g.style.pointerEvents="none",g.style.zIndex=this.options.pane==="esri-labels"?550:500}},onRemove:function(g){if(g.off("moveend",nl._updateMapAttribution),g.removeLayer(this._maplibreGL),g.attributionControl){var x=document.getElementsByClassName("esri-dynamic-attribution");if(x&&x.length>0){var S=x[0].outerHTML;g.attributionControl.removeAttribution(S)}}},_asyncAdd:function(){var g=this._map;g.on("moveend",nl._updateMapAttribution),this._maplibreGL.addTo(g,this)}});function Bf(g,x){return new Df(g,x)}yt.exports.Layer.extend({options:{pane:"overlayPane",portalUrl:"https://www.arcgis.com"},initialize:function(g,x){if(x&&yt.exports.setOptions(this,x),this.options.apiKey&&(this.options.apikey=this.options.apiKey),this.options.apikey&&(this.options.token=this.options.apikey),!g)throw new Error("An ITEM ID or SERVICE URL is required for vectorTileLayer.");g&&(this.options.key=g),this._createLayer()},_createLayer:function(){Pf(this.options.key,this.options,function(g,x,S,k){if(g)throw new Error(g);if(Lf(k.tileInfo.spatialReference.wkid)||console.warn('This layer is not guaranteed to display properly because its service does not use the Web Mercator projection. The "tileInfo.spatialReference" property is:',k.tileInfo.spatialReference,`
More information is available at https://github.com/maplibre/maplibre-gl-js/issues/168 and https://github.com/Esri/esri-leaflet-vector/issues/94.`),x=Cf(x,S,k,this.options.token),!this.getAttribution()){var R=Object.keys(x.sources);this.options.attribution=x.sources[R[R.length-1]].attribution,this._map&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution())}this.options.style&&typeof this.options.style=="function"&&(x=this.options.style(x)),this._maplibreGL=Qu({style:x,pane:this.options.pane,opacity:this.options.opacity}),this._ready=!0,this.fire("ready",{},!0)}.bind(this))},onAdd:function(g){this._map=g,this._ready?this._asyncAdd():this.once("ready",function(){this._asyncAdd()},this)},onRemove:function(g){g.removeLayer(this._maplibreGL)},_asyncAdd:function(){var g=this._map;this._maplibreGL.addTo(g,this)}});const Rf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",Of="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC";function Ff(g){let x,S,k;return{c(){x=Iu("div"),Eu(x,"class","svelte-1aboi1f")},m(R,Y){Su(R,x,Y),S||(k=Gd(g[0].call(null,x)),S=!0)},p:ra,i:ra,o:ra,d(R){R&&Rh(x),S=!1,k()}}}function Uf(g){const x="AAPK5f7db353b9a24f2e98c150e6eae03806djhOVrLffVWgu4cP9isr934iNjV7bAWI9z3eWZUQcyu9ADnErqcwxD6abFH43tPy";return[k=>{let R=new yt.exports.Icon({iconUrl:Rf,shadowUrl:Of,iconAnchor:[12,41],popupAnchor:[0,-41]});yt.exports.Marker.prototype.options.icon=R;const Y=new yt.exports.Map(k);Y.setView([25.773924,-80.196075],6),Bf("ArcGIS:Streets",{apiKey:x}).addTo(Y),new If({url:"https://sampleserver6.arcgisonline.com/arcgis/rest/services/SampleWorldCities/MapServer/0"}).addTo(Y).bindPopup(function(c){return`<p><strong>${c.feature.properties.CITY_NAME}</strong><br /> Population: ${c.feature.properties.POP.toLocaleString("en")}</p>`})}]}class Nf extends Lu{constructor(x){super(),zu(this,x,Uf,Ff,Tu,{})}}function Zf(g){let x,S,k;return S=new Nf({}),{c(){x=Iu("main"),Kd(S.$$.fragment),Eu(x,"class","svelte-1lux779")},m(R,Y){Su(R,x,Y),Cu(S,x,null),k=!0},p:ra,i(R){k||(Au(S.$$.fragment,R),k=!0)},o(R){Xd(S.$$.fragment,R),k=!1},d(R){R&&Rh(x),Mu(S)}}}class Vf extends Lu{constructor(x){super(),zu(this,x,null,Zf,Tu,{})}}new Vf({target:document.getElementById("app")});
